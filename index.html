<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>Tài liệu tổng quan luồng phân phối</title><link rel="icon" type="image/svg+xml" href="favicon.svg"/><style>


/* ===== EMERGENCY LAYOUT FIX ===== */
/* Force proper box-sizing globally */
*, *::before, *::after {
    box-sizing: border-box !important;
}

/* Fix viewport overflow */
html {
    width: 100% !important;
    max-width: 100vw !important;
    overflow-x: hidden !important;
    margin: 0 !important;
    padding: 0 !important;
}

body {
    width: 100% !important;
    max-width: 100vw !important;
    overflow-x: hidden !important;
    margin: 0 !important;
    padding: 0 !important;
    background: #F8FFF9 !important; /* Light green tint */
}

/* Override Notion's default max-width */
@media only screen {
    body {
        margin: 0 !important;
        max-width: 100vw !important;
        width: 100% !important;
    }
}

/* Fix main containers */
.page, .page.sans, article {
    width: 100% !important;
    max-width: 100% !important;
    margin: 0 !important;
    padding: 0 !important;
}

/* Fix page body */
.page-body {
    width: 100% !important;
    max-width: 100% !important;
    margin: 0 auto !important;
    padding: 2rem clamp(1rem, 5vw, 3rem) !important;
}


/* cspell:disable-file */
/* webkit printing magic: print all background colors */
html {
	-webkit-print-color-adjust: exact;
}
* {
	box-sizing: border-box;
	-webkit-print-color-adjust: exact;
}

html,
body {
	margin: 0;
	padding: 0;
}
@media only screen {
	body {
		margin: 2em auto;
		max-width: 900px;
		color: rgb(55, 53, 47);
	}
}

body {
	line-height: 1.5;
	white-space: pre-wrap;
}

a,
a.visited {
	color: inherit;
	text-decoration: underline;
}

.pdf-relative-link-path {
	font-size: 80%;
	color: #444;
}

h1,
h2,
h3 {
	letter-spacing: -0.01em;
	line-height: 1.2;
	font-weight: 600;
	margin-bottom: 0;
}

/* Override strong tags inside headings to maintain consistent weight */
h1 strong,
h2 strong,
h3 strong {
	font-weight: 600;
}

.page-title {
	font-size: 2.5rem;
	font-weight: 700;
	margin-top: 0;
	margin-bottom: 0.75em;
}

h1 {
	font-size: 1.875rem;
	margin-top: 1.875rem;
}

h2 {
	font-size: 1.5rem;
	margin-top: 1.5rem;
}

h3 {
	font-size: 1.25rem;
	margin-top: 1.25rem;
}

.source {
	border: 1px solid #ddd;
	border-radius: 3px;
	padding: 1.5em;
	word-break: break-all;
}

.callout {
	border-radius: 10px;
	padding: 1rem;
}

figure {
	margin: 1.25em 0;
	page-break-inside: avoid;
}

figcaption {
	opacity: 0.5;
	font-size: 85%;
	margin-top: 0.5em;
}

/* Hide image/video placeholder code blocks from Notion export */
.column-list .column p code {
	display: none;
}

mark {
	background-color: transparent;
}

.indented {
	padding-left: 1.5em;
}

hr {
	background: transparent;
	display: block;
	width: 100%;
	height: 1px;
	visibility: visible;
	border: none;
	border-bottom: 1px solid rgba(55, 53, 47, 0.09);
}

img {
	max-width: 100%;
}

@media only print {
	img {
		max-height: 100vh;
		object-fit: contain;
	}
}

@page {
	margin: 1in;
}

.collection-content {
	font-size: 0.875rem;
}

.collection-content td {
	white-space: pre-wrap;
	word-break: break-word;
}

.column-list {
	display: flex;
	justify-content: space-between;
}

.column {
	padding: 0 1em;
}

.column:first-child {
	padding-left: 0;
}

.column:last-child {
	padding-right: 0;
}

.table_of_contents-item {
	display: block;
	font-size: 0.875rem;
	line-height: 1.3;
	padding: 0.125rem;
}

.table_of_contents-indent-1 {
	margin-left: 1.5rem;
}

.table_of_contents-indent-2 {
	margin-left: 3rem;
}

.table_of_contents-indent-3 {
	margin-left: 4.5rem;
}

.table_of_contents-link {
	text-decoration: none;
	opacity: 0.7;
	border-bottom: 1px solid rgba(55, 53, 47, 0.18);
}

table,
th,
td {
	border: 1px solid rgba(55, 53, 47, 0.09);
	border-collapse: collapse;
}

table {
	border-left: none;
	border-right: none;
}

th,
td {
	font-weight: normal;
	padding: 0.25em 0.5em;
	line-height: 1.5;
	min-height: 1.5em;
	text-align: left;
}

th {
	color: rgba(55, 53, 47, 0.6);
}

ol,
ul {
	margin: 0;
	margin-block-start: 0.6em;
	margin-block-end: 0.6em;
}

li > ol:first-child,
li > ul:first-child {
	margin-block-start: 0.6em;
}

ul > li {
	list-style: disc;
}

ul.to-do-list {
	padding-inline-start: 0;
}

ul.to-do-list > li {
	list-style: none;
}

.to-do-children-checked {
	text-decoration: line-through;
	opacity: 0.375;
}

ul.toggle > li {
	list-style: none;
}

ul {
	padding-inline-start: 1.7em;
}

ul > li {
	padding-left: 0.1em;
}

ol {
	padding-inline-start: 1.6em;
}

ol > li {
	padding-left: 0.2em;
}

.mono ol {
	padding-inline-start: 2em;
}

.mono ol > li {
	text-indent: -0.4em;
}

.toggle {
	padding-inline-start: 0em;
	list-style-type: none;
}

/* Indent toggle children */
.toggle > li > details {
	padding-left: 1.7em;
}

.toggle > li > details > summary {
	margin-left: -1.1em;
}

.selected-value {
	display: inline-block;
	padding: 0 0.5em;
	background: rgba(206, 205, 202, 0.5);
	border-radius: 3px;
	margin-right: 0.5em;
	margin-top: 0.3em;
	margin-bottom: 0.3em;
	white-space: nowrap;
}

.collection-title {
	display: inline-block;
	margin-right: 1em;
}

.page-description {
	margin-bottom: 2em;
}

.simple-table {
	margin-top: 1em;
	font-size: 0.875rem;
	empty-cells: show;
}
.simple-table td {
	height: 29px;
	min-width: 120px;
}

.simple-table th {
	height: 29px;
	min-width: 120px;
}

.simple-table-header-color {
	background: rgb(247, 246, 243);
	color: black;
}
.simple-table-header {
	font-weight: 500;
}

time {
	opacity: 0.5;
}

.icon {
	display: inline-flex;
	align-items: center;
	justify-content: center;
	max-width: 1.2em;
	max-height: 1.2em;
	text-decoration: none;
	vertical-align: text-bottom;
	margin-right: 0.5em;
}

img.icon {
	border-radius: 3px;
}

.callout img.notion-static-icon {
	width: 1em;
	height: 1em;
}

.callout p {
	margin: 0;
}

.callout h1,
.callout h2,
.callout h3 {
	margin: 0 0 0.6rem;
}

.user-icon {
	width: 1.5em;
	height: 1.5em;
	border-radius: 100%;
	margin-right: 0.5rem;
}

.user-icon-inner {
	font-size: 0.8em;
}

.text-icon {
	border: 1px solid #000;
	text-align: center;
}

.page-cover-image {
	display: block;
	object-fit: cover;
	width: 100%;
	max-height: 30vh;
}

.page-header-icon {
	font-size: 3rem;
	margin-bottom: 1rem;
}

.page-header-icon-with-cover {
	margin-top: -0.72em;
	margin-left: 0.07em;
}

.page-header-icon img {
	border-radius: 3px;
}

.link-to-page {
	margin: 1em 0;
	padding: 0;
	border: none;
	font-weight: 500;
}

p > .user {
	opacity: 0.5;
}

td > .user,
td > time {
	white-space: nowrap;
}

input[type="checkbox"] {
	transform: scale(1.5);
	margin-right: 0.6em;
	vertical-align: middle;
}

p {
	margin-top: 0.5em;
	margin-bottom: 0.5em;
}

.image {
	border: none;
	margin: 1.5em 0;
	padding: 0;
	border-radius: 0;
	text-align: center;
}

.code,
code {
	background: rgba(135, 131, 120, 0.15);
	border-radius: 3px;
	padding: 0.2em 0.4em;
	border-radius: 3px;
	font-size: 85%;
	tab-size: 2;
}

code {
	color: #eb5757;
}

.code {
	padding: 1.5em 1em;
}

.code-wrap {
	white-space: pre-wrap;
	word-break: break-all;
}

.code > code {
	background: none;
	padding: 0;
	font-size: 100%;
	color: inherit;
}

blockquote {
	font-size: 1em;
	margin: 1em 0;
	padding-left: 1em;
	border-left: 3px solid rgb(55, 53, 47);
}

blockquote.quote-large {
	font-size: 1.25em;
}

.bookmark {
	text-decoration: none;
	max-height: 8em;
	padding: 0;
	display: flex;
	width: 100%;
	align-items: stretch;
}

.bookmark-title {
	font-size: 0.85em;
	overflow: hidden;
	text-overflow: ellipsis;
	height: 1.75em;
	white-space: nowrap;
}

.bookmark-text {
	display: flex;
	flex-direction: column;
}

.bookmark-info {
	flex: 4 1 180px;
	padding: 12px 14px 14px;
	display: flex;
	flex-direction: column;
	justify-content: space-between;
}

.bookmark-image {
	width: 33%;
	flex: 1 1 180px;
	display: block;
	position: relative;
	object-fit: cover;
	border-radius: 1px;
}

.bookmark-description {
	color: rgba(55, 53, 47, 0.6);
	font-size: 0.75em;
	overflow: hidden;
	max-height: 4.5em;
	word-break: break-word;
}

.bookmark-href {
	font-size: 0.75em;
	margin-top: 0.25em;
}

.sans { font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; }
.code { font-family: "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace; }
.serif { font-family: Lyon-Text, Georgia, ui-serif, serif; }
.mono { font-family: iawriter-mono, Nitti, Menlo, Courier, monospace; }
.pdf .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK JP'; }
.pdf:lang(zh-CN) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK SC'; }
.pdf:lang(zh-TW) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK TC'; }
.pdf:lang(ko-KR) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK KR'; }
.pdf .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.pdf .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK JP'; }
.pdf:lang(zh-CN) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK SC'; }
.pdf:lang(zh-TW) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK TC'; }
.pdf:lang(ko-KR) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK KR'; }
.pdf .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.highlight-default {
	color: rgba(44, 44, 43, 1);
}
.highlight-gray {
	color: rgba(125, 122, 117, 1);
	fill: rgba(125, 122, 117, 1);
}
.highlight-brown {
	color: rgba(159, 118, 90, 1);
	fill: rgba(159, 118, 90, 1);
}
.highlight-orange {
	color: rgba(210, 123, 45, 1);
	fill: rgba(210, 123, 45, 1);
}
.highlight-yellow {
	color: rgba(203, 148, 52, 1);
	fill: rgba(203, 148, 52, 1);
}
.highlight-teal {
	color: rgba(80, 148, 110, 1);
	fill: rgba(80, 148, 110, 1);
}
.highlight-blue {
	color: rgba(56, 125, 201, 1);
	fill: rgba(56, 125, 201, 1);
}
.highlight-purple {
	color: rgba(154, 107, 180, 1);
	fill: rgba(154, 107, 180, 1);
}
.highlight-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.highlight-red {
	color: rgba(207, 81, 72, 1);
	fill: rgba(207, 81, 72, 1);
}
.highlight-default_background {
	color: rgba(44, 44, 43, 1);
}
.highlight-gray_background {
	background: rgba(42, 28, 0, 0.07);
}
.highlight-brown_background {
	background: rgba(139, 46, 0, 0.086);
}
.highlight-orange_background {
	background: rgba(224, 101, 1, 0.129);
}
.highlight-yellow_background {
	background: rgba(211, 168, 0, 0.137);
}
.highlight-teal_background {
	background: rgba(0, 100, 45, 0.09);
}
.highlight-blue_background {
	background: rgba(0, 124, 215, 0.094);
}
.highlight-purple_background {
	background: rgba(102, 0, 178, 0.078);
}
.highlight-pink_background {
	background: rgba(197, 0, 93, 0.086);
}
.highlight-red_background {
	background: rgba(223, 22, 0, 0.094);
}
.block-color-default {
	color: inherit;
	fill: inherit;
}
.block-color-gray {
	color: rgba(125, 122, 117, 1);
	fill: rgba(125, 122, 117, 1);
}
.block-color-brown {
	color: rgba(159, 118, 90, 1);
	fill: rgba(159, 118, 90, 1);
}
.block-color-orange {
	color: rgba(210, 123, 45, 1);
	fill: rgba(210, 123, 45, 1);
}
.block-color-yellow {
	color: rgba(203, 148, 52, 1);
	fill: rgba(203, 148, 52, 1);
}
.block-color-teal {
	color: rgba(80, 148, 110, 1);
	fill: rgba(80, 148, 110, 1);
}
.block-color-blue {
	color: rgba(56, 125, 201, 1);
	fill: rgba(56, 125, 201, 1);
}
.block-color-purple {
	color: rgba(154, 107, 180, 1);
	fill: rgba(154, 107, 180, 1);
}
.block-color-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.block-color-red {
	color: rgba(207, 81, 72, 1);
	fill: rgba(207, 81, 72, 1);
}
.block-color-default_background {
	color: inherit;
	fill: inherit;
}
.block-color-gray_background {
	background: rgba(240, 239, 237, 1);
}
.block-color-brown_background {
	background: rgba(245, 237, 233, 1);
}
.block-color-orange_background {
	background: rgba(251, 235, 222, 1);
}
.block-color-yellow_background {
	background: rgba(249, 243, 220, 1);
}
.block-color-teal_background {
	background: rgba(232, 241, 236, 1);
}
.block-color-blue_background {
	background: rgba(229, 242, 252, 1);
}
.block-color-purple_background {
	background: rgba(243, 235, 249, 1);
}
.block-color-pink_background {
	background: rgba(250, 233, 241, 1);
}
.block-color-red_background {
	background: rgba(252, 233, 231, 1);
}
.select-value-color-default { background-color: rgba(42, 28, 0, 0.07); }
.select-value-color-gray { background-color: rgba(28, 19, 1, 0.11); }
.select-value-color-brown { background-color: rgba(127, 51, 0, 0.156); }
.select-value-color-orange { background-color: rgba(196, 88, 0, 0.203); }
.select-value-color-yellow { background-color: rgba(209, 156, 0, 0.282); }
.select-value-color-green { background-color: rgba(0, 96, 38, 0.156); }
.select-value-color-blue { background-color: rgba(0, 118, 217, 0.203); }
.select-value-color-purple { background-color: rgba(92, 0, 163, 0.141); }
.select-value-color-pink { background-color: rgba(183, 0, 78, 0.152); }
.select-value-color-red { background-color: rgba(206, 24, 0, 0.164); }

.checkbox {
	display: inline-flex;
	vertical-align: text-bottom;
	width: 16;
	height: 16;
	background-size: 16px;
	margin-left: 2px;
	margin-right: 5px;
}

.checkbox-on {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20width%3D%2216%22%20height%3D%2216%22%20fill%3D%22%2358A9D7%22%2F%3E%0A%3Cpath%20d%3D%22M6.71429%2012.2852L14%204.9995L12.7143%203.71436L6.71429%209.71378L3.28571%206.2831L2%207.57092L6.71429%2012.2852Z%22%20fill%3D%22white%22%2F%3E%0A%3C%2Fsvg%3E");
}

.checkbox-off {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20x%3D%220.75%22%20y%3D%220.75%22%20width%3D%2214.5%22%20height%3D%2214.5%22%20fill%3D%22white%22%20stroke%3D%22%2336352F%22%20stroke-width%3D%221.5%22%2F%3E%0A%3C%2Fsvg%3E");
}
	

/* ============================================
   ENHANCED STYLES - Modern Interactive Design
   GREEN THEME - Responsive & Optimized
   ============================================ */

/* CSS Variables for Green Theme */
:root {
    /* Main Green Colors */
    --primary-color: #2ECC71;      /* Emerald green */
    --secondary-color: #27AE60;    /* Dark emerald */
    --light-green: #58D68D;        /* Light emerald */
    --pale-green: #ABEBC6;         /* Very light green */
    --accent-color: #229954;       /* Deep green */

    /* Supporting Colors */
    --text-primary: #2C3E50;
    --text-secondary: #7F8C8D;
    --bg-gradient-start: #F0F8F5;  /* Pale green background */
    --bg-gradient-end: #D5F4E6;    /* Light green gradient */
    --white: #FFFFFF;

    /* Layout Variables - Optimized */
    --sidebar-width: 220px;        /* Reduced from 280px */
    --header-height: 90px;         /* Reduced from 120px */

    /* Shadows */
    --shadow-sm: 0 2px 4px rgba(46, 204, 113, 0.1);
    --shadow-md: 0 4px 10px rgba(46, 204, 113, 0.15);
    --shadow-lg: 0 10px 25px rgba(46, 204, 113, 0.2);

    /* Transitions */
    --transition-fast: 0.2s ease;
    --transition-normal: 0.3s ease;
}

/* Reset and base styles */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

html {
    scroll-behavior: smooth;
    -webkit-print-color-adjust: exact;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
                 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
    line-height: 1.6;
    color: var(--text-primary);
    background: linear-gradient(135deg, var(--bg-gradient-start) 0%, var(--bg-gradient-end) 100%);
    background-attachment: fixed;
    margin: 0;
    padding: 0;
    width: 100vw;
    overflow-x: hidden;  /* Fix overflow */
}

/* Gradient Header - Hidden Title */
.page-header {
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
    color: white;
    padding: 0;  /* Remove padding */
    box-shadow: var(--shadow-lg);
    position: sticky;
    top: 0;
    z-index: 100;
    min-height: 0;  /* Remove min-height */
    display: none;  /* Hide header completely */
    width: 100%;
    box-sizing: border-box;
}

.page-header h1 {
    display: none;  /* Hide title */
}

/* Main layout with TOC - Fix viewport */
.layout-container {
    width: 100% !important;
    max-width: 100% !important;
    margin: 0 !important;
    padding: 0 !important;
    box-sizing: border-box !important;
    overflow-x: hidden !important;
}

/* TOC Horizontal Navbar - Top Position */
.toc-sidebar {
    width: 100% !important;
    max-width: 100vw !important;
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
    border-bottom: 3px solid var(--light-green);
    position: sticky;
    top: 0;
    height: auto;
    overflow-x: auto;
    overflow-y: hidden;
    padding: 0.75rem clamp(1rem, 3vw, 2rem) !important; /* Responsive padding */
    box-shadow: var(--shadow-md);
    z-index: 100;
    display: flex;
    align-items: center;
    justify-content: center;
    box-sizing: border-box !important;
}

.toc-header {
    display: none;  /* Hide header in horizontal mode */
}

.toc-header h2 {
    display: none;
}

.toc-toggle {
    display: none;
}

.toc-list {
    list-style: none;
    padding: 0;
    margin: 0;
    display: flex;
    flex-direction: row;
    gap: 0.5rem;
    align-items: center;
    flex-wrap: wrap;
    justify-content: center;
}

.toc-list li {
    margin: 0;
}

.toc-link {
    display: inline-block;
    padding: 0.6rem 1.2rem;
    color: white;
    text-decoration: none;
    border-radius: 25px;
    transition: all var(--transition-fast);
    font-size: 0.95rem;
    font-weight: 500;
    background: rgba(255, 255, 255, 0.15);
    border: 2px solid transparent;
    white-space: nowrap;
}

.toc-link:hover {
    background: rgba(255, 255, 255, 0.25);
    color: white;
    transform: translateY(-2px);
    border-color: rgba(255, 255, 255, 0.5);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

.toc-link.active {
    background: white;
    color: var(--secondary-color);
    font-weight: 600;
    border-color: white;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
}

.toc-indent-1,
.toc-indent-2,
.toc-indent-3 {
    margin-left: 0;  /* Remove indents for horizontal layout */
}

/* Main content area - Proper spacing & width */
.main-content {
    flex: 1;
    width: calc(100% - var(--sidebar-width));
    padding: 2rem 2.5rem;  /* Reduced padding */
    background: white;
    box-sizing: border-box;
    overflow-x: auto;
    overflow-y: visible;
}

/* Override Notion styles for proper width */
@media only screen {
    body {
        margin: 0 !important;
        max-width: 100vw !important;
        width: 100% !important;
    }
}

.page.sans {
    width: 100% !important;
    max-width: 100% !important;
    margin: 0 !important;
    padding: 0 !important;
}

.page-body {
    width: 100% !important;
    max-width: 100% !important;
}

/* Enhanced typography - Green Theme */
.page-body h3 {
    color: var(--secondary-color);  /* Dark green */
    font-size: 1.8rem;
    margin-top: 3rem;
    margin-bottom: 1.5rem;
    padding-bottom: 0.5rem;
    border-bottom: 3px solid var(--primary-color);  /* Green border */
    position: relative;
}

.page-body h3::before {
    content: '';
    position: absolute;
    bottom: -3px;
    left: 0;
    width: 60px;
    height: 3px;
    background: var(--light-green);  /* Light green accent */
}

.page-body p {
    margin: 1rem 0;
    line-height: 1.8;
}

.page-body strong {
    color: var(--text-primary);
    font-weight: 600;
}

/* Enhanced tables - Green Theme & Responsive */
.simple-table {
    width: 100%;
    max-width: 100%;
    border-collapse: separate;
    border-spacing: 0;
    margin: 2rem 0;
    background: white;
    border-radius: 12px;
    overflow-x: auto;  /* Horizontal scroll on small screens */
    overflow-y: hidden;
    box-shadow: var(--shadow-md);
    display: table;
    table-layout: auto;
}

.simple-table thead {
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);  /* Green gradient */
}

.simple-table th {
    color: #000000 !important;
    font-weight: 600;
    padding: 1.2rem 1rem;
    text-align: left;
    font-size: 0.95rem;
    letter-spacing: 0.02em;
    white-space: normal;
    vertical-align: top;
}

.simple-table td {
    padding: 1rem;
    border-bottom: 1px solid #f0f0f0;
    white-space: normal;
    vertical-align: top;
    line-height: 1.6;
}

.simple-table tbody tr {
    transition: all var(--transition-fast);
}

.simple-table tbody tr:nth-child(even) {
    background: rgba(46, 204, 113, 0.03);  /* Light green */
}

.simple-table tbody tr:hover {
    background: rgba(46, 204, 113, 0.08);  /* Green hover */
    transform: scale(1.005);
    box-shadow: var(--shadow-sm);
}

.simple-table tbody tr:last-child td {
    border-bottom: none;
}

/* Interactive highlighted terms */
.interactive-term {
    cursor: pointer;
    position: relative;
    transition: all var(--transition-fast);
    border: 2px dotted transparent;
    border-radius: 4px;
    padding: 0.2em 0.5em;
    display: inline-block;
}

.interactive-term:hover {
    transform: scale(1.05);
    box-shadow: 0 2px 8px rgba(46, 204, 113, 0.3);  /* Green shadow */
    border-color: var(--primary-color);  /* Green border */
    z-index: 10;
}

/* Highlight colors - enhanced */
.highlight-blue, .highlight-blue_background {
    background: rgba(56, 125, 201, 0.15);
    color: #2563eb;
}

.highlight-yellow, .highlight-yellow_background {
    background: rgba(251, 191, 36, 0.2);
    color: #d97706;
}

.highlight-red, .highlight-red_background {
    background: rgba(239, 68, 68, 0.15);
    color: #dc2626;
}

.highlight-green, .highlight-green_background {
    background: rgba(76, 175, 80, 0.15);
    color: #059669;
}

.highlight-orange, .highlight-orange_background {
    background: rgba(251, 146, 60, 0.15);
    color: #ea580c;
}

.highlight-pink, .highlight-pink_background {
    background: rgba(236, 72, 153, 0.15);
    color: #db2777;
}

.highlight-purple, .highlight-purple_background {
    background: rgba(168, 85, 247, 0.15);
    color: #9333ea;
}

.highlight-gray, .highlight-gray_background {
    background: rgba(156, 163, 175, 0.2);
    color: #4b5563;
}

.highlight-brown, .highlight-brown_background {
    background: rgba(180, 83, 9, 0.15);
    color: #92400e;
}

.highlight-teal, .highlight-teal_background {
    background: rgba(20, 184, 166, 0.15);
    color: #0f766e;
}

.highlight-default, .highlight-default_background {
    background: rgba(156, 163, 175, 0.1);
    color: #374151;
}

/* Tooltip popup */
.tooltip-popup {
    position: fixed;
    background: white;
    border-radius: 12px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.2);
    padding: 1.5rem;
    max-width: 400px;
    z-index: 1000;
    animation: tooltipFadeIn 0.3s ease;
    border: 2px solid var(--primary-color);
}

@keyframes tooltipFadeIn {
    from {
        opacity: 0;
        transform: translateY(-10px) scale(0.95);
    }
    to {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
}

.tooltip-header {
    display: flex;
    justify-content: space-between;
    align-items: start;
    margin-bottom: 1rem;
    padding-bottom: 0.75rem;
    border-bottom: 2px solid #f0f0f0;
}

.tooltip-title {
    font-size: 1.1rem;
    font-weight: 600;
    color: var(--primary-color);
    margin: 0;
}

.tooltip-close {
    background: none;
    border: none;
    font-size: 1.5rem;
    color: #999;
    cursor: pointer;
    padding: 0;
    width: 30px;
    height: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    transition: all var(--transition-fast);
}

.tooltip-close:hover {
    background: #f0f0f0;
    color: #333;
}

.tooltip-id {
    font-size: 0.85rem;
    color: #666;
    font-family: 'Courier New', monospace;
    background: #f5f5f5;
    padding: 0.3rem 0.6rem;
    border-radius: 4px;
    margin-bottom: 1rem;
    display: inline-block;
}

.tooltip-content {
    color: var(--text-secondary);
    line-height: 1.6;
    margin: 1rem 0;
}

.tooltip-placeholder {
    background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
    background-size: 200% 100%;
    animation: shimmer 1.5s infinite;
    padding: 1rem;
    border-radius: 6px;
    text-align: center;
    color: #999;
    font-style: italic;
}

@keyframes shimmer {
    0% { background-position: 200% 0; }
    100% { background-position: -200% 0; }
}

/* Tooltip image placeholder - REMOVED per user request */

/* Image Preview Tooltip - Hover effect */
.image-preview-tooltip {
    position: fixed;
    background: white;
    border-radius: 8px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
    z-index: 10001;
    padding: 8px;
    max-width: 500px;
    max-height: 500px;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.2s ease;
}

.image-preview-tooltip.show {
    opacity: 1;
}

.image-preview-tooltip img {
    display: block;
    max-width: 100%;
    max-height: 450px;
    width: auto;
    height: auto;
    border-radius: 4px;
    object-fit: contain;
}

.image-preview-tooltip iframe {
    display: block;
    width: 480px;
    height: 360px;
    border-radius: 4px;
    background: #000;
}

.image-preview-loading {
    padding: 2rem;
    text-align: center;
    color: var(--text-secondary);
}

.image-preview-error {
    padding: 1rem;
    text-align: center;
    color: #e74c3c;
    font-size: 0.9rem;
}

/* Image placeholder buttons - REMOVED per user request */

/* ====== CREATE TERM MODAL STYLES ====== */
#create-term-btn {
    position: fixed;
    bottom: 30px;
    right: 30px;
    width: 60px;
    height: 60px;
    background: linear-gradient(135deg, #4CAF50, #45a049);
    color: white;
    border: none;
    border-radius: 50%;
    font-size: 32px;
    cursor: pointer;
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    z-index: 999;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
}

#create-term-btn:hover {
    transform: scale(1.1);
    box-shadow: 0 6px 16px rgba(0,0,0,0.4);
}

#create-term-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.6);
    z-index: 10000;
    align-items: center;
    justify-content: center;
}

#create-term-modal.active {
    display: flex;
}

.modal-content {
    background: white;
    border-radius: 12px;
    width: 90%;
    max-width: 900px;
    max-height: 85vh;
    display: flex;
    flex-direction: column;
    box-shadow: 0 8px 32px rgba(0,0,0,0.3);
}

.modal-header {
    padding: 20px 24px;
    border-bottom: 2px solid #e0e0e0;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.modal-header h2 {
    margin: 0;
    color: #333;
    font-size: 24px;
}

.modal-close {
    background: none;
    border: none;
    font-size: 28px;
    cursor: pointer;
    color: #999;
    padding: 0;
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    transition: all 0.2s;
}

.modal-close:hover {
    background: #f5f5f5;
    color: #333;
}

.modal-body {
    padding: 24px;
    overflow-y: auto;
    flex: 1;
}

.form-group {
    margin-bottom: 20px;
}

.form-group label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    color: #333;
}

.form-group select,
.form-group input,
.form-group textarea {
    width: 100%;
    padding: 10px 12px;
    border: 2px solid #e0e0e0;
    border-radius: 6px;
    font-size: 14px;
    transition: border-color 0.2s;
}

.form-group select:focus,
.form-group input:focus,
.form-group textarea:focus {
    outline: none;
    border-color: #4CAF50;
}

#content-area {
    min-height: 200px;
    max-height: 300px;
    overflow-y: auto;
    padding: 16px;
    border: 2px solid #e0e0e0;
    border-radius: 6px;
    background: #fafafa;
    line-height: 1.6;
    user-select: text;
    cursor: text;
}

#content-area.has-selection {
    border-color: #4CAF50;
    background: #f0fff4;
}

.selected-text-info {
    margin-top: 12px;
    padding: 12px;
    background: #e8f5e9;
    border-left: 4px solid #4CAF50;
    border-radius: 4px;
    display: none;
}

.selected-text-info.active {
    display: block;
}

.selected-text-info strong {
    color: #2e7d32;
}

.modal-footer {
    padding: 16px 24px;
    border-top: 2px solid #e0e0e0;
    display: flex;
    justify-content: flex-end;
    gap: 12px;
}

.btn {
    padding: 10px 24px;
    border: none;
    border-radius: 6px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
}

.btn-secondary {
    background: #e0e0e0;
    color: #333;
}

.btn-secondary:hover {
    background: #d0d0d0;
}

.btn-primary {
    background: #4CAF50;
    color: white;
}

.btn-primary:hover {
    background: #45a049;
}

.btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

/* Upload area styles */
.upload-area {
    margin-top: 12px;
    border: 2px dashed #ccc;
    border-radius: 8px;
    padding: 20px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s;
    background: #fafafa;
}

.upload-area:hover {
    border-color: #4CAF50;
    background: #f0fff4;
}

.upload-area.dragover {
    border-color: #4CAF50;
    background: #e8f5e9;
    transform: scale(1.02);
}

.upload-area input[type="file"] {
    display: none;
}

.upload-icon {
    font-size: 48px;
    margin-bottom: 12px;
    display: block;
}

.upload-text {
    color: #666;
    font-size: 14px;
}

.upload-text strong {
    color: #4CAF50;
}

.upload-preview {
    margin-top: 16px;
    display: none;
}

.upload-preview.active {
    display: block;
}

.preview-image {
    max-width: 100%;
    max-height: 200px;
    border-radius: 8px;
    margin-bottom: 12px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.upload-progress {
    margin-top: 12px;
    display: none;
}

.upload-progress.active {
    display: block;
}

.progress-bar {
    width: 100%;
    height: 24px;
    background: #e0e0e0;
    border-radius: 12px;
    overflow: hidden;
    position: relative;
}

.progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #4CAF50, #45a049);
    transition: width 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 12px;
    font-weight: 600;
}

.upload-status {
    margin-top: 8px;
    font-size: 13px;
    color: #666;
    text-align: center;
}

.upload-status.success {
    color: #4CAF50;
}

.upload-status.error {
    color: #e74c3c;
}

.file-info {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 12px;
    background: #f5f5f5;
    border-radius: 6px;
    margin-top: 12px;
}

.file-name {
    font-size: 13px;
    color: #333;
    font-weight: 500;
}

.remove-file {
    background: #e74c3c;
    color: white;
    border: none;
    padding: 4px 12px;
    border-radius: 4px;
    font-size: 12px;
    cursor: pointer;
    transition: background 0.2s;
}

.remove-file:hover {
    background: #c0392b;
}

/* Back to top button - Green Theme */
.back-to-top {
    position: fixed;
    bottom: 2rem;
    right: 2rem;
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);  /* Green gradient */
    color: white;
    width: 50px;
    height: 50px;
    border-radius: 50%;
    border: none;
    cursor: pointer;
    display: none;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    box-shadow: 0 4px 20px rgba(46, 204, 113, 0.4);  /* Green shadow */
    transition: all var(--transition-normal);
    z-index: 99;
}

.back-to-top:hover {
    transform: translateY(-5px) scale(1.1);
    background: linear-gradient(135deg, var(--secondary-color) 0%, var(--accent-color) 100%);  /* Darker green on hover */
    box-shadow: 0 6px 25px rgba(46, 204, 113, 0.5);
}

.back-to-top.visible {
    display: flex;
    animation: fadeInUp 0.3s ease;
}

@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Loading spinner */
.loading-spinner {
    display: none;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 9999;
}

.spinner {
    width: 60px;
    height: 60px;
    border: 5px solid #f3f3f3;
    border-top: 5px solid var(--primary-color);
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* Responsive design - Enhanced */
@media (max-width: 1200px) {
    :root {
        --sidebar-width: 180px;  /* Narrower on medium screens */
    }

    .main-content {
        padding: 2rem;
    }
}

@media (max-width: 1024px) {
    .toc-sidebar {
        display: none;  /* Hide sidebar completely on tablets */
    }

    .main-content {
        margin-left: 0 !important;
        max-width: 100% !important;
        padding: 2rem 1.5rem;
    }

    .layout-container {
        flex-direction: column;
    }
}

@media (max-width: 768px) {
    .layout-container {
        flex-direction: column;
    }

    .toc-sidebar {
        width: 100%;
        height: auto;
        position: fixed;
        top: var(--header-height);
        left: 0;
        right: 0;
        border-right: none;
        border-bottom: 1px solid var(--primary-color);
        max-height: 0;
        overflow-y: auto;
        transition: max-height var(--transition-normal);
        padding: 0;
        z-index: 999;
        background: white;
        box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }

    .toc-sidebar.open {
        max-height: calc(100vh - var(--header-height));
        padding: 1rem;
        display: block !important;
    }

    .toc-toggle {
        display: block;
        position: fixed;
        top: calc(var(--header-height) + 10px);
        left: 10px;
        z-index: 1001;
        background: var(--primary-color);
        color: white;
        border: none;
        padding: 0.5rem 1rem;
        border-radius: 8px;
        cursor: pointer;
        box-shadow: var(--shadow-md);
    }

    .main-content {
        max-width: 100%;
        padding: 1rem;
        margin-left: 0;
    }

    .page-header {
        padding: 1rem;
    }

    .page-header h1 {
        font-size: 1.5rem;
    }

    .back-to-top {
        bottom: 1rem;
        right: 1rem;
        width: 45px;
        height: 45px;
    }

    .tooltip-popup {
        max-width: 90%;
        left: 5% !important;
        right: 5% !important;
    }

    .simple-table {
        font-size: 0.85rem;
    }

    .simple-table th,
    .simple-table td {
        padding: 0.5rem !important;
        min-width: 100px;
    }
}

/* Print styles */
@media print {
    body {
        background: white;
    }

    .toc-sidebar,
    .back-to-top,
    .toc-toggle {
        display: none !important;
    }

    .main-content {
        max-width: 100%;
        padding: 0;
    }

    .page-header {
        position: relative;
        box-shadow: none;
    }

    .interactive-term {
        border: none;
        cursor: default;
    }

    .simple-table {
        box-shadow: none;
        page-break-inside: avoid;
    }
}

/* Smooth transitions for all interactive elements */
a, button, .interactive-term, .toc-link {
    transition: all var(--transition-fast);
}

/* Focus styles for accessibility - Green */
a:focus, button:focus, .interactive-term:focus {
    outline: 2px solid var(--primary-color);  /* Green outline */
    outline-offset: 2px;
}

/* Links - Green Theme */
a {
    color: var(--secondary-color);  /* Dark green */
}

a:hover {
    color: var(--primary-color);  /* Emerald green on hover */
}

/* Custom scrollbar - Green Theme */
::-webkit-scrollbar {
    width: 10px;
    height: 10px;
}

::-webkit-scrollbar-track {
    background: #f1f1f1;
}

::-webkit-scrollbar-thumb {
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);  /* Green gradient */
    border-radius: 5px;
}

::-webkit-scrollbar-thumb:hover {
    background: var(--secondary-color);  /* Dark green on hover */
}

/* Code blocks enhancement - Green accents */
.code {
    background: #2d2d2d;
    color: #f8f8f2;
    padding: 1.5rem;
    border-radius: 8px;
    overflow-x: auto;
    margin: 1.5rem 0;
    box-shadow: var(--shadow-md);
    border-left: 4px solid var(--primary-color);  /* Green accent */
}

code {
    font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    font-size: 0.9em;
    background: rgba(46, 204, 113, 0.1) !important;  /* Light green background */
    color: var(--secondary-color) !important;  /* Dark green text */
    border: 1px solid var(--pale-green);
    padding: 0.2em 0.4em;
    border-radius: 4px;
}

/* Horizontal rules - Green */
hr {
    border: none;
    height: 2px;
    background: linear-gradient(90deg, transparent 0%, var(--primary-color) 50%, transparent 100%);  /* Green gradient */
    margin: 2rem 0;
}

/* Images */
img {
    max-width: 100%;
    height: auto;
    border-radius: 8px;
    box-shadow: var(--shadow-md);
    margin: 1.5rem 0;
}

/* Callouts - Green Theme */
.callout {
    background: linear-gradient(135deg, rgba(46, 204, 113, 0.05) 0%, rgba(39, 174, 96, 0.05) 100%);  /* Light green gradient */
    border-left: 4px solid var(--primary-color);  /* Green border */
    padding: 1.5rem;
    border-radius: 8px;
    margin: 1.5rem 0;
}

/* ==========================================
   4 MAJOR IMPROVEMENTS - LAYOUT & NAVIGATION
   ========================================== */

/* 1. HIDE PAGE TITLE (Original header) */
.page-header {
    display: none !important;
}

h1.page-title {
    display: none !important;
}

/* 2. CENTER CONTENT */
body {
    padding-top: 90px !important;
    background: #F8FFF9 !important;
}

.layout-container {
    max-width: 1400px !important;
    margin: 0 auto !important;
    padding: 0 2rem !important;
    padding-top: 0 !important;
}

.main-content {
    max-width: 100% !important;
    margin: 0 auto !important;
    padding-top: 0 !important;
    margin-top: 0 !important;
}

article.page.sans {
    margin-top: 0 !important;
    padding-top: 0 !important;
}

.page-body {
    margin-top: 0 !important;
    padding-top: 0 !important;
}

/* 3. FIXED NAVIGATION BAR - Replaces header */
#main-navigation {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    width: 100%;
    background: linear-gradient(135deg, #2ECC71 0%, #27AE60 100%);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    z-index: 2000;
    padding: 0;
    margin: 0;
}

#main-navigation ul {
    display: flex;
    justify-content: center;
    align-items: center;
    list-style: none;
    margin: 0;
    padding: 1rem 0;
    flex-wrap: wrap;
    gap: 0.5rem;
}

#main-navigation li {
    list-style: none !important;
    margin: 0 !important;
}

#main-navigation li::before {
    display: none !important;
    content: none !important;
}

#main-navigation a {
    display: inline-block;
    padding: 0.75rem 1.5rem;
    background: rgba(255, 255, 255, 0.2);
    color: white;
    text-decoration: none;
    border-radius: 25px;
    font-weight: 600;
    font-size: 0.9rem;
    border: 2px solid rgba(255, 255, 255, 0.3);
    cursor: pointer;
    transition: all 0.3s ease;
    white-space: nowrap;
}

#main-navigation a:hover {
    background: white;
    color: #27AE60;
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
}

#main-navigation a.active {
    background: white;
    color: #27AE60;
    font-weight: 700;
}

/* Hide TOC sidebar - using main navigation only */
.toc-sidebar {
    display: none !important;
}

/* Adjust main content to use full width without sidebar */
.main-content {
    margin-left: 0 !important;
    width: 100% !important;
}

/* 4. TABLE CONTENT WRAPPING - Force text wrapping in tables */
table {
    table-layout: fixed !important;
    width: 100% !important;
}

th, td {
    word-wrap: break-word !important;
    word-break: break-word !important;
    overflow-wrap: break-word !important;
    white-space: normal !important;
    hyphens: auto !important;
    vertical-align: top !important;
}

th:first-child,
td:first-child {
    width: 30% !important;
}

th:nth-child(2),
td:nth-child(2) {
    width: 70% !important;
}

th:nth-child(3),
td:nth-child(3) {
    width: 30% !important;
}

td ul, td ol {
    margin: 0.5rem 0 !important;
    padding-left: 1.5rem !important;
}

td code, td a {
    word-break: break-all !important;
    max-width: 100%;
}

/* RESPONSIVE - Mobile optimizations */
@media (max-width: 768px) {
    body {
        padding-top: auto !important;
    }
    
    #main-navigation ul {
        flex-direction: column;
        gap: 0.5rem;
        padding: 0.75rem;
    }
    
    #main-navigation a {
        width: 90%;
        text-align: center;
        padding: 0.6rem 1rem;
        font-size: 0.85rem;
    }
    
    .layout-container {
        padding: 0 1rem !important;
    }
    
    .toc-sidebar {
        top: auto !important;
    }
}




/* ===== STICKY NAVIGATION BAR ===== */
/* Sticky Navigation Bar */
.main-nav {
  position: sticky;
  top: 0;
  left: 0;
  width: 100%;
  background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  z-index: 1000;
  padding: 0;
}

.nav-container {
  display: flex;
  justify-content: space-around;
  align-items: center;
  max-width: 100%;
  margin: 0 auto;
  padding: 0.8rem 1rem;
  flex-wrap: wrap;
  gap: 0.5rem;
}

.nav-link {
  color: white;
  text-decoration: none;
  padding: 0.6rem 1rem;
  border-radius: 6px;
  font-weight: 600;
  font-size: 0.9rem;
  transition: all 0.3s ease;
  white-space: nowrap;
}

.nav-link:hover {
  background: rgba(255,255,255,0.2);
  transform: translateY(-2px);
}

.nav-link.active {
  background: rgba(255,255,255,0.3);
}

/* Responsive */
@media (max-width: 768px) {
  .nav-container {
    justify-content: flex-start;
    overflow-x: auto;
    flex-wrap: nowrap;
    padding: 0.6rem;
  }
  
  .nav-link {
    font-size: 0.85rem;
    padding: 0.5rem 0.8rem;
  }
}

/* Adjust body padding for fixed nav */
body {
  padding-top: 0 !important;
}

article.page {
  padding-top: 1rem;
}

/* ===== ONBOARD TABLE - EQUAL 50/50 SPLIT ===== */
/* ONBOARD Table - Equal 50/50 split for PO and SO columns */
#faeda640-dac4-4844-9dad-9606804fd78c + hr + table.simple-table,
table#70fe4b0d-c3af-486e-8387-de3a7ced6ce4 {
  width: 100% !important;
  table-layout: auto;
  max-width: 100%;
}

table#70fe4b0d-c3af-486e-8387-de3a7ced6ce4 th:nth-child(1),
table#70fe4b0d-c3af-486e-8387-de3a7ced6ce4 td:nth-child(1) {
  width: 18% !important;
  min-width: 150px;
}

table#70fe4b0d-c3af-486e-8387-de3a7ced6ce4 th:nth-child(2),
table#70fe4b0d-c3af-486e-8387-de3a7ced6ce4 td:nth-child(2) {
  width: 41% !important;
  min-width: 300px;
}

table#70fe4b0d-c3af-486e-8387-de3a7ced6ce4 th:nth-child(3),
table#70fe4b0d-c3af-486e-8387-de3a7ced6ce4 td:nth-child(3) {
  width: 41% !important;
  min-width: 300px;
}

/* Improve table readability */
table#70fe4b0d-c3af-486e-8387-de3a7ced6ce4 td {
  word-wrap: break-word;
  overflow-wrap: break-word;
}
</style></head><body>
<nav class="main-nav">
  <div class="nav-container">
    <a href="#faeda640-dac4-4844-9dad-9606804fd78c" class="nav-link">1. ONBOARD</a>
    <a href="#2ceec18e-70ae-8058-841a-e0265fc85386" class="nav-link">2. ĐĂNG ĐƠN</a>
    <a href="#2ceec18e-70ae-8021-ba52-d0ba83f7adf6" class="nav-link">3. ĐĂNG ĐƠN</a>
    <a href="#2ceec18e-70ae-804c-99de-f363da316462" class="nav-link">4. VẬN HÀNH</a>
    <a href="#2ceec18e-70ae-8095-9925-c2ca73ab3c91" class="nav-link">5. HUB</a>
    <a href="#2ceec18e-70ae-80f6-8e4e-cc86f4a0e914" class="nav-link">6. KHO ĐÍCH</a>
  </div>
</nav>
<article id="2ceec18e-70ae-8055-8adc-cb8d94cbe6c2" class="page sans"><header><h1 class="page-title" dir="auto">Tài liệu tổng quan luồng phân phối</h1><table class="properties"><tbody></tbody></table></header><div class="page-body"><div style="display:contents" dir="auto"><h3 id="faeda640-dac4-4844-9dad-9606804fd78c" class="">1. ONBOARD</h3></div><div style="display:contents" dir="auto"><hr id="6098e4a1-3986-4462-ae54-9f3089f28bc9"/></div><div style="display:contents" dir="ltr"><table id="70fe4b0d-c3af-486e-8387-de3a7ced6ce4" class="simple-table"><thead class="simple-table-header"><div style="display:contents" dir="ltr"><tr id="8cf20af2-8bed-4638-83bd-b36c6fda8119"><th id="D{cg" class="simple-table-header-color simple-table-header"><strong>Nhóm tiêu chí</strong></th><th id=":CS?" class="simple-table-header-color simple-table-header" style="width:413px"><strong>PO – Phân phối (Thương mại / Sản xuất)</strong></th><th id="FQI\" class="simple-table-header-color simple-table-header" style="width:347px"><strong>SO – Shop Online / Bán sỉ</strong></th></tr></div></thead><tbody><div style="display:contents" dir="ltr"><tr id="0e4fe144-85bb-4653-86f8-0632b56f8b9e"><td id="D{cg" class=""><strong>I. Đặc thù kinh doanh.</strong></td><td id=":CS?" class="" style="width:413px">1. Đơn vị <strong>PHẢI</strong> hoạt động theo mô hình <strong>phân phối B2B</strong> (distributor, nhà phân phối, nhà sản xuất kiêm phân phối).<br/>2. Khách hàng cuối <strong>PHẢI</strong> là một trong các nhóm sau:<br/>- Cửa hàng bán lẻ, siêu thị, minimart.<br/>- Nhà hàng, quán ăn, điểm tiêu thụ F&amp;B.<br/>- Doanh nghiệp, tổ chức, hoặc distributor cấp dưới.<br/>3. Các đặc điểm pháp lý sau <strong>thường xuất hiện ở đơn vị phân phối B2B</strong> và được sử dụng như <strong>dấu hiệu nhận diện khách phân phối (PO)</strong>:<br/>- Giấy phép kinh doanh ngành nghề phù hợp với nhóm sản phẩm phân phối.<br/>- Hồ sơ chứng minh nguồn gốc xuất xứ sản phẩm (hợp đồng mua bán, hóa đơn, C/O (Giấy chứng nhận xuất xứ hàng hóa), phiếu kiểm nghiệm, v.v.).<br/>- Trường hợp là <strong>đơn vị sản xuất kiêm phân phối</strong>: sản phẩm <strong>PHẢI</strong> hoàn tất thủ tục công bố với cơ quan quản lý (Sở Công Thương/Sở Y Tế...)<br/></td><td id="FQI\" class="" style="width:347px">1. Hoạt động chính là <strong>bán online/bán sỉ/bán lẻ</strong>, trong đó khách hàng cuối <strong>CHỦ YẾU</strong> là người tiêu dùng hoặc các shop/đại lý nhỏ.<br/>2. Đơn vị <strong>CÓ THỂ</strong> có hoặc chưa có đăng ký kinh doanh; hồ sơ sản phẩm <strong>KHÔNG ĐƯỢC QUẢN LÝ TẬP TRUNG</strong> tại đơn vị vận hành.<br/>3. Thông tin sản phẩm trên kênh bán <strong>DO SHOP TỰ KHAI BÁO</strong>, không có bộ hồ sơ chuẩn dùng làm căn cứ vận hành như kênh phân phối B2B.</td></tr></div><div style="display:contents" dir="ltr"><tr id="29984f64-26f8-4d3c-9baf-42ab09b28c4a"><td id="D{cg" class=""><strong>II. Đặc thù sản phẩm.</strong></td><td id=":CS?" class="" style="width:413px">1. Sản phẩm <strong>thuộc kênh phân phối chính thống</strong>, đã hoặc đang được khách hàng thực hiện đầy đủ các nghĩa vụ pháp lý theo quy định ngành hàng (công bố, kiểm nghiệm, ghi nhãn…).<br/>2. Sản phẩm <strong>PHẢI</strong> có <strong>quy cách đóng gói chuẩn hoá</strong>, bao gồm tối thiểu:<br/>- Thùng/kiện tiêu chuẩn.<br/>- Số lượng chuẩn trên mỗi thùng/kiện.<br/>- Trọng lượng chuẩn hoặc khoảng trọng lượng được quy định trước.<br/>3. Bao bì sản phẩm <strong>PHẢI</strong> có tem nhãn đầy đủ, bao gồm:<br/>- Tên sản phẩm, thành phần, định lượng.<br/>- Ngày sản xuất (NSX), hạn sử dụng (HSD).<br/>- Batch/lot, điều kiện bảo quản, cảnh báo (nếu có).<br/>4. Hệ thống vận hành <strong>PHẢI</strong> sử dụng được bộ mã sản phẩm sau:<br/>- Mã SKU, mã thùng, mã lô/batch.<br/>- Ưu tiên có barcode/QR để scan theo thùng/pallet.<br/>5. Yêu cầu bảo quản sản phẩm <strong>PHẢI</strong> được quy định rõ ràng (ví dụ: FMCG, thực phẩm khô, hàng dễ vỡ, hàng cần giữ lạnh...).<br/></td><td id="FQI\" class="" style="width:347px">1. Sản phẩm <strong>KHÔNG BẮT BUỘC</strong> tuân theo quy cách đóng gói chuẩn hoá theo thùng/kiện cố định; đơn vị bán <strong>TỰ QUYẾT ĐỊNH</strong> cách đóng gói theo từng đơn hàng.<br/>2. Tem nhãn ngoài thùng <strong>KHÔNG BẮT BUỘC</strong> phải đầy đủ như kênh phân phối; thực tế chỉ <strong>BẮT BUỘC</strong> có tem vận đơn của hãng vận chuyển để phát được hàng.<br/>3. Không bắt buộc có mã thùng/mã lô; mã sản phẩm (nếu tồn tại) thường do shop tự đặt và <strong>KHÔNG ĐƯỢC SỬ DỤNG</strong> làm căn cứ chính thức cho kiểm đếm theo SKU ở phía đơn vị vận hành.<br/>4. Yêu cầu bảo quản sản phẩm <strong>KHÔNG ĐƯỢC QUY ĐỊNH CHẶT CHẼ</strong>, thường mô tả chung chung hoặc không ghi rõ trong hồ sơ.</td></tr></div><div style="display:contents" dir="ltr"><tr id="01a0af89-56a1-487e-84c0-ac52dd13517b"><td id="D{cg" class=""><strong>III. Đặc điểm giao hàng &amp; thanh toán.</strong></td><td id=":CS?" class="" style="width:413px">1. Địa chỉ giao hàng <strong>BẮT BUỘC</strong> là một trong các loại sau:<br/>- Kho hàng, trung tâm phân phối (DC).<br/>- Cửa hàng, điểm bán, địa điểm kinh doanh cố định.<br/>2. Tần suất giao hàng <strong>BẮT BUỘC</strong> thể hiện được tính định kỳ, bao gồm:<br/>- Lịch giao lặp lại theo ngày/tuần/tháng cùng điểm giao cụ thể.<br/>3. Giờ giao hàng <strong>BẮT BUỘC</strong> nằm trong khung giờ có nhân sự chuyên trách tiếp nhận hàng hoá (thường là giờ hành chính hoặc khung giờ đã được thoả thuận trước trong hợp đồng).<br/>4. Chứng từ giao nhận (POD) <strong>BẮT BUỘC</strong> đáp ứng đồng thời:<br/>- Có người có thẩm quyền ký nhận, đóng dấu (nếu áp dụng).<br/>- Được sử dụng làm căn cứ đối soát công nợ và xử lý khiếu nại.<br/>5. Phương thức thanh toán và hợp đồng <strong>BẮT BUỘC</strong> thoả mãn:<br/>- Thanh toán theo hình thức <strong>công nợ</strong>, theo kỳ (15–30 ngày hoặc theo thoả thuận trong hợp đồng).<br/>- Có <strong>hợp đồng vận chuyển / frame contract</strong> quy định rõ: phạm vi dịch vụ, bảng giá, SLA, trách nhiệm và chế tài khi vi phạm.</td><td id="FQI\" class="" style="width:347px">1. Địa chỉ giao hàng chủ yếu là:<br/>- Địa chỉ dân cư, căn hộ, vị trí thay đổi theo từng đơn.<br/>2. Tần suất giao hàng:<br/>- Đơn hàng phát sinh <strong>ngẫu nhiên</strong>, không hình thành pattern giao lặp lại ổn định cùng điểm.<br/>3. Giờ giao hàng:<br/>- Phụ thuộc hoàn toàn vào người nhận; đơn vị vận hành <strong>KHÔNG CÓ QUYỀN</strong> yêu cầu cố định khung giờ tiếp nhận.<br/>4. Chứng từ giao nhận (POD):<br/>- Người nhận <strong>KHÔNG BẮT BUỘC</strong> phải có thẩm quyền; chỉ cần ký/nhận hàng là hoàn tất giao dịch.<br/>5. Thanh toán và hợp đồng:<br/>- <strong>BẮT BUỘC</strong> sử dụng thanh toán theo từng đơn (COD hoặc chuyển khoản trước).<br/>- Giao dịch <strong>KHÔNG DỰA TRÊN</strong> frame contract; áp dụng <strong>bảng giá công khai</strong> và SLA ở mức cam kết chung của dịch vụ.</td></tr></div></tbody></table></div><div style="display:contents" dir="auto"><h3 id="2ceec18e-70ae-8058-841a-e0265fc85386" class="">2. ĐĂNG ĐƠN</h3></div><div style="display:contents" dir="auto"><p id="2ceec18e-70ae-8008-bf26-fac2001731fb" class=""><strong>2.1. Cấu hình shop được phép đăng đơn.</strong></p></div><div style="display:contents" dir="ltr"><table id="2ceec18e-70ae-80b2-9e7e-d80f760da1c2" class="simple-table"><thead class="simple-table-header"><div style="display:contents" dir="ltr"><tr id="2ceec18e-70ae-80e3-b232-e8b58af6010c"><th id="omna" class="simple-table-header-color simple-table-header" style="width:236.33333333333334px">Bộ phận thực hiện</th><th id="MGl;" class="simple-table-header-color simple-table-header" style="width:537.328125px">Nội dung</th></tr></div></thead><tbody><div style="display:contents" dir="ltr"><tr id="2ceec18e-70ae-80ea-a633-d1bcfc2d69e7"><td id="omna" class="" style="width:236.33333333333334px">CSKH</td><td id="MGl;" class="" style="width:537.328125px"><strong>Bước 1 : Truy cập màn hình chi tiết shop.</strong><br/>• CSKH truy cập vào trang <em><mark class="highlight-default"><a href="http://dashboard.ghtk.vn/">dashboard.ghtk.vn</a></mark></em>, tại thanh chức năng chọn <code>Shop</code> → <code>Danh sách Shop</code> → tìm kiếm <code>mã Shop cần config</code> → bấm vào <code>Chi tiết</code> → truy cập màn hình cấu hình chi tiết của Shop<br/><strong>Bước 2 : Tại mục &quot;Đăng đơn&quot;</strong><br/>• CSKH tick chọn dịch vụ <code>Booking phân phối</code> và <code>Lưu thông tin</code><br/>*<em><strong><span style="border-bottom:0.05em solid">Lưu ý: </span></strong></em><em>Sau khi bấm lưu thông tin, vui lòng chờ 5 phút để config có hiệu lực</em></td></tr></div></tbody></table></div><div style="display:contents" dir="auto"></div><div style="display:contents" dir="auto"><p id="2ceec18e-70ae-8023-8871-fadf52db2fc4" class=""><strong>2.2. Chuẩn hoá kho sản phẩm.</strong></p></div><div style="display:contents" dir="ltr"><table id="2ceec18e-70ae-80cd-8e35-f94c0e842b35" class="simple-table"><thead class="simple-table-header"><div style="display:contents" dir="ltr"><tr id="2ceec18e-70ae-80cc-ac25-c7c08ecba943"><th id="UAXK" class="simple-table-header-color simple-table-header" style="width:236.33333333333334px">Bộ phận thực hiện</th><th id="gmAf" class="simple-table-header-color simple-table-header" style="width:520.328125px">Nội dung</th></tr></div></thead><tbody><div style="display:contents" dir="ltr"><tr id="2ceec18e-70ae-80b6-8f75-e5bb8ee89c9b"><td id="UAXK" class="" style="width:236.33333333333334px">CSKH | Shop</td><td id="gmAf" class="" style="width:520.328125px"><strong>Bước 1 : Truy cập màn hình chi tiết Shop tại màn : </strong><em><mark class="highlight-default"><a href="https://khachhang.ghtk.vn/web/kho-va-san-">https://khachhang.ghtk.vn/web/kho-va-san-ff</a></mark></em><br/>• CSKH/Shop truy cập vào thanh chức năng <code>Kho và sản phẩm</code><br/>• Trong giao diện chi tiết chọn <code>Xem</code> → <code>Chỉnh sửa</code> → cập nhật thông tin sản phẩm gồm :<br/>• Ảnh sản phẩm ( Bắt buộc nhập ).<br/>• Tên sản phẩm ( Bắt buộc nhập ).<br/>• Ngành hàng ( Bắt buộc nhập ).<br/>• Barcode ( Bắt buộc nhập ).<br/>• Khối lượng &amp; Kích thước<br/>• Giá, Tag<br/><strong>Bước 2 : Chọn </strong><code>Lưu sản phẩm</code></td></tr></div></tbody></table></div><div style="display:contents" dir="auto"></div><div style="display:contents" dir="auto"><h3 id="2ceec18e-70ae-8021-ba52-d0ba83f7adf6" class="">3. ĐĂNG ĐƠN</h3></div><div style="display:contents" dir="auto"><p id="2ceec18e-70ae-801d-b481-c3bbb0f5c9df" class=""><strong>3.1. Tạo PO ( PO điện tử ).</strong></p></div><div style="display:contents" dir="ltr"><table id="2ceec18e-70ae-807e-838e-df7e38e8efb0" class="simple-table"><thead class="simple-table-header"><div style="display:contents" dir="ltr"><tr id="2ceec18e-70ae-80bb-9fd7-e9be42fe8df4"><th id="eWmF" class="simple-table-header-color simple-table-header" style="width:236.33333333333334px">Bộ phận thực hiện</th><th id="&lt;qEt" class="simple-table-header-color simple-table-header" style="width:534.328125px">Nội dung</th></tr></div></thead><tbody><div style="display:contents" dir="ltr"><tr id="2ceec18e-70ae-8044-b8f9-e5ba69de6b48"><td id="eWmF" class="" style="width:236.33333333333334px"><strong>SHOP | SALE | DVKH</strong></td><td id="&lt;qEt" class="" style="width:534.328125px"><strong>📌 Tạo phiếu PO và đẩy đơn đồng thời :</strong><br/>- <strong><span style="border-bottom:0.05em solid">Bước 1:</span></strong> Truy cập vào màn hình <code>Phiếu PO</code><br/>  • Shop thực hiện đăng nhập vào web <mark class="highlight-default"><a href="http://khachhang.ghtk.vn/">http://khachhang.ghtk.vn/</a></mark><mark class="highlight-yellow"> </mark>→ vào mục       <code>Đơn hàng</code> <em>( hoặc mục vận hành với giao diện mới → </em><em><code>Phiếu PO</code></em><em> )</em><br/>- <strong><span style="border-bottom:0.05em solid">Bước 2:</span></strong> Tạo phiếu PO.<br/>  • Shop bấm <code>+ Phiếu PO</code> → hệ thống hiển thị màn hình tạo phiếu PO<br/>- <strong><span style="border-bottom:0.05em solid">Bước 3:</span></strong> Điền thông tin phiếu PO<br/> + <em>Cách 1: Shop điền thủ công các thông tin cần thiết của phiếu PO bao gồm:</em><br/>  • Thời gian lấy<br/>  • Thông tin giao hàng<br/>  • Thông tin sản phẩm<br/>  • Mã khách hàng của PO<br/>+ <em>Cách 2: Upload phiếu PO:</em><br/>  • Shop bấm vào <code>Upload phiếu</code> trên màn tạo, hệ thống mở ra thư viện để chọn file. Tại đây shop có thể chọn <em><mark class="highlight-yellow"><span style="border-bottom:0.05em solid">ảnh chụp</span></mark></em> hoặc <em><mark class="highlight-yellow"><span style="border-bottom:0.05em solid">file PO</span></mark></em> để tải lên<br/>* <em><strong><span style="border-bottom:0.05em solid">Lưu ý:</span></strong></em> <em>Cần liên hệ với </em><em><mark class="highlight-yellow"><span style="border-bottom:0.05em solid">hanhnm12</span></mark></em><em><mark class="highlight-yellow"> </mark></em><em>hoặc </em><em><mark class="highlight-yellow"><span style="border-bottom:0.05em solid">ngatpth1</span></mark></em><em> để cấu hình mẫu phiếu trước khi upload.</em><br/>- <strong>Bước 4 :</strong> Sau khi điền đầy đủ thông tin :<br/>  • Bấm <code>Tạo PO</code> → Hệ thống sinh ra mã PO ở trạng thái tạm.<br/>* <em><strong>Lưu ý:</strong></em> <em>Phiếu PO tạm được sử dụng để tài xế kéo tạo thành đơn hoặc shop kép tạo thành đơn.</em><br/></td></tr></div><div style="display:contents" dir="ltr"><tr id="2ceec18e-70ae-8004-b10e-f27e8de3a488"><td id="eWmF" class="" style="width:236.33333333333334px"><strong>SHOP | SALE | DVKH</strong></td><td id="&lt;qEt" class="" style="width:534.328125px"><strong>📌 Shop đăng đơn kèm phiếu tạm:</strong><br/><strong><span style="border-bottom:0.05em solid">Cách 1:</span></strong> Click vào <code>Tạo đơn hàng</code><br/> - Bước 1: Truy cập vào màn hình đăng đơn, bấm chọn <code>Đăng đơn PO</code>.<br/> - Bước 2: Chọn phiếu tạm đã tạo.<br/><em> * Shop thực hiện đăng nhiều PO hoặc từng PO một<br/></em>  <mark class="highlight-blue">+ TH1 :</mark> Chọn thủ công từng PO<br/>  • Shop bấm vào ô <code>Chọn PO</code> và <code>chọn phiếu</code> mong muốn → hệ thống tự động  điền các thông tin của PO vào đơn hàng.<br/>  <mark class="highlight-blue">+ TH2 :</mark> Chọn nhiều PO.<br/>  • Shop bấm vào mục <code>Danh sách PO</code> → chọn các PO cần đăng và bấm <code>Áp dụng</code>.<br/> - Bước 3 : Đăng đơn hàng<br/>  • Sau khi đã fill thông tin PO, shop chọn từng đơn hàng và bấm <code>Đăng đơn</code><br/>  • Các đơn hàng sau khi đăng sẽ được link tới PO đã chọn.<br/><strong><span style="border-bottom:0.05em solid">Cách 2 :</span></strong> <br/>- Bước 1 : Chọn phiếu PO tạm<br/>- Bước 2 : Nhấn chọn <code>Tạo đơn PO</code><br/>- Bước 3 : Bổ sung các thông tin yêu cầu để đăng đơn.<br/>- Bước 4 : Nhấn chọn <code>Đăng ĐH</code></td></tr></div></tbody></table></div><div style="display:contents" dir="auto"><hr id="2ceec18e-70ae-8018-ab4f-ef52a440ccfb"/></div><div style="display:contents" dir="auto"><p id="2ceec18e-70ae-80a7-9b63-f5d744452fde" class=""><strong>3.2. Tạo Booking phân phối</strong></p></div><div style="display:contents" dir="ltr"><table id="2ceec18e-70ae-803e-9504-feeb85525d0e" class="simple-table"><thead class="simple-table-header"><div style="display:contents" dir="ltr"><tr id="2ceec18e-70ae-800b-8374-e4ab193ceaea"><th id=":p&gt;`" class="simple-table-header-color simple-table-header" style="width:236.33333333333334px">Bộ phận thực hiện</th><th id="dh:[" class="simple-table-header-color simple-table-header" style="width:535.328125px">Nội dung</th></tr></div></thead><tbody><div style="display:contents" dir="ltr"><tr id="2ceec18e-70ae-8093-b0be-dce0f9660bc9"><td id=":p&gt;`" class="" style="width:236.33333333333334px"><strong>SHOP | SALE | DVKH</strong></td><td id="dh:[" class="" style="width:535.328125px">📌 Thao tác trên app :<br/>- <span style="border-bottom:0.05em solid">Bước 1:</span> Chọn tính năng <code>Booking xe</code><br/>  • Hệ thống hiển thị giao diện tạo Booking.<br/>- <span style="border-bottom:0.05em solid">Bước 2:</span> Điền thông tin tạo booking:<br/>  • Bản đồ : Hiển thị bản đồ với địa chỉ của shop<br/>  • Kho lấy : Mặc định hiển thị kho lấy mặc định của shop → <code>Click để mở danh sách</code> →. Mở lên bottomsheet danh sách địa chỉ kho lấy của shop.<br/>  • Thời gian hẹn lấy : Mặc định hiển ca lấy sớm nhất theo tiêu chuẩn của shop. Shop có config hẹn lấy cố định → hiển thị danh sách <code>thời gian hẹn cố định</code>.<br/>  • Hàng hoá : Mặc định hiển thị hint text. Bấm Chọn → bottomsheet <code>nhập KL, KT hàng hoá</code><br/>  • Lưu nháp : Shop <code>Lưu nháp</code> → Tạo ra 1 mã booking nháp với trạng thái <code>&quot;Chưa tiếp nhận&quot;</code>.<br/>  • Lưu thông tin : Shop bấm <code>Lưu thông tin</code> → Validate các thông tin bắt buộc → Lưu thông tin thành công → Pop-up <em>&quot;Tạo booking lấy hàng thành công, Vui lòng kiểm tra trong danh sách booking&quot;</em> và lưu log <em>&quot;Đã tạo booking, Đã tiếp nhận booking&quot;</em><br/><em><strong><span style="border-bottom:0.05em solid">Lưu ý : </span></strong></em><em>Các booking phải có thông tin khác nhau, trường thông tin booking trùng với booking đã có ( trừ trường hợp booking cũ đã huỷ hoặc hoàn thành ) → Báo lỗi &quot;Booking tương tự đã tồn tại và đang ở trạng thái &quot;</em><br/></td></tr></div><div style="display:contents" dir="ltr"><tr id="2ceec18e-70ae-8058-933c-e7fecd857356"><td id=":p&gt;`" class="" style="width:236.33333333333334px"><strong>SHOP | SALE | DVKH</strong></td><td id="dh:[" class="" style="width:535.328125px"><strong>📌 Thao tác trên web :</strong><br/> - <strong><span style="border-bottom:0.05em solid">Bước 1:</span></strong> Truy cập website cho shop: <mark class="highlight-gray"><a href="https://khachhang.ghtk.vn/">https://khachhang.ghtk.vn/</a></mark>, vào mục <code>Tạo đơn hàng</code>.<br/> - <strong><span style="border-bottom:0.05em solid">Bước 2:</span></strong> Chọn tính năng <code>Booking xe</code>, hệ thống hiển thị giao diện tạo booking<br/> - <strong><span style="border-bottom:0.05em solid">Bước 3:</span></strong> Điền thông tin để tạo booking.<br/>  • Các thông tin tương tự như trên app.</td></tr></div></tbody></table></div></div></div><div style="display:contents" dir="auto"><hr id="2ceec18e-70ae-8064-a404-fce4fd6451a6"/></div><div style="display:contents" dir="auto"><p id="2ceec18e-70ae-8093-8914-da5363dcaed9" class=""><strong>3.3. Phân phối xe tải lấy hàng</strong></p></div><div style="display:contents" dir="ltr"><table id="2ceec18e-70ae-8043-a7f1-f27b4830da83" class="simple-table"><thead class="simple-table-header"><div style="display:contents" dir="ltr"><tr id="2ceec18e-70ae-80c1-b587-f6ee9490cee6"><th id="Wds;" class="simple-table-header-color simple-table-header" style="width:236.33333333333334px">Bộ phận thực hiện</th><th id="avRo" class="simple-table-header-color simple-table-header" style="width:570.328125px">Nội dung</th></tr></div></thead><tbody><div style="display:contents" dir="ltr"><tr id="2ceec18e-70ae-80d8-99d5-e4aa1a20c026"><td id="Wds;" class="" style="width:236.33333333333334px"><strong>VHXT | TECH</strong></td><td id="avRo" class="" style="width:570.328125px">- <strong><span style="border-bottom:0.05em solid">Bước 1:</span></strong> Vận hành xe tải thao tác config kịch bản nổ điểm Lấy tại màn: <a href="https://bbs.ghtk.vn/bbs-">https://bbs.ghtk.vn/bbs-scenario</a> <em>(Config như kịch bản nổ điểm BBS)</em><br/> • Config nổ shop cố định: Shop phát sinh hàng cố định hàng ngày.<br/> • Config nổ shop : Shop phát sinh hàng không cố định.<br/>- <strong><span style="border-bottom:0.05em solid">Bước 2:</span></strong> Khi shop tạo booking:<br/> + Hệ thống check thông tin booking và tìm kịch bản thoả mãn nổ xe tải :<br/>  • <mark class="highlight-blue">UT1</mark>: Kịch bản nổ shop cố định ( Nổ gom theo thời gian config cố định trong kịch bản ).<br/>  • <mark class="highlight-blue">UT2</mark>: Kịch bản nổ shop ( Ưu tiên nổ theo thời gian hẹn trong leadtime hẹn lấy booking ).<br/>- <strong><span style="border-bottom:0.05em solid">Bước 3:</span></strong> Từ kịch bản thoả mãn:<br/>  • Hệ thống tìm ra được xe, được config trong kịch bản thoả mãn.<br/>- <strong><span style="border-bottom:0.05em solid">Bước 4:</span></strong> Nổ điểm lấy lên tuyến của tài xế:<br/>  • Trường hợp fail nổ xe tải lấy (<em> không đảm bảo dư địa, không có kịch bản nào thoả mãn)</em> → Tech support đẩy tay.<br/><em><strong><span style="border-bottom:0.05em solid">Yêu cầu:</span></strong></em> <em>Cần có kịch bản nổ điểm để hệ thống có thể điều phối xe tải đến shop lấy hàng.</em></td></tr></div></tbody></table></div><div style="display:contents" dir="auto"><hr id="2ceec18e-70ae-802c-874b-ee3fc633d81f"/></div><div style="display:contents" dir="auto"><h3 id="2ceec18e-70ae-804c-99de-f363da316462" class="">4. VẬN HÀNH.</h3></div><div style="display:contents" dir="auto"><p id="2ceec18e-70ae-800d-b61e-da5c6577a459" class=""><strong>4.1. PO điện tử ( PO shop tạo sẵn).</strong></p></div><div style="display:contents" dir="ltr"><table id="2ceec18e-70ae-807e-9bd7-dd2afb44fde9" class="simple-table"><thead class="simple-table-header"><div style="display:contents" dir="ltr"><tr id="2ceec18e-70ae-80f1-a547-fbd98377795d"><th id="N&lt;t`" class="simple-table-header-color simple-table-header" style="width:236.33333333333334px">Bộ phận thực hiện</th><th id="CN?i" class="simple-table-header-color simple-table-header" style="width:562.328125px">Nội dung</th></tr></div></thead><tbody><div style="display:contents" dir="ltr"><tr id="2ceec18e-70ae-809f-9a37-e4c032cb95c6"><td id="N&lt;t`" class="" style="width:236.33333333333334px"><strong>VHXT - TÀI XẾ | LM - COD</strong></td><td id="CN?i" class="" style="width:562.328125px">- <strong><span style="border-bottom:0.05em solid">Bước 1:</span></strong> Tại màn hình các thao tác với điểm dừng chọn <code>QUÉT PHIẾU</code>.<br/>- <strong><span style="border-bottom:0.05em solid">Bước 2:</span></strong> Trong popup chọn đơn hoặc phiếu muốn tạo: Chọn action <code>Tạo phiếu PO</code>.<br/>- <strong><span style="border-bottom:0.05em solid">Bước 3:</span></strong> Tại màn hình tạo phiếu PO: Chọn action <code>KÉO THÊM</code><br/>- <strong><span style="border-bottom:0.05em solid">Bước 4:</span></strong> Kiểm tra các<em><strong> &quot;Dịch vụ gia tăng&quot;</strong></em> :<br/> • Nếu shop đăng kí các dịch vụ gia tăng và shop có nhu cầu → <code>Chọn dịch vụ</code> khi tạo PO → TX cần tích chọn đúng, đủ dịch vụ shop mong muốn <em>(các dịch vụ shop luôn đăng ký chọn sẽ được mặc định chọn trên màn hình)</em><br/> • Nếu shop không đăng ký các dịch vụ gia tăng → Phần dịch vụ gia tăng sẽ không hiển thị dịch vụ nào<br/>- <strong><span style="border-bottom:0.05em solid">Bước 5:</span></strong> Tại màn hình danh sách các phiếu ở ‘<em>trạng thái Tạm thời’</em> của shop: <code>Chọn PO</code> mong muốn kéo thêm trong danh sách.<br/> • Sau khi chọn HT fill sẵn thông tin của PO trên form tạo.<br/>- <strong><span style="border-bottom:0.05em solid">Bước 6:</span></strong> Kiểm tra lại thông tin sản phẩm trong danh sách khớp với số lượng thực tế được bàn giao<br/> • Bấm <code>Xác nhận</code> và tạo phiếu.</td></tr></div></tbody></table></div><div style="display:contents" dir="auto"><hr id="2ceec18e-70ae-808c-a28e-da6095d04184"/></div><div style="display:contents" dir="auto"><p id="2ceec18e-70ae-803e-b1f7-f89c15868c85" class=""><strong>4.2.  PO tiêu chuẩn ( Shop tạo booking phân phối ).</strong></p></div><div style="display:contents" dir="ltr"><table id="2ceec18e-70ae-80ac-90f2-ca21a3c6c099" class="simple-table"><thead class="simple-table-header"><div style="display:contents" dir="ltr"><tr id="2ceec18e-70ae-805b-8b2e-da7279fbbfa4"><th id="uZZ[" class="simple-table-header-color simple-table-header" style="width:236.33333333333334px">Bộ phận thực hiện</th><th id="b^zc" class="simple-table-header-color simple-table-header" style="width:554.328125px">Nội dung</th></tr></div></thead><tbody><div style="display:contents" dir="ltr"><tr id="2ceec18e-70ae-8040-a15d-f5bfb9429e7f"><td id="uZZ[" class="" style="width:236.33333333333334px"><strong>VHXT - TÀI XẾ | LM - COD</strong></td><td id="b^zc" class="" style="width:554.328125px"><strong>📌 Thao tác chung :</strong><br/>• Truy cập vào ứng dụng <a href="http://ghtk.co/">GHTK.Co</a>.<br/>• Tài xế chọn menu các điểm đang cần xử lý.<br/>• Tại màn hình danh sách các điểm: Tài xế chọn điểm <code>LẤY HÀNG</code> có label <code>Có hàng phân phối</code><br/>• Tại màn hình các action thực hiện với điểm → chọn action <code>Quét phiếu</code><br/>• Chọn <code>Tạo phiếu PO</code><br/></td></tr></div><div style="display:contents" dir="ltr"><tr id="2ceec18e-70ae-80a0-b490-faa055f77a05"><td id="uZZ[" class="" style="width:236.33333333333334px"><strong>VHXT - TÀI XẾ | LM - COD</strong></td><td id="b^zc" class="" style="width:554.328125px">🚫 <strong>Shop không có PO vật lý :</strong><br/>- <strong><span style="border-bottom:0.05em solid">Bước 1:</span></strong> Tại màn hình các thông tin cần nhập để tạo phiếu → Tài xế nhập các thông tin người nhận hàng (do ‘<em>shop cung cấp’</em> hoặc team ‘<em>Sale phụ trách’</em> shop cung cấp) &amp; <code>chọn sản phẩm</code>.<br/> • Nếu shop đăng kí các dịch vụ gia tăng và shop có nhu cầu chọn dịch vụ đó khi tạo PO → TX cần tích chọn đúng, đủ dịch vụ shop mong muốn (các dịch vụ shop luôn đăng ký chọn sẽ được mặc định chọn trên màn hình).<br/> • Nếu shop không đăng ký các dịch vụ gia tăng → Phần dịch vụ gia tăng sẽ không hiển thị dịch vụ nào.<br/>- <strong><span style="border-bottom:0.05em solid">Bước 2:</span></strong> Thêm sản phẩm vào PO.<br/> • TH1 : Đối với sản phẩm đã chuẩn hóa trước trong kho sản phẩm → Nhập <code>tên sản phẩm</code> cần tìm.<br/> • TH2 : Đối với sản phẩm ‘<em><strong>Chưa’</strong></em> có trong kho sản phẩm → TX chọn button <code>Thêm mới</code> → Nhập thông tin sản phẩm ( bắt buộc ) → <code>Chọn số lượng &gt; 0</code><br/>- <strong><span style="border-bottom:0.05em solid">Bước 3:</span></strong> Sau khi điền đủ thông tin trên form <code>Tạo Phiếu</code> → Tài xế bấm <code>Xác nhận</code> để  tạo <em>‘Đơn phân phối’</em><br/>- <strong><span style="border-bottom:0.05em solid">Bước 4:</span></strong> Kiểm tra lại thông tin sản phẩm trong danh sách khớp với số lượng thực tế được bàn giao.<br/> • Bấm <code>Xác nhận</code> và <code>tạo phiếu</code></td></tr></div></tbody></table></div><div style="display:contents" dir="auto"><hr id="2ceec18e-70ae-80a9-973a-d0343c52d958"/></div><div style="display:contents" dir="auto"><div id="2ceec18e-70ae-809d-84ca-ec891990722e" class="column-list"><div style="display:contents" dir="auto"><div id="2ceec18e-70ae-80e4-92ef-e3186d0f3922" style="width:50%" class="column"><div style="display:contents" dir="auto"><ol type="a" id="2ceec18e-70ae-80eb-a339-d3c9e3cbb0dc" class="numbered-list" start="1"><li>Khách mua lần đầu</li></ol></div></div></div><div style="display:contents" dir="auto"><div id="2ceec18e-70ae-80b9-a497-fb636247d20c" style="width:50%" class="column"><div style="display:contents" dir="auto"><p id="2ceec18e-70ae-8098-a228-ffd51e99bd51" class="">b.  Đối với khách hàng cũ</p></div></div></div></div></div><div style="display:contents" dir="auto"><hr id="2ceec18e-70ae-80c5-9392-fad47a185671"/></div><div style="display:contents" dir="ltr"><table id="2ceec18e-70ae-8087-aa3a-f32aff8f25a6" class="simple-table"><thead class="simple-table-header"><div style="display:contents" dir="ltr"><tr id="2ceec18e-70ae-8007-b291-daa2dbedd007"><th id="s]X&lt;" class="simple-table-header-color simple-table-header" style="width:236.33333333333334px">Bộ phận thực hiện</th><th id="KMVb" class="simple-table-header-color simple-table-header" style="width:549.328125px">Nội dung</th></tr></div></thead><tbody><div style="display:contents" dir="ltr"><tr id="2ceec18e-70ae-80c7-bcbc-f984a0158cf4"><td id="s]X&lt;" class="" style="width:236.33333333333334px"><strong>VHXT - TÀI XẾ | LM - COD</strong></td><td id="KMVb" class="" style="width:549.328125px"><strong>📋 Shop có PO vật lý:</strong><br/> - <strong><span style="border-bottom:0.05em solid">Bước 1:</span></strong> Tại màn hình các thông tin cần nhập để tạo phiếu → <code>Tài xế chọn UpLoad</code> → HT hiển thị màn hình camera để chụp ảnh trực tiếp.<br/>  • Nếu shop gửi ‘<em>file ảnh’</em> hoặc ‘<em>file PDF’</em> có thể chọn action <code>Tải lên</code> → Chọn ảnh hoặc file PDF mong muốn.<br/> - <strong><span style="border-bottom:0.05em solid">Bước 2:</span></strong> Hệ thống tự đọc các thông tin từ ảnh/file để trả ra màn hình preview sản phẩm:<br/> + <mark class="highlight-blue">TH1</mark>: Sản phẩm đã được chuẩn hóa trong kho sản phẩm<br/>  • Nếu tất cả sản phẩm trong danh sách đã <code>Hợp lệ</code> → TX chọn nút <code>Tiếp tục</code> để chuyển các thông tin về màn tạo phiếu.<br/>  • Nếu tất cả sản phẩm trong danh sách <code>Không hợp lệ</code> TX chọn nút <code>tìm kiếm</code> lại sản phẩm theo ‘<em>mã SKU’</em> / ‘<em>Barcode’</em> đúng <em>(vì có thể HT đã đọc nhầm số trong bộ mã SKU và không tìm được sản phẩm đúng)</em> → Sửa các <code>sản phẩm</code> thành hợp lệ → TX chọn nút <code>Tiếp tục</code> để chuyển các thông tin về màn tạo phiếu.<br/> + <mark class="highlight-blue">TH2</mark>: Sản phẩm <code>CHƯA</code> được tạo hoặc chuẩn hóa trong kho sản phẩm<br/>  • HT kiểm tra ‘<em>mã barcode’ </em>/ ‘<em>mã SKU’</em> không trùng với thông tin của bất kì sản phẩm nào trong <em>‘Kho sản phẩm’</em> → sản phẩm đó có trạng thái là ‘<em>sản phẩm mới’</em><br/>  • Với sản phẩm mới tài xế có thể xem thông tin hoặc chỉnh sửa thông tin <em>(không bắt buộc chỉnh sửa)</em> → HT set sẵn các giá trị tối thiếu đối với thông tin sản phẩm như <code>giá bán</code>, <code>giá nhập</code>, <code>khối lượng</code>, <code>kích thướcDxRxC</code> | <code>Tên sản phẩm</code> &amp; <code>số lượng</code> → HT trích xuất từ PO bàn giao hàng hóa vừa upload.</td></tr></div></tbody></table></div><div style="display:contents" dir="auto"><div id="2ceec18e-70ae-80f6-bd74-e479d0bae050" class="column-list"><div style="display:contents" dir="auto"><div id="2ceec18e-70ae-8040-85be-f4f98003d3f7" style="width:50%" class="column"><div style="display:contents" dir="auto"><p id="2ceec18e-70ae-804b-bd94-d10f68124eae" class=""><code>Shop đăng ký DVGT</code></p></div></div></div><div style="display:contents" dir="auto"><div id="2ceec18e-70ae-8070-99c2-d4a6ead4dfbe" style="width:50%" class="column"><div style="display:contents" dir="auto"><p id="2ceec18e-70ae-8016-9073-f16a13adce65" class=""><code>Shop không đăng ký DVGT</code></p></div></div></div></div></div><div style="display:contents" dir="auto"><hr id="2ceec18e-70ae-8005-8d32-c85d62aaff0f"/></div><div style="display:contents" dir="auto"><p id="2ceec18e-70ae-8059-9933-dff7f791d193" class=""><strong>4.3. Xử lý tại điểm.</strong></p></div><div style="display:contents" dir="ltr"><table id="2ceec18e-70ae-80a3-91a5-c10810e8110f" class="simple-table"><thead class="simple-table-header"><div style="display:contents" dir="ltr"><tr id="2ceec18e-70ae-80e1-9fea-f48be2a4c673"><th id="?w[x" class="simple-table-header-color simple-table-header" style="width:236.33333333333334px">Bộ phận thực hiện</th><th id="wNmR" class="simple-table-header-color simple-table-header" style="width:547.328125px">Nội dung</th></tr></div></thead><tbody><div style="display:contents" dir="ltr"><tr id="2ceec18e-70ae-804f-9598-e498bf1089a0"><td id="?w[x" class="" style="width:236.33333333333334px"><strong>VHXT - TÀI XẾ | LM - COD</strong></td><td id="wNmR" class="" style="width:547.328125px">📦 <strong>Vận hành không theo vật chứa:</strong><br/> - <strong><span style="border-bottom:0.05em solid">Bước 1:</span></strong> <mark class="highlight-default">In mã SKU sản phẩm ( Bắt buộc )</mark><br/>  • Bấm chọn để <code>in mã SKU sản phẩm</code> <em>(Áp dụng trong trường hợp sản phẩm shop bàn giao chưa có mã barcode trên thùng/bao, trường hợp sản phẩm đã có sẵn mã tài xế bỏ qua bước này)</em>.<br/>  • Chọn checkbox <code>Sản phẩm</code> muốn in mã <em>(có thể chọn tất cả sản phẩm trong danh sách)</em> → HT tự động hiển thị ‘<em>số lượng’</em> của mỗi sản phẩm trong phiếu → cho phép thay đổi số lượng trong trường hợp muốn in ít hơn.<br/>  • Chọn nút <code>In mã</code> để tiến hành in.<br/> *<em><strong>Lưu ý:</strong></em> <em>In mã SKU sản phẩm đối với các sản phẩm không có barcode trên thùng/ bao hàng</em>:<br/>  • Tại màn <code>Lấy hàng</code>: Tài xế chọn button <code>Xem thông tin phiếu</code> → HT hiển thị màn hình chi tiết phiếu.<br/>  • Tài xế chọn button <code>In mã SKU</code> → HT mở popup cho phép người dùng kết nối với <code>máy in</code> → Tài xế chọn <code>thiết bị in</code> cần kết nối → HT cho phép in các SKU tương ứng với từng sản phẩm.<br/>  • Tài xế chọn <code>sản phẩm</code> muốn in mã SKU → Tài xế dùng mã đã in để dán lên bao/ thùng SP chưa có mã để xử lý hàng hóa ở các khâu vận hành sau khi lấy thành công.<br/> - <strong><span style="border-bottom:0.05em solid">Bước 2:</span></strong> Kiểm tra lại thông tin sản phẩm trong danh sách khớp với số lượng thực tế được bàn giao → Bấm <code>Xác nhận</code> và <code>tạo phiếu</code><br/> - <strong><span style="border-bottom:0.05em solid">Bước 3:</span></strong> Tài xế <code>kéo phiếu</code> &amp; <code>Update thông tin</code> phiếu mới thành công → Lấy hàng đúng đủ số lượng trên PO.</td></tr></div></tbody></table></div><div style="display:contents" dir="auto"><p id="2ceec18e-70ae-804a-832c-e28649bccd0f" class=""><code>In mã mặc định khi lấy đơn</code></div></div></p></div><div style="display:contents" dir="auto"><p id="2ceec18e-70ae-8067-832c-c8902286ebc7" class=""><code>In trong chi tiết phiếu</code></div></div></p></div><div style="display:contents" dir="auto"><hr id="2ceec18e-70ae-80f6-a836-ca0d426a0d8f"/></div><div style="display:contents" dir="ltr"><table id="2ceec18e-70ae-8074-8925-ef32698e3be0" class="simple-table"><thead class="simple-table-header"><div style="display:contents" dir="ltr"><tr id="2ceec18e-70ae-803b-9897-e61e45ce4f0e"><th id="iFKp" class="simple-table-header-color simple-table-header" style="width:236.33333333333334px">Bộ phận thực hiện</th><th id="{sYe" class="simple-table-header-color simple-table-header" style="width:595.328125px">Nội dung</th></tr></div></thead><tbody><div style="display:contents" dir="ltr"><tr id="2ceec18e-70ae-805b-b0ba-d224a98b7d89"><td id="iFKp" class="" style="width:236.33333333333334px"><strong>VHXT - TÀI XẾ | LM - COD</strong></td><td id="{sYe" class="" style="width:595.328125px"><strong>🕋 Vận hành theo vật chứa :</strong><br/> - <strong><span style="border-bottom:0.05em solid">Bước 1:</span></strong> Sau khi tạo PO thành công → TX thao tác in ‘<em>mã Pallet’</em> bằng cách click chọn <code>In mã Pallet</code>.<br/> - <strong><span style="border-bottom:0.05em solid">Bước 2:</span></strong> Chọn loại mã cần in.<br/>  + Pallet của khách hàng:<br/>   • TX chọn <code>Mã Pallet đối tác</code> và <code>nhập số lượng</code>.<br/>  + Pallet G ( GHTK ):<br/>   • TX chọn <code>Mã Pallet của GHTK</code> → Chọn <code>mã pallet</code> từ danh sách.<br/> - <strong><span style="border-bottom:0.05em solid">Bước 3:</span></strong> Gán <code>Sản phẩm</code> lên pallet:<br/>   • Chọn <code>Gán Pallet</code> → <code>Chọn PO cần gán</code> → Chọn <code>Sản Phẩm</code> cần gán vào pallet ( Có thể chọn tất cả ) → <code>Scan mã pallet</code> → Nhập <code>SL gán</code> → Chọn <code>Xác nhận</code> → popup <code>Gán pallet thành công</code> → <code>Ok</code><br/>• Thao tác <code>Gán Pallet</code> có thể thực hiện tại điểm lấy hàng hoặc tại Hub, tuỳ vào vận hành thực tế.<br/> - <strong><span style="border-bottom:0.05em solid">Bước 4:</span></strong> Kiểm tra lại thông tin sản phẩm trong danh sách trên pallet khớp với số lượng thực tế được bàn giao → Bấm <code>Xác nhận</code> và <code>tạo phiếu</code>.<br/> - <strong><span style="border-bottom:0.05em solid">Bước 5:</span></strong> Tài xế <code>kéo phiếu</code> &amp; <code>Update</code> thông tin phiếu mới thành công → Lấy hàng đúng đủ số lượng pallet trên PO.<br/> - <strong><span style="border-bottom:0.05em solid">Bước 6:</span></strong> Hệ thống gửi BBBG cho Shop</td></tr></div></tbody></table></div><div style="display:contents" dir="auto"><p id="2ceec18e-70ae-8051-b9c4-d9f138f64afe" class=""><code>Gán vật chứa ( Pallet ) khi lấy hàng</code></p></div><div style="display:contents" dir="auto"><hr id="2ceec18e-70ae-80d5-a0c8-df050a946f4b"/></div><div style="display:contents" dir="auto"></div><div style="display:contents" dir="auto"><h3 id="2ceec18e-70ae-8015-bf55-c1aa534c4e83" class="">5. HUB.</h3></div><div style="display:contents" dir="auto"><p id="2ceec18e-70ae-808f-971e-fc8b9f153e1f" class=""><strong>5.1. Nhập kho nguồn.</strong></p></div><div style="display:contents" dir="ltr"><table id="2ceec18e-70ae-8053-9c6b-f22573be56d2" class="simple-table"><thead class="simple-table-header"><div style="display:contents" dir="ltr"><tr id="2ceec18e-70ae-8077-82f4-cc37d8322d3b"><th id="le{x" class="simple-table-header-color simple-table-header" style="width:236.33333333333334px">Bộ phận thực hiện</th><th id="tdXD" class="simple-table-header-color simple-table-header" style="width:591.328125px">Nội dung</th></tr></div></thead><tbody><div style="display:contents" dir="ltr"><tr id="2ceec18e-70ae-8079-8db0-cfa6b05b9078"><td id="le{x" class="" style="width:236.33333333333334px"><strong>VHXT - TÀI XẾ</strong></td><td id="tdXD" class="" style="width:591.328125px"><strong>📌 TX gửi yêu cầu nhập kho.</strong><br/>- <strong><span style="border-bottom:0.05em solid">Bước 1:</span></strong> Chọn truy cập vào ứng dụng.<br/>- <strong><span style="border-bottom:0.05em solid">Bước 2:</span></strong> Chọn <code>Nhập kho BBS</code> → HT hiển thị danh sách các đơn cần gửi yêu cầu nhập kho theo - điều kiện tương tự đơn hàng.<br/>- <strong><span style="border-bottom:0.05em solid">Bước 3:</span></strong> Click <code>chọn đơn hàng</code> cần gửi yêu cầu nhập kho → Gửi yêu cầu thành công HT hiện thị thông báo <em>&quot;đã gửi yêu cầu nhập kho thành công&quot;</em><br/>- <strong><span style="border-bottom:0.05em solid">Bước 4:</span></strong> Tài xế chờ XLHH/ NVBC <code>xác nhận</code>.</td></tr></div><div style="display:contents" dir="ltr"><tr id="2ceec18e-70ae-802c-bfc4-c4edb08da42a"><td id="le{x" class="" style="width:236.33333333333334px"><strong>HUB - XLHH</strong></td><td id="tdXD" class="" style="width:591.328125px">- <strong><span style="border-bottom:0.05em solid">Bước 5:</span></strong> Chọn truy cập vào ứng dụng<br/>- <strong><span style="border-bottom:0.05em solid">Bước 6:</span></strong> Chọn menu <code>Xác nhận hàng BBS</code> → Chọn <code>Bấm để chọn xe tải</code> → Nhập thông tin ‘<em>biển số xe’</em> để tìm xe → HT hiển thị danh sách các đơn hàng thường và đơn phân phối.<br/><em><strong>*Lưu ý:</strong></em> <em>Các đơn theo luồng phân phối hiện tại được gắn tag đơn </em><em><code>&quot;Đơn phân phối”</code></em></td></tr></div><div style="display:contents" dir="ltr"><tr id="2ceec18e-70ae-8091-8e6e-d9a0c8ac47d1"><td id="le{x" class="" style="width:236.33333333333334px"><strong>HUB - XLHH</strong></td><td id="tdXD" class="" style="width:591.328125px"><strong>📦 Luồng PO không gán vật chứa.</strong><br/> - Chọn <code>xem danh sách SKU</code> của đơn (phiếu) → HT hiển thị danh sách SKU của phiếu<br/> - Click <code>scan</code> để mở camera quét mã barcode sản phẩm → Click lại lần nữa để đóng<br/>camera.<br/>  • User lia camera vào <code>sản phẩm cần quét</code> -&gt; HT quét mã thành công hiển thị trường cho phép nhập số lượng cần xử lý.<br/>  • User kiểm đếm <code>sản phẩm</code> và <code>nhập số lượng</code> cần xử lý.<br/>  • Trong trường hợp đơn có <code>nhiều sản phẩm</code> → User thao tác tương tự với các sản phẩm còn lại trong danh sách<br/> - Chọn <code>Xác nhận</code> :<br/>  • HT ghi nhận nhập hàng cho SP vừa quét với số lượng hàng hóa tương ứng đã nhập ở trường số lượng.<br/>  • HT sinh log nhập hàng trung chuyển cho đơn hàng khi nhập đủ số lượng sản phẩm của SKU cuối cùng trong đơn (phiếu)<br/> - Chọn <code>Hoàn thành</code> → <code>chốt nhập</code> → <code>chốt seal</code> <em>(nếu xe cần chốt seal)</em> → và hoàn thành nhập hàng</td></tr></div></tbody></table></div><div style="display:contents" dir="auto"><div id="2ceec18e-70ae-80fb-83db-d0876efae352" class="column-list"><div style="display:contents" dir="auto"><div id="2ceec18e-70ae-8038-a702-e4ca4086d757" style="width:50%" class="column"><div style="display:contents" dir="auto"><p id="2ceec18e-70ae-80d6-ac7c-e9fc414c82ac" class=""><code>Tài xế gửi yêu cầu nhập kho</code></p></div><div style="display:contents" dir="auto"><p id="2ceec18e-70ae-80ff-8cd3-c50053b80b7e" class=""><code>Gán pallet với đơn chưa gán.</code></p></div></div></div><div style="display:contents" dir="auto"><div id="2ceec18e-70ae-802d-bb6f-ecfa6dfdc805" style="width:50.00000000000004%" class="column"><div style="display:contents" dir="auto"><p id="2ceec18e-70ae-80b6-a12e-dff9aa7b273a" class=""><code>Xử lý hàng hoá duyệt yêu cầu nhập kho</code></p></div><div style="display:contents" dir="auto"></div></div></div></div></div><div style="display:contents" dir="auto"><hr id="2ceec18e-70ae-8005-b3d4-f17a25258a5a"/></div><div style="display:contents" dir="ltr"><table id="2ceec18e-70ae-80ed-9e7f-dfd91d7f397e" class="simple-table"><thead class="simple-table-header"><div style="display:contents" dir="ltr"><tr id="2ceec18e-70ae-8068-8124-edaa6c68de74"><th id="cip}" class="simple-table-header-color simple-table-header" style="width:236.33333333333334px">Bộ phận thực hiện</th><th id="@hS^" class="simple-table-header-color simple-table-header" style="width:604.328125px">Nội dung</th></tr></div></thead><tbody><div style="display:contents" dir="ltr"><tr id="2ceec18e-70ae-8057-951a-cb9ed3eb3842"><td id="cip}" class="" style="width:236.33333333333334px"><strong>HUB - XLHH</strong></td><td id="@hS^" class="" style="width:604.328125px">🕋 <strong>Luồng PO có gán vật chứa ( Thao tác trên vật chứa )</strong>.<br/> + <strong><span style="border-bottom:0.05em solid">TH1:</span></strong> Nhập kho đối với đơn đã được gán vật chứa.<br/>  • Quét mã <code>Pallet</code> đã gán vật chứa → HT hiển thị số lượng <em>&quot;Pallet&quot;</em> đã quét và hiển thị số lượng <code>Sản phẩm</code> đã được gán.<br/>  • Chọn <code>Xác nhận</code> và hoàn tất nhập kho → HT hiển thị thông báo <em>&quot;Nhập kho thành công cho các phiếu&quot;</em> → chọn <code>Ok</code> để hoàn tất nhập kho<br/> + <strong><span style="border-bottom:0.05em solid">TH2:</span></strong> Nhập kho đối với đơn chưa gán vật chứa ( TX chưa gán vật chứa tại điểm ).<br/>  • HT hiển thị thông báo <em>&quot;Đơn hàng cần gán với vật chứa”</em>. Vui lòng thao tác gán hoặc nhập kho <code>theo mã SKU</code> → chọn <code>Gán ngay</code> → Chọn <code>Sản phẩm</code> cần gán vào vật chứa ( có thể chọn tất cả ) → chọn <code>Gán Pallet</code> → HT hiển thị danh sách sản phẩm cần gán → Nhập số lượng <code>Sản phẩm</code> cần gán vào vật chứa → chọn <code>Xác nhận</code> → HT hiển thị thông báo <code>Gán pallet thành công</code> → chọn <code>Ok</code> → HT hiển thị thông báo <em>&quot;Nhập kho thành công&quot;</em> → chọn <code>Ok</code> để hoàn tất nhập kho. </td></tr></div></tbody></table></div><div style="display:contents" dir="auto"><p id="2ceec18e-70ae-80a4-874e-d7c83f2d0867" class=""><code>Nhập kho với đơn đã gán pallet</code></p></div><div style="display:contents" dir="auto"><hr id="2ceec18e-70ae-80a0-b8df-e622b8a5aa6a"/></div><div style="display:contents" dir="auto"><p id="2ceec18e-70ae-80c2-b21a-d93e777e74ff" class=""><strong>5.2. Nhập kho trung chuyển.</strong></p></div><div style="display:contents" dir="ltr"><table id="2ceec18e-70ae-8067-936c-cd745269b96d" class="simple-table"><thead class="simple-table-header"><div style="display:contents" dir="ltr"><tr id="2ceec18e-70ae-8056-9c2b-c9653bacfbc5"><th id="N\Zk" class="simple-table-header-color simple-table-header" style="width:236.33333333333334px">Bộ phận thực hiện</th><th id="N[TS" class="simple-table-header-color simple-table-header" style="width:632.328125px">Nội dung</th></tr></div></thead><tbody><div style="display:contents" dir="ltr"><tr id="2ceec18e-70ae-809d-b05c-ca400bbbbefc"><td id="N\Zk" class="" style="width:236.33333333333334px"><strong>HUB - XLHH</strong></td><td id="N[TS" class="" style="width:632.328125px">- <strong><span style="border-bottom:0.05em solid">Bước 1:</span></strong> Chọn truy cập vào ứng dụng → Chọn menu <code>Nhập hàng</code><br/>- <strong><span style="border-bottom:0.05em solid">Bước 2:</span></strong> Nhập và <code>chọn BKS xe</code> cần nhập hàng → HT hiển thị danh sách các đơn cần nhập vào kho trung chuyển :<br/> • Điều kiện hiển thị đơn cần nhập theo config đường đi</td></tr></div><div style="display:contents" dir="ltr"><tr id="2ceec18e-70ae-8097-9642-c77b4b97506b"><td id="N\Zk" class="" style="width:236.33333333333334px"><strong>HUB - XLHH</strong></td><td id="N[TS" class="" style="width:632.328125px"><strong>📦 Luồng PO không gán vật chứa</strong><br/> - Chọn <code>xem danh sách SKU</code> của đơn (phiếu) → HT hiển thị danh sách SKU của phiếu.<br/> - Click chọn nút <code>scan</code> để mở camera quét mã barcode sản phẩm → Click lại lần nữa để đóng<br/>camera.<br/>  • User lia camera vào <code>sản phẩm</code> cần quét -&gt; HT quét mã thành công hiển thị trường cho phép nhập số lượng cần xử lý.<br/>  • User kiểm đếm <code>sản phẩm</code> và nhập số lượng cần xử lý và trường nhập.<br/>  • Trong trường hợp đơn có nhiều sản phẩm -&gt; User thao tác tương tự với các sản phẩm còn lại<br/>trong danh sách.<br/> - Click button <code>Xác nhận</code><br/>  • HT ghi nhận xuất hàng cho SP vừa quét với số lượng hàng hóa tương ứng đã nhập ở trường số lượng.<br/>  • HT sinh log xuất hàng trung chuyển cho đơn hàng khi nhập đủ số lượng sản phẩm của SKU cuối cùng trong đơn (phiếu).<br/> - Click button <code>Hoàn thành → chốt nhập → chốt seal</code> <em>(nếu xe cần chốt seal)</em> → và hoàn<br/>thành xuất hàng.</td></tr></div><div style="display:contents" dir="ltr"><tr id="2ceec18e-70ae-804e-8ca8-f8631c5b90d4"><td id="N\Zk" class="" style="width:236.33333333333334px"><strong>HUB - XLHH</strong></td><td id="N[TS" class="" style="width:632.328125px"><strong>🕋 Luồng PO có gán vật chứa ( Thao tác trên vật chứa )</strong><br/>• Chọn <code>đơn hàng</code> cần thao tác → HT hiển thị <em>&quot;Danh sách Pallet gán với phiếu&quot;</em> → Quét <code>mã vật chứa</code><br/>→ HT hiển thị số lượng <code>Pallet</code> và số lượng <code>Sản phẩm</code> → Chọn <code>Xác nhận</code> <em>(Tuỳ chọn xem chi tiết &quot;Vật chứa gán với phiếu&quot;</em> và thông tin chi tiết sản phẩm có trong vật chứa ) → Chọn <code>Hoàn thành</code>để hoàn tất nhập kho.</td></tr></div></tbody></table></div><div style="display:contents" dir="auto"><div id="2ceec18e-70ae-809e-92b5-cb4bd3ad22f7" class="column-list"><div style="display:contents" dir="auto"><div id="2ceec18e-70ae-8066-8063-d2b128fafdb4" style="width:50%" class="column"><div style="display:contents" dir="auto"><p id="2ceec18e-70ae-8023-afb7-f72e13ed5b56" class=""><code>PO gán vật chứa ( pallet )</code></p></div></div></div><div style="display:contents" dir="auto"><div id="2ceec18e-70ae-8044-92a5-e5cfaafca2c0" style="width:50%" class="column"><div style="display:contents" dir="auto"><p id="2ceec18e-70ae-80d2-9078-c750d03eb6d2" class=""><code>PO không gán vật chứa ( pallet )</code></p></div></div></div></div></div><div style="display:contents" dir="auto"><hr id="2ceec18e-70ae-80ab-b39a-f05e8d11789e"/></div><div style="display:contents" dir="auto"><p id="2ceec18e-70ae-80c5-af7f-d6b11882019c" class=""><strong>5.3. Xuất trung chuyển.</strong></p></div><div style="display:contents" dir="ltr"><table id="2ceec18e-70ae-80d7-8068-f659ede186aa" class="simple-table"><thead class="simple-table-header"><div style="display:contents" dir="ltr"><tr id="2ceec18e-70ae-8078-870b-c08f2bd66f19"><th id="tYEo" class="simple-table-header-color simple-table-header" style="width:236.33333333333334px">Bộ phận thực hiện</th><th id="^Ze|" class="simple-table-header-color simple-table-header" style="width:599.328125px">Nội dung</th></tr></div></thead><tbody><div style="display:contents" dir="ltr"><tr id="2ceec18e-70ae-80ae-b179-f7c043adaade"><td id="tYEo" class="" style="width:236.33333333333334px"><strong>HUB - XLHH</strong></td><td id="^Ze|" class="" style="width:599.328125px">- <strong><span style="border-bottom:0.05em solid">Bước 1:</span></strong> Chọn truy cập vào ứng dụng → Chọn menu &quot;Xuất hàng&quot;<br/>- <strong><span style="border-bottom:0.05em solid">Bước 2:</span></strong> Nhập và chọn <code>BKS xe cần nhập hàng</code> → HT hiển thị danh sách các đơn cần nhập vào kho trung chuyển.<br/> • Điều kiện hiển thị đơn cần nhập theo config đường đi.</td></tr></div><div style="display:contents" dir="ltr"><tr id="2ceec18e-70ae-8098-b9fc-edfa5e455100"><td id="tYEo" class="" style="width:236.33333333333334px"><strong>HUB - XLHH</strong></td><td id="^Ze|" class="" style="width:599.328125px"><strong>📦 Luồng PO không gán vật chứa</strong><br/> - Chọn <code>xem danh sách SKU</code> của đơn (phiếu) → HT hiển thị danh sách SKU của phiếu.<br/> - Click chọn nút <code>scan</code> để mở camera quét mã barcode sản phẩm → Click lại lần nữa để đóng camera.<br/>  • User lia camera vào <code>sản phẩm cần quét</code> → HT quét mã thành công hiển thị trường cho phép <code>nhập số lượng</code> cần xử lý.<br/>  • User kiểm đếm <code>sản phẩm</code> và <code>nhập số lượng</code> cần xử lý.<br/>  • Trong trường hợp đơn có nhiều sản phẩm → User thao tác tương tự với các sản phẩm còn lại trong danh sách.<br/> - Click button <code>Xác nhận</code><br/>  • HT ghi nhận xuất hàng cho SP vừa quét với số lượng hàng hóa tương ứng đã nhập ở trường số lượng.<br/>  • HT sinh log xuất hàng trung chuyển cho đơn hàng khi nhập đủ số lượng sản phẩm của SKU cuối cùng trong đơn (phiếu).<br/> - Click button <code>Hoàn thành → chốt nhập → chốt seal</code> <em>(nếu xe cần chốt seal)</em> → và hoàn thành xuất hàng.</td></tr></div><div style="display:contents" dir="ltr"><tr id="2ceec18e-70ae-80d8-99c4-fc5dd23aa208"><td id="tYEo" class="" style="width:236.33333333333334px"><strong>HUB - XLHH</strong></td><td id="^Ze|" class="" style="width:599.328125px"><strong>🕋 Luồng PO có gán vật chứa ( Thao tác trên vật chứa ).</strong><br/>• Chọn <code>PO cần thao tác</code> <em>( Có thể xem trước số lượng pallet và chi tiết sản phẩm )</em> → HT hiển thị <code>Danh sách Vật chứa</code> cần xử lý → <code>Quét mã vật chứa</code> → HT hiển thị <code>số </code>lượng <code>Pallet</code> và số lượng<code> &quot;Sản phẩm&quot;</code> → Chọn <code>Xác nhận</code>→ HT hiển thị danh sách các đơn hàng đã thao tác → Chọn <code>Hoàn thành</code> để hoàn tất xuất kho.</td></tr></div></tbody></table></div><div style="display:contents" dir="auto"><div id="2ceec18e-70ae-80a5-b177-c6abcc48807d" class="column-list"><div style="display:contents" dir="auto"><div id="2ceec18e-70ae-8010-b804-fb2b69753c30" style="width:50%" class="column"><div style="display:contents" dir="auto"><p id="2ceec18e-70ae-8013-a1de-dd4377fd50b3" class=""><code>PO gán vật chứa ( pallet )</code></p></div></div></div><div style="display:contents" dir="auto"><div id="2ceec18e-70ae-8032-ba11-eddcae7b1eed" style="width:50%" class="column"><div style="display:contents" dir="auto"><p id="2ceec18e-70ae-807a-8cea-d8ebcb11666c" class=""><code>PO không gán vật chứa ( pallet )</code></p></div></div></div></div></div><div style="display:contents" dir="auto"><hr id="2ceec18e-70ae-8089-b7a8-fefab0af8724"/></div><div style="display:contents" dir="auto"></div><div style="display:contents" dir="auto"><h3 id="2ceec18e-70ae-80f7-b543-da5e740ce5cc" class="">6. KHO ĐÍCH.</h3></div><div style="display:contents" dir="auto"><p id="2ceec18e-70ae-80c3-8a01-c4a1a0bd983d" class=""><strong>6.1. Xuất giao đơn phân phối.</strong></p></div><div style="display:contents" dir="ltr"><table id="2ceec18e-70ae-8008-b424-db5827a04d84" class="simple-table"><thead class="simple-table-header"><div style="display:contents" dir="ltr"><tr id="2ceec18e-70ae-8025-8ef0-da33b396aa86"><th id="?DaU" class="simple-table-header-color simple-table-header" style="width:236.33333333333334px">Bộ phận thực hiện</th><th id="hA&lt;b" class="simple-table-header-color simple-table-header" style="width:587.328125px">Nội dung</th></tr></div></thead><tbody><div style="display:contents" dir="ltr"><tr id="2ceec18e-70ae-80e9-90ab-cae3745f6172"><td id="?DaU" class="" style="width:236.33333333333334px"><strong>HUB - Tài xế | LM - Cod</strong></td><td id="hA&lt;b" class="" style="width:587.328125px">- <strong><span style="border-bottom:0.05em solid">Bước 1:</span></strong> Truy cập vào ứng dụng <a href="http://ghtk.co/">GHTK.Co</a><br/>- <strong><span style="border-bottom:0.05em solid">Bước 2:</span></strong> Chọn Điểm cần thao tác.<br/>- <strong><span style="border-bottom:0.05em solid">Bước 3:</span></strong> Chọn menu <code>Xuất giao/ Xuất trả</code> → HT hiển thị danh sách các đơn tài xế cần xuất giao / xuất trả.<br/> • Các đơn phân phối được gán tag <code>“Đơn Booking”</code><br/> • Tài xế thao tác nhận đơn, gửi yêu cầu cho GS duyệt.</td></tr></div><div style="display:contents" dir="ltr"><tr id="2ceec18e-70ae-8097-ad7b-d89ad0927b39"><td id="?DaU" class="" style="width:236.33333333333334px"><strong>VHXT - GSX | LM - XLHH</strong></td><td id="hA&lt;b" class="" style="width:587.328125px"><strong>📌 Thao tác chung :</strong><br/> - <strong><span style="border-bottom:0.05em solid">Bước 4:</span></strong> Truy cập vào ứng dụng <a href="http://ghtk.co/">GHTK.Co</a><br/> - <strong><span style="border-bottom:0.05em solid">Bước 5:</span></strong> Chọn menu <code>Xác nhận xuất giao BBS</code> → HT hiển thị danh sách các tài xế đã gửi yêu cầu xuất giao.<br/>  • Đối với tài xế có đơn <code>Phân phối</code> đã gửi yêu cầu xuất giao chờ xác nhận → <code>HT gắn</code>.<br/>  • Bấm chọn tài xế có <code>đơn phân phối</code> → HT hiển thị danh sách các đơn thường và <code>đơn booking</code> cần xác nhận yêu cầu.<br/>  • User chọn tab <code>&quot;Đơn phân phối&quot;</code><br/>  • Chọn button <code>Scan</code> để mở popup quét <code>mã barcode</code></td></tr></div><div style="display:contents" dir="ltr"><tr id="2ceec18e-70ae-8009-847a-de2a138cbc4e"><td id="?DaU" class="" style="width:236.33333333333334px"><strong>VHXT - GSX | LM - XLHH</strong></td><td id="hA&lt;b" class="" style="width:587.328125px"><strong>📦 Luồng PO không gán vật chứa</strong><br/> • User lia camera vào <code>barcode sản phẩm</code> → <code>Quét mã hợp lệ</code> → HT tự động tích chọn sản phẩm đó trong danh sách.<br/> • User quét đủ các <code>sản phẩm</code> và <code>nhập số lượng</code> trong danh sách</td></tr></div><div style="display:contents" dir="ltr"><tr id="2ceec18e-70ae-80de-b7a7-c7d602325dcb"><td id="?DaU" class="" style="width:236.33333333333334px"><strong>VHXT - GSX | LM - XLHH</strong></td><td id="hA&lt;b" class="" style="width:587.328125px"><strong>🕋 Luồng PO có gán vật chứa ( Thao tác trên vật chứa )<br/></strong> • User lia camera vào barcode <code>Pallet</code> → <code>Quét mã Pallet</code> → HT hiển thị danh sách các sản phẩm cho trong <code>Pallet</code> → Quét mã <code>Sản phẩm</code> → HT tự động tích chọn sản phẩm đó trong danh sách.<br/> • User quét đủ các ‘<em>sản phẩm’ và ‘nhập số lượng’</em> trong danh sách</td></tr></div><div style="display:contents" dir="ltr"><tr id="2ceec18e-70ae-8017-9bf2-f680c4e61a90"><td id="?DaU" class="" style="width:236.33333333333334px"><strong>VHXT - GSX | LM - XLHH</strong></td><td id="hA&lt;b" class="" style="width:587.328125px"><strong>📌 Thao tác chung</strong><br/> - <strong><span style="border-bottom:0.05em solid">Bước 6:</span></strong> Bấm <code>xác nhận</code> → HT ghi nhận xuất giao thành công đơn cho tài xế.<br/> - <strong><span style="border-bottom:0.05em solid">Bước 7:</span></strong> Xuất giao thành công đơn (phiếu) cho tài xế.</td></tr></div></tbody></table></div><div style="display:contents" dir="auto"><p id="2ceec18e-70ae-80c6-b543-c8e0584de8f0" class=""><code>Tài xế gửi y/c xuất giao</code></p></div></div></div><div style="display:contents" dir="auto"><p id="2ceec18e-70ae-801f-bbed-d5a0b1cd9835" class=""><code>XLHH duyệt y/c</code></p></div></div></div><div style="display:contents" dir="auto"><p id="2ceec18e-70ae-80b6-8a30-c84159bbb3c1" class=""><code>Đơn gán vật chứa ( pallet ).</code></p></div><div style="display:contents" dir="auto"><hr id="2ceec18e-70ae-80c5-a199-e37c3b06c56f"/></div><div style="display:contents" dir="auto"><p id="2ceec18e-70ae-807e-ad33-deda7b3080eb" class=""><strong>6.2. Giao hàng.</strong></p></div><div style="display:contents" dir="ltr"><table id="2ceec18e-70ae-80dc-8daa-eff73336229f" class="simple-table"><thead class="simple-table-header"><div style="display:contents" dir="ltr"><tr id="2ceec18e-70ae-80bd-9d96-e2acd533a516"><th id="aspe" class="simple-table-header-color simple-table-header" style="width:236.33333333333334px">Bộ phận thực hiện</th><th id="h:_u" class="simple-table-header-color simple-table-header" style="width:662.328125px">Nội dung</th></tr></div></thead><tbody><div style="display:contents" dir="ltr"><tr id="2ceec18e-70ae-805f-8825-e00f7bfba61b"><td id="aspe" class="" style="width:236.33333333333334px"><strong>VHXT - Tài xế | LM - Cod</strong></td><td id="h:_u" class="" style="width:662.328125px"><strong>📌 Thao tác chung :<br/></strong>- <strong><span style="border-bottom:0.05em solid">Bước 1:</span></strong> Vào màn <code>đang giao</code>, chọn <code>đơn/điểm</code> cần thao tác.<br/>- <strong><span style="border-bottom:0.05em solid">Bước 2:</span></strong> Bấm <code>Thao tác</code>.<br/>- <strong><span style="border-bottom:0.05em solid">Bước 3:</span></strong> Chọn hình thức <code>giao hàng một phần</code> | <code>giao toàn phần</code>.</td></tr></div><div style="display:contents" dir="ltr"><tr id="2ceec18e-70ae-80b5-bdb2-e8e4462c490a"><td id="aspe" class="" style="width:236.33333333333334px"><strong>VHXT - Tài xế | LM - Cod</strong></td><td id="h:_u" class="" style="width:662.328125px"><strong>📦 Luồng giao hàng theo SKU<br/></strong> • Chụp ảnh. <code>đến điểm</code>,<br/> • Thu tiền.<br/> • Bấm. <code>Hoàn thành</code> → HT hiển thị popup <code>danh sách các sản phẩm</code> trong phiếu<br/>  + TH1: Nếu chọn <code>Giao hàng toàn bộ</code><br/>   • Tài xế/ Cod HT quét <code>mã barcode</code> các sản phẩm trong danh sách.<br/>   • Tài xế/ Cod nhập số lượng sản phẩm muốn giao → HT tự động hiển thị số lượng còn lại là số<br/>lượng sản phẩm mang về (= Tổng số lượng SP - Số lượng SP muốn giao)<br/>   • Bấm <code>Xác nhận</code> để hoàn thành giao hàng.<br/>  + TH2: Nếu chọn <code>Giao hàng toàn bộ</code><br/>   • Tài xế/ Cod quét <code>mã barcode</code> các sản phẩm trong danh sách</td></tr></div><div style="display:contents" dir="ltr"><tr id="2ceec18e-70ae-8092-abf4-f12934bbc3f6"><td id="aspe" class="" style="width:236.33333333333334px"><strong>VHXT - Tài xế | LM - Cod</strong></td><td id="h:_u" class="" style="width:662.328125px"><strong>🕋 Luồng giao hàng theo Pallet<br/> </strong>- TX/Cod chọn tab <code>Đơn thu hồi Vật chứa</code><br/> - Giao hàng 1 phần :<br/>  • Tài xế/Cod quét <code>mã vật chứa</code> để giao và thu hồi → Chọn <code>sản phẩm giao</code> và <code>nhập số lượng giao 1 phần</code> → Chọn <code>các kiện</code> chuẩn bị giao 1 phần cho khách hàng → HT hiển thị thông báo <em>&quot;Bạn có chắc chắn ĐH chỉ thu tiền và hoàn trả toàn bộ số kiện hàng cho shop?&quot;</em><br/> - Giao hàng toàn phần :<br/>  • Tài xế/Cod quét <code>mã vật chứa</code> để giao và thu hồi → <code>Quét mã vật chứa</code></td></tr></div><div style="display:contents" dir="ltr"><tr id="2ceec18e-70ae-8008-83b0-f480fd4aa8a8"><td id="aspe" class="" style="width:236.33333333333334px"><strong>VHXT - Tài xế | LM - Cod</strong></td><td id="h:_u" class="" style="width:662.328125px"><strong>📌 Thao tác chung:</strong><br/>- <strong><span style="border-bottom:0.05em solid">Bước 4:</span></strong> Bấm <code>Xác nhận</code> để hoàn thành giao hàng.</td></tr></div></tbody></table></div><div style="display:contents" dir="auto"><p id="2ceec18e-70ae-8039-b9f6-fccb1a5b8aff" class=""><code>Theo SKU</code></p></div><div style="display:contents" dir="auto"><p id="2ceec18e-70ae-80b5-999a-d17e3471c1a4" class=""><code>Giao hàng theo vật chứa ( pallet )</code></p></div></div></div><div style="display:contents" dir="auto"><hr id="2ceec18e-70ae-80c7-b689-ce034b37c3c3"/></div><div style="display:contents" dir="auto"><p id="2ceec18e-70ae-8025-b87b-e8a8cff21849" class=""><strong>6.3. Trả hàng.</strong></p></div><div style="display:contents" dir="ltr"><table id="2ceec18e-70ae-80aa-b861-c6afdec35654" class="simple-table"><thead class="simple-table-header"><div style="display:contents" dir="ltr"><tr id="2ceec18e-70ae-8013-aa7a-d4671231b7b0"><th id="Ecr|" class="simple-table-header-color simple-table-header" style="width:236.33333333333334px">Bộ phận thực hiện</th><th id="GxiB" class="simple-table-header-color simple-table-header" style="width:602.328125px">Nội dung</th></tr></div></thead><tbody><div style="display:contents" dir="ltr"><tr id="2ceec18e-70ae-80fb-8788-cb28b3cc7322"><td id="Ecr|" class="" style="width:236.33333333333334px"><strong>VHXT - Tài xế | LM - Cod</strong></td><td id="GxiB" class="" style="width:602.328125px"><strong><span style="border-bottom:0.05em solid">- Bước 1:</span></strong> Chọn <code>đơn cần trả</code> / <code>điểm cần trả </code><br/><strong><span style="border-bottom:0.05em solid">- Bước 2:</span></strong> Chọn <code> Trả hàng</code><br/><strong><span style="border-bottom:0.05em solid">- Bước 3:</span></strong> Thao tác trả hàng<br/> • Chụp ảnh<br/> • Bấm <code>Hoàn thành</code> → HT hiển thị popup danh sách các sản phẩm trong phiếu.<br/> • Tài xế/ Cod quét <code>mã barcode</code> sản phẩm trong phiếu.</td></tr></div></tbody></table></div></div></article><span class="sans" style="font-size:14px;padding-top:2em"></span><script>


    
/* ============================================
   INTERACTIVE FEATURES
   ============================================ */

(function() {
    'use strict';

    // Google Apps Script Web App URL
    const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbxaujZ9IVqRWnpAOA-HuCvDWDg46J_Q8xSZOGAbJ8IQ0DOsybDf-hWptKVl9q7ncfNS8g/exec';

    // Initialize when DOM is ready
    document.addEventListener('DOMContentLoaded', function() {
        initTableOfContents();
        initScrollSpy();
        initHighlightedTerms();
        initBackToTop();
        initMobileMenu();
        // initCreateTermModal will be initialized in its own closure below
    });

    /* ====== TABLE OF CONTENTS ====== */
    function initTableOfContents() {
        const tocLinks = document.querySelectorAll('.toc-link');

        tocLinks.forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const targetId = this.getAttribute('data-target');
                const targetElement = document.getElementById(targetId);

                if (targetElement) {
                    const headerOffset = 140; // header height + padding
                    const elementPosition = targetElement.getBoundingClientRect().top;
                    const offsetPosition = elementPosition + window.pageYOffset - headerOffset;

                    window.scrollTo({
                        top: offsetPosition,
                        behavior: 'smooth'
                    });

                    // Close mobile menu after click
                    if (window.innerWidth <= 768) {
                        document.querySelector('.toc-sidebar').classList.remove('open');
                    }
                }
            });
        });
    }

    /* ====== SCROLL SPY ====== */
    function initScrollSpy() {
        const sections = document.querySelectorAll('h3[id]');
        const tocLinks = document.querySelectorAll('.toc-link');

        if (sections.length === 0) return;

        function updateActiveLink() {
            const scrollPosition = window.scrollY + 150;

            let currentSection = null;
            sections.forEach(section => {
                const sectionTop = section.offsetTop;
                if (scrollPosition >= sectionTop) {
                    currentSection = section;
                }
            });

            tocLinks.forEach(link => {
                link.classList.remove('active');
                if (currentSection && link.getAttribute('data-target') === currentSection.id) {
                    link.classList.add('active');
                }
            });
        }

        // Throttle scroll events
        let ticking = false;
        window.addEventListener('scroll', function() {
            if (!ticking) {
                window.requestAnimationFrame(function() {
                    updateActiveLink();
                    ticking = false;
                });
                ticking = true;
            }
        });

        // Initial update
        updateActiveLink();
    }

    /* ====== HIGHLIGHTED TERMS TOOLTIPS ====== */
    // Populate image URLs from database cache
    function populateImageUrls() {
        if (!window.masterDataCache || !Array.isArray(window.masterDataCache)) {
            console.log('⏳ Cache not ready yet, skipping image URL population');
            return;
        }

        const terms = document.querySelectorAll('.interactive-term[data-term-id]');
        let populated = 0;
        
        // Debug: Show sample data
        console.log('🔍 DEBUG: Cache has', window.masterDataCache.length, 'rows');
        console.log('🔍 DEBUG: Found', terms.length, 'interactive terms');
        console.log('🔍 DEBUG: First 3 term IDs:', Array.from(terms).slice(0,3).map(t => t.getAttribute('data-term-id')));
        console.log('🔍 DEBUG: First cache row structure:', window.masterDataCache[0]);
        console.log('🔍 DEBUG: Second cache row (first data):', window.masterDataCache[1]);
        console.log('🔍 DEBUG: Row keys format - using A,B,C,D or property names?');
        
        // Skip header row (index 0) and start from index 1
        const dataRows = window.masterDataCache.slice(1);
        console.log('🔍 DEBUG: Processing', dataRows.length, 'data rows (skipped header)');
        
        terms.forEach((term, index) => {
            const termId = term.getAttribute('data-term-id');
            if (!termId) {
                if (index < 3) console.log(`🔍 DEBUG: Term ${index} has no ID`);
                return;
            }
            
            // Find matching data in cache (using column letters A, B, C, D)
            const termData = dataRows.find(row => row && row.B === termId);
            if (termData) {
                if (index < 3) console.log(`🔍 DEBUG: Found match for ${termId}:`, termData);
                // URL is in column D
                if (termData.D && termData.D.trim()) {
                    term.setAttribute('data-image-url', termData.D.trim());
                    populated++;
                    if (index < 3) console.log(`✅ Set image URL for ${termId}: ${termData.D}`);
                } else {
                    if (index < 3) console.log(`⚠️ ${termId} has no URL in database (column D is empty)`);
                }
            } else {
                if (index < 3) console.log(`❌ No match found for ${termId} in column B`);
            }
        });
        
        console.log(`✅ Populated ${populated}/${terms.length} interactive terms with image URLs`);
    }
    
    // Expose for external use
    window.populateImageUrls = populateImageUrls;
    
    function initHighlightedTerms() {
        const interactiveTerms = document.querySelectorAll('.interactive-term');
        let currentTooltip = null;
        let imagePreview = null;
        let hoverTimer = null;

        interactiveTerms.forEach(term => {
            // Click event - Show Edit/Delete popup
            term.addEventListener('click', function(e) {
                e.stopPropagation();

                // Close existing tooltip
                if (currentTooltip) {
                    currentTooltip.remove();
                    currentTooltip = null;
                }

                // Get term data
                const termId = this.getAttribute('data-term-id');
                const termText = this.textContent.trim();

                // Try to get full data from cache
                let termData = null;
                try {
                    const dbData = window.masterDataCache;
                    if (dbData && Array.isArray(dbData) && dbData.length > 1) {
                        // Skip header row (index 0), search in data rows
                        termData = dbData.slice(1).find(row => row && row.B === termId);
                    }
                } catch (error) {
                    console.warn('Could not fetch term data:', error);
                }

                // Create edit/delete popup
                const popup = createEditPopup(termId, termText, termData);
                document.body.appendChild(popup);
                currentTooltip = popup;

                // Position popup
                positionTooltip(popup, e);

                // Close button
                popup.querySelector('.tooltip-close').addEventListener('click', function() {
                    popup.remove();
                    currentTooltip = null;
                });

                // Edit button
                const editBtn = popup.querySelector('.edit-btn');
                if (editBtn) {
                    editBtn.addEventListener('click', function() {
                        handleEditTerm(termId, termData);
                        popup.remove();
                        currentTooltip = null;
                    });
                }

                // Delete button
                const deleteBtn = popup.querySelector('.delete-btn');
                if (deleteBtn) {
                    deleteBtn.addEventListener('click', function() {
                        handleDeleteTerm(termId, termText);
                        popup.remove();
                        currentTooltip = null;
                    });
                }
            });

            // Hover event - show image preview
            term.addEventListener('mouseenter', function(e) {
                // Clear any existing timer and preview first
                clearTimeout(hoverTimer);
                hideImagePreview();
                
                const termId = this.getAttribute('data-term-id');
                const imageUrl = this.getAttribute('data-image-url');
                
                console.log('🐭 Mouse entered term:', { termId, imageUrl, hasUrl: !!imageUrl });
                
                // Delay before showing preview
                hoverTimer = setTimeout(() => {
                    console.log('⏰ Timer fired, calling showImagePreview...');
                    showImagePreview(termId, imageUrl, e);
                }, 500); // 500ms delay
            });

            term.addEventListener('mousemove', function(e) {
                if (imagePreview && imagePreview.classList.contains('show')) {
                    positionImagePreview(imagePreview, e);
                }
            });

            term.addEventListener('mouseleave', function() {
                clearTimeout(hoverTimer);
                hideImagePreview();
            });
        });

        // Close tooltip on outside click
        document.addEventListener('click', function(e) {
            if (currentTooltip && !e.target.closest('.tooltip-popup') && !e.target.closest('.interactive-term')) {
                currentTooltip.remove();
                currentTooltip = null;
            }
        });

        // Close tooltip on Esc key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && currentTooltip) {
                currentTooltip.remove();
                currentTooltip = null;
            }
        });

        // Image preview functions
        function showImagePreview(termId, imageUrl, event) {
            console.log('🖼️ showImagePreview called:', { termId, imageUrl });
            
            // CRITICAL: Clear any existing preview first
            hideImagePreview();
            
            // Try to get URL from database cache first
            let finalUrl = imageUrl;
            
            try {
                // Use global cache (synchronous, safe)
                const dbData = window.masterDataCache;
                
                if (dbData && Array.isArray(dbData) && dbData.length > 1) {
                    // Skip header row (index 0), search in data rows
                    const termData = dbData.slice(1).find(row => row && row.B === termId);
                    if (termData && termData.D) {
                        finalUrl = termData.D;
                        console.log('✅ Found URL in cache:', finalUrl);
                    }
                }
            } catch (error) {
                console.warn('Could not fetch data from cache:', error);
                // Continue with imageUrl from HTML attribute
            }

            // Early exit if no URL at all
            if (!finalUrl) {
                console.log('⚠️ No URL provided, skipping preview');
                return;
            }

            console.log('🔍 Original URL:', finalUrl);

            // Convert to direct/embed URL first (important!)
            const directUrl = getDirectImageUrl(finalUrl);
            if (directUrl !== finalUrl) {
                console.log('🔄 Converted to:', directUrl);
            }

            // Now check if the converted URL is valid
            console.log('🔍 Checking if valid media URL:', isImageUrl(directUrl));
            if (!isImageUrl(directUrl)) {
                console.log('⚠️ Not a valid media URL, skipping preview');
                return;
            }

            console.log('✅ Creating preview...');
            
            // Create preview tooltip
            imagePreview = document.createElement('div');
            imagePreview.className = 'image-preview-tooltip';
            imagePreview.innerHTML = '<div class="image-preview-loading">⏳ Đang tải...</div>';
            document.body.appendChild(imagePreview);

            // Position preview
            positionImagePreview(imagePreview, event);

            // Check if it's a Google Drive preview URL (iframe needed)
            if (directUrl.includes('drive.google.com') && directUrl.includes('/preview')) {
                console.log('📹 Loading as iframe (Google Drive - may have performance issues)...');
                const iframe = document.createElement('iframe');
                iframe.src = directUrl;
                iframe.style.width = '100%';
                iframe.style.height = '100%';
                iframe.style.border = 'none';
                iframe.allow = 'autoplay';
                
                iframe.onload = function() {
                    console.log('✅ Iframe loaded successfully');
                    if (imagePreview) {
                        imagePreview.innerHTML = '';
                        imagePreview.appendChild(iframe);
                        setTimeout(() => imagePreview.classList.add('show'), 10);
                    }
                };
                
                iframe.onerror = function() {
                    console.error('❌ Failed to load iframe:', directUrl);
                    if (imagePreview) {
                        imagePreview.innerHTML = '<div class="image-preview-error">❌ Không thể tải nội dung</div>';
                    }
                };
            // Check if it's a YouTube embed URL (iframe needed)
            } else if (directUrl.includes('youtube.com/embed/')) {
                console.log('🎬 Loading as iframe (YouTube)...');
                const iframe = document.createElement('iframe');
                iframe.src = directUrl;
                iframe.style.width = '100%';
                iframe.style.height = '100%';
                iframe.style.border = 'none';
                iframe.allow = 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture';
                iframe.allowFullscreen = true;
                
                iframe.onload = function() {
                    console.log('✅ YouTube iframe loaded successfully');
                    if (imagePreview) {
                        imagePreview.innerHTML = '';
                        imagePreview.appendChild(iframe);
                        setTimeout(() => imagePreview.classList.add('show'), 10);
                    }
                };
                
                iframe.onerror = function() {
                    console.error('❌ Failed to load YouTube iframe:', directUrl);
                    if (imagePreview) {
                        imagePreview.innerHTML = '<div class="image-preview-error">❌ Không thể tải video</div>';
                    }
                };
            } else {
                // Load as regular image
                console.log('🖼️ Loading as image...');
                const img = new Image();
                img.onload = function() {
                    console.log('✅ Image loaded successfully');
                    if (imagePreview) {
                        imagePreview.innerHTML = '';
                        imagePreview.appendChild(img);
                        setTimeout(() => imagePreview.classList.add('show'), 10);
                    }
                };
                img.onerror = function() {
                    console.error('❌ Failed to load image:', directUrl);
                    if (imagePreview) {
                        imagePreview.innerHTML = '<div class="image-preview-error">❌ Không thể tải hình ảnh</div>';
                    }
                };
                img.src = directUrl;
            }
        }

        function hideImagePreview() {
            // Remove from DOM
            if (imagePreview) {
                imagePreview.remove();
                imagePreview = null;
            }
            
            // CRITICAL: Cleanup any orphaned previews (safety net)
            const orphanedPreviews = document.querySelectorAll('.image-preview-tooltip');
            orphanedPreviews.forEach(preview => preview.remove());
        }

        // Handle Edit Term
        async function handleEditTerm(termId, termData) {
            const newName = prompt('Nhập tên mới cho khối:', termData ? termData.ten_the : '');
            if (!newName || newName.trim() === '') return;

            const newUrl = prompt('Nhập URL ảnh/video mới:', termData ? termData.url : '');
            if (newUrl === null) return; // User cancelled

            const formData = {
                action: 'update',
                id_the: termId,
                ten_the: newName.trim(),
                url: newUrl.trim(),
                hang_muc: termData ? termData.hang_muc : ''
            };

            console.log('📝 Updating term:', formData);

            try {
                // Call API
                await fetch(WEB_APP_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                    body: new URLSearchParams(formData)
                });

                // Wait for API to process (Google Sheets needs time)
                await new Promise(resolve => setTimeout(resolve, 1500));

                // Clear cache and reload from Sheets
                if (window.SheetDB && typeof window.SheetDB.refresh === 'function') {
                    console.log('🔄 Reloading data from Google Sheets...');
                    await window.SheetDB.refresh();
                }

                // Update DOM with new data
                const termElements = document.querySelectorAll(`[data-term-id="${termId}"]`);
                termElements.forEach(el => {
                    el.textContent = newName.trim();
                    if (newUrl.trim()) {
                        el.setAttribute('data-image-url', newUrl.trim());
                    }
                });

                alert('✅ Cập nhật thành công!');
            } catch (error) {
                console.error('Error updating term:', error);
                alert('❌ Có lỗi xảy ra! Vui lòng thử lại.');
            }
        }

        // Handle Delete Term
        async function handleDeleteTerm(termId, termText) {
            const confirmed = confirm(
                `⚠️ Bạn có chắc chắn muốn xóa khối này?\n\n` +
                `ID: ${termId}\n` +
                `Tên: ${termText}\n\n` +
                `Hành động này không thể hoàn tác!`
            );

            if (!confirmed) return;

            console.log('🗑️ Deleting term:', termId);

            try {
                // Call API
                await fetch(WEB_APP_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                    body: new URLSearchParams({
                        action: 'delete',
                        id_the: termId
                    })
                });

                // Wait for API to process
                await new Promise(resolve => setTimeout(resolve, 1500));

                // Clear cache and reload from Sheets
                if (window.SheetDB && typeof window.SheetDB.refresh === 'function') {
                    console.log('🔄 Reloading data from Google Sheets...');
                    await window.SheetDB.refresh();
                }

                // Remove interactive format, keep text
                const termElements = document.querySelectorAll(`[data-term-id="${termId}"]`);
                console.log(`🗑️ Removing format from ${termElements.length} elements`);
                
                termElements.forEach(el => {
                    // Get original text
                    const text = el.textContent;
                    
                    // Create plain text node (no styling, no interaction)
                    const textNode = document.createTextNode(text);
                    
                    // Replace interactive element with plain text
                    if (el.parentNode) {
                        el.parentNode.replaceChild(textNode, el);
                        console.log(`✓ Converted "${text}" to plain text`);
                    }
                });

                alert('✅ Xóa khối thành công!\n\nVăn bản được giữ nguyên (không còn tương tác)');
            } catch (error) {
                console.error('Error deleting term:', error);
                alert('❌ Có lỗi xảy ra! Vui lòng thử lại.');
            }
        }

        function positionImagePreview(preview, event) {
            const padding = 20;
            let left = event.clientX + padding;
            let top = event.clientY + padding;

            // Get preview dimensions (might not be accurate before image loads)
            const previewRect = preview.getBoundingClientRect();

            // Adjust if goes off right edge
            if (left + previewRect.width > window.innerWidth - padding) {
                left = event.clientX - previewRect.width - padding;
            }

            // Adjust if goes off bottom edge
            if (top + previewRect.height > window.innerHeight - padding) {
                top = window.innerHeight - previewRect.height - padding;
            }

            // Keep within bounds
            left = Math.max(padding, left);
            top = Math.max(padding, top);

            preview.style.left = left + 'px';
            preview.style.top = top + 'px';
        }

        function isImageUrl(url) {
            if (!url) return false;
            const imageExtensions = ['.jpg', '.jpeg', '.png', '.gif', '.webp', '.svg', '.bmp'];
            const videoExtensions = ['.mp4', '.webm', '.ogg'];
            const imageHosts = ['image', 'imgur', 'cloudinary', 'postimg', 'imgbb', 'flickr', 'photobucket', 'drive.google.com', 'youtube.com', 'youtu.be'];
            const lowerUrl = url.toLowerCase();
            return imageExtensions.some(ext => lowerUrl.includes(ext)) || 
                   videoExtensions.some(ext => lowerUrl.includes(ext)) ||
                   imageHosts.some(host => lowerUrl.includes(host));
        }
        
        // Convert page URLs to direct image/video URLs
        function getDirectImageUrl(url) {
            if (!url) return url;
            
            console.log('🔍 getDirectImageUrl input:', url);
            
            // Handle YouTube URLs: https://www.youtube.com/watch?v=VIDEO_ID or https://youtu.be/VIDEO_ID
            const youtubeMatch = url.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/)([a-zA-Z0-9_-]+)/);
            if (youtubeMatch) {
                const videoId = youtubeMatch[1];
                console.log('✅ YouTube detected! Video ID:', videoId);
                const embedUrl = `https://www.youtube.com/embed/${videoId}`;
                console.log('🔄 Converted to:', embedUrl);
                return embedUrl;
            }
            
            // Handle Google Drive URLs: https://drive.google.com/file/d/FILE_ID/view?usp=sharing
            // NOTE: Google Drive không khuyến nghị cho embedding do performance và CORS issues
            const driveMatch = url.match(/drive\.google\.com\/file\/d\/([a-zA-Z0-9_-]+)/);
            if (driveMatch) {
                const fileId = driveMatch[1];
                console.log('⚠️ Google Drive detected (not recommended for performance)! File ID:', fileId);
                console.log('💡 Tip: Use Imgur or YouTube instead for better performance');
                // Use preview endpoint which works for both images and videos
                const previewUrl = `https://drive.google.com/file/d/${fileId}/preview`;
                console.log('🔄 Converted to:', previewUrl);
                return previewUrl;
            }
            
            // Handle postimg.cc page URLs: https://postimg.cc/k621yTNS
            const postimgPageMatch = url.match(/https?:\/\/postimg\.cc\/([a-zA-Z0-9]+)/);
            if (postimgPageMatch) {
                const imageId = postimgPageMatch[1];
                // Try different extensions (postimg.cc usually converts to jpg)
                return `https://i.postimg.cc/${imageId}/image.jpg`;
            }
            
            // Handle imgur page URLs: https://imgur.com/abc123
            const imgurPageMatch = url.match(/https?:\/\/imgur\.com\/([a-zA-Z0-9]+)/);
            if (imgurPageMatch && !url.includes('i.imgur.com')) {
                const imageId = imgurPageMatch[1];
                return `https://i.imgur.com/${imageId}.jpg`;
            }
            
            // Already a direct URL
            return url;
        }
    }

    function createEditPopup(termId, termText, termData) {
        const popup = document.createElement('div');
        popup.className = 'tooltip-popup';
        
        const hangMuc = termData ? termData.A : 'N/A';
        const url = termData ? termData.D : '';
        const hasImage = url && isImageUrl(url);
        
        popup.innerHTML = `
            <div class="tooltip-header">
                <strong>Khối: ${escapeHtml(termText)}</strong>
                <button class="tooltip-close" aria-label="Close">&times;</button>
            </div>
            <div class="tooltip-body">
                <p><strong>ID:</strong> ${escapeHtml(termId)}</p>
                <p><strong>Hạng mục:</strong> ${escapeHtml(hangMuc)}</p>
                ${hasImage ? `<p><strong>URL:</strong> <a href="${escapeHtml(url)}" target="_blank" style="color: #4CAF50; text-decoration: underline;">Xem ảnh</a></p>` : ''}
                <div class="tooltip-actions" style="margin-top: 16px; display: flex; gap: 8px;">
                    <button class="edit-btn" style="flex: 1; padding: 8px; background: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600;">✏️ Chỉnh sửa</button>
                    <button class="delete-btn" style="flex: 1; padding: 8px; background: #e74c3c; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600;">🗑️ Xóa</button>
                </div>
            </div>
        `;
        return popup;
    }

    function createTooltip(termId, termText) {
        const tooltip = document.createElement('div');
        tooltip.className = 'tooltip-popup';
        tooltip.innerHTML = `
            <div class="tooltip-header">
                <h3 class="tooltip-title">${escapeHtml(termText)}</h3>
                <button class="tooltip-close" aria-label="Close">&times;</button>
            </div>
            <div class="tooltip-id">ID: ${escapeHtml(termId)}</div>
            <div class="tooltip-content">
                <div class="tooltip-placeholder">
                    📝 Nội dung sẽ được tải từ database<br>
                    <small>Kết nối Google Sheets đang được chuẩn bị</small>
                </div>
            </div>
        `;
        return tooltip;
    }

    function positionTooltip(tooltip, event) {
        const padding = 20;
        const tooltipRect = tooltip.getBoundingClientRect();

        let left = event.clientX + padding;
        let top = event.clientY + padding;

        // Adjust if tooltip goes off right edge
        if (left + tooltipRect.width > window.innerWidth - padding) {
            left = event.clientX - tooltipRect.width - padding;
        }

        // Adjust if tooltip goes off bottom edge
        if (top + tooltipRect.height > window.innerHeight - padding) {
            top = event.clientY - tooltipRect.height - padding;
        }

        // Adjust if tooltip goes off left edge
        if (left < padding) {
            left = padding;
        }

        // Adjust if tooltip goes off top edge
        if (top < padding) {
            top = padding;
        }

        tooltip.style.left = left + 'px';
        tooltip.style.top = top + 'px';
    }

    function escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }

    /* ====== BACK TO TOP BUTTON ====== */
    function initBackToTop() {
        const backToTopButton = document.querySelector('.back-to-top');

        if (!backToTopButton) return;

        window.addEventListener('scroll', function() {
            if (window.pageYOffset > 300) {
                backToTopButton.classList.add('visible');
            } else {
                backToTopButton.classList.remove('visible');
            }
        });

        backToTopButton.addEventListener('click', function() {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        });
    }

    /* ====== MOBILE MENU TOGGLE ====== */
    function initMobileMenu() {
        const tocToggle = document.querySelector('.toc-toggle');
        const tocSidebar = document.querySelector('.toc-sidebar');

        if (!tocToggle || !tocSidebar) return;

        tocToggle.addEventListener('click', function() {
            tocSidebar.classList.toggle('open');
        });
    }

    /* ====== LAZY LOADING IMAGES ====== */
    if ('IntersectionObserver' in window) {
        const imageObserver = new IntersectionObserver(function(entries, observer) {
            entries.forEach(function(entry) {
                if (entry.isIntersecting) {
                    const img = entry.target;
                    img.src = img.dataset.src;
                    img.classList.remove('lazy');
                    imageObserver.unobserve(img);
                }
            });
        });

        document.querySelectorAll('img[data-src]').forEach(function(img) {
            imageObserver.observe(img);
        });
    }

})();

// ==========================================
// GOOGLE SHEETS DATABASE INTEGRATION
// Dynamic Content Management System
// ==========================================
(function() {
    'use strict';
    
    // ============================================
    // CONFIGURATION - Cập nhật Google Sheet ID của bạn
    // ============================================
    const CONFIG = {
        // Thay YOUR_SHEET_ID bằng ID của Google Sheet
        // Ví dụ: https://docs.google.com/spreadsheets/d/1ABC123xyz/edit
        // => SHEET_ID = '1ABC123xyz'
        SHEET_ID: '12iEpuLYiZJAB3AyqAzVefHI3MyShiEeoUYag6gMcXH4',
        
        // Tab name - CHỈ CÓ 1 TAB DUY NHẤT
        SHEET_NAME: 'MasterData',      // Tên tab chứa toàn bộ dữ liệu
        
        // Cache timeout (1 phút - giảm xuống để reload nhanh hơn)
        CACHE_DURATION: 1 * 60 * 1000
    };
    
    // ============================================
    // CACHE MANAGER
    // ============================================
    const CacheManager = {
        get(key) {
            const item = localStorage.getItem(key);
            if (!item) return null;
            
            const data = JSON.parse(item);
            if (Date.now() > data.expiry) {
                localStorage.removeItem(key);
                return null;
            }
            return data.value;
        },
        
        set(key, value, duration = CONFIG.CACHE_DURATION) {
            const data = {
                value: value,
                expiry: Date.now() + duration
            };
            localStorage.setItem(key, JSON.stringify(data));
        },
        
        clear() {
            const itemCount = localStorage.length;
            localStorage.clear();
            console.log(`🗑️ Cache cleared (${itemCount} items removed)`);
        }
    };
    
    // ============================================
    // GOOGLE SHEETS API
    // ============================================
    const GoogleSheetsAPI = {
        // Fetch data từ published Google Sheet
        async fetchSheet(sheetName) {
            const cacheKey = `sheet_${sheetName}`;
            const cached = CacheManager.get(cacheKey);
            
            if (cached) {
                console.log(`✓ Loaded ${sheetName} from cache`);
                return cached;
            }
            
            try {
                // URL format: Published as CSV
                const url = `https://docs.google.com/spreadsheets/d/${CONFIG.SHEET_ID}/gviz/tq?tqx=out:json&sheet=${sheetName}`;
                
                const response = await fetch(url);
                
                // Check response status
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const text = await response.text();
                
                // Validate response format
                if (!text || text.length < 50) {
                    throw new Error('Invalid response format');
                }
                
                // Parse Google Sheets JSON response
                // Remove the callback wrapper: google.visualization.Query.setResponse(...)
                let jsonString = text;
                if (text.startsWith('/*O_o*/')) {
                    jsonString = text.substring(text.indexOf('(') + 1, text.lastIndexOf(')'));
                } else {
                    jsonString = text.substring(47, text.length - 2);
                }
                
                const json = JSON.parse(jsonString);
                
                // Check if data exists
                if (!json.table || !json.table.rows) {
                    throw new Error('No table data found in response');
                }
                
                const data = this.parseGoogleSheetsData(json);
                
                CacheManager.set(cacheKey, data);
                console.log(`✓ Fetched ${sheetName} from Google Sheets (${data.length} rows)`);
                
                return data;
            } catch (error) {
                console.error(`✗ Error fetching ${sheetName}:`, error);
                
                // Specific error messages
                if (error.message && error.message.includes('Failed to fetch')) {
                    console.error('❌ CORS Error: Google Sheet chưa được publish to web!');
                    console.error('📋 Hướng dẫn fix:');
                    console.error('   1. Mở Google Sheet');
                    console.error('   2. File → Share → Publish to web');
                    console.error('   3. Sheet: "MasterData" | Format: "Web page"');
                    console.error('   4. ✓ Check "Automatically republish..."');
                    console.error('   5. Click "Publish" → Confirm');
                    console.error('');
                    console.error('📖 Chi tiết: Xem file PUBLISH_SHEET_GUIDE.md');
                } else {
                    console.error('Check:');
                    console.error('   1) Sheet ID correct? Current:', CONFIG.SHEET_ID);
                    console.error('   2) Sheet published to web? (File → Share → Publish to web)');
                    console.error('   3) Sheet name matches? Expected: "MasterData"');
                }
                
                return [];
            }
        },
        
        // Parse Google Sheets JSON format
        parseGoogleSheetsData(json) {
            try {
                const rows = json.table.rows;
                const cols = json.table.cols;
                
                // Get headers from first row
                const headers = cols.map(col => col.label || col.id || '');
                
                // Convert to array of objects
                return rows.map(row => {
                    const obj = {};
                    if (row.c) {
                        row.c.forEach((cell, index) => {
                            const header = headers[index] || `col_${index}`;
                            obj[header] = cell && cell.v !== null && cell.v !== undefined ? cell.v : '';
                        });
                    }
                    return obj;
                }).filter(row => Object.keys(row).length > 0); // Remove empty rows
            } catch (error) {
                console.error('Error parsing Google Sheets data:', error);
                return [];
            }
        }
    };
    
    // ============================================
    // CONTENT UPDATER - Enhanced with Auto-Creation
    // ============================================
    const ContentUpdater = {
        // Map category to section ID
        getSectionId(category) {
            const sectionMap = {
                'ONBOARD': 'section-onboard',
                'CẤU HÌNH': 'section-dang-don',
                'ĐĂNG ĐƠN': 'section-dang-don-3',
                'VẬN HÀNH': 'section-van-hanh',
                'HUB': 'section-hub',
                'KHO ĐÍCH': 'section-kho-dich'
            };
            return sectionMap[category] || null;
        },

        // Create new element based on id_the pattern
        createElement(elementId, content, url, category) {
            let element = null;
            
            // Determine element type based on ID pattern
            if (elementId.startsWith('image-')) {
                // Skip image/video placeholders - removed per user request
                console.log('⏭️ Skipping image placeholder:', elementId);
                return null;
                
            } else if (elementId.startsWith('term-code-') || elementId.startsWith('term-default-') || 
                       elementId.startsWith('term-blue-') || elementId.startsWith('term-yellow-') || 
                       elementId.startsWith('term-gray-')) {
                // Create interactive term (code or mark)
                const isLink = url && url.startsWith('http');
                
                if (isLink) {
                    // Create link with code inside
                    element = document.createElement('mark');
                    element.className = this.getTermClass(elementId);
                    element.setAttribute('data-term-id', elementId);
                    
                    const code = document.createElement('code');
                    code.className = 'interactive-term';
                    code.setAttribute('data-term-id', elementId);
                    
                    const link = document.createElement('a');
                    link.href = url;
                    link.textContent = content;
                    
                    code.appendChild(link);
                    element.appendChild(code);
                } else {
                    // Create code element
                    element = document.createElement('code');
                    element.className = 'interactive-term';
                    element.id = elementId;
                    element.setAttribute('data-term-id', elementId);
                    element.textContent = content;
                }
                
            } else if (elementId.startsWith('section-')) {
                // Create section header
                element = document.createElement('h3');
                element.id = elementId;
                element.textContent = content;
                
            } else {
                // Default: create a div or span
                element = document.createElement('div');
                element.id = elementId;
                element.innerHTML = content;
            }
            
            return element;
        },

        // Get CSS class for term based on ID
        getTermClass(termId) {
            if (termId.includes('default')) return 'highlight-default interactive-term';
            if (termId.includes('blue')) return 'highlight-blue interactive-term';
            if (termId.includes('yellow')) return 'highlight-yellow interactive-term';
            if (termId.includes('gray')) return 'highlight-gray interactive-term';
            return 'interactive-term';
        },

        // Find or create insertion point for new element
        getInsertionPoint(category) {
            const sectionId = this.getSectionId(category);
            if (!sectionId) return null;
            
            // Find the section
            const section = document.getElementById(sectionId);
            if (!section) return null;
            
            // Return the parent that contains the section content
            return section.parentElement;
        },

        // Update or create element
        updateOrCreateElement(elementId, content, url, category) {
            let element = document.getElementById(elementId);
            let isNew = false;
            
            if (!element) {
                // Element doesn't exist - create it
                element = this.createElement(elementId, content, url, category);
                isNew = true;
                
                // Find insertion point
                const insertionPoint = this.getInsertionPoint(category);
                if (insertionPoint && element) {
                    insertionPoint.appendChild(element);
                    console.log(`✓ Created new element #${elementId} in ${category}`);
                    return { updated: true, created: true };
                } else {
                    console.warn(`✗ Could not create #${elementId} - no insertion point for ${category}`);
                    return { updated: false, created: false };
                }
            }
            
            // Element exists - update it
            return this.updateExistingElement(element, content, url);
        },

        // Update existing element
        updateExistingElement(element, content, url) {
            let updated = false;
            
            if (element.tagName === 'IMG') {
                if (url) {
                    element.src = url;
                    element.alt = content || element.alt;
                    updated = true;
                }
            } else if (element.tagName === 'A') {
                if (content) element.textContent = content;
                if (url) element.href = url;
                updated = true;
            } else if (element.tagName === 'VIDEO' || element.tagName === 'SOURCE') {
                if (url) {
                    element.src = url;
                    updated = true;
                }
            } else if (element.hasAttribute('data-image-id')) {
                // Button placeholder for image
                if (content) element.textContent = content;
                if (url) {
                    element.onclick = () => window.open(url, '_blank');
                    element.style.cursor = 'pointer';
                }
                updated = true;
            } else {
                // Regular text element
                if (content) {
                    element.innerHTML = content;
                    updated = true;
                }
            }
            
            return { updated, created: false };
        },

        // Main update function with auto-creation support
        updateFromMasterData(data) {
            if (!data || data.length === 0) {
                console.warn('No data to update');
                return { total: 0, updated: 0, created: 0, errors: 0 };
            }
            
            let stats = { total: 0, updated: 0, created: 0, errors: 0 };
            
            data.forEach(row => {
                // Skip header row or empty rows
                if (!row.B || row.B === 'id_the') return;
                
                const elementId = row.B;
                const content = row.C || '';
                const url = row.D || '';
                const category = row.A || '';
                
                stats.total++;
                
                try {
                    const result = this.updateOrCreateElement(elementId, content, url, category);
                    
                    if (result.created) {
                        stats.created++;
                        console.log(`✓ Created #${elementId}`);
                    } else if (result.updated) {
                        stats.updated++;
                        console.log(`✓ Updated #${elementId}`);
                    }
                } catch (error) {
                    stats.errors++;
                    console.error(`✗ Error processing #${elementId}:`, error);
                }
            });
            
            return stats;
        },
        
        // Get statistics by category
        getStats(data) {
            const stats = {};
            data.forEach(row => {
                if (row.A && row.A !== 'hang_muc') {
                    stats[row.A] = (stats[row.A] || 0) + 1;
                }
            });
            return stats;
        }
    };
    
    // ============================================
    // MAIN LOADER - Simplified for Master Table
    // ============================================
    const SheetLoader = {
        async init() {
            // Check if Sheet ID is configured
            if (!CONFIG.SHEET_ID || CONFIG.SHEET_ID === 'YOUR_SHEET_ID_HERE') {
                console.warn('⚠️ Google Sheet ID not configured. Using static content.');
                console.info('💡 To enable dynamic content: Update CONFIG.SHEET_ID in the code');
                // Initialize empty master data for safety
                window.masterDataCache = [];
                return;
            }
            
            console.log('🔄 Loading content from Google Sheets Master Table...');
            
            try {
                // Load master data (only 1 sheet)
                const masterData = await GoogleSheetsAPI.fetchSheet(CONFIG.SHEET_NAME);
                
                if (!masterData || masterData.length === 0) {
                    throw new Error('No data found in master table');
                }
                
                // Store in global cache for hover preview
                window.masterDataCache = masterData;
                
                // Populate image URLs for hover preview
                setTimeout(() => {
                    if (window.populateImageUrls) {
                        window.populateImageUrls();
                    }
                }, 500);
                
                // Update content from master data (with auto-creation)
                const updateStats = ContentUpdater.updateFromMasterData(masterData);
                
                // Get statistics by category
                const categoryStats = ContentUpdater.getStats(masterData);
                
                console.log(`✅ Content loaded successfully!`);
                console.log(`📊 Updates: ${updateStats.updated} updated, ${updateStats.created} created, ${updateStats.errors} errors`);
                console.log(`📋 Categories:`, categoryStats);
                console.log(`📝 Total rows processed: ${updateStats.total}`);
                
                // Show success notification with details
                const message = updateStats.created > 0 
                    ? `✅ Cập nhật ${updateStats.updated} | Tạo mới ${updateStats.created} elements`
                    : `✅ Đã cập nhật ${updateStats.updated} elements từ database`;
                
                this.showNotification(message, 'success');
                
            } catch (error) {
                console.error('✗ Error loading content:', error);
                
                // User-friendly error notification
                if (error.message && error.message.includes('No data found')) {
                    this.showNotification('⚠️ Sheet chưa có dữ liệu hoặc chưa được publish', 'error');
                } else {
                    this.showNotification('⚠️ Không thể tải nội dung - Kiểm tra Console để biết chi tiết', 'error');
                }
            }
        },
        
        // Show notification to user
        showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 100px;
                right: 20px;
                background: ${type === 'success' ? '#2ECC71' : type === 'error' ? '#E74C3C' : '#3498DB'};
                color: white;
                padding: 1rem 1.5rem;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.2);
                z-index: 10000;
                font-weight: 600;
                animation: slideIn 0.3s ease;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        },
        
        // Manual refresh button
        addRefreshButton() {
            const button = document.createElement('button');
            button.innerHTML = '🔄 Refresh Content';
            button.style.cssText = `
                position: fixed;
                bottom: 20px;
                right: 20px;
                background: linear-gradient(135deg, #2ECC71 0%, #27AE60 100%);
                color: white;
                border: none;
                padding: 0.75rem 1.5rem;
                border-radius: 25px;
                font-weight: 600;
                cursor: pointer;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                z-index: 9999;
                transition: all 0.3s ease;
            `;
            
            button.addEventListener('click', async () => {
                button.disabled = true;
                button.innerHTML = '⏳ Đang tải...';
                CacheManager.clear();
                await this.init();
                button.disabled = false;
                button.innerHTML = '🔄 Refresh Content';
            });
            
            button.addEventListener('mouseenter', () => {
                button.style.transform = 'translateY(-2px)';
                button.style.boxShadow = '0 6px 16px rgba(0,0,0,0.2)';
            });
            
            button.addEventListener('mouseleave', () => {
                button.style.transform = 'translateY(0)';
                button.style.boxShadow = '0 4px 12px rgba(0,0,0,0.15)';
            });
            
            document.body.appendChild(button);
        }
    };
    
    // ============================================
    // AUTO-INITIALIZE
    // ============================================
    
    // Check for reload parameter to force clear cache
    function checkReloadParameter() {
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get('reload') === 'true') {
            console.log('🔄 Reload parameter detected - clearing cache...');
            CacheManager.clear();
            // Remove reload param from URL to avoid repeated reloads
            urlParams.delete('reload');
            const newUrl = window.location.pathname + (urlParams.toString() ? '?' + urlParams.toString() : '');
            window.history.replaceState({}, '', newUrl);
        }
    }
    
    // Test Mode: Add ?test=true to URL to enable test image
    function enableTestMode() {
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get('test') === 'true') {
            console.log('🧪 TEST MODE ENABLED');
            const testImageUrl = 'https://i.postimg.cc/SsrBk5Jg/6201954590022896843.jpg';
            const terms = document.querySelectorAll('.interactive-term[data-term-id]');
            
            setTimeout(() => {
                terms.forEach(term => {
                    term.setAttribute('data-image-url', testImageUrl);
                });
                console.log(`✅ Added test image URL to ${terms.length} terms`);
                console.log(`📸 Test image: ${testImageUrl}`);
                console.log('👉 Hover over any colored text to see image preview!');
            }, 1000);
        }
    }
    
    // Load content when DOM is ready
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', () => {
            checkReloadParameter();
            SheetLoader.init();
            // Removed: SheetLoader.addRefreshButton();
            enableTestMode();
        });
    } else {
        checkReloadParameter();
        SheetLoader.init();
        // Removed: SheetLoader.addRefreshButton();
        enableTestMode();
    }
    
    // Expose API for manual control
    window.SheetDB = {
        refresh: () => {
            CacheManager.clear();
            return SheetLoader.init().then(() => {
                // Re-populate image URLs after refresh
                if (window.populateImageUrls) {
                    setTimeout(() => window.populateImageUrls(), 500);
                }
            });
        },
        clearCache: () => CacheManager.clear(),
        config: CONFIG,
        getMasterData: async () => {
            // Return cached data first if available
            if (window.masterDataCache && Array.isArray(window.masterDataCache)) {
                return window.masterDataCache;
            }
            // Check if configured
            if (!CONFIG.SHEET_ID || CONFIG.SHEET_ID === 'YOUR_SHEET_ID_HERE') {
                console.warn('Sheet ID not configured');
                return [];
            }
            // Fetch from API
            const data = await GoogleSheetsAPI.fetchSheet(CONFIG.SHEET_NAME);
            return data || [];
        },
        updateFromData: (data) => {
            return ContentUpdater.updateFromMasterData(data);
        },
        getStats: (data) => {
            return ContentUpdater.getStats(data);
        }
    };
    
    // Initialize global cache
    window.masterDataCache = [];
    
})();

// ==========================================
// SMOOTH SCROLL & NAVIGATION FUNCTIONALITY
// ==========================================
(function() {
    'use strict';
    
    // Get navigation elements
    const mainNav = document.querySelector('#main-navigation');
    const navLinks = document.querySelectorAll('#main-navigation a');
    
    if (!mainNav || navLinks.length === 0) return;
    
    // Smooth scroll to sections
    navLinks.forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            
            // Remove active class from all links
            navLinks.forEach(l => l.classList.remove('active'));
            
            // Add active class to clicked link
            this.classList.add('active');
            
            // Get target section
            const targetId = this.getAttribute('href');
            const targetSection = document.querySelector(targetId);
            
            if (targetSection) {
                // Calculate offset for fixed nav
                const navHeight = mainNav.offsetHeight;
                const targetPosition = targetSection.getBoundingClientRect().top + window.pageYOffset - navHeight - 20;
                
                // Smooth scroll
                window.scrollTo({
                    top: targetPosition,
                    behavior: 'smooth'
                });
            }
        });
    });
    
    // Highlight active section on scroll
    let ticking = false;
    
    function updateActiveNav() {
        const sections = document.querySelectorAll('h3[id^="section-"]');
        const navHeight = mainNav ? mainNav.offsetHeight : 0;
        const scrollPosition = window.pageYOffset + navHeight + 100;
        
        sections.forEach(section => {
            const sectionTop = section.offsetTop;
            const sectionBottom = sectionTop + section.offsetHeight;
            const sectionId = section.getAttribute('id');
            
            if (scrollPosition >= sectionTop && scrollPosition < sectionBottom) {
                navLinks.forEach(link => {
                    link.classList.remove('active');
                    if (link.getAttribute('href') === '#' + sectionId) {
                        link.classList.add('active');
                    }
                });
            }
        });
        
        ticking = false;
    }
    
    function requestUpdateNav() {
        if (!ticking) {
            window.requestAnimationFrame(updateActiveNav);
            ticking = true;
        }
    }
    
    window.addEventListener('scroll', requestUpdateNav);
    
    // Initial active section
    updateActiveNav();
    
    /* ====== CREATE TERM MODAL ====== */
    function initCreateTermModal() {
        const createBtn = document.getElementById('create-term-btn');
        const modal = document.getElementById('create-term-modal');
        const closeBtn = document.getElementById('modal-close-btn');
        const cancelBtn = document.getElementById('cancel-btn');
        const submitBtn = document.getElementById('submit-btn');
        const hangMucSelect = document.getElementById('hang-muc-select');
        const contentArea = document.getElementById('content-area');
        const selectedTextInfo = document.getElementById('selected-text-info');
        const selectedTextDisplay = document.getElementById('selected-text-display');
        const idTheInput = document.getElementById('id-the-input');
        const tenTheInput = document.getElementById('ten-the-input');
        const urlInput = document.getElementById('url-input');
        const uploadArea = document.getElementById('upload-area');
        const fileInput = document.getElementById('file-input');
        const uploadPreview = document.getElementById('upload-preview');
        const previewImage = document.getElementById('preview-image');
        const fileName = document.getElementById('file-name');
        const removeFileBtn = document.getElementById('remove-file');
        const uploadProgress = document.getElementById('upload-progress');
        const progressFill = document.getElementById('progress-fill');
        const uploadStatus = document.getElementById('upload-status');

        let selectedText = '';
        let currentHangMuc = '';
        let uploadedFile = null;

        // Section mapping - match với sections trong HTML
        const sectionMap = {
            '1. ONBOARD': 'section-onboard',
            '2. CẤU HÌNH': 'section-dang-don',
            '3. ĐĂNG ĐƠN': 'section-dang-don-3',
            '4. VẬN HÀNH.': 'section-van-hanh',
            '5. HUB.': 'section-hub',
            '6. KHO ĐÍCH.': 'section-kho-dich'
        };

        // Open modal
        createBtn.addEventListener('click', () => {
            modal.classList.add('active');
            resetForm();
        });

        // Close modal
        const closeModal = () => {
            modal.classList.remove('active');
            resetForm();
        };

        closeBtn.addEventListener('click', closeModal);
        cancelBtn.addEventListener('click', closeModal);
        
        // Close on backdrop click
        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                closeModal();
            }
        });

        // Hạng mục selection
        hangMucSelect.addEventListener('change', (e) => {
            currentHangMuc = e.target.value;
            if (currentHangMuc) {
                loadSectionContent(currentHangMuc);
            } else {
                contentArea.innerHTML = 'Vui lòng chọn hạng mục để hiển thị nội dung...';
                contentArea.classList.remove('has-selection');
            }
            resetSelection();
        });

        // Load section content
        function loadSectionContent(hangMuc) {
            const sectionId = sectionMap[hangMuc];
            if (!sectionId) {
                contentArea.innerHTML = '<p style="color: red;">Không tìm thấy nội dung cho hạng mục này.</p>';
                return;
            }

            const sectionElement = document.getElementById(sectionId);
            if (!sectionElement) {
                contentArea.innerHTML = '<p style="color: red;">Không tìm thấy section trong trang.</p>';
                return;
            }

            // Get section content (exclude heading)
            const heading = sectionElement.querySelector('h3');
            let content = sectionElement.innerHTML;
            
            // Remove heading from content
            if (heading) {
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = content;
                const headingClone = tempDiv.querySelector('h3');
                if (headingClone) {
                    headingClone.remove();
                }
                content = tempDiv.innerHTML;
            }

            // Display content (first 3000 characters to avoid too much text)
            const truncatedContent = content.substring(0, 3000);
            contentArea.innerHTML = truncatedContent + (content.length > 3000 ? '...' : '');
            contentArea.classList.remove('has-selection');

            // Enable text selection
            enableTextSelection();
        }

        // Enable text selection in content area
        function enableTextSelection() {
            contentArea.addEventListener('mouseup', handleTextSelection);
            contentArea.addEventListener('touchend', handleTextSelection);
        }

        // Handle text selection
        function handleTextSelection() {
            const selection = window.getSelection();
            const text = selection.toString().trim();

            if (text.length > 0 && text.length <= 100) {
                selectedText = text;
                selectedTextDisplay.textContent = text;
                selectedTextInfo.classList.add('active');
                contentArea.classList.add('has-selection');

                // Auto-fill form fields
                tenTheInput.value = text;
                idTheInput.value = generateId(text, currentHangMuc);
                
                // Enable submit button if URL is provided
                updateSubmitButton();
            }
        }

        // Generate ID from text
        function generateId(text, hangMuc) {
            // Remove dấu
            const normalized = text
                .normalize('NFD')
                .replace(/[\u0300-\u036f]/g, '')
                .toUpperCase()
                .replace(/[^A-Z0-9\s]/g, '')
                .replace(/\s+/g, '_')
                .substring(0, 30);

            // Prefix from hạng mục
            const prefixMap = {
                '1. ONBOARD': 'OB',
                '2. CẤU HÌNH': 'CH',
                '3. ĐĂNG ĐƠN': 'DD',
                '4. VẬN HÀNH.': 'VH',
                '5. HUB.': 'HUB',
                '6. KHO ĐÍCH.': 'KD'
            };

            const prefix = prefixMap[hangMuc] || 'TERM';
            return `${prefix}_${normalized}`;
        }

        // File upload handlers
        uploadArea.addEventListener('click', () => fileInput.click());
        
        fileInput.addEventListener('change', handleFileSelect);
        
        // Drag and drop
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });
        
        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });
        
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                fileInput.files = files;
                handleFileSelect();
            }
        });
        
        removeFileBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            resetUpload();
        });

        // URL input validation
        urlInput.addEventListener('input', updateSubmitButton);

        function updateSubmitButton() {
            const hasText = tenTheInput.value.trim().length > 0;
            const hasUrl = urlInput.value.trim().length > 0;
            submitBtn.disabled = !(hasText && hasUrl);
        }

        // Submit form
        submitBtn.addEventListener('click', async () => {
            const formData = {
                hang_muc: currentHangMuc,
                id_the: idTheInput.value,
                ten_the: tenTheInput.value,
                url: urlInput.value
            };

            console.log('📋 Form Data:', formData);
            
            // Disable button and show loading
            submitBtn.disabled = true;
            submitBtn.textContent = '⏳ Đang lưu...';

            try {
                // Call Google Apps Script Web App
                const response = await fetch(WEB_APP_URL, {
                    method: 'POST',
                    mode: 'no-cors', // Required for Apps Script
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    },
                    body: new URLSearchParams({
                        action: 'create',
                        ...formData
                    })
                });

                // Note: no-cors mode doesn't return response body
                // Assume success and reload cache
                alert('✅ Tạo khối thành công!\n\n' +
                      `ID: ${formData.id_the}\n` +
                      `Tên: ${formData.ten_the}\n\n` +
                      'Vui lòng reload trang để thấy khối mới.');

                // Reload page to fetch new data
                setTimeout(() => {
                    window.location.reload();
                }, 1000);

            } catch (error) {
                console.error('Error creating term:', error);
                alert('❌ Có lỗi xảy ra! Vui lòng thử lại.\n\n' + error.message);
                submitBtn.disabled = false;
                submitBtn.textContent = 'Tạo Khối';
            }
        });

        function resetForm() {
            hangMucSelect.value = '';
            contentArea.innerHTML = 'Vui lòng chọn hạng mục để hiển thị nội dung...';
            contentArea.classList.remove('has-selection');
            resetSelection();
            resetUpload();
            submitBtn.disabled = true;
        }

        function resetSelection() {
            selectedText = '';
            selectedTextInfo.classList.remove('active');
            selectedTextDisplay.textContent = '';
            idTheInput.value = '';
            tenTheInput.value = '';
        }

        // File upload functions
        function handleFileSelect() {
            const file = fileInput.files[0];
            if (!file) return;

            // Validate file size (10MB max)
            if (file.size > 10 * 1024 * 1024) {
                alert('⚠️ File quá lớn! Vui lòng chọn file dưới 10MB.');
                fileInput.value = '';
                return;
            }

            // Validate file type
            const validTypes = ['image/jpeg', 'image/png', 'image/gif', 'image/webp', 'video/mp4'];
            if (!validTypes.includes(file.type)) {
                alert('⚠️ File không hợp lệ! Chỉ hỗ trợ JPG, PNG, GIF, WEBP, MP4');
                fileInput.value = '';
                return;
            }

            uploadedFile = file;
            showPreview(file);
            uploadToImgur(file);
        }

        function showPreview(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                if (file.type.startsWith('image/')) {
                    previewImage.src = e.target.result;
                    previewImage.style.display = 'block';
                } else {
                    previewImage.style.display = 'none';
                }
                fileName.textContent = file.name;
                uploadPreview.classList.add('active');
                uploadArea.style.display = 'none';
            };
            reader.readAsDataURL(file);
        }

        async function uploadToImgur(file) {
            // Imgur API Client ID (public, free tier)
            const IMGUR_CLIENT_ID = '547b0c065feb937';
            
            uploadProgress.classList.add('active');
            uploadStatus.textContent = '⏳ Đang upload...';
            uploadStatus.className = 'upload-status';
            progressFill.style.width = '0%';
            progressFill.textContent = '0%';

            const formData = new FormData();
            formData.append('image', file);

            try {
                // Simulate progress
                let progress = 0;
                const progressInterval = setInterval(() => {
                    progress += 10;
                    if (progress <= 90) {
                        progressFill.style.width = progress + '%';
                        progressFill.textContent = progress + '%';
                    }
                }, 200);

                const response = await fetch('https://api.imgur.com/3/image', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Client-ID ${IMGUR_CLIENT_ID}`
                    },
                    body: formData
                });

                clearInterval(progressInterval);

                if (!response.ok) {
                    throw new Error('Upload failed');
                }

                const data = await response.json();
                
                if (data.success && data.data.link) {
                    const imageUrl = data.data.link;
                    
                    // Complete progress
                    progressFill.style.width = '100%';
                    progressFill.textContent = '100%';
                    
                    // Update status
                    uploadStatus.textContent = '✅ Upload thành công!';
                    uploadStatus.className = 'upload-status success';
                    
                    // Fill URL input
                    urlInput.value = imageUrl;
                    updateSubmitButton();
                    
                    // Hide progress after 2s
                    setTimeout(() => {
                        uploadProgress.classList.remove('active');
                    }, 2000);
                } else {
                    throw new Error('Invalid response');
                }
            } catch (error) {
                console.error('Upload error:', error);
                progressFill.style.width = '100%';
                progressFill.textContent = 'Error';
                uploadStatus.textContent = '❌ Upload thất bại! Vui lòng thử lại.';
                uploadStatus.className = 'upload-status error';
            }
        }

        function resetUpload() {
            fileInput.value = '';
            uploadedFile = null;
            uploadPreview.classList.remove('active');
            uploadProgress.classList.remove('active');
            uploadArea.style.display = 'block';
            urlInput.value = '';
            previewImage.src = '';
            fileName.textContent = '';
            updateSubmitButton();
        }
    }
    
    // Initialize when DOM is ready
    document.addEventListener('DOMContentLoaded', function() {
        initCreateTermModal();
    });
    
})();

    


    // ===== NAVIGATION SMOOTH SCROLL AND ACTIVE STATE =====
    // Smooth scroll for navigation
    document.querySelectorAll('.nav-link').forEach(link => {
      link.addEventListener('click', function(e) {
        e.preventDefault();
        const targetId = this.getAttribute('href').substring(1);
        const targetElement = document.getElementById(targetId);
        
        if (targetElement) {
          const navHeight = document.querySelector('.main-nav').offsetHeight;
          const elementPosition = targetElement.getBoundingClientRect().top;
          const offsetPosition = elementPosition + window.pageYOffset - navHeight - 20;
          
          window.scrollTo({
            top: offsetPosition,
            behavior: 'smooth'
          });
        }
      });
    });

    // Active link on scroll
    window.addEventListener('scroll', function() {
      const sections = ['faeda640-dac4-4844-9dad-9606804fd78c', '2ceec18e-70ae-8058-841a-e0265fc85386', '2ceec18e-70ae-8021-ba52-d0ba83f7adf6', '2ceec18e-70ae-804c-99de-f363da316462', '2ceec18e-70ae-8095-9925-c2ca73ab3c91', '2ceec18e-70ae-80f6-8e4e-cc86f4a0e914'];
      const navHeight = document.querySelector('.main-nav').offsetHeight;
      
      let currentSection = '';
      sections.forEach(sectionId => {
        const section = document.getElementById(sectionId);
        if (section) {
          const sectionTop = section.offsetTop - navHeight - 100;
          if (window.pageYOffset >= sectionTop) {
            currentSection = sectionId;
          }
        }
      });
      
      document.querySelectorAll('.nav-link').forEach(link => {
        link.classList.remove('active');
        if (link.getAttribute('href') === '#' + currentSection) {
          link.classList.add('active');
        }
      });
    });
</script>
</body></html>
