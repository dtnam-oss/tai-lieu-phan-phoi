<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>Tài liệu tổng quan luồng phân phối</title><link rel="icon" type="image/svg+xml" href="favicon.svg"/>
<!-- Premium Typography -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

<!-- ============================================================================
     STATIC DATA - Pre-built data for ultra-fast loading (no API calls)
     ============================================================================ -->
<!-- 
   USAGE: When content changes, run buildStaticData() in Google Apps Script,
   then replace this file with the generated static-data.js
   
   To download: 
   https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec?action=download_static_data
-->
<!-- STATIC MODE DISABLED - Using API + Cache mode -->
<!-- <script src="static-data.js"></script> -->
<!-- If static-data.js not found, will fallback to API mode -->

<style>

/* ========================================
   PREMIUM DOCUMENTATION UI - PRIORITY STYLES
   ======================================== */

/* Background for entire page */
html, body {
    background: #F0F2F5 !important; /* Light gray-blue background */
    margin: 0 !important;
    padding: 0 !important;
    width: 100% !important;
    max-width: 100vw !important;
    overflow-x: hidden !important;
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif !important;
    color: #334155 !important; /* Slate color for better readability */
    line-height: 1.6 !important;
}

/* Document Paper Container - The "Page" Effect */
.document-paper {
    background: #ffffff !important;
    max-width: 1440px !important;
    width: 100% !important;
    margin: 40px auto !important; /* Space for fixed nav + bottom margin */
    padding: 60px 80px !important;
    border-radius: 8px !important;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08) !important;
    box-sizing: border-box !important;
}

/* Mobile adjustments for paper */
@media (max-width: 768px) {
    .document-paper {
        margin: 80px 10px 20px 10px !important;
        padding: 20px !important;
        border-radius: 6px !important;
    }
}

/* ========================================
   AGGRESSIVE TABLE FIXES - HIGHEST PRIORITY
   ======================================== */

/* Force all tables to respect container width - HARD ENFORCEMENT */
.document-paper table,
.document-paper .simple-table {
    width: 100% !important;
    max-width: 100% !important;
    table-layout: fixed !important;
    border-collapse: separate !important; /* Changed from collapse for border-radius */
    border-spacing: 0 !important;
    margin: 1.5rem 0 !important;
    margin-left: 0 !important;
    margin-right: 0 !important;
    box-sizing: border-box !important;
    border-radius: 12px !important; /* Premium rounded corners */
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08), 0 2px 4px rgba(0, 0, 0, 0.04) !important; /* Soft elevation */
    overflow: hidden !important; /* Ensure content respects border-radius */
}

/* Force word wrapping in all cells */
.document-paper table th,
.document-paper table td,
.document-paper .simple-table th,
.document-paper .simple-table td {
    word-wrap: break-word !important;
    overflow-wrap: break-word !important;
    word-break: break-word !important;
    white-space: normal !important;
    hyphens: auto !important;
    vertical-align: top !important;
    padding: 16px !important; /* Increased for premium spacing */
    line-height: 1.6 !important;
    box-sizing: border-box !important;
}

/* PREMIUM TABLE HEADERS - GHTK Green Gradient with Sticky */
.document-paper table th,
.document-paper .simple-table th,
.document-paper .simple-table-header th {
    background: linear-gradient(135deg, #00b14f 0%, #028a3d 100%) !important;
    color: #ffffff !important;
    font-weight: 600 !important;
    text-align: left !important;
    position: sticky !important;
    top: 0 !important;
    z-index: 10 !important;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1) !important;
}

/* Rounded corners for header - matching table border-radius */
.document-paper table thead tr:first-child th:first-child,
.document-paper .simple-table thead tr:first-child th:first-child {
    border-top-left-radius: 12px !important;
}

.document-paper table thead tr:first-child th:last-child,
.document-paper .simple-table thead tr:first-child th:last-child {
    border-top-right-radius: 12px !important;
}

/* Rounded corners for last row */
.document-paper table tbody tr:last-child td:first-child,
.document-paper .simple-table tbody tr:last-child td:first-child {
    border-bottom-left-radius: 12px !important;
}

.document-paper table tbody tr:last-child td:last-child,
.document-paper .simple-table tbody tr:last-child td:last-child {
    border-bottom-right-radius: 12px !important;
}

/* PREMIUM ROW HOVER - Mint Green Highlight */
.document-paper table tbody tr:hover,
.document-paper .simple-table tbody tr:hover {
    background-color: #f0fdf4 !important; /* Mint ultra light */
    border-left: 4px solid #00b14f !important;
    transition: all 0.2s ease !important;
    cursor: pointer !important;
}

/* BADGE STYLING - First Column (Bộ phận thực hiện) */
.document-paper table tbody tr td:first-child,
.document-paper .simple-table tbody tr td:first-child {
    background-color: #f0fdfa !important; /* Teal ultra light */
    font-weight: 600 !important;
    color: #0f766e !important; /* Teal dark */
    border-right: 2px solid #ccfbf1 !important;
}

/* CRITICAL: Force consistent 30-70% column ratio for ALL tables */
.document-paper table tr > *:first-child,
.document-paper .simple-table tr > *:first-child {
    width: 30% !important;
    min-width: 30% !important;
    max-width: 30% !important;
}

.document-paper table tr > *:nth-child(2),
.document-paper .simple-table tr > *:nth-child(2) {
    width: 70% !important;
    min-width: 70% !important;
    max-width: 70% !important;
}

/* Special rule for 3-column table (ONBOARD section) */
.document-paper table#70fe4b0d-c3af-486e-8387-de3a7ced6ce4 tbody tr td:nth-child(1),
.document-paper table#70fe4b0d-c3af-486e-8387-de3a7ced6ce4 thead tr th:nth-child(1) {
    width: 20% !important;
    min-width: 20% !important;
    max-width: 20% !important;
}

.document-paper table#70fe4b0d-c3af-486e-8387-de3a7ced6ce4 tbody tr td:nth-child(2),
.document-paper table#70fe4b0d-c3af-486e-8387-de3a7ced6ce4 thead tr th:nth-child(2),
.document-paper table#70fe4b0d-c3af-486e-8387-de3a7ced6ce4 tbody tr td:nth-child(3),
.document-paper table#70fe4b0d-c3af-486e-8387-de3a7ced6ce4 thead tr th:nth-child(3) {
    width: 40% !important;
    min-width: 40% !important;
    max-width: 40% !important;
}

/* Force links and code to break properly */
.document-paper table td a,
.document-paper table td code,
.document-paper .simple-table td a,
.document-paper .simple-table td code {
    word-break: break-all !important;
    overflow-wrap: break-word !important;
    display: inline !important;
    max-width: 100% !important;
}

/* Remove any inline width styles - Override with extreme specificity */
.document-paper table[style*="width"],
.document-paper table th[style*="width"],
.document-paper table td[style*="width"],
.document-paper .simple-table[style*="width"],
.document-paper .simple-table th[style*="width"],
.document-paper .simple-table td[style*="width"] {
    width: auto !important;
}

/* Reset header column widths for consistency */
.document-paper .simple-table thead tr th:nth-child(1) {
    width: 30% !important;
}

.document-paper .simple-table thead tr th:nth-child(2) {
    width: 70% !important;
}

/* Mobile table adjustments */
@media (max-width: 768px) {
    .document-paper .simple-table tbody tr td:nth-child(1),
    .document-paper .simple-table thead tr th:nth-child(1) {
        width: 30% !important;
        min-width: 30% !important;
        max-width: 30% !important;
    }
    
    .document-paper .simple-table tbody tr td:nth-child(2),
    .document-paper .simple-table thead tr th:nth-child(2) {
        width: 70% !important;
        min-width: 70% !important;
        max-width: 70% !important;
    }
    
    .document-paper table th,
    .document-paper table td {
        font-size: 0.85rem !important;
        padding: 0.5rem 0.4rem !important;
    }
}

/* ===== EMERGENCY LAYOUT FIX ===== */
/* Force proper box-sizing globally */
*, *::before, *::after {
    box-sizing: border-box !important;
}

/* Fix viewport overflow */
html {
    width: 100% !important;
    max-width: 100vw !important;
    overflow-x: hidden !important;
    margin: 0 !important;
    padding: 0 !important;
}

body {
    width: 100% !important;
    max-width: 100vw !important;
    overflow-x: hidden !important;
    margin: 0 !important;
    padding: 0 !important;
    background: #F8FFF9 !important; /* Light green tint */
}

/* Override Notion's default max-width */
@media only screen {
    body {
        margin: 0 !important;
        max-width: 100vw !important;
        width: 100% !important;
    }
}

/* Fix main containers */
.page, .page.sans, article {
    width: 100% !important;
    max-width: 100% !important;
    margin: 0 !important;
    padding: 0 !important;
}

/* Fix page body */
.page-body {
    width: 100% !important;
    max-width: 100% !important;
    margin: 0 auto !important;
    padding: 2rem clamp(1rem, 5vw, 3rem) !important;
}

/* ========================================
   PREMIUM PROCESS/STEP HIGHLIGHTING
   ======================================== */

/* Highlight steps (Bước 1, Bước 2, etc.) */
.document-paper strong:is(
    [style*="border-bottom"],
    span[style*="border-bottom"]
) {
    color: #00b14f !important;
    background: linear-gradient(120deg, #d4fc79 0%, #96e6a1 100%) !important;
    padding: 2px 6px !important;
    border-radius: 4px !important;
    font-weight: 600 !important;
    display: inline-block !important;
}

/* Highlight any strong tag containing "Bước" */
.document-paper td strong,
.document-paper td b {
    color: #059669 !important; /* Green 600 */
    font-weight: 600 !important;
}

/* Special highlight for "Lưu ý" */
.document-paper em strong span,
.document-paper em strong {
    color: #f59e0b !important; /* Amber 500 */
    font-weight: 600 !important;
}

/* ========================================
   PREMIUM CALLOUT/NOTE BOXES
   ======================================== */

/* Style for paragraphs/sections containing "Lưu ý" */
.document-paper td:has(em:has(strong:has(span[style*="border-bottom"]))),
.document-paper td em {
    background: #fffbeb !important; /* Amber 50 */
    border-left: 4px solid #f59e0b !important; /* Amber 500 */
    padding: 12px 15px !important;
    border-radius: 6px !important;
    margin: 8px 0 !important;
    display: block !important;
    font-style: normal !important;
}

/* Icon-like styling for note markers */
.document-paper td em strong::before {
    content: "⚠️ ";
    margin-right: 4px;
}

/* ========================================
   CODE BLOCK & INLINE CODE PREMIUM STYLING
   ======================================== */

.document-paper code {
    background: #f1f5f9 !important; /* Slate 100 */
    color: #0f766e !important; /* Teal 700 */
    padding: 2px 6px !important;
    border-radius: 4px !important;
    font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', monospace !important;
    font-size: 0.9em !important;
    font-weight: 500 !important;
    border: 1px solid #e2e8f0 !important;
}

/* ========================================
   LINKS PREMIUM STYLING
   ======================================== */

.document-paper a {
    color: #00b14f !important;
    text-decoration: none !important;
    border-bottom: 1px solid transparent !important;
    transition: all 0.2s ease !important;
}

.document-paper a:hover {
    color: #028a3d !important;
    border-bottom: 1px solid #00b14f !important;
}

/* ========================================
   HEADINGS PREMIUM STYLING
   ======================================== */

.document-paper h1,
.document-paper h2,
.document-paper h3 {
    color: #1e293b !important; /* Slate 800 */
    font-weight: 700 !important;
    margin-top: 2em !important;
    margin-bottom: 0.5em !important;
}

.document-paper h3 {
    color: #00b14f !important; /* GHTK Green */
    font-size: 1.5rem !important;
    border-bottom: 2px solid #d4fc79 !important;
    padding-bottom: 8px !important;
    margin-top: 2.5em !important;
}

.document-paper .page-title {
    color: #1e293b !important;
    font-size: 2.75rem !important;
    font-weight: 800 !important;
    margin-bottom: 1rem !important;
}

/* ========================================
   MACOS BROWSER WINDOW MOCKUP
   ======================================== */

.browser-mockup {
    position: relative;
    background: #ffffff;
    border-radius: 12px;
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
    overflow: hidden;
    max-width: 750px;
    max-height: 450px;
    aspect-ratio: 16 / 9;
    margin: 30px auto;
    border: 1px solid #e2e8f0;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.browser-mockup:hover {
    transform: scale(1.02);
    box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
}

/* Video caption styling */
.browser-mockup::after {
    content: "Video minh họa thao tác thực tế";
    display: block;
    text-align: center;
    font-style: italic;
    color: #94a3b8;
    font-size: 0.875rem;
    padding: 12px 0;
    background: #ffffff;
}

.browser-header {
    height: 36px;
    background: #f1f5f9;
    border-bottom: 1px solid #e2e8f0;
    display: flex;
    align-items: center;
    padding: 0 12px;
}

.traffic-lights {
    display: flex;
    gap: 8px;
}

.traffic-lights span {
    width: 12px;
    height: 12px;
    border-radius: 50%;
}

.traffic-lights .red { 
    background: #ff5f56; 
}

.traffic-lights .yellow { 
    background: #ffbd2e; 
}

.traffic-lights .green { 
    background: #27c93f; 
}

.browser-content {
    position: absolute;
    top: 36px;
    left: 0;
    right: 0;
    bottom: 0;
    width: 100%;
    height: calc(100% - 36px);
    background: #ffffff;
    overflow: hidden;
}

/* Override inline styles on iframe wrapper */
.browser-content > div {
    position: absolute !important;
    width: 100% !important;
    height: 100% !important;
    padding-bottom: 0 !important;
}

/* Ensure iframe fills container */
.browser-content iframe {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border: none;
}

/* ========================================
   VIDEO PLACEHOLDER & LAZY LOADING
   Layers Architecture (Dot-Grid Minimalist)
   ======================================== */

/* Layer 0: Base Container */
.video-placeholder {
    position: absolute;
    top: 36px;
    left: 0;
    width: 100%;
    height: calc(100% - 36px);
    /* Dot-Grid Background */
    background-color: #f8fafc;
    background-image: radial-gradient(#cbd5e1 1px, transparent 1px);
    background-size: 20px 20px;
    cursor: pointer;
    transition: background-color 0.3s ease;
    overflow: hidden;
}

.video-placeholder:hover {
    background-color: #f1f5f9;
}

.video-placeholder.loading {
    cursor: wait;
}

/* Layer 1: Thumbnail Background (Below UI) */
.video-placeholder .thumbnail-bg {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: center;
    opacity: 0.15;
    z-index: 1;
    pointer-events: none;
}

/* Layer 2: UI Overlay (Above Thumbnail) */
.video-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 10;
    /* Optional: Semi-transparent overlay for better contrast */
    background: rgba(248, 250, 252, 0.3);
    backdrop-filter: blur(0px);
    
    /* Perfect Centering with Flexbox */
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 16px;
}

/* Play Button Container with Pulse Ring */
.play-button-wrapper {
    position: relative;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    z-index: 11;
}

/* Pulse Ring Animation - Breathing Effect */
.play-button-wrapper::before {
    content: '';
    position: absolute;
    width: 100%;
    height: 100%;
    border-radius: 50%;
    background: rgba(0, 177, 79, 0.3);
    animation: pulse-breathe 2.5s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    z-index: 0;
}

@keyframes pulse-breathe {
    0%, 100% {
        transform: scale(1);
        opacity: 0.8;
    }
    50% {
        transform: scale(1.5);
        opacity: 0;
    }
}

/* Play Button - Gradient Green with Glow */
.play-button {
    position: relative;
    width: 64px;
    height: 64px;
    background: linear-gradient(135deg, #00b14f, #009944);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 10px 25px rgba(0, 177, 79, 0.4);
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    z-index: 1;
}

.video-placeholder:hover .play-button {
    background: linear-gradient(135deg, #00c458, #00a84f);
    transform: scale(1.15);
    box-shadow: 0 15px 35px rgba(0, 177, 79, 0.5);
}

/* Play Icon Triangle */
.play-button::before {
    content: '';
    width: 0;
    height: 0;
    border-style: solid;
    border-width: 11px 0 11px 19px;
    border-color: transparent transparent transparent #ffffff;
    margin-left: 4px;
    filter: drop-shadow(0 2px 3px rgba(0, 0, 0, 0.15));
}

/* Loading State - Breathing Pulse */
.video-placeholder.loading .play-button {
    animation: button-breathe 2s ease-in-out infinite;
}

@keyframes button-breathe {
    0%, 100% {
        opacity: 1;
        transform: scale(1);
        box-shadow: 0 10px 25px rgba(0, 177, 79, 0.4);
    }
    50% {
        opacity: 0.8;
        transform: scale(0.98);
        box-shadow: 0 5px 15px rgba(0, 177, 79, 0.3);
    }
}

/* Helper Text - Pill-shaped Badge */
.play-helper-text {
    display: inline-block;
    padding: 8px 20px;
    font-size: 14px;
    font-weight: 500;
    color: #475569;
    background: #ffffff;
    border: 1px solid #e2e8f0;
    border-radius: 24px;
    letter-spacing: 0.2px;
    transition: all 0.3s ease;
    user-select: none;
    text-align: center;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
    z-index: 11;
}

.video-placeholder:hover .play-helper-text {
    color: #334155;
    border-color: #cbd5e1;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    transform: translateY(-2px);
}

/* ========================================
   REFRESH BUTTON (DEV TOOL)
   ======================================== */

.refresh-button {
    position: fixed;
    bottom: 24px;
    right: 24px;
    width: 48px;
    height: 48px;
    background: linear-gradient(135deg, #00b14f, #009944);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    box-shadow: 0 4px 12px rgba(0, 177, 79, 0.3);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    z-index: 9999;
    opacity: 0.7;
}

.refresh-button:hover {
    opacity: 1;
    transform: scale(1.1) rotate(90deg);
    box-shadow: 0 6px 20px rgba(0, 177, 79, 0.4);
}

.refresh-button:active {
    transform: scale(0.95) rotate(180deg);
}

.refresh-button.spinning {
    animation: spin 1s linear infinite;
}

@keyframes spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}

/* Refresh icon (SVG) */
.refresh-button svg {
    width: 24px;
    height: 24px;
    fill: #ffffff;
}

.refresh-button .tooltip {
    position: absolute;
    bottom: 60px;
    right: 0;
    background: #1e293b;
    color: #ffffff;
    padding: 8px 12px;
    border-radius: 6px;
    font-size: 12px;
    white-space: nowrap;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.2s;
}

.refresh-button:hover .tooltip {
    opacity: 1;
}

.refresh-button .tooltip::after {
    content: '';
    position: absolute;
    top: 100%;
    right: 12px;
    border: 6px solid transparent;
    border-top-color: #1e293b;
}

/* Skeleton Loading Animation */
@keyframes shimmer {
    0% {
        background-position: -200% 0;
    }
    100% {
        background-position: 200% 0;
    }
}

.skeleton-loading {
    pointer-events: none;
    opacity: 0.7;
}

.skeleton-loading .browser-content {
    background: linear-gradient(90deg, 
        #f0f0f0 0%, 
        #e0e0e0 20%, 
        #f0f0f0 40%, 
        #f0f0f0 100%
    );
    background-size: 200% 100%;
    animation: shimmer 1.5s infinite;
}

/* Video Slot Container */
.video-slot {
    margin: 20px 0;
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .browser-mockup {
        max-width: 100%;
        max-height: none;
        aspect-ratio: 16 / 9;
        margin: 20px 0;
        border-radius: 8px;
    }
    
    .browser-mockup:hover {
        transform: none;
    }
    
    .browser-mockup::after {
        font-size: 0.8rem;
        padding: 10px 0;
    }
    
    .browser-header {
        height: 32px;
    }
    
    .browser-content {
        top: 32px;
        height: calc(100% - 32px);
    }
    
    .traffic-lights span {
        width: 10px;
        height: 10px;
    }
}
    background: linear-gradient(135deg, #00b14f 0%, #028a3d 100%) !important;
    -webkit-background-clip: text !important;
    -webkit-text-fill-color: transparent !important;
    background-clip: text !important;
}

/* ========================================
   HR DIVIDER PREMIUM STYLING
   ======================================== */

.document-paper hr {
    border: none !important;
    height: 2px !important;
    background: linear-gradient(90deg, transparent 0%, #e2e8f0 20%, #e2e8f0 80%, transparent 100%) !important;
    margin: 2.5rem 0 !important;
}

/* ========================================
   PARAGRAPH & LIST PREMIUM STYLING
   ======================================== */

.document-paper p {
    margin: 1em 0 !important;
    line-height: 1.7 !important;
}

.document-paper ul,
.document-paper ol {
    padding-left: 1.5em !important;
    margin: 1em 0 !important;
}

.document-paper li {
    margin: 0.5em 0 !important;
    line-height: 1.6 !important;
}


/* cspell:disable-file */
/* webkit printing magic: print all background colors */
html {
	-webkit-print-color-adjust: exact;
}
* {
	box-sizing: border-box;
	-webkit-print-color-adjust: exact;
}

html,
body {
	margin: 0;
	padding: 0;
}
@media only screen {
	body {
		margin: 2em auto;
		max-width: 900px;
		color: rgb(55, 53, 47);
	}
}

body {
	line-height: 1.5;
	white-space: pre-wrap;
}

a,
a.visited {
	color: inherit;
	text-decoration: underline;
}

.pdf-relative-link-path {
	font-size: 80%;
	color: #444;
}

h1,
h2,
h3 {
	letter-spacing: -0.01em;
	line-height: 1.2;
	font-weight: 600;
	margin-bottom: 0;
}

/* Override strong tags inside headings to maintain consistent weight */
h1 strong,
h2 strong,
h3 strong {
	font-weight: 600;
}

.page-title {
	font-size: 2.5rem;
	font-weight: 700;
	margin-top: 0;
	margin-bottom: 0.75em;
}

h1 {
	font-size: 1.875rem;
	margin-top: 1.875rem;
}

h2 {
	font-size: 1.5rem;
	margin-top: 1.5rem;
}

h3 {
	font-size: 1.25rem;
	margin-top: 1.25rem;
}

.source {
	border: 1px solid #ddd;
	border-radius: 3px;
	padding: 1.5em;
	word-break: break-all;
}

.callout {
	border-radius: 10px;
	padding: 1rem;
}

figure {
	margin: 1.25em 0;
	page-break-inside: avoid;
}

figcaption {
	opacity: 0.5;
	font-size: 85%;
	margin-top: 0.5em;
}

/* Hide image/video placeholder code blocks from Notion export */
.column-list .column p code {
	display: none;
}

/* Hide all column-list blocks that are not inside tables */
.page-body > div[style*="display:contents"] > .column-list {
	display: none !important;
}

/* Extract data button */
#extract-data-btn {
	display: none !important;
}

#debug-btn {
	display: none !important;
}

#extract-data-modal {
	display: none;
	position: fixed;
	top: 0;
	left: 0;
	right: 0;
	bottom: 0;
	background: rgba(0,0,0,0.8);
	z-index: 10001;
	padding: 20px;
	overflow: auto;
}

#extract-data-modal.show {
	display: block;
}

#extract-data-content {
	background: white;
	max-width: 1200px;
	margin: 0 auto;
	padding: 30px;
	border-radius: 8px;
	position: relative;
}

#extract-close-btn {
	position: absolute;
	top: 15px;
	right: 15px;
	background: #dc3545;
	color: white;
	border: none;
	padding: 8px 16px;
	border-radius: 4px;
	cursor: pointer;
	font-weight: bold;
}

#extract-data-output {
	background: #f5f5f5;
	padding: 15px;
	border-radius: 4px;
	max-height: 500px;
	overflow: auto;
	font-family: monospace;
	font-size: 12px;
	white-space: pre;
	margin-top: 20px;
}

mark {
	background-color: transparent;
}

.indented {
	padding-left: 1.5em;
}

hr {
	background: transparent;
	display: block;
	width: 100%;
	height: 1px;
	visibility: visible;
	border: none;
	border-bottom: 1px solid rgba(55, 53, 47, 0.09);
}

img {
	max-width: 100%;
}

@media only print {
	img {
		max-height: 100vh;
		object-fit: contain;
	}
}

@page {
	margin: 1in;
}

.collection-content {
	font-size: 0.875rem;
}

.collection-content td {
	white-space: pre-wrap;
	word-break: break-word;
}

.column-list {
	display: flex;
	justify-content: space-between;
}

.column {
	padding: 0 1em;
}

.column:first-child {
	padding-left: 0;
}

.column:last-child {
	padding-right: 0;
}

.table_of_contents-item {
	display: block;
	font-size: 0.875rem;
	line-height: 1.3;
	padding: 0.125rem;
}

.table_of_contents-indent-1 {
	margin-left: 1.5rem;
}

.table_of_contents-indent-2 {
	margin-left: 3rem;
}

.table_of_contents-indent-3 {
	margin-left: 4.5rem;
}

.table_of_contents-link {
	text-decoration: none;
	opacity: 0.7;
	border-bottom: 1px solid rgba(55, 53, 47, 0.18);
}

table,
th,
td {
	border: 1px solid rgba(55, 53, 47, 0.09);
	border-collapse: collapse;
}

table {
	border-left: none;
	border-right: none;
}

th,
td {
	font-weight: normal;
	padding: 0.25em 0.5em;
	line-height: 1.5;
	min-height: 1.5em;
	text-align: left;
}

th {
	color: rgba(55, 53, 47, 0.6);
}

ol,
ul {
	margin: 0;
	margin-block-start: 0.6em;
	margin-block-end: 0.6em;
}

li > ol:first-child,
li > ul:first-child {
	margin-block-start: 0.6em;
}

ul > li {
	list-style: disc;
}

ul.to-do-list {
	padding-inline-start: 0;
}

ul.to-do-list > li {
	list-style: none;
}

.to-do-children-checked {
	text-decoration: line-through;
	opacity: 0.375;
}

ul.toggle > li {
	list-style: none;
}

ul {
	padding-inline-start: 1.7em;
}

ul > li {
	padding-left: 0.1em;
}

ol {
	padding-inline-start: 1.6em;
}

ol > li {
	padding-left: 0.2em;
}

.mono ol {
	padding-inline-start: 2em;
}

.mono ol > li {
	text-indent: -0.4em;
}

.toggle {
	padding-inline-start: 0em;
	list-style-type: none;
}

/* Indent toggle children */
.toggle > li > details {
	padding-left: 1.7em;
}

.toggle > li > details > summary {
	margin-left: -1.1em;
}

.selected-value {
	display: inline-block;
	padding: 0 0.5em;
	background: rgba(206, 205, 202, 0.5);
	border-radius: 3px;
	margin-right: 0.5em;
	margin-top: 0.3em;
	margin-bottom: 0.3em;
	white-space: nowrap;
}

.collection-title {
	display: inline-block;
	margin-right: 1em;
}

.page-description {
	margin-bottom: 2em;
}

/* Notion default styles removed - using custom table styles below */

.simple-table-header-color {
	background: rgb(247, 246, 243);
	color: black;
}
.simple-table-header {
	font-weight: 500;
}

time {
	opacity: 0.5;
}

.icon {
	display: inline-flex;
	align-items: center;
	justify-content: center;
	max-width: 1.2em;
	max-height: 1.2em;
	text-decoration: none;
	vertical-align: text-bottom;
	margin-right: 0.5em;
}

img.icon {
	border-radius: 3px;
}

.callout img.notion-static-icon {
	width: 1em;
	height: 1em;
}

.callout p {
	margin: 0;
}

.callout h1,
.callout h2,
.callout h3 {
	margin: 0 0 0.6rem;
}

.user-icon {
	width: 1.5em;
	height: 1.5em;
	border-radius: 100%;
	margin-right: 0.5rem;
}

.user-icon-inner {
	font-size: 0.8em;
}

.text-icon {
	border: 1px solid #000;
	text-align: center;
}

.page-cover-image {
	display: block;
	object-fit: cover;
	width: 100%;
	max-height: 30vh;
}

.page-header-icon {
	font-size: 3rem;
	margin-bottom: 1rem;
}

.page-header-icon-with-cover {
	margin-top: -0.72em;
	margin-left: 0.07em;
}

.page-header-icon img {
	border-radius: 3px;
}

.link-to-page {
	margin: 1em 0;
	padding: 0;
	border: none;
	font-weight: 500;
}

p > .user {
	opacity: 0.5;
}

td > .user,
td > time {
	white-space: nowrap;
}

input[type="checkbox"] {
	transform: scale(1.5);
	margin-right: 0.6em;
	vertical-align: middle;
}

p {
	margin-top: 0.5em;
	margin-bottom: 0.5em;
}

.image {
	border: none;
	margin: 1.5em 0;
	padding: 0;
	border-radius: 0;
	text-align: center;
}

.code,
code {
	background: rgba(135, 131, 120, 0.15);
	border-radius: 3px;
	padding: 0.2em 0.4em;
	border-radius: 3px;
	font-size: 85%;
	tab-size: 2;
}

code {
	color: #eb5757;
}

.code {
	padding: 1.5em 1em;
}

.code-wrap {
	white-space: pre-wrap;
	word-break: break-all;
}

.code > code {
	background: none;
	padding: 0;
	font-size: 100%;
	color: inherit;
}

blockquote {
	font-size: 1em;
	margin: 1em 0;
	padding-left: 1em;
	border-left: 3px solid rgb(55, 53, 47);
}

blockquote.quote-large {
	font-size: 1.25em;
}

.bookmark {
	text-decoration: none;
	max-height: 8em;
	padding: 0;
	display: flex;
	width: 100%;
	align-items: stretch;
}

.bookmark-title {
	font-size: 0.85em;
	overflow: hidden;
	text-overflow: ellipsis;
	height: 1.75em;
	white-space: nowrap;
}

.bookmark-text {
	display: flex;
	flex-direction: column;
}

.bookmark-info {
	flex: 4 1 180px;
	padding: 12px 14px 14px;
	display: flex;
	flex-direction: column;
	justify-content: space-between;
}

.bookmark-image {
	width: 33%;
	flex: 1 1 180px;
	display: block;
	position: relative;
	object-fit: cover;
	border-radius: 1px;
}

.bookmark-description {
	color: rgba(55, 53, 47, 0.6);
	font-size: 0.75em;
	overflow: hidden;
	max-height: 4.5em;
	word-break: break-word;
}

.bookmark-href {
	font-size: 0.75em;
	margin-top: 0.25em;
}

.sans { font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; }
.code { font-family: "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace; }
.serif { font-family: Lyon-Text, Georgia, ui-serif, serif; }
.mono { font-family: iawriter-mono, Nitti, Menlo, Courier, monospace; }
.pdf .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK JP'; }
.pdf:lang(zh-CN) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK SC'; }
.pdf:lang(zh-TW) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK TC'; }
.pdf:lang(ko-KR) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK KR'; }
.pdf .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.pdf .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK JP'; }
.pdf:lang(zh-CN) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK SC'; }
.pdf:lang(zh-TW) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK TC'; }
.pdf:lang(ko-KR) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK KR'; }
.pdf .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.highlight-default {
	color: rgba(44, 44, 43, 1);
}
.highlight-gray {
	color: rgba(125, 122, 117, 1);
	fill: rgba(125, 122, 117, 1);
}
.highlight-brown {
	color: rgba(159, 118, 90, 1);
	fill: rgba(159, 118, 90, 1);
}
.highlight-orange {
	color: rgba(210, 123, 45, 1);
	fill: rgba(210, 123, 45, 1);
}
.highlight-yellow {
	color: rgba(203, 148, 52, 1);
	fill: rgba(203, 148, 52, 1);
}
.highlight-teal {
	color: rgba(80, 148, 110, 1);
	fill: rgba(80, 148, 110, 1);
}
.highlight-blue {
	color: rgba(56, 125, 201, 1);
	fill: rgba(56, 125, 201, 1);
}
.highlight-purple {
	color: rgba(154, 107, 180, 1);
	fill: rgba(154, 107, 180, 1);
}
.highlight-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.highlight-red {
	color: rgba(207, 81, 72, 1);
	fill: rgba(207, 81, 72, 1);
}
.highlight-default_background {
	color: rgba(44, 44, 43, 1);
}
.highlight-gray_background {
	background: rgba(42, 28, 0, 0.07);
}
.highlight-brown_background {
	background: rgba(139, 46, 0, 0.086);
}
.highlight-orange_background {
	background: rgba(224, 101, 1, 0.129);
}
.highlight-yellow_background {
	background: rgba(211, 168, 0, 0.137);
}
.highlight-teal_background {
	background: rgba(0, 100, 45, 0.09);
}
.highlight-blue_background {
	background: rgba(0, 124, 215, 0.094);
}
.highlight-purple_background {
	background: rgba(102, 0, 178, 0.078);
}
.highlight-pink_background {
	background: rgba(197, 0, 93, 0.086);
}
.highlight-red_background {
	background: rgba(223, 22, 0, 0.094);
}
.block-color-default {
	color: inherit;
	fill: inherit;
}
.block-color-gray {
	color: rgba(125, 122, 117, 1);
	fill: rgba(125, 122, 117, 1);
}
.block-color-brown {
	color: rgba(159, 118, 90, 1);
	fill: rgba(159, 118, 90, 1);
}
.block-color-orange {
	color: rgba(210, 123, 45, 1);
	fill: rgba(210, 123, 45, 1);
}
.block-color-yellow {
	color: rgba(203, 148, 52, 1);
	fill: rgba(203, 148, 52, 1);
}
.block-color-teal {
	color: rgba(80, 148, 110, 1);
	fill: rgba(80, 148, 110, 1);
}
.block-color-blue {
	color: rgba(56, 125, 201, 1);
	fill: rgba(56, 125, 201, 1);
}
.block-color-purple {
	color: rgba(154, 107, 180, 1);
	fill: rgba(154, 107, 180, 1);
}
.block-color-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.block-color-red {
	color: rgba(207, 81, 72, 1);
	fill: rgba(207, 81, 72, 1);
}
.block-color-default_background {
	color: inherit;
	fill: inherit;
}
.block-color-gray_background {
	background: rgba(240, 239, 237, 1);
}
.block-color-brown_background {
	background: rgba(245, 237, 233, 1);
}
.block-color-orange_background {
	background: rgba(251, 235, 222, 1);
}
.block-color-yellow_background {
	background: rgba(249, 243, 220, 1);
}
.block-color-teal_background {
	background: rgba(232, 241, 236, 1);
}
.block-color-blue_background {
	background: rgba(229, 242, 252, 1);
}
.block-color-purple_background {
	background: rgba(243, 235, 249, 1);
}
.block-color-pink_background {
	background: rgba(250, 233, 241, 1);
}
.block-color-red_background {
	background: rgba(252, 233, 231, 1);
}
.select-value-color-default { background-color: rgba(42, 28, 0, 0.07); }
.select-value-color-gray { background-color: rgba(28, 19, 1, 0.11); }
.select-value-color-brown { background-color: rgba(127, 51, 0, 0.156); }
.select-value-color-orange { background-color: rgba(196, 88, 0, 0.203); }
.select-value-color-yellow { background-color: rgba(209, 156, 0, 0.282); }
.select-value-color-green { background-color: rgba(0, 96, 38, 0.156); }
.select-value-color-blue { background-color: rgba(0, 118, 217, 0.203); }
.select-value-color-purple { background-color: rgba(92, 0, 163, 0.141); }
.select-value-color-pink { background-color: rgba(183, 0, 78, 0.152); }
.select-value-color-red { background-color: rgba(206, 24, 0, 0.164); }

.checkbox {
	display: inline-flex;
	vertical-align: text-bottom;
	width: 16;
	height: 16;
	background-size: 16px;
	margin-left: 2px;
	margin-right: 5px;
}

.checkbox-on {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20width%3D%2216%22%20height%3D%2216%22%20fill%3D%22%2358A9D7%22%2F%3E%0A%3Cpath%20d%3D%22M6.71429%2012.2852L14%204.9995L12.7143%203.71436L6.71429%209.71378L3.28571%206.2831L2%207.57092L6.71429%2012.2852Z%22%20fill%3D%22white%22%2F%3E%0A%3C%2Fsvg%3E");
}

.checkbox-off {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20x%3D%220.75%22%20y%3D%220.75%22%20width%3D%2214.5%22%20height%3D%2214.5%22%20fill%3D%22white%22%20stroke%3D%22%2336352F%22%20stroke-width%3D%221.5%22%2F%3E%0A%3C%2Fsvg%3E");
}
	

/* ============================================
   ENHANCED STYLES - Modern Interactive Design
   GREEN THEME - Responsive & Optimized
   ============================================ */

/* CSS Variables for Green Theme */
:root {
    /* Main Green Colors */
    --primary-color: #2ECC71;      /* Emerald green */
    --secondary-color: #27AE60;    /* Dark emerald */
    --light-green: #58D68D;        /* Light emerald */
    --pale-green: #ABEBC6;         /* Very light green */
    --accent-color: #229954;       /* Deep green */

    /* Supporting Colors */
    --text-primary: #2C3E50;
    --text-secondary: #7F8C8D;
    --bg-gradient-start: #F0F8F5;  /* Pale green background */
    --bg-gradient-end: #D5F4E6;    /* Light green gradient */
    --white: #FFFFFF;

    /* Layout Variables - Optimized */
    --sidebar-width: 220px;        /* Reduced from 280px */
    --header-height: 90px;         /* Reduced from 120px */

    /* Shadows */
    --shadow-sm: 0 2px 4px rgba(46, 204, 113, 0.1);
    --shadow-md: 0 4px 10px rgba(46, 204, 113, 0.15);
    --shadow-lg: 0 10px 25px rgba(46, 204, 113, 0.2);

    /* Transitions */
    --transition-fast: 0.2s ease;
    --transition-normal: 0.3s ease;
}

/* Reset and base styles */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

html {
    scroll-behavior: smooth;
    -webkit-print-color-adjust: exact;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
                 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
    line-height: 1.6;
    color: var(--text-primary);
    background: linear-gradient(135deg, var(--bg-gradient-start) 0%, var(--bg-gradient-end) 100%);
    background-attachment: fixed;
    margin: 0;
    padding: 0;
    width: 100vw;
    overflow-x: hidden;  /* Fix overflow */
}

/* Gradient Header - Hidden Title */
.page-header {
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
    color: white;
    padding: 0;  /* Remove padding */
    box-shadow: var(--shadow-lg);
    position: sticky;
    top: 0;
    z-index: 100;
    min-height: 0;  /* Remove min-height */
    display: none;  /* Hide header completely */
    width: 100%;
    box-sizing: border-box;
}

.page-header h1 {
    display: none;  /* Hide title */
}

/* Main layout with TOC - Fix viewport */
.layout-container {
    width: 100% !important;
    max-width: 100% !important;
    margin: 0 !important;
    padding: 0 !important;
    box-sizing: border-box !important;
    overflow-x: hidden !important;
}

/* TOC Horizontal Navbar - Top Position */
.toc-sidebar {
    width: 100% !important;
    max-width: 100vw !important;
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
    border-bottom: 3px solid var(--light-green);
    position: sticky;
    top: 0;
    height: auto;
    overflow-x: auto;
    overflow-y: hidden;
    padding: 0.75rem clamp(1rem, 3vw, 2rem) !important; /* Responsive padding */
    box-shadow: var(--shadow-md);
    z-index: 100;
    display: flex;
    align-items: center;
    justify-content: center;
    box-sizing: border-box !important;
}

.toc-header {
    display: none;  /* Hide header in horizontal mode */
}

.toc-header h2 {
    display: none;
}

.toc-toggle {
    display: none;
}

.toc-list {
    list-style: none;
    padding: 0;
    margin: 0;
    display: flex;
    flex-direction: row;
    gap: 0.5rem;
    align-items: center;
    flex-wrap: wrap;
    justify-content: center;
}

.toc-list li {
    margin: 0;
}

.toc-link {
    display: inline-block;
    padding: 0.6rem 1.2rem;
    color: white;
    text-decoration: none;
    border-radius: 25px;
    transition: all var(--transition-fast);
    font-size: 0.95rem;
    font-weight: 500;
    background: rgba(255, 255, 255, 0.15);
    border: 2px solid transparent;
    white-space: nowrap;
}

.toc-link:hover {
    background: rgba(255, 255, 255, 0.25);
    color: white;
    transform: translateY(-2px);
    border-color: rgba(255, 255, 255, 0.5);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

.toc-link.active {
    background: white;
    color: var(--secondary-color);
    font-weight: 600;
    border-color: white;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
}

.toc-indent-1,
.toc-indent-2,
.toc-indent-3 {
    margin-left: 0;  /* Remove indents for horizontal layout */
}

/* Main content area - Proper spacing & width */
.main-content {
    flex: 1;
    width: calc(100% - var(--sidebar-width));
    padding: 2rem 2.5rem;  /* Reduced padding */
    background: white;
    box-sizing: border-box;
    overflow-x: auto;
    overflow-y: visible;
}

/* Override Notion styles for proper width */
@media only screen {
    body {
        margin: 0 !important;
        max-width: 100vw !important;
        width: 100% !important;
    }
}

.page.sans {
    width: 100% !important;
    max-width: 100% !important;
    margin: 0 !important;
    padding: 0 !important;
}

.page-body {
    width: 100% !important;
    max-width: 100% !important;
}

/* Enhanced typography - Green Theme */
.page-body h3 {
    color: var(--secondary-color);  /* Dark green */
    font-size: 1.8rem;
    margin-top: 3rem;
    margin-bottom: 1.5rem;
    padding-bottom: 0.5rem;
    border-bottom: 3px solid var(--primary-color);  /* Green border */
    position: relative;
}

.page-body h3::before {
    content: '';
    position: absolute;
    bottom: -3px;
    left: 0;
    width: 60px;
    height: 3px;
    background: var(--light-green);  /* Light green accent */
}

.page-body p {
    margin: 1rem 0;
    line-height: 1.8;
}

.page-body strong {
    color: var(--text-primary);
    font-weight: 600;
}

/* Enhanced tables - Green Theme & Responsive */
.simple-table {
    width: 100%;
    max-width: 100%;
    border-collapse: separate;
    border-spacing: 0;
    margin: 2rem 0;
    background: white;
    border-radius: 12px;
    overflow-x: auto;  /* Horizontal scroll on small screens */
    overflow-y: hidden;
    box-shadow: var(--shadow-md);
    display: table;
    table-layout: fixed !important;
}

.simple-table thead {
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);  /* Green gradient */
}

.simple-table th {
    color: #000000 !important;
    font-weight: 600;
    padding: 1.2rem 1rem;
    text-align: left;
    font-size: 0.95rem;
    letter-spacing: 0.02em;
    white-space: normal;
    vertical-align: top;
}

.simple-table td {
    padding: 1rem;
    border-bottom: 1px solid #f0f0f0;
    white-space: normal;
    vertical-align: top;
    line-height: 1.6;
}

.simple-table tbody tr {
    transition: all var(--transition-fast);
}

.simple-table tbody tr:nth-child(even) {
    background: rgba(46, 204, 113, 0.03);  /* Light green */
}

.simple-table tbody tr:hover {
    background: rgba(46, 204, 113, 0.08);  /* Green hover */
    transform: scale(1.005);
    box-shadow: var(--shadow-sm);
}

.simple-table tbody tr:last-child td {
    border-bottom: none;
}

/* Column width ratios for all tables */
.simple-table th,
.simple-table td {
    word-wrap: break-word;
    overflow-wrap: break-word;
}

/* Override all inline width styles */
.simple-table th[style*="width"],
.simple-table td[style*="width"] {
    width: auto !important;
}

/* STANDARDIZED COLUMN WIDTHS - Áp dụng cho tất cả bảng 2 cột (3.2, 3.3, 4.x, 5.x, 6.x) */
/* Tỷ lệ chuẩn: 30% (Bộ phận) - 70% (Nội dung) */

/* Cột 1: Bộ phận thực hiện */
.simple-table th:first-child,
.simple-table td:first-child {
    width: 30% !important;
}

/* Cột 2: Nội dung */
.simple-table th:nth-child(2),
.simple-table td:nth-child(2) {
    width: 70% !important;
}

/* Xử lý trường hợp cột 2 bị tràn hoặc nội dung quá dài */
.simple-table td:nth-child(2) ul,
.simple-table td:nth-child(2) ol {
    padding-left: 1.5rem;
    margin: 0.5rem 0;
}

/* NGOẠI LỆ: BẢNG 3 CỘT (Mục 1. ONBOARD) */
/* ID bảng Onboard: #70fe4b0d-c3af-486e-8387-de3a7ced6ce4 */
#\37 0fe4b0d-c3af-486e-8387-de3a7ced6ce4 th:first-child,
#\37 0fe4b0d-c3af-486e-8387-de3a7ced6ce4 td:first-child {
    width: 20% !important; /* Nhóm tiêu chí */
}

#\37 0fe4b0d-c3af-486e-8387-de3a7ced6ce4 th:nth-child(2),
#\37 0fe4b0d-c3af-486e-8387-de3a7ced6ce4 td:nth-child(2) {
    width: 40% !important; /* PO */
}

#\37 0fe4b0d-c3af-486e-8387-de3a7ced6ce4 th:nth-child(3),
#\37 0fe4b0d-c3af-486e-8387-de3a7ced6ce4 td:nth-child(3) {
    width: 40% !important; /* SO */
}

/* HARD-FIX: Bảng mục 3.3 - Phân phối xe tải lấy hàng */
/* ID bảng 3.3: #2ceec18e-70ae-8043-a7f1-f27b4830da83 */
/* Reset hoàn toàn margin và width để khắc phục lỗi tràn trái */
#\32 ceec18e-70ae-8043-a7f1-f27b4830da83 {
    margin-left: 0 !important;
    margin-right: 0 !important;
    width: 100% !important;
    max-width: 100% !important;
    table-layout: fixed !important;
}

/* Đồng bộ cột 30% - 70% cho bảng 3.3 */
#\32 ceec18e-70ae-8043-a7f1-f27b4830da83 th:first-child,
#\32 ceec18e-70ae-8043-a7f1-f27b4830da83 td:first-child {
    width: 30% !important;
}

#\32 ceec18e-70ae-8043-a7f1-f27b4830da83 th:nth-child(2),
#\32 ceec18e-70ae-8043-a7f1-f27b4830da83 td:nth-child(2) {
    width: 70% !important;
}

/* Interactive highlighted terms */
.interactive-term {
    cursor: pointer;
    position: relative;
    transition: all var(--transition-fast);
    border: 2px dotted transparent;
    border-radius: 4px;
    padding: 0.2em 0.5em;
    display: inline-block;
}

.interactive-term:hover {
    transform: scale(1.05);
    box-shadow: 0 4px 12px rgba(46, 204, 113, 0.4);  /* Green shadow */
    border-color: var(--primary-color);  /* Green border */
    background: rgba(46, 204, 113, 0.15);
    z-index: 10;
}

/* Highlight colors - enhanced */
.highlight-blue, .highlight-blue_background {
    background: rgba(56, 125, 201, 0.15);
    color: #2563eb;
}

.highlight-yellow, .highlight-yellow_background {
    background: rgba(251, 191, 36, 0.2);
    color: #d97706;
}

.highlight-red, .highlight-red_background {
    background: rgba(239, 68, 68, 0.15);
    color: #dc2626;
}

.highlight-green, .highlight-green_background {
    background: rgba(76, 175, 80, 0.15);
    color: #059669;
}

.highlight-orange, .highlight-orange_background {
    background: rgba(251, 146, 60, 0.15);
    color: #ea580c;
}

.highlight-pink, .highlight-pink_background {
    background: rgba(236, 72, 153, 0.15);
    color: #db2777;
}

.highlight-purple, .highlight-purple_background {
    background: rgba(168, 85, 247, 0.15);
    color: #9333ea;
}

.highlight-gray, .highlight-gray_background {
    background: rgba(156, 163, 175, 0.2);
    color: #4b5563;
}

.highlight-brown, .highlight-brown_background {
    background: rgba(180, 83, 9, 0.15);
    color: #92400e;
}

.highlight-teal, .highlight-teal_background {
    background: rgba(20, 184, 166, 0.15);
    color: #0f766e;
}

.highlight-default, .highlight-default_background {
    background: rgba(156, 163, 175, 0.1);
    color: #374151;
}

/* Tooltip popup */
.tooltip-popup {
    position: fixed;
    background: white;
    border-radius: 12px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.2);
    padding: 1.5rem;
    max-width: 400px;
    z-index: 1000;
    animation: tooltipFadeIn 0.3s ease;
    border: 2px solid var(--primary-color);
}

@keyframes tooltipFadeIn {
    from {
        opacity: 0;
        transform: translateY(-10px) scale(0.95);
    }
    to {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
}

.tooltip-header {
    display: flex;
    justify-content: space-between;
    align-items: start;
    margin-bottom: 1rem;
    padding-bottom: 0.75rem;
    border-bottom: 2px solid #f0f0f0;
}

.tooltip-title {
    font-size: 1.1rem;
    font-weight: 600;
    color: var(--primary-color);
    margin: 0;
}

.tooltip-close {
    background: none;
    border: none;
    font-size: 1.5rem;
    color: #999;
    cursor: pointer;
    padding: 0;
    width: 30px;
    height: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    transition: all var(--transition-fast);
}

.tooltip-close:hover {
    background: #f0f0f0;
    color: #333;
}

.tooltip-id {
    font-size: 0.85rem;
    color: #666;
    font-family: 'Courier New', monospace;
    background: #f5f5f5;
    padding: 0.3rem 0.6rem;
    border-radius: 4px;
    margin-bottom: 1rem;
    display: inline-block;
}

.tooltip-content {
    color: var(--text-secondary);
    line-height: 1.6;
    margin: 1rem 0;
}

.tooltip-placeholder {
    background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
    background-size: 200% 100%;
    animation: shimmer 1.5s infinite;
    padding: 1rem;
    border-radius: 6px;
    text-align: center;
    color: #999;
    font-style: italic;
}

@keyframes shimmer {
    0% { background-position: 200% 0; }
    100% { background-position: -200% 0; }
}

/* Tooltip image placeholder - REMOVED per user request */

/* Image Preview Tooltip - Hover effect */
.image-preview-tooltip {
    position: fixed;
    background: white;
    border-radius: 8px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
    z-index: 10001;
    padding: 8px;
    max-width: 500px;
    max-height: 500px;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.2s ease;
}

.image-preview-tooltip.show {
    opacity: 1;
}

.image-preview-tooltip img {
    display: block;
    max-width: 100%;
    max-height: 450px;
    width: auto;
    height: auto;
    border-radius: 4px;
    object-fit: contain;
}

.image-preview-tooltip iframe {
    display: block;
    width: 480px;
    height: 360px;
    border-radius: 4px;
    background: #000;
}

.image-preview-loading {
    padding: 2rem;
    text-align: center;
    color: var(--text-secondary);
}

.image-preview-error {
    padding: 1rem;
    text-align: center;
    color: #e74c3c;
    font-size: 0.9rem;
}

/* Image placeholder buttons - REMOVED per user request */

/* ====== CREATE TERM MODAL STYLES ====== */
#create-term-btn {
    position: fixed;
    bottom: 30px;
    right: 30px;
    width: 60px;
    height: 60px;
    background: linear-gradient(135deg, #4CAF50, #45a049);
    color: white;
    border: none;
    border-radius: 50%;
    font-size: 32px;
    cursor: pointer;
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    z-index: 999;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
}

#create-term-btn:hover {
    transform: scale(1.1);
    box-shadow: 0 6px 16px rgba(0,0,0,0.4);
}

#create-term-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.6);
    z-index: 10000;
    align-items: center;
    justify-content: center;
}

#create-term-modal.active {
    display: flex;
}

.modal-content {
    background: white;
    border-radius: 12px;
    width: 90%;
    max-width: 900px;
    max-height: 85vh;
    display: flex;
    flex-direction: column;
    box-shadow: 0 8px 32px rgba(0,0,0,0.3);
}

.modal-header {
    padding: 20px 24px;
    border-bottom: 2px solid #e0e0e0;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.modal-header h2 {
    margin: 0;
    color: #333;
    font-size: 24px;
}

.modal-close {
    background: none;
    border: none;
    font-size: 28px;
    cursor: pointer;
    color: #999;
    padding: 0;
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    transition: all 0.2s;
}

.modal-close:hover {
    background: #f5f5f5;
    color: #333;
}

.modal-body {
    padding: 24px;
    overflow-y: auto;
    flex: 1;
}

.form-group {
    margin-bottom: 20px;
}

.form-group label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    color: #333;
}

.form-group select,
.form-group input,
.form-group textarea {
    width: 100%;
    padding: 10px 12px;
    border: 2px solid #e0e0e0;
    border-radius: 6px;
    font-size: 14px;
    transition: border-color 0.2s;
}

.form-group select:focus,
.form-group input:focus,
.form-group textarea:focus {
    outline: none;
    border-color: #4CAF50;
}

#content-area {
    min-height: 200px;
    max-height: 300px;
    overflow-y: auto;
    padding: 16px;
    border: 2px solid #e0e0e0;
    border-radius: 6px;
    background: #fafafa;
    line-height: 1.6;
    user-select: text;
    cursor: text;
}

#content-area.has-selection {
    border-color: #4CAF50;
    background: #f0fff4;
}

.selected-text-info {
    margin-top: 12px;
    padding: 12px;
    background: #e8f5e9;
    border-left: 4px solid #4CAF50;
    border-radius: 4px;
    display: none;
}

.selected-text-info.active {
    display: block;
}

.selected-text-info strong {
    color: #2e7d32;
}

.modal-footer {
    padding: 16px 24px;
    border-top: 2px solid #e0e0e0;
    display: flex;
    justify-content: flex-end;
    gap: 12px;
}

.btn {
    padding: 10px 24px;
    border: none;
    border-radius: 6px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
}

.btn-secondary {
    background: #e0e0e0;
    color: #333;
}

.btn-secondary:hover {
    background: #d0d0d0;
}

.btn-primary {
    background: #4CAF50;
    color: white;
}

.btn-primary:hover {
    background: #45a049;
}

.btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

/* Upload area styles */
.upload-area {
    margin-top: 12px;
    border: 2px dashed #ccc;
    border-radius: 8px;
    padding: 20px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s;
    background: #fafafa;
}

.upload-area:hover {
    border-color: #4CAF50;
    background: #f0fff4;
}

.upload-area.dragover {
    border-color: #4CAF50;
    background: #e8f5e9;
    transform: scale(1.02);
}

.upload-area input[type="file"] {
    display: none;
}

.upload-icon {
    font-size: 48px;
    margin-bottom: 12px;
    display: block;
}

.upload-text {
    color: #666;
    font-size: 14px;
}

.upload-text strong {
    color: #4CAF50;
}

.upload-preview {
    margin-top: 16px;
    display: none;
}

.upload-preview.active {
    display: block;
}

.preview-image {
    max-width: 100%;
    max-height: 200px;
    border-radius: 8px;
    margin-bottom: 12px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.upload-progress {
    margin-top: 12px;
    display: none;
}

.upload-progress.active {
    display: block;
}

.progress-bar {
    width: 100%;
    height: 24px;
    background: #e0e0e0;
    border-radius: 12px;
    overflow: hidden;
    position: relative;
}

.progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #4CAF50, #45a049);
    transition: width 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 12px;
    font-weight: 600;
}

.upload-status {
    margin-top: 8px;
    font-size: 13px;
    color: #666;
    text-align: center;
}

.upload-status.success {
    color: #4CAF50;
}

.upload-status.error {
    color: #e74c3c;
}

.file-info {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 12px;
    background: #f5f5f5;
    border-radius: 6px;
    margin-top: 12px;
}

.file-name {
    font-size: 13px;
    color: #333;
    font-weight: 500;
}

.remove-file {
    background: #e74c3c;
    color: white;
    border: none;
    padding: 4px 12px;
    border-radius: 4px;
    font-size: 12px;
    cursor: pointer;
    transition: background 0.2s;
}

.remove-file:hover {
    background: #c0392b;
}

/* Back to top button - Green Theme */
.back-to-top {
    position: fixed;
    bottom: 2rem;
    right: 2rem;
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);  /* Green gradient */
    color: white;
    width: 50px;
    height: 50px;
    border-radius: 50%;
    border: none;
    cursor: pointer;
    display: none;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    box-shadow: 0 4px 20px rgba(46, 204, 113, 0.4);  /* Green shadow */
    transition: all var(--transition-normal);
    z-index: 99;
}

.back-to-top:hover {
    transform: translateY(-5px) scale(1.1);
    background: linear-gradient(135deg, var(--secondary-color) 0%, var(--accent-color) 100%);  /* Darker green on hover */
    box-shadow: 0 6px 25px rgba(46, 204, 113, 0.5);
}

.back-to-top.visible {
    display: flex;
    animation: fadeInUp 0.3s ease;
}

@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Loading spinner */
.loading-spinner {
    display: none;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 9999;
}

.spinner {
    width: 60px;
    height: 60px;
    border: 5px solid #f3f3f3;
    border-top: 5px solid var(--primary-color);
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* Responsive design - Enhanced */
@media (max-width: 1200px) {
    :root {
        --sidebar-width: 180px;  /* Narrower on medium screens */
    }

    .main-content {
        padding: 2rem;
    }
}

@media (max-width: 1024px) {
    .toc-sidebar {
        display: none;  /* Hide sidebar completely on tablets */
    }

    .main-content {
        margin-left: 0 !important;
        max-width: 100% !important;
        padding: 2rem 1.5rem;
    }

    .layout-container {
        flex-direction: column;
    }
}

@media (max-width: 768px) {
    .layout-container {
        flex-direction: column;
    }

    .toc-sidebar {
        width: 100%;
        height: auto;
        position: fixed;
        top: var(--header-height);
        left: 0;
        right: 0;
        border-right: none;
        border-bottom: 1px solid var(--primary-color);
        max-height: 0;
        overflow-y: auto;
        transition: max-height var(--transition-normal);
        padding: 0;
        z-index: 999;
        background: white;
        box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }

    .toc-sidebar.open {
        max-height: calc(100vh - var(--header-height));
        padding: 1rem;
        display: block !important;
    }

    .toc-toggle {
        display: block;
        position: fixed;
        top: calc(var(--header-height) + 10px);
        left: 10px;
        z-index: 1001;
        background: var(--primary-color);
        color: white;
        border: none;
        padding: 0.5rem 1rem;
        border-radius: 8px;
        cursor: pointer;
        box-shadow: var(--shadow-md);
    }

    .main-content {
        max-width: 100%;
        padding: 1rem;
        margin-left: 0;
    }

    .page-header {
        padding: 1rem;
    }

    .page-header h1 {
        font-size: 1.5rem;
    }

    .back-to-top {
        bottom: 1rem;
        right: 1rem;
        width: 45px;
        height: 45px;
    }

    .tooltip-popup {
        max-width: 90%;
        left: 5% !important;
        right: 5% !important;
    }

    .simple-table {
        font-size: 0.85rem;
    }

    .simple-table th,
    .simple-table td {
        padding: 0.5rem !important;
        /* min-width removed - conflicts with percentage-based widths */
    }
}

/* Print styles */
@media print {
    body {
        background: white;
    }

    .toc-sidebar,
    .back-to-top,
    .toc-toggle {
        display: none !important;
    }

    .main-content {
        max-width: 100%;
        padding: 0;
    }

    .page-header {
        position: relative;
        box-shadow: none;
    }

    .interactive-term {
        border: none;
        cursor: default;
    }

    .simple-table {
        box-shadow: none;
        page-break-inside: avoid;
    }
}

/* Smooth transitions for all interactive elements */
a, button, .interactive-term, .toc-link {
    transition: all var(--transition-fast);
}

/* Focus styles for accessibility - Green */
a:focus, button:focus, .interactive-term:focus {
    outline: 2px solid var(--primary-color);  /* Green outline */
    outline-offset: 2px;
}

/* Links - Green Theme */
a {
    color: var(--secondary-color);  /* Dark green */
}

a:hover {
    color: var(--primary-color);  /* Emerald green on hover */
}

/* Custom scrollbar - Green Theme */
::-webkit-scrollbar {
    width: 10px;
    height: 10px;
}

::-webkit-scrollbar-track {
    background: #f1f1f1;
}

::-webkit-scrollbar-thumb {
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);  /* Green gradient */
    border-radius: 5px;
}

::-webkit-scrollbar-thumb:hover {
    background: var(--secondary-color);  /* Dark green on hover */
}

/* Code blocks enhancement - Green accents */
.code {
    background: #2d2d2d;
    color: #f8f8f2;
    padding: 1.5rem;
    border-radius: 8px;
    overflow-x: auto;
    margin: 1.5rem 0;
    box-shadow: var(--shadow-md);
    border-left: 4px solid var(--primary-color);  /* Green accent */
}

code {
    font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    font-size: 0.9em;
    background: rgba(46, 204, 113, 0.1) !important;  /* Light green background */
    color: var(--secondary-color) !important;  /* Dark green text */
    border: 1px solid var(--pale-green);
    padding: 0.2em 0.4em;
    border-radius: 4px;
}

/* Horizontal rules - Green */
hr {
    border: none;
    height: 2px;
    background: linear-gradient(90deg, transparent 0%, var(--primary-color) 50%, transparent 100%);  /* Green gradient */
    margin: 2rem 0;
}

/* Images */
img {
    max-width: 100%;
    height: auto;
    border-radius: 8px;
    box-shadow: var(--shadow-md);
    margin: 1.5rem 0;
}

/* Callouts - Green Theme */
.callout {
    background: linear-gradient(135deg, rgba(46, 204, 113, 0.05) 0%, rgba(39, 174, 96, 0.05) 100%);  /* Light green gradient */
    border-left: 4px solid var(--primary-color);  /* Green border */
    padding: 1.5rem;
    border-radius: 8px;
    margin: 1.5rem 0;
}

/* ==========================================
   4 MAJOR IMPROVEMENTS - LAYOUT & NAVIGATION
   ========================================== */

/* 1. HIDE PAGE TITLE (Original header) */
.page-header {
    display: none !important;
}

h1.page-title {
    display: none !important;
}

/* 2. CENTER CONTENT */
body {
    padding-top: 90px !important;
    background: #F8FFF9 !important;
}

.layout-container {
    max-width: 1400px !important;
    margin: 0 auto !important;
    padding: 0 2rem !important;
    padding-top: 0 !important;
}

.main-content {
    max-width: 100% !important;
    margin: 0 auto !important;
    padding-top: 0 !important;
    margin-top: 0 !important;
}

article.page.sans {
    margin-top: 0 !important;
    padding-top: 0 !important;
}

.page-body {
    margin-top: 0 !important;
    padding-top: 0 !important;
}

/* 3. FIXED NAVIGATION BAR - Replaces header */
#main-navigation {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    width: 100%;
    background: linear-gradient(135deg, #2ECC71 0%, #27AE60 100%);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    z-index: 2000;
    padding: 0;
    margin: 0;
}

#main-navigation ul {
    display: flex;
    justify-content: center;
    align-items: center;
    list-style: none;
    margin: 0;
    padding: 1rem 0;
    flex-wrap: wrap;
    gap: 0.5rem;
}

#main-navigation li {
    list-style: none !important;
    margin: 0 !important;
}

#main-navigation li::before {
    display: none !important;
    content: none !important;
}

#main-navigation a {
    display: inline-block;
    padding: 0.75rem 1.5rem;
    background: rgba(255, 255, 255, 0.2);
    color: white;
    text-decoration: none;
    border-radius: 25px;
    font-weight: 600;
    font-size: 0.9rem;
    border: 2px solid rgba(255, 255, 255, 0.3);
    cursor: pointer;
    transition: all 0.3s ease;
    white-space: nowrap;
}

#main-navigation a:hover {
    background: white;
    color: #27AE60;
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
}

#main-navigation a.active {
    background: white;
    color: #27AE60;
    font-weight: 700;
}

/* Hide TOC sidebar - using main navigation only */
.toc-sidebar {
    display: none !important;
}

/* Adjust main content to use full width without sidebar */
.main-content {
    margin-left: 0 !important;
    width: 100% !important;
}

/* 4. TABLE CONTENT WRAPPING - Force text wrapping in tables */
table {
    table-layout: fixed !important;
    width: 100% !important;
}

th, td {
    word-wrap: break-word !important;
    word-break: break-word !important;
    overflow-wrap: break-word !important;
    white-space: normal !important;
    hyphens: auto !important;
    vertical-align: top !important;
}


td ul, td ol {
    margin: 0.5rem 0 !important;
    padding-left: 1.5rem !important;
}

/* CRITICAL FIX: Force URLs and code in table cells to wrap properly */
td code, td a {
    word-break: break-all !important;
    overflow-wrap: break-word !important;
    max-width: 100%;
    display: inline !important; /* Allow inline wrapping */
}

/* Ensure table cells never overflow container */
.simple-table td,
.simple-table th {
    overflow-wrap: break-word !important;
    word-break: break-word !important;
}

/* Ensure URLs and links wrap within cells */
.simple-table td a,
.simple-table td code {
    max-width: 100% !important;
    word-wrap: break-word !important;
    overflow-wrap: break-word !important;
}

/* RESPONSIVE - Mobile optimizations */
@media (max-width: 768px) {
    body {
        padding-top: auto !important;
    }

    #main-navigation ul {
        flex-direction: column;
        gap: 0.5rem;
        padding: 0.75rem;
    }

    #main-navigation a {
        width: 90%;
        text-align: center;
        padding: 0.6rem 1rem;
        font-size: 0.85rem;
    }

    .layout-container {
        padding: 0 1rem !important;
    }

    .toc-sidebar {
        top: auto !important;
    }

    /* Responsive table cho mobile */
    .simple-table th,
    .simple-table td {
        padding: 0.75rem 0.5rem !important;
        font-size: 0.85rem;
    }

    /* Trên mobile cho phép cột 1 nhỏ hơn chút để dành chỗ cho nội dung */
    .simple-table th:first-child,
    .simple-table td:first-child {
        width: 35% !important;
        min-width: unset !important;
    }

    .simple-table th:nth-child(2),
    .simple-table td:nth-child(2) {
        width: 65% !important;
    }
}




/* ===== FLOATING PILL-SHAPED NAVIGATION BAR ===== */
.main-nav {
  position: fixed;
  top: 20px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 9999;
  max-width: 95%;
  width: auto;
}

.nav-container {
  display: flex;
  align-items: center;
  background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
  border-radius: 50px;
  padding: 12px 24px 12px 12px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
  gap: 8px;
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
}

/* Planet Icon Circle */
.nav-icon {
  width: 48px;
  height: 48px;
  background: white;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
  margin-right: 8px;
}

.nav-icon img {
  width: 100%;
  height: 100%;
  object-fit: contain;
  padding: 4px;
}

/* Navigation Links */
.nav-link {
  color: white;
  text-decoration: none;
  padding: 10px 18px;
  border-radius: 25px;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
  font-weight: 500;
  font-size: 0.95rem;
  transition: all 0.3s ease;
  white-space: nowrap;
  flex-shrink: 0;
}

.nav-link:hover {
  background: rgba(255, 255, 255, 0.2);
  transform: translateY(-2px);
}

.nav-link.active {
  background: rgba(255, 255, 255, 0.3);
  font-weight: 600;
}

/* Responsive */
@media (max-width: 1200px) {
  .nav-link {
    font-size: 0.85rem;
    padding: 8px 14px;
  }

  .nav-icon {
    width: 42px;
    height: 42px;
  }

  .nav-icon img {
    padding: 3px;
  }
}

@media (max-width: 768px) {
  .main-nav {
    top: 10px;
    max-width: 98%;
  }

  .nav-container {
    padding: 8px 16px 8px 8px;
    gap: 4px;
    overflow-x: auto;
    scrollbar-width: none;
    -ms-overflow-style: none;
  }

  .nav-container::-webkit-scrollbar {
    display: none;
  }

  .nav-link {
    font-size: 0.8rem;
    padding: 8px 12px;
  }

  .nav-icon {
    width: 36px;
    height: 36px;
    margin-right: 4px;
  }

  .nav-icon img {
    padding: 2px;
  }
}

/* Adjust body padding for fixed nav */
article.page {
  padding-top: 80px;
}

body {
  padding-top: 0 !important;
}

article.page {
  padding-top: 1rem;
}

/* ONBOARD table rules consolidated at lines 1165-1180 - duplicate removed */

/* Extract Data Button & Modal */
#extract-data-btn {
	position: fixed;
	top: 20px;
	right: 20px;
	z-index: 10000;
	padding: 12px 24px;
	background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
	color: white;
	border: none;
	border-radius: 8px;
	font-weight: bold;
	cursor: pointer;
	box-shadow: 0 4px 12px rgba(40, 167, 69, 0.4);
	transition: all 0.3s ease;
	font-size: 14px;
}

#extract-data-btn:hover {
	transform: translateY(-2px);
	box-shadow: 0 6px 20px rgba(40, 167, 69, 0.6);
}

#extract-data-modal {
	display: none;
	position: fixed;
	top: 0;
	left: 0;
	width: 100%;
	height: 100%;
	background: rgba(0, 0, 0, 0.7);
	z-index: 9999;
	overflow: auto;
	padding: 20px;
}

#extract-data-modal.show {
	display: block;
}

#extract-data-content {
	background: white;
	max-width: 1200px;
	margin: 0 auto;
	padding: 30px;
	border-radius: 8px;
	position: relative;
}

#extract-close-btn {
	position: absolute;
	top: 15px;
	right: 15px;
	background: #dc3545;
	color: white;
	border: none;
	padding: 8px 16px;
	border-radius: 4px;
	cursor: pointer;
	font-weight: bold;
}

#extract-data-output {
	background: #f5f5f5;
	padding: 15px;
	border-radius: 4px;
	max-height: 500px;
	overflow: auto;
	font-family: monospace;
	font-size: 12px;
	white-space: pre;
	margin-top: 20px;
}

/* ========================================
   GHTK AI ASSISTANT - CHAT WIDGET
   ======================================== */

/* Chat Widget Container */
#ghtk-chat-widget {
	position: fixed;
	bottom: 24px;
	right: 24px;
	z-index: 9999;
	font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
}

/* Chat Launcher Button */
#chat-launcher {
	width: 64px;
	height: 64px;
	border-radius: 50%;
	background: linear-gradient(135deg, #00b14f 0%, #028a3d 100%);
	border: none;
	cursor: pointer;
	display: flex;
	align-items: center;
	justify-content: center;
	box-shadow: 0 8px 24px rgba(0, 177, 79, 0.4);
	transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
	position: relative;
	overflow: hidden;
}

#chat-launcher:hover {
	transform: translateY(-2px);
	box-shadow: 0 12px 32px rgba(0, 177, 79, 0.5);
}

#chat-launcher:active {
	transform: scale(0.95);
}

/* Pulse Animation */
#chat-launcher::before {
	content: '';
	position: absolute;
	top: 0;
	left: 0;
	right: 0;
	bottom: 0;
	border-radius: 50%;
	background: inherit;
	animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
	opacity: 0.6;
}

@keyframes pulse {
	0%, 100% {
		transform: scale(1);
		opacity: 0.6;
	}
	50% {
		transform: scale(1.15);
		opacity: 0;
	}
}

#chat-launcher svg {
	width: 32px;
	height: 32px;
	fill: white;
	position: relative;
	z-index: 1;
}

/* Chat Window */
#chat-window {
	position: fixed;
	bottom: 100px;
	right: 24px;
	width: 420px;
	height: 640px;
	border-radius: 20px;
	background: rgba(255, 255, 255, 0.98);
	backdrop-filter: blur(20px) saturate(180%);
	-webkit-backdrop-filter: blur(20px) saturate(180%);
	box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15), 0 0 0 1px rgba(0, 177, 79, 0.1);
	display: none;
	flex-direction: column;
	overflow: hidden;
	animation: slideUp 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

#chat-window.active {
	display: flex;
}

@keyframes slideUp {
	from {
		opacity: 0;
		transform: translateY(20px) scale(0.95);
	}
	to {
		opacity: 1;
		transform: translateY(0) scale(1);
	}
}

/* Chat Header */
#chat-header {
	background: linear-gradient(135deg, #00b14f 0%, #028a3d 100%);
	padding: 20px 24px;
	display: flex;
	align-items: center;
	justify-content: space-between;
	border-radius: 20px 20px 0 0;
	box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

#chat-header-left {
	display: flex;
	align-items: center;
	gap: 12px;
}

#chat-header-logo {
	width: 40px;
	height: 40px;
	border-radius: 50%;
	background: white;
	display: flex;
	align-items: center;
	justify-content: center;
	box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

#chat-header-logo svg {
	width: 24px;
	height: 24px;
	fill: #00b14f;
}

#chat-header-title {
	color: white;
	font-weight: 600;
	font-size: 16px;
	margin: 0;
}

#chat-header-subtitle {
	color: rgba(255, 255, 255, 0.85);
	font-size: 13px;
	margin: 2px 0 0 0;
}

#chat-close {
	width: 32px;
	height: 32px;
	border-radius: 50%;
	background: rgba(255, 255, 255, 0.15);
	border: none;
	cursor: pointer;
	display: flex;
	align-items: center;
	justify-content: center;
	transition: all 0.2s;
}

#chat-close:hover {
	background: rgba(255, 255, 255, 0.25);
	transform: rotate(90deg);
}

#chat-close svg {
	width: 16px;
	height: 16px;
	stroke: white;
	stroke-width: 2.5;
}

/* Chat Messages */
#chat-messages {
	flex: 1;
	overflow-y: auto;
	padding: 20px;
	background: linear-gradient(to bottom, #f8f9fa 0%, #ffffff 100%);
	display: flex;
	flex-direction: column;
	gap: 16px;
}

#chat-messages::-webkit-scrollbar {
	width: 6px;
}

#chat-messages::-webkit-scrollbar-thumb {
	background: rgba(0, 177, 79, 0.2);
	border-radius: 3px;
}

#chat-messages::-webkit-scrollbar-track {
	background: transparent;
}

/* Message Bubbles */
.chat-message {
	display: flex;
	gap: 10px;
	animation: messageSlide 0.3s ease-out;
}

@keyframes messageSlide {
	from {
		opacity: 0;
		transform: translateY(10px);
	}
	to {
		opacity: 1;
		transform: translateY(0);
	}
}

.chat-message.user {
	flex-direction: row-reverse;
}

.message-avatar {
	width: 32px;
	height: 32px;
	border-radius: 50%;
	flex-shrink: 0;
	display: flex;
	align-items: center;
	justify-content: center;
	font-size: 16px;
}

.message-avatar.bot {
	background: linear-gradient(135deg, #00b14f, #028a3d);
	color: white;
}

.message-avatar.user {
	background: linear-gradient(135deg, #3b82f6, #2563eb);
	color: white;
}

.message-bubble {
	max-width: 75%;
	padding: 12px 16px;
	border-radius: 16px;
	line-height: 1.5;
	font-size: 14px;
	word-wrap: break-word;
}

.chat-message.bot .message-bubble {
	background: white;
	color: #334155;
	border: 1px solid #e2e8f0;
	box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
	border-radius: 16px 16px 16px 4px;
}

.chat-message.user .message-bubble {
	background: linear-gradient(135deg, #00b14f, #028a3d);
	color: white;
	border-radius: 16px 16px 4px 16px;
	box-shadow: 0 2px 8px rgba(0, 177, 79, 0.2);
}

/* Markdown Support in Messages */
.message-bubble ul,
.message-bubble ol {
	margin: 8px 0;
	padding-left: 20px;
}

.message-bubble li {
	margin: 4px 0;
}

.message-bubble strong {
	font-weight: 600;
}

.message-bubble code {
	background: rgba(0, 0, 0, 0.05);
	padding: 2px 6px;
	border-radius: 4px;
	font-family: 'Monaco', 'Courier New', monospace;
	font-size: 13px;
}

/* Typing Indicator */
.typing-indicator {
	display: flex;
	gap: 4px;
	padding: 12px 16px;
}

.typing-dot {
	width: 8px;
	height: 8px;
	border-radius: 50%;
	background: #94a3b8;
	animation: typing 1.4s infinite;
}

.typing-dot:nth-child(2) {
	animation-delay: 0.2s;
}

.typing-dot:nth-child(3) {
	animation-delay: 0.4s;
}

@keyframes typing {
	0%, 60%, 100% {
		transform: translateY(0);
		opacity: 0.7;
	}
	30% {
		transform: translateY(-10px);
		opacity: 1;
	}
}

/* Quick Actions (Chips) */
#chat-quick-actions {
	padding: 12px 20px 8px;
	background: white;
	border-top: 1px solid #e2e8f0;
	display: flex;
	gap: 8px;
	overflow-x: auto;
	flex-wrap: nowrap;
}

#chat-quick-actions::-webkit-scrollbar {
	height: 4px;
}

#chat-quick-actions::-webkit-scrollbar-thumb {
	background: rgba(0, 177, 79, 0.2);
	border-radius: 2px;
}

.quick-action-chip {
	padding: 8px 14px;
	background: linear-gradient(135deg, #f0fdf4, #dcfce7);
	border: 1px solid #bbf7d0;
	border-radius: 20px;
	cursor: pointer;
	font-size: 13px;
	color: #166534;
	font-weight: 500;
	white-space: nowrap;
	transition: all 0.2s;
	flex-shrink: 0;
}

.quick-action-chip:hover {
	background: linear-gradient(135deg, #dcfce7, #bbf7d0);
	border-color: #86efac;
	transform: translateY(-1px);
	box-shadow: 0 2px 8px rgba(0, 177, 79, 0.15);
}

.quick-action-chip:active {
	transform: scale(0.98);
}

/* Chat Input */
#chat-input-container {
	padding: 16px 20px;
	background: white;
	border-top: 1px solid #e2e8f0;
	display: flex;
	gap: 12px;
	align-items: center;
	border-radius: 0 0 20px 20px;
}

#chat-input {
	flex: 1;
	border: 1.5px solid #e2e8f0;
	border-radius: 12px;
	padding: 12px 16px;
	font-size: 14px;
	font-family: inherit;
	resize: none;
	outline: none;
	transition: all 0.2s;
	max-height: 100px;
}

#chat-input:focus {
	border-color: #00b14f;
	box-shadow: 0 0 0 3px rgba(0, 177, 79, 0.1);
}

#chat-send {
	width: 44px;
	height: 44px;
	border-radius: 12px;
	background: linear-gradient(135deg, #00b14f, #028a3d);
	border: none;
	cursor: pointer;
	display: flex;
	align-items: center;
	justify-content: center;
	transition: all 0.2s;
	flex-shrink: 0;
}

#chat-send:hover {
	transform: translateY(-1px);
	box-shadow: 0 4px 12px rgba(0, 177, 79, 0.3);
}

#chat-send:active {
	transform: scale(0.95);
}

#chat-send:disabled {
	opacity: 0.5;
	cursor: not-allowed;
	transform: none;
}

#chat-send svg {
	width: 20px;
	height: 20px;
	fill: white;
}

/* Welcome Message */
.welcome-message {
	text-align: center;
	padding: 40px 20px;
	color: #64748b;
}

.welcome-message svg {
	width: 64px;
	height: 64px;
	margin: 0 auto 16px;
	fill: #00b14f;
	opacity: 0.6;
}

.welcome-message h3 {
	font-size: 18px;
	font-weight: 600;
	color: #334155;
	margin: 0 0 8px 0;
}

.welcome-message p {
	font-size: 14px;
	margin: 0;
	line-height: 1.6;
}

/* Mobile Responsive */
@media (max-width: 768px) {
	#chat-window {
		bottom: 0;
		right: 0;
		left: 0;
		width: 100%;
		height: 100vh;
		border-radius: 0;
		max-height: 100vh;
	}

	#chat-launcher {
		bottom: 16px;
		right: 16px;
		width: 56px;
		height: 56px;
	}

	#chat-launcher svg {
		width: 28px;
		height: 28px;
	}

	#chat-header {
		border-radius: 0;
	}

	#chat-input-container {
		border-radius: 0;
	}
}

/* ========================================
   AUTHENTICATION MODAL - PREMIUM REDESIGN
   Modern UI with Success Sequence Animation
   ======================================== */

/* CSS Variables for GHTK Branding */
:root {
	--ghtk-primary: #069255;
	--ghtk-primary-dark: #028a3d;
	--ghtk-primary-light: #00b14f;
	--ghtk-success: #10b981;
	--ghtk-gradient: linear-gradient(135deg, var(--ghtk-primary-light) 0%, var(--ghtk-primary-dark) 100%);
	--text-dark: #1e293b;
	--text-medium: #475569;
	--text-light: #94a3b8;
	--border-color: #e2e8f0;
	--shadow-lg: 0 24px 48px rgba(0, 0, 0, 0.12), 0 8px 16px rgba(0, 0, 0, 0.08);
	--shadow-xl: 0 32px 64px rgba(0, 0, 0, 0.16), 0 12px 24px rgba(0, 0, 0, 0.12);
}

/* Overlay nền xanh full màn hình */
#auth-overlay {
	position: fixed;
	top: 0;
	left: 0;
	width: 100%;
	height: 100%;
	background-color: #069255; /* Xanh GHTK */
	display: flex; /* Flexbox căn giữa */
	justify-content: center;
	align-items: center;
	z-index: 99999;
	padding: 20px; /* Khoảng cách an toàn cho mobile */
	backdrop-filter: blur(5px);
	transition: opacity 0.6s ease;
	opacity: 1;
}

/* Hide overlay when authenticated */
#auth-overlay.auth-success {
	opacity: 0;
	pointer-events: none;
}

/* Card đăng nhập màu trắng - QUAN TRỌNG: height auto */
.login-card {
	background: white;
	width: 90%;
	max-width: 400px; /* Card nhỏ gọn hơn */
	height: auto !important; /* Bắt buộc co lại theo nội dung */
	min-height: unset !important; /* Bỏ min-height nếu có */
	padding: 30px; /* Padding vừa phải */
	border-radius: 16px;
	box-shadow: 0 10px 30px rgba(0,0,0,0.15);
	text-align: center;
	
	/* Flexbox để xếp nội dung */
	display: flex;
	flex-direction: column;
	align-items: center; /* Căn giữa trục ngang (Sửa lỗi logo lệch) */
	gap: 16px; /* Khoảng cách đều giữa các phần tử con */
	
	animation: modalSlideIn 0.5s ease-out;
}

@keyframes modalSlideIn {
	from {
		opacity: 0;
		transform: translateY(-30px) scale(0.96);
	}
	to {
		opacity: 1;
		transform: translateY(0) scale(1);
	}
}

/* Reset Margin thừa của các phần tử con để dùng gap */
#auth-overlay .login-logo,
#auth-overlay h3,
#auth-overlay p,
#auth-overlay .form-group,
#auth-overlay form,
#auth-overlay button {
	margin-bottom: 0 !important;
	margin-top: 0 !important;
	width: 100%; /* Đảm bảo input/button full width */
}

/* Logo specific - Đảm bảo căn giữa tuyệt đối */
.login-logo {
	width: 100%;
	text-align: center;
	margin: 0 !important;
}

.login-logo img {
	max-width: 100px;
	width: 100px;
	height: auto;
	display: block;
	margin: 0 auto !important; /* Đảm bảo ảnh logo ra giữa */
	animation: logoFloat 3s ease-in-out infinite;
}

@keyframes logoFloat {
	0%, 100% { transform: translateY(0px); }
	50% { transform: translateY(-6px); }
}

/* Typography */
.login-title {
	font-size: 22px;
	font-weight: 700;
	color: #1e293b;
	margin: 0 !important;
	text-align: center;
}

.login-desc {
	font-size: 14px;
	color: #64748b;
	margin: 0 !important;
	text-align: center;
}

/* Form group */
.form-group {
	width: 100%;
	margin: 0 !important;
}

/* Input Field */
.login-input {
	width: 100%;
	padding: 14px 16px;
	font-size: 15px;
	color: #1e293b;
	border: 2px solid #e2e8f0;
	border-radius: 10px;
	outline: none;
	box-sizing: border-box; /* Quan trọng để không bị vỡ layout */
	transition: 0.3s;
	font-family: 'Inter', sans-serif;
	background: #f8fafc;
}

.login-input:focus {
	border-color: #069255;
	background: #ffffff;
	box-shadow: 0 0 0 4px rgba(6, 146, 85, 0.1);
}

.login-input::placeholder {
	color: #94a3b8;
}

/* Button */
#login-submit-btn {
	width: 100%;
	padding: 14px;
	background: linear-gradient(135deg, #00b14f 0%, #069255 100%);
	color: white;
	border: none;
	border-radius: 10px;
	font-size: 16px;
	font-weight: 600;
	cursor: pointer;
	margin: 0 !important;
	transition: all 0.3s ease;
	box-shadow: 0 4px 16px rgba(6, 146, 85, 0.3);
}

#login-submit-btn:hover {
	transform: translateY(-2px);
	box-shadow: 0 8px 24px rgba(6, 146, 85, 0.4);
}

#login-submit-btn:active {
	transform: translateY(0);
}

#login-submit-btn:disabled {
	opacity: 0.7;
	cursor: not-allowed;
	transform: none;
}

/* Ẩn hiện form và success state */
#login-form {
	display: block;
	width: 100%;
}

#login-form.hidden {
	display: none;
}

/* ========================================
   SUCCESS STATE - The Magic Happens Here
   ======================================== */

#success-container {
	display: none;
	opacity: 0;
	transform: scale(0.9);
	transition: opacity 0.4s ease, transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
}

#success-container.show {
	display: block;
	opacity: 1;
	transform: scale(1);
}

/* Animated checkmark circle */
.success-checkmark {
	width: 80px;
	height: 80px;
	margin: 0 auto 32px;
	position: relative;
}

.checkmark-circle {
	stroke-dasharray: 251;
	stroke-dashoffset: 251;
	stroke: var(--ghtk-success);
	stroke-width: 3;
	fill: none;
	animation: checkmarkCircle 0.6s cubic-bezier(0.65, 0, 0.45, 1) forwards;
}

@keyframes checkmarkCircle {
	to {
		stroke-dashoffset: 0;
	}
}

.checkmark-check {
	stroke-dasharray: 48;
	stroke-dashoffset: 48;
	stroke: var(--ghtk-success);
	stroke-width: 3;
	fill: none;
	stroke-linecap: round;
	animation: checkmarkCheck 0.3s 0.6s cubic-bezier(0.65, 0, 0.45, 1) forwards;
}

@keyframes checkmarkCheck {
	to {
		stroke-dashoffset: 0;
	}
}

/* Success text */
.success-title {
	font-size: 24px;
	font-weight: 700;
	color: var(--text-dark);
	margin: 0 0 12px 0;
	animation: fadeInUp 0.5s 0.8s ease both;
}

.success-subtitle {
	font-size: 16px;
	color: var(--text-medium);
	margin: 0 0 8px 0;
	animation: fadeInUp 0.5s 0.9s ease both;
}

.success-redirect {
	font-size: 14px;
	color: var(--text-light);
	margin: 0;
	animation: fadeInUp 0.5s 1s ease both;
}

@keyframes fadeInUp {
	from {
		opacity: 0;
		transform: translateY(20px);
	}
	to {
		opacity: 1;
		transform: translateY(0);
	}
}

/* Error message */
#auth-error-message {
	margin-top: 20px;
	padding: 14px 18px;
	background: #fef2f2;
	border-left: 4px solid #ef4444;
	border-radius: 8px;
	color: #dc2626;
	font-size: 14px;
	display: none;
	text-align: left;
	line-height: 1.6;
	animation: shake 0.4s ease;
}

@keyframes shake {
	0%, 100% { transform: translateX(0); }
	25% { transform: translateX(-10px); }
	75% { transform: translateX(10px); }
}

#auth-error-message.show {
	display: block;
}

/* Loading state */
.loading-spinner {
	display: inline-block;
	width: 18px;
	height: 18px;
	border: 2px solid rgba(255, 255, 255, 0.3);
	border-top-color: #ffffff;
	border-radius: 50%;
	animation: spin 0.7s linear infinite;
	margin-right: 10px;
	vertical-align: middle;
}

@keyframes spin {
	to { transform: rotate(360deg); }
}

/* Mobile responsive - Compact layout */
@media (max-width: 768px) {
	#auth-overlay {
		padding: 15px;
	}

	.login-card {
		padding: 25px 20px; /* Padding nhỏ hơn trên mobile */
		max-width: 100%;
		width: 95%;
		gap: 14px; /* Giảm gap trên mobile */
	}

	.login-title {
		font-size: 20px;
	}

	.login-desc {
		font-size: 13px;
	}

	.login-logo img {
		width: 90px !important;
		max-width: 90px !important;
	}

	.login-input {
		padding: 12px 14px;
		font-size: 14px;
	}

	#login-submit-btn {
		padding: 12px;
		font-size: 15px;
	}

	.success-checkmark {
		width: 64px;
		height: 64px;
	}

	.success-title {
		font-size: 20px;
	}
}

/* Bootstrap Grid System Support */
#auth-overlay .container {
	width: 100%;
	padding-right: 15px;
	padding-left: 15px;
	margin-right: auto;
	margin-left: auto;
	height: 100%;
}

#auth-overlay .row {
	display: flex;
	flex-wrap: wrap;
	margin-right: -15px;
	margin-left: -15px;
	height: 100%;
}

#auth-overlay .h-100 {
	height: 100% !important;
}

#auth-overlay .py-5 {
	padding-top: 3rem !important;
	padding-bottom: 3rem !important;
}

#auth-overlay .d-flex {
	display: flex !important;
}

#auth-overlay .justify-content-center {
	justify-content: center !important;
}

#auth-overlay .align-items-center {
	align-items: center !important;
}

#auth-overlay .text-center {
	text-align: center !important;
}

#auth-overlay .mb-4 {
	margin-bottom: 1.5rem !important;
}

#auth-overlay .p-5 {
	padding: 3rem !important;
}

#auth-overlay [class*="col-"] {
	position: relative;
	width: 100%;
	padding-right: 15px;
	padding-left: 15px;
}

#auth-overlay .col-12 {
	flex: 0 0 100%;
	max-width: 100%;
}

@media (min-width: 768px) {
	#auth-overlay .col-md-8 {
		flex: 0 0 66.666667%;
		max-width: 66.666667%;
	}
}

@media (min-width: 992px) {
	#auth-overlay .col-lg-6 {
		flex: 0 0 50%;
		max-width: 50%;
	}
}

@media (min-width: 1200px) {
	#auth-overlay .col-xl-5 {
		flex: 0 0 41.666667%;
		max-width: 41.666667%;
	}
}

/* Form outline styles */
#auth-overlay .form-outline {
	position: relative;
	margin-bottom: 1rem;
}

#auth-overlay .btn-block {
	display: block;
	width: 100%;
}

/* ============================================
   VIDEO PLAYER CARDS - Modern Click-to-Load UI with GHTK Branding
   ============================================ */

.video-card {
    position: relative;
    width: 100%;
    aspect-ratio: 16 / 9;
    border-radius: 12px;
    overflow: hidden;
    background: linear-gradient(135deg, #069255, #00b14f);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    cursor: pointer;
    transition: all 0.3s ease;
}

.video-card:hover {
    box-shadow: 0 8px 24px rgba(6, 146, 85, 0.2);
    transform: translateY(-2px);
}

.video-card.loading {
    cursor: wait;
}

.video-card.loaded {
    cursor: default;
}

/* Video Poster (Thumbnail or Gradient Background) */
.video-poster {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
}

/* If no thumbnail, gradient shows through */
.video-card:not([data-has-thumb]) .video-poster {
    background: linear-gradient(135deg, #069255, #00b14f);
}

/* Dark overlay for better logo visibility */
.video-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.3);
    transition: background 0.3s ease;
}

.video-card:hover .video-overlay {
    background: rgba(0, 0, 0, 0.4);
}

/* GHTK Logo as Play Button */
.play-button-ghtk {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 70px;
    height: 70px;
    background: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
    pointer-events: none;
    padding: 12px;
}

.video-card:hover .play-button-ghtk {
    transform: translate(-50%, -50%) scale(1.15) rotate(5deg);
    box-shadow: 0 6px 24px rgba(6, 146, 85, 0.4);
}

.play-button-ghtk img {
    width: 100%;
    height: 100%;
    object-fit: contain;
    display: block;
}

/* Video Title (Optional overlay) */
.video-title {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    padding: 16px 20px;
    background: linear-gradient(to top, rgba(0, 0, 0, 0.8), transparent);
    color: white;
    font-size: 14px;
    font-weight: 600;
    opacity: 0;
    transition: opacity 0.3s ease;
    pointer-events: none;
}

.video-card:hover .video-title {
    opacity: 1;
}

/* Loading state */
.video-card.loading .play-button-ghtk {
    animation: pulse-ghtk 1.5s ease-in-out infinite;
}

@keyframes pulse-ghtk {
    0%, 100% {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1);
    }
    50% {
        opacity: 0.6;
        transform: translate(-50%, -50%) scale(1.05);
    }
}

/* Loaded state - hide poster, overlay, and play button */
.video-card.loaded .video-poster,
.video-card.loaded .video-overlay,
.video-card.loaded .play-button-ghtk,
.video-card.loaded .video-title {
    display: none;
}

/* Video iframe/video tag styles */
.video-card iframe,
.video-card video {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border: none;
}

/* Thumbnail error fallback - show gradient */
.video-poster img {
    display: none; /* Hide img tag, use background-image instead */
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .play-button-ghtk {
        width: 56px;
        height: 56px;
        padding: 10px;
    }
    
    .video-title {
        font-size: 13px;
        padding: 12px 16px;
    }
}

@media (max-width: 480px) {
    .play-button-ghtk {
        width: 48px;
        height: 48px;
        padding: 8px;
    }
    
    .video-title {
        font-size: 12px;
        padding: 10px 14px;
    }
}



#auth-overlay .btn-lg {
	padding: 0.5rem 1rem;
	font-size: 1.25rem;
	line-height: 1.5;
}

/* ========================================
   SUCCESS STATE - The Magic Happens Here
   ======================================== */

#success-container {
	display: none;
	opacity: 0;
	transform: scale(0.9);
	transition: opacity 0.4s ease, transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
}

#success-container.show {
	display: block;
	opacity: 1;
	transform: scale(1);
}

/* Animated checkmark circle */
.success-checkmark {
	width: 80px;
	height: 80px;
	margin: 0 auto 32px;
	position: relative;
}

.checkmark-circle {
	stroke-dasharray: 251;
	stroke-dashoffset: 251;
	stroke: var(--ghtk-success);
	stroke-width: 3;
	fill: none;
	animation: checkmarkCircle 0.6s cubic-bezier(0.65, 0, 0.45, 1) forwards;
}

@keyframes checkmarkCircle {
	to {
		stroke-dashoffset: 0;
	}
}

.checkmark-check {
	stroke-dasharray: 48;
	stroke-dashoffset: 48;
	stroke: var(--ghtk-success);
	stroke-width: 3;
	fill: none;
	stroke-linecap: round;
	animation: checkmarkCheck 0.3s 0.6s cubic-bezier(0.65, 0, 0.45, 1) forwards;
}

@keyframes checkmarkCheck {
	to {
		stroke-dashoffset: 0;
	}
}

/* Success text */
.success-title {
	font-size: 24px;
	font-weight: 700;
	color: var(--text-dark);
	margin: 0 0 12px 0;
	animation: fadeInUp 0.5s 0.8s ease both;
}

.success-subtitle {
	font-size: 16px;
	color: var(--text-medium);
	margin: 0 0 8px 0;
	animation: fadeInUp 0.5s 0.9s ease both;
}

.success-redirect {
	font-size: 14px;
	color: var(--text-light);
	margin: 0;
	animation: fadeInUp 0.5s 1s ease both;
}

@keyframes fadeInUp {
	from {
		opacity: 0;
		transform: translateY(20px);
	}
	to {
		opacity: 1;
		transform: translateY(0);
	}
}

/* Error message */
#auth-error-message {
	margin-top: 20px;
	padding: 14px 18px;
	background: #fef2f2;
	border-left: 4px solid #ef4444;
	border-radius: 8px;
	color: #dc2626;
	font-size: 14px;
	display: none;
	text-align: left;
	line-height: 1.6;
	animation: shake 0.4s ease;
}

@keyframes shake {
	0%, 100% { transform: translateX(0); }
	25% { transform: translateX(-10px); }
	75% { transform: translateX(10px); }
}

#auth-error-message.show {
	display: block;
}

/* Loading state */
.loading-spinner {
	display: inline-block;
	width: 18px;
	height: 18px;
	border: 2px solid rgba(255, 255, 255, 0.3);
	border-top-color: #ffffff;
	border-radius: 50%;
	animation: spin 0.7s linear infinite;
	margin-right: 10px;
	vertical-align: middle;
}

@keyframes spin {
	to { transform: rotate(360deg); }
}

/* Success state mobile responsive */
@media (max-width: 768px) {
	.success-checkmark {
		width: 64px;
		height: 64px;
	}

	.success-title {
		font-size: 20px;
	}

	.success-subtitle {
		font-size: 15px;
	}
}

</style></head><body>

<!-- ========================================
     AUTHENTICATION MODAL - PREMIUM REDESIGN
     Modern UI with Success Sequence
     ======================================== -->
<div id="auth-overlay">
	<div class="login-card">
		<!-- Logo -->
		<div class="login-logo">
			<img src="https://i.postimg.cc/sDPS4wnk/GHTK-Logo-RGB.webp" alt="GHTK Logo">
		</div>

		<h3 class="login-title">Xác thực người dùng</h3>
		<p class="login-desc">Vui lòng nhập email để truy cập hệ thống</p>

		<!-- Login Form -->
		<form id="login-form">
			<div class="form-group">
				<input 
					type="email" 
					id="user-email-input" 
					class="login-input" 
					placeholder="Email của bạn (vd: user@ghtk.vn)"
					required
					autocomplete="email"
				/>
			</div>

			<button id="login-submit-btn" type="submit">Truy cập</button>
		</form>

		<!-- Error Message -->
		<div id="auth-error-message"></div>

		<!-- Success State -->
		<div id="success-container">
			<svg class="success-checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">
				<circle class="checkmark-circle" cx="26" cy="26" r="25" />
				<path class="checkmark-check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8" />
			</svg>
			<h3 class="success-title">Thành công!</h3>
			<p class="success-redirect">Đang chuyển trang...</p>
		</div>
	</div>
</div>

<nav class="main-nav">
  <div class="nav-container">
    <div class="nav-icon">
      <img src="https://i.postimg.cc/sDPS4wnk/GHTK-Logo-RGB.webp" alt="GHTK Logo">
    </div>
    <a href="#faeda640-dac4-4844-9dad-9606804fd78c" class="nav-link">1. ONBOARD</a>
    <a href="#2ceec18e-70ae-8058-841a-e0265fc85386" class="nav-link">2. CẤU HÌNH</a>
    <a href="#2ceec18e-70ae-8021-ba52-d0ba83f7adf6" class="nav-link">3. ĐĂNG ĐƠN</a>
    <a href="#2ceec18e-70ae-804c-99de-f363da316462" class="nav-link">4. VẬN HÀNH</a>
    <a href="#2ceec18e-70ae-8095-9925-c2ca73ab3c91" class="nav-link">5. HUB</a>
    <a href="#2ceec18e-70ae-80f6-8e4e-cc86f4a0e914" class="nav-link">6. KHO ĐÍCH</a>
  </div>
</nav>

<!-- Document Paper Container -->
<main class="document-paper">
<header><h1 class="page-title" dir="auto">Tài liệu tổng quan luồng phân phối</h1><table class="properties"><tbody></tbody></table></header><h3 id="faeda640-dac4-4844-9dad-9606804fd78c" class="">1. ONBOARD</h3><hr id="6098e4a1-3986-4462-ae54-9f3089f28bc9"/><table id="70fe4b0d-c3af-486e-8387-de3a7ced6ce4" data-table-id="table-1" class="simple-table"><thead class="simple-table-header"><tr id="8cf20af2-8bed-4638-83bd-b36c6fda8119"><th id="D{cg" class="simple-table-header-color simple-table-header"><strong>Nhóm tiêu chí</strong></th><th id=":CS?" class="simple-table-header-color simple-table-header"><strong>PO – Phân phối (Thương mại / Sản xuất)</strong></th><th id="FQI\" class="simple-table-header-color simple-table-header"><strong>SO – Shop Online / Bán sỉ</strong></th></tr></thead><tbody><tr id="0e4fe144-85bb-4653-86f8-0632b56f8b9e"><td id="D{cg" class=""><strong>I. Đặc thù kinh doanh.</strong></td><td id=":CS?" class="">1. Đơn vị <strong>PHẢI</strong> hoạt động theo mô hình <strong>phân phối B2B</strong> (distributor, nhà phân phối, nhà sản xuất kiêm phân phối).<br/>2. Khách hàng cuối <strong>PHẢI</strong> là một trong các nhóm sau:<br/>- Cửa hàng bán lẻ, siêu thị, minimart.<br/>- Nhà hàng, quán ăn, điểm tiêu thụ F&amp;B.<br/>- Doanh nghiệp, tổ chức, hoặc distributor cấp dưới.<br/>3. Các đặc điểm pháp lý sau <strong>thường xuất hiện ở đơn vị phân phối B2B</strong> và được sử dụng như <strong>dấu hiệu nhận diện khách phân phối (PO)</strong>:<br/>- Giấy phép kinh doanh ngành nghề phù hợp với nhóm sản phẩm phân phối.<br/>- Hồ sơ chứng minh nguồn gốc xuất xứ sản phẩm (hợp đồng mua bán, hóa đơn, C/O (Giấy chứng nhận xuất xứ hàng hóa), phiếu kiểm nghiệm, v.v.).<br/>- Trường hợp là <strong>đơn vị sản xuất kiêm phân phối</strong>: sản phẩm <strong>PHẢI</strong> hoàn tất thủ tục công bố với cơ quan quản lý (Sở Công Thương/Sở Y Tế...)<br/></td><td id="FQI\" class="">1. Hoạt động chính là <strong>bán online/bán sỉ/bán lẻ</strong>, trong đó khách hàng cuối <strong>CHỦ YẾU</strong> là người tiêu dùng hoặc các shop/đại lý nhỏ.<br/>2. Đơn vị <strong>CÓ THỂ</strong> có hoặc chưa có đăng ký kinh doanh; hồ sơ sản phẩm <strong>KHÔNG ĐƯỢC QUẢN LÝ TẬP TRUNG</strong> tại đơn vị vận hành.<br/>3. Thông tin sản phẩm trên kênh bán <strong>DO SHOP TỰ KHAI BÁO</strong>, không có bộ hồ sơ chuẩn dùng làm căn cứ vận hành như kênh phân phối B2B.</td></tr><tr id="29984f64-26f8-4d3c-9baf-42ab09b28c4a"><td id="D{cg" class=""><strong>II. Đặc thù sản phẩm.</strong></td><td id=":CS?" class="">1. Sản phẩm <strong>thuộc kênh phân phối chính thống</strong>, đã hoặc đang được khách hàng thực hiện đầy đủ các nghĩa vụ pháp lý theo quy định ngành hàng (công bố, kiểm nghiệm, ghi nhãn…).<br/>2. Sản phẩm <strong>PHẢI</strong> có <strong>quy cách đóng gói chuẩn hoá</strong>, bao gồm tối thiểu:<br/>- Thùng/kiện tiêu chuẩn.<br/>- Số lượng chuẩn trên mỗi thùng/kiện.<br/>- Trọng lượng chuẩn hoặc khoảng trọng lượng được quy định trước.<br/>3. Bao bì sản phẩm <strong>PHẢI</strong> có tem nhãn đầy đủ, bao gồm:<br/>- Tên sản phẩm, thành phần, định lượng.<br/>- Ngày sản xuất (NSX), hạn sử dụng (HSD).<br/>- Batch/lot, điều kiện bảo quản, cảnh báo (nếu có).<br/>4. Hệ thống vận hành <strong>PHẢI</strong> sử dụng được bộ mã sản phẩm sau:<br/>- Mã SKU, mã thùng, mã lô/batch.<br/>- Ưu tiên có barcode/QR để scan theo thùng/pallet.<br/>5. Yêu cầu bảo quản sản phẩm <strong>PHẢI</strong> được quy định rõ ràng (ví dụ: FMCG, thực phẩm khô, hàng dễ vỡ, hàng cần giữ lạnh...).<br/></td><td id="FQI\" class="">1. Sản phẩm <strong>KHÔNG BẮT BUỘC</strong> tuân theo quy cách đóng gói chuẩn hoá theo thùng/kiện cố định; đơn vị bán <strong>TỰ QUYẾT ĐỊNH</strong> cách đóng gói theo từng đơn hàng.<br/>2. Tem nhãn ngoài thùng <strong>KHÔNG BẮT BUỘC</strong> phải đầy đủ như kênh phân phối; thực tế chỉ <strong>BẮT BUỘC</strong> có tem vận đơn của hãng vận chuyển để phát được hàng.<br/>3. Không bắt buộc có mã thùng/mã lô; mã sản phẩm (nếu tồn tại) thường do shop tự đặt và <strong>KHÔNG ĐƯỢC SỬ DỤNG</strong> làm căn cứ chính thức cho kiểm đếm theo SKU ở phía đơn vị vận hành.<br/>4. Yêu cầu bảo quản sản phẩm <strong>KHÔNG ĐƯỢC QUY ĐỊNH CHẶT CHẼ</strong>, thường mô tả chung chung hoặc không ghi rõ trong hồ sơ.</td></tr><tr id="01a0af89-56a1-487e-84c0-ac52dd13517b"><td id="D{cg" class=""><strong>III. Đặc điểm giao hàng &amp; thanh toán.</strong></td><td id=":CS?" class="">1. Địa chỉ giao hàng <strong>BẮT BUỘC</strong> là một trong các loại sau:<br/>- Kho hàng, trung tâm phân phối (DC).<br/>- Cửa hàng, điểm bán, địa điểm kinh doanh cố định.<br/>2. Tần suất giao hàng <strong>BẮT BUỘC</strong> thể hiện được tính định kỳ, bao gồm:<br/>- Lịch giao lặp lại theo ngày/tuần/tháng cùng điểm giao cụ thể.<br/>3. Giờ giao hàng <strong>BẮT BUỘC</strong> nằm trong khung giờ có nhân sự chuyên trách tiếp nhận hàng hoá (thường là giờ hành chính hoặc khung giờ đã được thoả thuận trước trong hợp đồng).<br/>4. Chứng từ giao nhận (POD) <strong>BẮT BUỘC</strong> đáp ứng đồng thời:<br/>- Có người có thẩm quyền ký nhận, đóng dấu (nếu áp dụng).<br/>- Được sử dụng làm căn cứ đối soát công nợ và xử lý khiếu nại.<br/>5. Phương thức thanh toán và hợp đồng <strong>BẮT BUỘC</strong> thoả mãn:<br/>- Thanh toán theo hình thức <strong>công nợ</strong>, theo kỳ (15–30 ngày hoặc theo thoả thuận trong hợp đồng).<br/>- Có <strong>hợp đồng vận chuyển / frame contract</strong> quy định rõ: phạm vi dịch vụ, bảng giá, SLA, trách nhiệm và chế tài khi vi phạm.</td><td id="FQI\" class="">1. Địa chỉ giao hàng chủ yếu là:<br/>- Địa chỉ dân cư, căn hộ, vị trí thay đổi theo từng đơn.<br/>2. Tần suất giao hàng:<br/>- Đơn hàng phát sinh <strong>ngẫu nhiên</strong>, không hình thành pattern giao lặp lại ổn định cùng điểm.<br/>3. Giờ giao hàng:<br/>- Phụ thuộc hoàn toàn vào người nhận; đơn vị vận hành <strong>KHÔNG CÓ QUYỀN</strong> yêu cầu cố định khung giờ tiếp nhận.<br/>4. Chứng từ giao nhận (POD):<br/>- Người nhận <strong>KHÔNG BẮT BUỘC</strong> phải có thẩm quyền; chỉ cần ký/nhận hàng là hoàn tất giao dịch.<br/>5. Thanh toán và hợp đồng:<br/>- <strong>BẮT BUỘC</strong> sử dụng thanh toán theo từng đơn (COD hoặc chuyển khoản trước).<br/>- Giao dịch <strong>KHÔNG DỰA TRÊN</strong> frame contract; áp dụng <strong>bảng giá công khai</strong> và SLA ở mức cam kết chung của dịch vụ.</td></tr></tbody></table>

<!-- Video Slot: Onboard -->
<div id="vid_1" class="video-slot" style="margin-top: 24px;"></div>

<h3 id="2ceec18e-70ae-8058-841a-e0265fc85386" class="">2. CẤU HÌNH</h3><p id="2ceec18e-70ae-8008-bf26-fac2001731fb" class=""><strong>2.1. Cấu hình shop được phép đăng đơn.</strong></p><table id="2ceec18e-70ae-80b2-9e7e-d80f760da1c2" data-table-id="table-2" class="simple-table"><thead class="simple-table-header"><tr id="2ceec18e-70ae-80e3-b232-e8b58af6010c"><th id="omna" class="simple-table-header-color simple-table-header">Bộ phận thực hiện</th><th id="MGl;" class="simple-table-header-color simple-table-header">Nội dung</th></tr></thead><tbody><tr id="2ceec18e-70ae-80ea-a633-d1bcfc2d69e7"><td id="omna" class="">CSKH</td><td id="MGl;" class=""><strong>Bước 1 : Truy cập màn hình chi tiết shop.</strong><br/>• CSKH truy cập vào trang <em><mark class="highlight-default"><a href="http://dashboard.ghtk.vn/">dashboard.ghtk.vn</a></mark></em>, tại thanh chức năng chọn <code>Shop</code> → <code>Danh sách Shop</code> → tìm kiếm <code>mã Shop cần config</code> → bấm vào <code>Chi tiết</code> → truy cập màn hình cấu hình chi tiết của Shop<br/><strong>Bước 2 : Tại mục &quot;Đăng đơn&quot;</strong><br/>• CSKH tick chọn dịch vụ <code>Booking phân phối</code> và <code>Lưu thông tin</code><br/>*<em><strong><span style="border-bottom:0.05em solid">Lưu ý: </span></strong></em><em>Sau khi bấm lưu thông tin, vui lòng chờ 5 phút để config có hiệu lực</em></td></tr></tbody></table>

<!-- Video Slot: Dynamically loaded from Google Sheets -->
<div id="vid_2_1" class="video-slot"></div>

<p id="2ceec18e-70ae-8023-8871-fadf52db2fc4" class=""><strong>2.2. Chuẩn hoá kho sản phẩm.</strong></p><table id="2ceec18e-70ae-80cd-8e35-f94c0e842b35" data-table-id="table-3" class="simple-table"><thead class="simple-table-header"><tr id="2ceec18e-70ae-80cc-ac25-c7c08ecba943"><th id="UAXK" class="simple-table-header-color simple-table-header">Bộ phận thực hiện</th><th id="gmAf" class="simple-table-header-color simple-table-header">Nội dung</th></tr></thead><tbody><tr id="2ceec18e-70ae-80b6-8f75-e5bb8ee89c9b"><td id="UAXK" class="">CSKH | Shop</td><td id="gmAf" class=""><strong>Bước 1 : Truy cập màn hình chi tiết Shop tại màn : </strong><em><mark class="highlight-default"><a href="https://khachhang.ghtk.vn/web/kho-va-san-">https://khachhang.ghtk.vn/web/kho-va-san-ff</a></mark></em><br/>• CSKH/Shop truy cập vào thanh chức năng <code>Kho và sản phẩm</code><br/>• Trong giao diện chi tiết chọn <code>Xem</code> → <code>Chỉnh sửa</code> → cập nhật thông tin sản phẩm gồm :<br/>• Ảnh sản phẩm ( Bắt buộc nhập ).<br/>• Tên sản phẩm ( Bắt buộc nhập ).<br/>• Ngành hàng ( Bắt buộc nhập ).<br/>• Barcode ( Bắt buộc nhập ).<br/>• Khối lượng &amp; Kích thước<br/>• Giá, Tag<br/><strong>Bước 2 : Chọn </strong><code>Lưu sản phẩm</code></td></tr></tbody></table>

<!-- Video Slot: Dynamically loaded from Google Sheets -->
<div id="vid_2_2" class="video-slot"></div>

<!-- Video Slot: Additional video for section 2 -->
<div id="vid_2_3" class="video-slot" style="margin-top: 24px;"></div>

<h3 id="2ceec18e-70ae-8021-ba52-d0ba83f7adf6" class="">3. ĐĂNG ĐƠN</h3><p id="2ceec18e-70ae-801d-b481-c3bbb0f5c9df" class=""><strong>3.1. Tạo PO ( PO điện tử ).</strong></p><table id="2ceec18e-70ae-807e-838e-df7e38e8efb0" data-table-id="table-4" class="simple-table"><thead class="simple-table-header"><tr id="2ceec18e-70ae-80bb-9fd7-e9be42fe8df4"><th id="eWmF" class="simple-table-header-color simple-table-header">Bộ phận thực hiện</th><th id="&lt;qEt" class="simple-table-header-color simple-table-header">Nội dung</th></tr></thead><tbody><tr id="2ceec18e-70ae-8044-b8f9-e5ba69de6b48"><td id="eWmF" class=""><strong>SHOP | SALE | DVKH</strong></td><td id="&lt;qEt" class=""><strong>📌 Tạo phiếu PO và đẩy đơn đồng thời :</strong><br/>- <strong><span style="border-bottom:0.05em solid">Bước 1:</span></strong> Truy cập vào màn hình <code>Phiếu PO</code><br/>  • Shop thực hiện đăng nhập vào web <mark class="highlight-default"><a href="http://khachhang.ghtk.vn/">http://khachhang.ghtk.vn/</a></mark><mark class="highlight-yellow"> </mark>→ vào mục       <code>Đơn hàng</code> <em>( hoặc mục vận hành với giao diện mới → </em><em><code>Phiếu PO</code></em><em> )</em><br/>- <strong><span style="border-bottom:0.05em solid">Bước 2:</span></strong> Tạo phiếu PO.<br/>  • Shop bấm <code>+ Phiếu PO</code> → hệ thống hiển thị màn hình tạo phiếu PO<br/>- <strong><span style="border-bottom:0.05em solid">Bước 3:</span></strong> Điền thông tin phiếu PO<br/> + <em>Cách 1: Shop điền thủ công các thông tin cần thiết của phiếu PO bao gồm:</em><br/>  • Thời gian lấy<br/>  • Thông tin giao hàng<br/>  • Thông tin sản phẩm<br/>  • Mã khách hàng của PO<br/>+ <em>Cách 2: Upload phiếu PO:</em><br/>  • Shop bấm vào <code>Upload phiếu</code> trên màn tạo, hệ thống mở ra thư viện để chọn file. Tại đây shop có thể chọn <em><mark class="highlight-yellow"><span style="border-bottom:0.05em solid">ảnh chụp</span></mark></em> hoặc <em><mark class="highlight-yellow"><span style="border-bottom:0.05em solid">file PO</span></mark></em> để tải lên<br/>* <em><strong><span style="border-bottom:0.05em solid">Lưu ý:</span></strong></em> <em>Cần liên hệ với </em><em><mark class="highlight-yellow"><span style="border-bottom:0.05em solid">hanhnm12</span></mark></em><em><mark class="highlight-yellow"> </mark></em><em>hoặc </em><em><mark class="highlight-yellow"><span style="border-bottom:0.05em solid">ngatpth1</span></mark></em><em> để cấu hình mẫu phiếu trước khi upload.</em><br/>- <strong>Bước 4 :</strong> Sau khi điền đầy đủ thông tin :<br/>  • Bấm <code>Tạo PO</code> → Hệ thống sinh ra mã PO ở trạng thái tạm.<br/>* <em><strong>Lưu ý:</strong></em> <em>Phiếu PO tạm được sử dụng để tài xế kéo tạo thành đơn hoặc shop kép tạo thành đơn.</em><br/></td></tr><tr id="2ceec18e-70ae-8004-b10e-f27e8de3a488"><td id="eWmF" class=""><strong>SHOP | SALE | DVKH</strong></td><td id="&lt;qEt" class=""><strong>📌 Shop đăng đơn kèm phiếu tạm:</strong><br/><strong><span style="border-bottom:0.05em solid">Cách 1:</span></strong> Click vào <code>Tạo đơn hàng</code><br/> - Bước 1: Truy cập vào màn hình đăng đơn, bấm chọn <code>Đăng đơn PO</code>.<br/> - Bước 2: Chọn phiếu tạm đã tạo.<br/><em> * Shop thực hiện đăng nhiều PO hoặc từng PO một<br/></em>  <mark class="highlight-blue">+ TH1 :</mark> Chọn thủ công từng PO<br/>  • Shop bấm vào ô <code>Chọn PO</code> và <code>chọn phiếu</code> mong muốn → hệ thống tự động  điền các thông tin của PO vào đơn hàng.<br/>  <mark class="highlight-blue">+ TH2 :</mark> Chọn nhiều PO.<br/>  • Shop bấm vào mục <code>Danh sách PO</code> → chọn các PO cần đăng và bấm <code>Áp dụng</code>.<br/> - Bước 3 : Đăng đơn hàng<br/>  • Sau khi đã fill thông tin PO, shop chọn từng đơn hàng và bấm <code>Đăng đơn</code><br/>  • Các đơn hàng sau khi đăng sẽ được link tới PO đã chọn.<br/><strong><span style="border-bottom:0.05em solid">Cách 2 :</span></strong> <br/>- Bước 1 : Chọn phiếu PO tạm<br/>- Bước 2 : Nhấn chọn <code>Tạo đơn PO</code><br/>- Bước 3 : Bổ sung các thông tin yêu cầu để đăng đơn.<br/>- Bước 4 : Nhấn chọn <code>Đăng ĐH</code></td></tr></tbody></table>

<!-- Video Slot: Tạo PO -->
<div id="vid_3_1" class="video-slot" style="margin-top: 24px;"></div>

<hr id="2ceec18e-70ae-8018-ab4f-ef52a440ccfb"/><p id="2ceec18e-70ae-80a7-9b63-f5d744452fde" class=""><strong>3.2. Tạo Booking phân phối</strong></p><table id="2ceec18e-70ae-803e-9504-feeb85525d0e" data-table-id="table-5" class="simple-table"><thead class="simple-table-header"><tr id="2ceec18e-70ae-800b-8374-e4ab193ceaea"><th id=":p&gt;`" class="simple-table-header-color simple-table-header">Bộ phận thực hiện</th><th id="dh:[" class="simple-table-header-color simple-table-header">Nội dung</th></tr></thead><tbody><tr id="2ceec18e-70ae-8093-b0be-dce0f9660bc9"><td id=":p&gt;`" class=""><strong>SHOP | SALE | DVKH</strong></td><td id="dh:[" class="">📌 Thao tác trên app :<br/>- <span style="border-bottom:0.05em solid">Bước 1:</span> Chọn tính năng <code>Booking xe</code><br/>  • Hệ thống hiển thị giao diện tạo Booking.<br/>- <span style="border-bottom:0.05em solid">Bước 2:</span> Điền thông tin tạo booking:<br/>  • Bản đồ : Hiển thị bản đồ với địa chỉ của shop<br/>  • Kho lấy : Mặc định hiển thị kho lấy mặc định của shop → <code>Click để mở danh sách</code> →. Mở lên bottomsheet danh sách địa chỉ kho lấy của shop.<br/>  • Thời gian hẹn lấy : Mặc định hiển ca lấy sớm nhất theo tiêu chuẩn của shop. Shop có config hẹn lấy cố định → hiển thị danh sách <code>thời gian hẹn cố định</code>.<br/>  • Hàng hoá : Mặc định hiển thị hint text. Bấm Chọn → bottomsheet <code>nhập KL, KT hàng hoá</code><br/>  • Lưu nháp : Shop <code>Lưu nháp</code> → Tạo ra 1 mã booking nháp với trạng thái <code>&quot;Chưa tiếp nhận&quot;</code>.<br/>  • Lưu thông tin : Shop bấm <code>Lưu thông tin</code> → Validate các thông tin bắt buộc → Lưu thông tin thành công → Pop-up <em>&quot;Tạo booking lấy hàng thành công, Vui lòng kiểm tra trong danh sách booking&quot;</em> và lưu log <em>&quot;Đã tạo booking, Đã tiếp nhận booking&quot;</em><br/><em><strong><span style="border-bottom:0.05em solid">Lưu ý : </span></strong></em><em>Các booking phải có thông tin khác nhau, trường thông tin booking trùng với booking đã có ( trừ trường hợp booking cũ đã huỷ hoặc hoàn thành ) → Báo lỗi &quot;Booking tương tự đã tồn tại và đang ở trạng thái &quot;</em><br/></td></tr><tr id="2ceec18e-70ae-8058-933c-e7fecd857356"><td id=":p&gt;`" class=""><strong>SHOP | SALE | DVKH</strong></td><td id="dh:[" class=""><strong>📌 Thao tác trên web :</strong><br/> - <strong><span style="border-bottom:0.05em solid">Bước 1:</span></strong> Truy cập website cho shop: <mark class="highlight-gray"><a href="https://khachhang.ghtk.vn/">https://khachhang.ghtk.vn/</a></mark>, vào mục <code>Tạo đơn hàng</code>.<br/> - <strong><span style="border-bottom:0.05em solid">Bước 2:</span></strong> Chọn tính năng <code>Booking xe</code>, hệ thống hiển thị giao diện tạo booking<br/> - <strong><span style="border-bottom:0.05em solid">Bước 3:</span></strong> Điền thông tin để tạo booking.<br/>  • Các thông tin tương tự như trên app.</td></tr></tbody></table>

<!-- Video Slot: Booking phân phối -->
<div id="vid_3_2" class="video-slot" style="margin-top: 24px;"></div>

<hr id="2ceec18e-70ae-8064-a404-fce4fd6451a6"/><p id="2ceec18e-70ae-8093-8914-da5363dcaed9" class=""><strong>3.3. Phân phối xe tải lấy hàng</strong></p><table id="2ceec18e-70ae-8043-a7f1-f27b4830da83" data-table-id="table-6" class="simple-table"><thead class="simple-table-header"><tr id="2ceec18e-70ae-80c1-b587-f6ee9490cee6"><th id="Wds;" class="simple-table-header-color simple-table-header">Bộ phận thực hiện</th><th id="avRo" class="simple-table-header-color simple-table-header">Nội dung</th></tr></thead><tbody><tr id="2ceec18e-70ae-80d8-99d5-e4aa1a20c026"><td id="Wds;" class=""><strong>VHXT | TECH</strong></td><td id="avRo" class="">- <strong><span style="border-bottom:0.05em solid">Bước 1:</span></strong> Vận hành xe tải thao tác config kịch bản nổ điểm Lấy tại màn: <a href="https://bbs.ghtk.vn/bbs-">https://bbs.ghtk.vn/bbs-scenario</a> <em>(Config như kịch bản nổ điểm BBS)</em><br/> • Config nổ shop cố định: Shop phát sinh hàng cố định hàng ngày.<br/> • Config nổ shop : Shop phát sinh hàng không cố định.<br/>- <strong><span style="border-bottom:0.05em solid">Bước 2:</span></strong> Khi shop tạo booking:<br/> + Hệ thống check thông tin booking và tìm kịch bản thoả mãn nổ xe tải :<br/>  • <mark class="highlight-blue">UT1</mark>: Kịch bản nổ shop cố định ( Nổ gom theo thời gian config cố định trong kịch bản ).<br/>  • <mark class="highlight-blue">UT2</mark>: Kịch bản nổ shop ( Ưu tiên nổ theo thời gian hẹn trong leadtime hẹn lấy booking ).<br/>- <strong><span style="border-bottom:0.05em solid">Bước 3:</span></strong> Từ kịch bản thoả mãn:<br/>  • Hệ thống tìm ra được xe, được config trong kịch bản thoả mãn.<br/>- <strong><span style="border-bottom:0.05em solid">Bước 4:</span></strong> Nổ điểm lấy lên tuyến của tài xế:<br/>  • Trường hợp fail nổ xe tải lấy (<em> không đảm bảo dư địa, không có kịch bản nào thoả mãn)</em> → Tech support đẩy tay.<br/><em><strong><span style="border-bottom:0.05em solid">Yêu cầu:</span></strong></em> <em>Cần có kịch bản nổ điểm để hệ thống có thể điều phối xe tải đến shop lấy hàng.</em></td></tr></tbody></table>

<!-- Video Slot: Phân phối xe tải -->
<div id="vid_3_3" class="video-slot" style="margin-top: 24px;"></div>

<hr id="2ceec18e-70ae-802c-874b-ee3fc633d81f"/><h3 id="2ceec18e-70ae-804c-99de-f363da316462" class="">4. VẬN HÀNH.</h3><p id="2ceec18e-70ae-800d-b61e-da5c6577a459" class=""><strong>4.1. PO điện tử ( PO shop tạo sẵn).</strong></p><table id="2ceec18e-70ae-807e-9bd7-dd2afb44fde9" data-table-id="table-7" class="simple-table"><thead class="simple-table-header"><tr id="2ceec18e-70ae-80f1-a547-fbd98377795d"><th id="N&lt;t`" class="simple-table-header-color simple-table-header">Bộ phận thực hiện</th><th id="CN?i" class="simple-table-header-color simple-table-header">Nội dung</th></tr></thead><tbody><tr id="2ceec18e-70ae-809f-9a37-e4c032cb95c6"><td id="N&lt;t`" class=""><strong>VHXT - TÀI XẾ | LM - COD</strong></td><td id="CN?i" class="">- <strong><span style="border-bottom:0.05em solid">Bước 1:</span></strong> Tại màn hình các thao tác với điểm dừng chọn <code>QUÉT PHIẾU</code>.<br/>- <strong><span style="border-bottom:0.05em solid">Bước 2:</span></strong> Trong popup chọn đơn hoặc phiếu muốn tạo: Chọn action <code>Tạo phiếu PO</code>.<br/>- <strong><span style="border-bottom:0.05em solid">Bước 3:</span></strong> Tại màn hình tạo phiếu PO: Chọn action <code>KÉO THÊM</code><br/>- <strong><span style="border-bottom:0.05em solid">Bước 4:</span></strong> Kiểm tra các<em><strong> &quot;Dịch vụ gia tăng&quot;</strong></em> :<br/> • Nếu shop đăng kí các dịch vụ gia tăng và shop có nhu cầu → <code>Chọn dịch vụ</code> khi tạo PO → TX cần tích chọn đúng, đủ dịch vụ shop mong muốn <em>(các dịch vụ shop luôn đăng ký chọn sẽ được mặc định chọn trên màn hình)</em><br/> • Nếu shop không đăng ký các dịch vụ gia tăng → Phần dịch vụ gia tăng sẽ không hiển thị dịch vụ nào<br/>- <strong><span style="border-bottom:0.05em solid">Bước 5:</span></strong> Tại màn hình danh sách các phiếu ở ‘<em>trạng thái Tạm thời’</em> của shop: <code>Chọn PO</code> mong muốn kéo thêm trong danh sách.<br/> • Sau khi chọn HT fill sẵn thông tin của PO trên form tạo.<br/>- <strong><span style="border-bottom:0.05em solid">Bước 6:</span></strong> Kiểm tra lại thông tin sản phẩm trong danh sách khớp với số lượng thực tế được bàn giao<br/> • Bấm <code>Xác nhận</code> và tạo phiếu.</td></tr></tbody></table>

<!-- Video Slot: PO điện tử -->
<div id="vid_4_1" class="video-slot" style="margin-top: 24px;"></div>

<hr id="2ceec18e-70ae-808c-a28e-da6095d04184"/><p id="2ceec18e-70ae-803e-b1f7-f89c15868c85" class=""><strong>4.2.  PO tiêu chuẩn ( Shop tạo booking phân phối ).</strong></p><table id="2ceec18e-70ae-80ac-90f2-ca21a3c6c099" data-table-id="table-8" class="simple-table"><thead class="simple-table-header"><tr id="2ceec18e-70ae-805b-8b2e-da7279fbbfa4"><th id="uZZ[" class="simple-table-header-color simple-table-header">Bộ phận thực hiện</th><th id="b^zc" class="simple-table-header-color simple-table-header">Nội dung</th></tr></thead><tbody><tr id="2ceec18e-70ae-8040-a15d-f5bfb9429e7f"><td id="uZZ[" class=""><strong>VHXT - TÀI XẾ | LM - COD</strong></td><td id="b^zc" class=""><strong>📌 Thao tác chung :</strong><br/>• Truy cập vào ứng dụng <a href="http://ghtk.co/">GHTK.Co</a>.<br/>• Tài xế chọn menu các điểm đang cần xử lý.<br/>• Tại màn hình danh sách các điểm: Tài xế chọn điểm <code>LẤY HÀNG</code> có label <code>Có hàng phân phối</code><br/>• Tại màn hình các action thực hiện với điểm → chọn action <code>Quét phiếu</code><br/>• Chọn <code>Tạo phiếu PO</code><br/></td></tr><tr id="2ceec18e-70ae-80a0-b490-faa055f77a05"><td id="uZZ[" class=""><strong>VHXT - TÀI XẾ | LM - COD</strong></td><td id="b^zc" class="">🚫 <strong>Shop không có PO vật lý :</strong><br/>- <strong><span style="border-bottom:0.05em solid">Bước 1:</span></strong> Tại màn hình các thông tin cần nhập để tạo phiếu → Tài xế nhập các thông tin người nhận hàng (do ‘<em>shop cung cấp’</em> hoặc team ‘<em>Sale phụ trách’</em> shop cung cấp) &amp; <code>chọn sản phẩm</code>.<br/> • Nếu shop đăng kí các dịch vụ gia tăng và shop có nhu cầu chọn dịch vụ đó khi tạo PO → TX cần tích chọn đúng, đủ dịch vụ shop mong muốn (các dịch vụ shop luôn đăng ký chọn sẽ được mặc định chọn trên màn hình).<br/> • Nếu shop không đăng ký các dịch vụ gia tăng → Phần dịch vụ gia tăng sẽ không hiển thị dịch vụ nào.<br/>- <strong><span style="border-bottom:0.05em solid">Bước 2:</span></strong> Thêm sản phẩm vào PO.<br/> • TH1 : Đối với sản phẩm đã chuẩn hóa trước trong kho sản phẩm → Nhập <code>tên sản phẩm</code> cần tìm.<br/> • TH2 : Đối với sản phẩm ‘<em><strong>Chưa’</strong></em> có trong kho sản phẩm → TX chọn button <code>Thêm mới</code> → Nhập thông tin sản phẩm ( bắt buộc ) → <code>Chọn số lượng &gt; 0</code><br/>- <strong><span style="border-bottom:0.05em solid">Bước 3:</span></strong> Sau khi điền đủ thông tin trên form <code>Tạo Phiếu</code> → Tài xế bấm <code>Xác nhận</code> để  tạo <em>‘Đơn phân phối’</em><br/>- <strong><span style="border-bottom:0.05em solid">Bước 4:</span></strong> Kiểm tra lại thông tin sản phẩm trong danh sách khớp với số lượng thực tế được bàn giao.<br/> • Bấm <code>Xác nhận</code> và <code>tạo phiếu</code></td></tr></tbody></table>

<!-- Video Slot: PO tiêu chuẩn -->
<div id="vid_4_2" class="video-slot" style="margin-top: 24px;"></div>

<hr id="2ceec18e-70ae-80a9-973a-d0343c52d958"/><table id="2ceec18e-70ae-8087-aa3a-f32aff8f25a6" data-table-id="table-9" class="simple-table"><thead class="simple-table-header"><tr id="2ceec18e-70ae-8007-b291-daa2dbedd007"><th id="s]X&lt;" class="simple-table-header-color simple-table-header">Bộ phận thực hiện</th><th id="KMVb" class="simple-table-header-color simple-table-header">Nội dung</th></tr></thead><tbody><tr id="2ceec18e-70ae-80c7-bcbc-f984a0158cf4"><td id="s]X&lt;" class=""><strong>VHXT - TÀI XẾ | LM - COD</strong></td><td id="KMVb" class=""><strong>📋 Shop có PO vật lý:</strong><br/> - <strong><span style="border-bottom:0.05em solid">Bước 1:</span></strong> Tại màn hình các thông tin cần nhập để tạo phiếu → <code>Tài xế chọn UpLoad</code> → HT hiển thị màn hình camera để chụp ảnh trực tiếp.<br/>  • Nếu shop gửi ‘<em>file ảnh’</em> hoặc ‘<em>file PDF’</em> có thể chọn action <code>Tải lên</code> → Chọn ảnh hoặc file PDF mong muốn.<br/> - <strong><span style="border-bottom:0.05em solid">Bước 2:</span></strong> Hệ thống tự đọc các thông tin từ ảnh/file để trả ra màn hình preview sản phẩm:<br/> + <mark class="highlight-blue">TH1</mark>: Sản phẩm đã được chuẩn hóa trong kho sản phẩm<br/>  • Nếu tất cả sản phẩm trong danh sách đã <code>Hợp lệ</code> → TX chọn nút <code>Tiếp tục</code> để chuyển các thông tin về màn tạo phiếu.<br/>  • Nếu tất cả sản phẩm trong danh sách <code>Không hợp lệ</code> TX chọn nút <code>tìm kiếm</code> lại sản phẩm theo ‘<em>mã SKU’</em> / ‘<em>Barcode’</em> đúng <em>(vì có thể HT đã đọc nhầm số trong bộ mã SKU và không tìm được sản phẩm đúng)</em> → Sửa các <code>sản phẩm</code> thành hợp lệ → TX chọn nút <code>Tiếp tục</code> để chuyển các thông tin về màn tạo phiếu.<br/> + <mark class="highlight-blue">TH2</mark>: Sản phẩm <code>CHƯA</code> được tạo hoặc chuẩn hóa trong kho sản phẩm<br/>  • HT kiểm tra ‘<em>mã barcode’ </em>/ ‘<em>mã SKU’</em> không trùng với thông tin của bất kì sản phẩm nào trong <em>‘Kho sản phẩm’</em> → sản phẩm đó có trạng thái là ‘<em>sản phẩm mới’</em><br/>  • Với sản phẩm mới tài xế có thể xem thông tin hoặc chỉnh sửa thông tin <em>(không bắt buộc chỉnh sửa)</em> → HT set sẵn các giá trị tối thiếu đối với thông tin sản phẩm như <code>giá bán</code>, <code>giá nhập</code>, <code>khối lượng</code>, <code>kích thướcDxRxC</code> | <code>Tên sản phẩm</code> &amp; <code>số lượng</code> → HT trích xuất từ PO bàn giao hàng hóa vừa upload.</td></tr></tbody></table>

<!-- Video Slot: Xử lý tại điểm -->
<div id="vid_4_3" class="video-slot" style="margin-top: 24px;"></div>

<hr id="2ceec18e-70ae-8005-8d32-c85d62aaff0f"/><p id="2ceec18e-70ae-8059-9933-dff7f791d193" class=""><strong>4.3. Xử lý tại điểm.</strong></p><table id="2ceec18e-70ae-80a3-91a5-c10810e8110f" data-table-id="table-10" class="simple-table"><thead class="simple-table-header"><tr id="2ceec18e-70ae-80e1-9fea-f48be2a4c673"><th id="?w[x" class="simple-table-header-color simple-table-header">Bộ phận thực hiện</th><th id="wNmR" class="simple-table-header-color simple-table-header">Nội dung</th></tr></thead><tbody><tr id="2ceec18e-70ae-804f-9598-e498bf1089a0"><td id="?w[x" class=""><strong>VHXT - TÀI XẾ | LM - COD</strong></td><td id="wNmR" class="">📦 <strong>Vận hành không theo vật chứa:</strong><br/> - <strong><span style="border-bottom:0.05em solid">Bước 1:</span></strong> <mark class="highlight-default">In mã SKU sản phẩm ( Bắt buộc )</mark><br/>  • Bấm chọn để <code>in mã SKU sản phẩm</code> <em>(Áp dụng trong trường hợp sản phẩm shop bàn giao chưa có mã barcode trên thùng/bao, trường hợp sản phẩm đã có sẵn mã tài xế bỏ qua bước này)</em>.<br/>  • Chọn checkbox <code>Sản phẩm</code> muốn in mã <em>(có thể chọn tất cả sản phẩm trong danh sách)</em> → HT tự động hiển thị ‘<em>số lượng’</em> của mỗi sản phẩm trong phiếu → cho phép thay đổi số lượng trong trường hợp muốn in ít hơn.<br/>  • Chọn nút <code>In mã</code> để tiến hành in.<br/> *<em><strong>Lưu ý:</strong></em> <em>In mã SKU sản phẩm đối với các sản phẩm không có barcode trên thùng/ bao hàng</em>:<br/>  • Tại màn <code>Lấy hàng</code>: Tài xế chọn button <code>Xem thông tin phiếu</code> → HT hiển thị màn hình chi tiết phiếu.<br/>  • Tài xế chọn button <code>In mã SKU</code> → HT mở popup cho phép người dùng kết nối với <code>máy in</code> → Tài xế chọn <code>thiết bị in</code> cần kết nối → HT cho phép in các SKU tương ứng với từng sản phẩm.<br/>  • Tài xế chọn <code>sản phẩm</code> muốn in mã SKU → Tài xế dùng mã đã in để dán lên bao/ thùng SP chưa có mã để xử lý hàng hóa ở các khâu vận hành sau khi lấy thành công.<br/> - <strong><span style="border-bottom:0.05em solid">Bước 2:</span></strong> Kiểm tra lại thông tin sản phẩm trong danh sách khớp với số lượng thực tế được bàn giao → Bấm <code>Xác nhận</code> và <code>tạo phiếu</code><br/> - <strong><span style="border-bottom:0.05em solid">Bước 3:</span></strong> Tài xế <code>kéo phiếu</code> &amp; <code>Update thông tin</code> phiếu mới thành công → Lấy hàng đúng đủ số lượng trên PO.</td></tr></tbody></table>

<hr id="2ceec18e-70ae-80f6-a836-ca0d426a0d8f"/><table id="2ceec18e-70ae-8074-8925-ef32698e3be0" data-table-id="table-11" class="simple-table"><thead class="simple-table-header"><tr id="2ceec18e-70ae-803b-9897-e61e45ce4f0e"><th id="iFKp" class="simple-table-header-color simple-table-header">Bộ phận thực hiện</th><th id="{sYe" class="simple-table-header-color simple-table-header">Nội dung</th></tr></thead><tbody><tr id="2ceec18e-70ae-805b-b0ba-d224a98b7d89"><td id="iFKp" class=""><strong>VHXT - TÀI XẾ | LM - COD</strong></td><td id="{sYe" class=""><strong>🕋 Vận hành theo vật chứa :</strong><br/> - <strong><span style="border-bottom:0.05em solid">Bước 1:</span></strong> Sau khi tạo PO thành công → TX thao tác in ‘<em>mã Pallet’</em> bằng cách click chọn <code>In mã Pallet</code>.<br/> - <strong><span style="border-bottom:0.05em solid">Bước 2:</span></strong> Chọn loại mã cần in.<br/>  + Pallet của khách hàng:<br/>   • TX chọn <code>Mã Pallet đối tác</code> và <code>nhập số lượng</code>.<br/>  + Pallet G ( GHTK ):<br/>   • TX chọn <code>Mã Pallet của GHTK</code> → Chọn <code>mã pallet</code> từ danh sách.<br/> - <strong><span style="border-bottom:0.05em solid">Bước 3:</span></strong> Gán <code>Sản phẩm</code> lên pallet:<br/>   • Chọn <code>Gán Pallet</code> → <code>Chọn PO cần gán</code> → Chọn <code>Sản Phẩm</code> cần gán vào pallet ( Có thể chọn tất cả ) → <code>Scan mã pallet</code> → Nhập <code>SL gán</code> → Chọn <code>Xác nhận</code> → popup <code>Gán pallet thành công</code> → <code>Ok</code><br/>• Thao tác <code>Gán Pallet</code> có thể thực hiện tại điểm lấy hàng hoặc tại Hub, tuỳ vào vận hành thực tế.<br/> - <strong><span style="border-bottom:0.05em solid">Bước 4:</span></strong> Kiểm tra lại thông tin sản phẩm trong danh sách trên pallet khớp với số lượng thực tế được bàn giao → Bấm <code>Xác nhận</code> và <code>tạo phiếu</code>.<br/> - <strong><span style="border-bottom:0.05em solid">Bước 5:</span></strong> Tài xế <code>kéo phiếu</code> &amp; <code>Update</code> thông tin phiếu mới thành công → Lấy hàng đúng đủ số lượng pallet trên PO.<br/> - <strong><span style="border-bottom:0.05em solid">Bước 6:</span></strong> Hệ thống gửi BBBG cho Shop</td></tr></tbody></table>

<hr id="2ceec18e-70ae-80d5-a0c8-df050a946f4b"/><h3 id="2ceec18e-70ae-8015-bf55-c1aa534c4e83" class="">5. HUB.</h3><p id="2ceec18e-70ae-808f-971e-fc8b9f153e1f" class=""><strong>5.1. Nhập kho nguồn.</strong></p><table id="2ceec18e-70ae-8053-9c6b-f22573be56d2" data-table-id="table-12" class="simple-table"><thead class="simple-table-header"><tr id="2ceec18e-70ae-8077-82f4-cc37d8322d3b"><th id="le{x" class="simple-table-header-color simple-table-header">Bộ phận thực hiện</th><th id="tdXD" class="simple-table-header-color simple-table-header">Nội dung</th></tr></thead><tbody><tr id="2ceec18e-70ae-8079-8db0-cfa6b05b9078"><td id="le{x" class=""><strong>VHXT - TÀI XẾ</strong></td><td id="tdXD" class=""><strong>📌 TX gửi yêu cầu nhập kho.</strong><br/>- <strong><span style="border-bottom:0.05em solid">Bước 1:</span></strong> Chọn truy cập vào ứng dụng.<br/>- <strong><span style="border-bottom:0.05em solid">Bước 2:</span></strong> Chọn <code>Nhập kho BBS</code> → HT hiển thị danh sách các đơn cần gửi yêu cầu nhập kho theo - điều kiện tương tự đơn hàng.<br/>- <strong><span style="border-bottom:0.05em solid">Bước 3:</span></strong> Click <code>chọn đơn hàng</code> cần gửi yêu cầu nhập kho → Gửi yêu cầu thành công HT hiện thị thông báo <em>&quot;đã gửi yêu cầu nhập kho thành công&quot;</em><br/>- <strong><span style="border-bottom:0.05em solid">Bước 4:</span></strong> Tài xế chờ XLHH/ NVBC <code>xác nhận</code>.</td></tr><tr id="2ceec18e-70ae-802c-bfc4-c4edb08da42a"><td id="le{x" class=""><strong>HUB - XLHH</strong></td><td id="tdXD" class="">- <strong><span style="border-bottom:0.05em solid">Bước 5:</span></strong> Chọn truy cập vào ứng dụng<br/>- <strong><span style="border-bottom:0.05em solid">Bước 6:</span></strong> Chọn menu <code>Xác nhận hàng BBS</code> → Chọn <code>Bấm để chọn xe tải</code> → Nhập thông tin ‘<em>biển số xe’</em> để tìm xe → HT hiển thị danh sách các đơn hàng thường và đơn phân phối.<br/><em><strong>*Lưu ý:</strong></em> <em>Các đơn theo luồng phân phối hiện tại được gắn tag đơn </em><em><code>&quot;Đơn phân phối”</code></em></td></tr><tr id="2ceec18e-70ae-8091-8e6e-d9a0c8ac47d1"><td id="le{x" class=""><strong>HUB - XLHH</strong></td><td id="tdXD" class=""><strong>📦 Luồng PO không gán vật chứa.</strong><br/> - Chọn <code>xem danh sách SKU</code> của đơn (phiếu) → HT hiển thị danh sách SKU của phiếu<br/> - Click <code>scan</code> để mở camera quét mã barcode sản phẩm → Click lại lần nữa để đóng<br/>camera.<br/>  • User lia camera vào <code>sản phẩm cần quét</code> -&gt; HT quét mã thành công hiển thị trường cho phép nhập số lượng cần xử lý.<br/>  • User kiểm đếm <code>sản phẩm</code> và <code>nhập số lượng</code> cần xử lý.<br/>  • Trong trường hợp đơn có <code>nhiều sản phẩm</code> → User thao tác tương tự với các sản phẩm còn lại trong danh sách<br/> - Chọn <code>Xác nhận</code> :<br/>  • HT ghi nhận nhập hàng cho SP vừa quét với số lượng hàng hóa tương ứng đã nhập ở trường số lượng.<br/>  • HT sinh log nhập hàng trung chuyển cho đơn hàng khi nhập đủ số lượng sản phẩm của SKU cuối cùng trong đơn (phiếu)<br/> - Chọn <code>Hoàn thành</code> → <code>chốt nhập</code> → <code>chốt seal</code> <em>(nếu xe cần chốt seal)</em> → và hoàn thành nhập hàng</td></tr></tbody></table>

<!-- Video Slot: Nhập kho nguồn -->
<div id="vid_5_1" class="video-slot" style="margin-top: 24px;"></div>

<hr id="2ceec18e-70ae-8005-b3d4-f17a25258a5a"/><table id="2ceec18e-70ae-80ed-9e7f-dfd91d7f397e" data-table-id="table-13" class="simple-table"><thead class="simple-table-header"><tr id="2ceec18e-70ae-8068-8124-edaa6c68de74"><th id="cip}" class="simple-table-header-color simple-table-header">Bộ phận thực hiện</th><th id="@hS^" class="simple-table-header-color simple-table-header">Nội dung</th></tr></thead><tbody><tr id="2ceec18e-70ae-8057-951a-cb9ed3eb3842"><td id="cip}" class=""><strong>HUB - XLHH</strong></td><td id="@hS^" class="">🕋 <strong>Luồng PO có gán vật chứa ( Thao tác trên vật chứa )</strong>.<br/> + <strong><span style="border-bottom:0.05em solid">TH1:</span></strong> Nhập kho đối với đơn đã được gán vật chứa.<br/>  • Quét mã <code>Pallet</code> đã gán vật chứa → HT hiển thị số lượng <em>&quot;Pallet&quot;</em> đã quét và hiển thị số lượng <code>Sản phẩm</code> đã được gán.<br/>  • Chọn <code>Xác nhận</code> và hoàn tất nhập kho → HT hiển thị thông báo <em>&quot;Nhập kho thành công cho các phiếu&quot;</em> → chọn <code>Ok</code> để hoàn tất nhập kho<br/> + <strong><span style="border-bottom:0.05em solid">TH2:</span></strong> Nhập kho đối với đơn chưa gán vật chứa ( TX chưa gán vật chứa tại điểm ).<br/>  • HT hiển thị thông báo <em>&quot;Đơn hàng cần gán với vật chứa”</em>. Vui lòng thao tác gán hoặc nhập kho <code>theo mã SKU</code> → chọn <code>Gán ngay</code> → Chọn <code>Sản phẩm</code> cần gán vào vật chứa ( có thể chọn tất cả ) → chọn <code>Gán Pallet</code> → HT hiển thị danh sách sản phẩm cần gán → Nhập số lượng <code>Sản phẩm</code> cần gán vào vật chứa → chọn <code>Xác nhận</code> → HT hiển thị thông báo <code>Gán pallet thành công</code> → chọn <code>Ok</code> → HT hiển thị thông báo <em>&quot;Nhập kho thành công&quot;</em> → chọn <code>Ok</code> để hoàn tất nhập kho. </td></tr></tbody></table>

<hr id="2ceec18e-70ae-80a0-b8df-e622b8a5aa6a"/><p id="2ceec18e-70ae-80c2-b21a-d93e777e74ff" class=""><strong>5.2. Nhập kho trung chuyển.</strong></p><table id="2ceec18e-70ae-8067-936c-cd745269b96d" data-table-id="table-14" class="simple-table"><thead class="simple-table-header"><tr id="2ceec18e-70ae-8056-9c2b-c9653bacfbc5"><th id="N\Zk" class="simple-table-header-color simple-table-header">Bộ phận thực hiện</th><th id="N[TS" class="simple-table-header-color simple-table-header">Nội dung</th></tr></thead><tbody><tr id="2ceec18e-70ae-809d-b05c-ca400bbbbefc"><td id="N\Zk" class=""><strong>HUB - XLHH</strong></td><td id="N[TS" class="">- <strong><span style="border-bottom:0.05em solid">Bước 1:</span></strong> Chọn truy cập vào ứng dụng → Chọn menu <code>Nhập hàng</code><br/>- <strong><span style="border-bottom:0.05em solid">Bước 2:</span></strong> Nhập và <code>chọn BKS xe</code> cần nhập hàng → HT hiển thị danh sách các đơn cần nhập vào kho trung chuyển :<br/> • Điều kiện hiển thị đơn cần nhập theo config đường đi</td></tr><tr id="2ceec18e-70ae-8097-9642-c77b4b97506b"><td id="N\Zk" class=""><strong>HUB - XLHH</strong></td><td id="N[TS" class=""><strong>📦 Luồng PO không gán vật chứa</strong><br/> - Chọn <code>xem danh sách SKU</code> của đơn (phiếu) → HT hiển thị danh sách SKU của phiếu.<br/> - Click chọn nút <code>scan</code> để mở camera quét mã barcode sản phẩm → Click lại lần nữa để đóng<br/>camera.<br/>  • User lia camera vào <code>sản phẩm</code> cần quét -&gt; HT quét mã thành công hiển thị trường cho phép nhập số lượng cần xử lý.<br/>  • User kiểm đếm <code>sản phẩm</code> và nhập số lượng cần xử lý và trường nhập.<br/>  • Trong trường hợp đơn có nhiều sản phẩm -&gt; User thao tác tương tự với các sản phẩm còn lại<br/>trong danh sách.<br/> - Click button <code>Xác nhận</code><br/>  • HT ghi nhận xuất hàng cho SP vừa quét với số lượng hàng hóa tương ứng đã nhập ở trường số lượng.<br/>  • HT sinh log xuất hàng trung chuyển cho đơn hàng khi nhập đủ số lượng sản phẩm của SKU cuối cùng trong đơn (phiếu).<br/> - Click button <code>Hoàn thành → chốt nhập → chốt seal</code> <em>(nếu xe cần chốt seal)</em> → và hoàn<br/>thành xuất hàng.</td></tr><tr id="2ceec18e-70ae-804e-8ca8-f8631c5b90d4"><td id="N\Zk" class=""><strong>HUB - XLHH</strong></td><td id="N[TS" class=""><strong>🕋 Luồng PO có gán vật chứa ( Thao tác trên vật chứa )</strong><br/>• Chọn <code>đơn hàng</code> cần thao tác → HT hiển thị <em>&quot;Danh sách Pallet gán với phiếu&quot;</em> → Quét <code>mã vật chứa</code><br/>→ HT hiển thị số lượng <code>Pallet</code> và số lượng <code>Sản phẩm</code> → Chọn <code>Xác nhận</code> <em>(Tuỳ chọn xem chi tiết &quot;Vật chứa gán với phiếu&quot;</em> và thông tin chi tiết sản phẩm có trong vật chứa ) → Chọn <code>Hoàn thành</code>để hoàn tất nhập kho.</td></tr></tbody></table>

<!-- Video Slot: Nhập kho trung chuyển -->
<div id="vid_5_2" class="video-slot" style="margin-top: 24px;"></div>

<hr id="2ceec18e-70ae-80ab-b39a-f05e8d11789e"/><p id="2ceec18e-70ae-80c5-af7f-d6b11882019c" class=""><strong>5.3. Xuất trung chuyển.</strong></p><table id="2ceec18e-70ae-80d7-8068-f659ede186aa" data-table-id="table-15" class="simple-table"><thead class="simple-table-header"><tr id="2ceec18e-70ae-8078-870b-c08f2bd66f19"><th id="tYEo" class="simple-table-header-color simple-table-header">Bộ phận thực hiện</th><th id="^Ze|" class="simple-table-header-color simple-table-header">Nội dung</th></tr></thead><tbody><tr id="2ceec18e-70ae-80ae-b179-f7c043adaade"><td id="tYEo" class=""><strong>HUB - XLHH</strong></td><td id="^Ze|" class="">- <strong><span style="border-bottom:0.05em solid">Bước 1:</span></strong> Chọn truy cập vào ứng dụng → Chọn menu &quot;Xuất hàng&quot;<br/>- <strong><span style="border-bottom:0.05em solid">Bước 2:</span></strong> Nhập và chọn <code>BKS xe cần nhập hàng</code> → HT hiển thị danh sách các đơn cần nhập vào kho trung chuyển.<br/> • Điều kiện hiển thị đơn cần nhập theo config đường đi.</td></tr><tr id="2ceec18e-70ae-8098-b9fc-edfa5e455100"><td id="tYEo" class=""><strong>HUB - XLHH</strong></td><td id="^Ze|" class=""><strong>📦 Luồng PO không gán vật chứa</strong><br/> - Chọn <code>xem danh sách SKU</code> của đơn (phiếu) → HT hiển thị danh sách SKU của phiếu.<br/> - Click chọn nút <code>scan</code> để mở camera quét mã barcode sản phẩm → Click lại lần nữa để đóng camera.<br/>  • User lia camera vào <code>sản phẩm cần quét</code> → HT quét mã thành công hiển thị trường cho phép <code>nhập số lượng</code> cần xử lý.<br/>  • User kiểm đếm <code>sản phẩm</code> và <code>nhập số lượng</code> cần xử lý.<br/>  • Trong trường hợp đơn có nhiều sản phẩm → User thao tác tương tự với các sản phẩm còn lại trong danh sách.<br/> - Click button <code>Xác nhận</code><br/>  • HT ghi nhận xuất hàng cho SP vừa quét với số lượng hàng hóa tương ứng đã nhập ở trường số lượng.<br/>  • HT sinh log xuất hàng trung chuyển cho đơn hàng khi nhập đủ số lượng sản phẩm của SKU cuối cùng trong đơn (phiếu).<br/> - Click button <code>Hoàn thành → chốt nhập → chốt seal</code> <em>(nếu xe cần chốt seal)</em> → và hoàn thành xuất hàng.</td></tr><tr id="2ceec18e-70ae-80d8-99c4-fc5dd23aa208"><td id="tYEo" class=""><strong>HUB - XLHH</strong></td><td id="^Ze|" class=""><strong>🕋 Luồng PO có gán vật chứa ( Thao tác trên vật chứa ).</strong><br/>• Chọn <code>PO cần thao tác</code> <em>( Có thể xem trước số lượng pallet và chi tiết sản phẩm )</em> → HT hiển thị <code>Danh sách Vật chứa</code> cần xử lý → <code>Quét mã vật chứa</code> → HT hiển thị <code>số </code>lượng <code>Pallet</code> và số lượng<code> &quot;Sản phẩm&quot;</code> → Chọn <code>Xác nhận</code>→ HT hiển thị danh sách các đơn hàng đã thao tác → Chọn <code>Hoàn thành</code> để hoàn tất xuất kho.</td></tr></tbody></table>

<!-- Video Slot: Xuất trung chuyển -->
<div id="vid_5_3" class="video-slot" style="margin-top: 24px;"></div>

<hr id="2ceec18e-70ae-8089-b7a8-fefab0af8724"/><h3 id="2ceec18e-70ae-80f7-b543-da5e740ce5cc" class="">6. KHO ĐÍCH.</h3><p id="2ceec18e-70ae-80c3-8a01-c4a1a0bd983d" class=""><strong>6.1. Xuất giao đơn phân phối.</strong></p><table id="2ceec18e-70ae-8008-b424-db5827a04d84" data-table-id="table-16" class="simple-table"><thead class="simple-table-header"><tr id="2ceec18e-70ae-8025-8ef0-da33b396aa86"><th id="?DaU" class="simple-table-header-color simple-table-header">Bộ phận thực hiện</th><th id="hA&lt;b" class="simple-table-header-color simple-table-header">Nội dung</th></tr></thead><tbody><tr id="2ceec18e-70ae-80e9-90ab-cae3745f6172"><td id="?DaU" class=""><strong>HUB - Tài xế | LM - Cod</strong></td><td id="hA&lt;b" class="">- <strong><span style="border-bottom:0.05em solid">Bước 1:</span></strong> Truy cập vào ứng dụng <a href="http://ghtk.co/">GHTK.Co</a><br/>- <strong><span style="border-bottom:0.05em solid">Bước 2:</span></strong> Chọn Điểm cần thao tác.<br/>- <strong><span style="border-bottom:0.05em solid">Bước 3:</span></strong> Chọn menu <code>Xuất giao/ Xuất trả</code> → HT hiển thị danh sách các đơn tài xế cần xuất giao / xuất trả.<br/> • Các đơn phân phối được gán tag <code>“Đơn Booking”</code><br/> • Tài xế thao tác nhận đơn, gửi yêu cầu cho GS duyệt.</td></tr><tr id="2ceec18e-70ae-8097-ad7b-d89ad0927b39"><td id="?DaU" class=""><strong>VHXT - GSX | LM - XLHH</strong></td><td id="hA&lt;b" class=""><strong>📌 Thao tác chung :</strong><br/> - <strong><span style="border-bottom:0.05em solid">Bước 4:</span></strong> Truy cập vào ứng dụng <a href="http://ghtk.co/">GHTK.Co</a><br/> - <strong><span style="border-bottom:0.05em solid">Bước 5:</span></strong> Chọn menu <code>Xác nhận xuất giao BBS</code> → HT hiển thị danh sách các tài xế đã gửi yêu cầu xuất giao.<br/>  • Đối với tài xế có đơn <code>Phân phối</code> đã gửi yêu cầu xuất giao chờ xác nhận → <code>HT gắn</code>.<br/>  • Bấm chọn tài xế có <code>đơn phân phối</code> → HT hiển thị danh sách các đơn thường và <code>đơn booking</code> cần xác nhận yêu cầu.<br/>  • User chọn tab <code>&quot;Đơn phân phối&quot;</code><br/>  • Chọn button <code>Scan</code> để mở popup quét <code>mã barcode</code></td></tr><tr id="2ceec18e-70ae-8009-847a-de2a138cbc4e"><td id="?DaU" class=""><strong>VHXT - GSX | LM - XLHH</strong></td><td id="hA&lt;b" class=""><strong>📦 Luồng PO không gán vật chứa</strong><br/> • User lia camera vào <code>barcode sản phẩm</code> → <code>Quét mã hợp lệ</code> → HT tự động tích chọn sản phẩm đó trong danh sách.<br/> • User quét đủ các <code>sản phẩm</code> và <code>nhập số lượng</code> trong danh sách</td></tr><tr id="2ceec18e-70ae-80de-b7a7-c7d602325dcb"><td id="?DaU" class=""><strong>VHXT - GSX | LM - XLHH</strong></td><td id="hA&lt;b" class=""><strong>🕋 Luồng PO có gán vật chứa ( Thao tác trên vật chứa )<br/></strong> • User lia camera vào barcode <code>Pallet</code> → <code>Quét mã Pallet</code> → HT hiển thị danh sách các sản phẩm cho trong <code>Pallet</code> → Quét mã <code>Sản phẩm</code> → HT tự động tích chọn sản phẩm đó trong danh sách.<br/> • User quét đủ các ‘<em>sản phẩm’ và ‘nhập số lượng’</em> trong danh sách</td></tr><tr id="2ceec18e-70ae-8017-9bf2-f680c4e61a90"><td id="?DaU" class=""><strong>VHXT - GSX | LM - XLHH</strong></td><td id="hA&lt;b" class=""><strong>📌 Thao tác chung</strong><br/> - <strong><span style="border-bottom:0.05em solid">Bước 6:</span></strong> Bấm <code>xác nhận</code> → HT ghi nhận xuất giao thành công đơn cho tài xế.<br/> - <strong><span style="border-bottom:0.05em solid">Bước 7:</span></strong> Xuất giao thành công đơn (phiếu) cho tài xế.</td></tr></tbody></table>

<!-- Video Slot: Xuất giao đơn phân phối -->
<div id="vid_6_1" class="video-slot" style="margin-top: 24px;"></div>

<hr id="2ceec18e-70ae-80c5-a199-e37c3b06c56f"/><p id="2ceec18e-70ae-807e-ad33-deda7b3080eb" class=""><strong>6.2. Giao hàng.</strong></p><table id="2ceec18e-70ae-80dc-8daa-eff73336229f" data-table-id="table-17" class="simple-table"><thead class="simple-table-header"><tr id="2ceec18e-70ae-80bd-9d96-e2acd533a516"><th id="aspe" class="simple-table-header-color simple-table-header">Bộ phận thực hiện</th><th id="h:_u" class="simple-table-header-color simple-table-header">Nội dung</th></tr></thead><tbody><tr id="2ceec18e-70ae-805f-8825-e00f7bfba61b"><td id="aspe" class=""><strong>VHXT - Tài xế | LM - Cod</strong></td><td id="h:_u" class=""><strong>📌 Thao tác chung :<br/></strong>- <strong><span style="border-bottom:0.05em solid">Bước 1:</span></strong> Vào màn <code>đang giao</code>, chọn <code>đơn/điểm</code> cần thao tác.<br/>- <strong><span style="border-bottom:0.05em solid">Bước 2:</span></strong> Bấm <code>Thao tác</code>.<br/>- <strong><span style="border-bottom:0.05em solid">Bước 3:</span></strong> Chọn hình thức <code>giao hàng một phần</code> | <code>giao toàn phần</code>.</td></tr><tr id="2ceec18e-70ae-80b5-bdb2-e8e4462c490a"><td id="aspe" class=""><strong>VHXT - Tài xế | LM - Cod</strong></td><td id="h:_u" class=""><strong>📦 Luồng giao hàng theo SKU<br/></strong> • Chụp ảnh. <code>đến điểm</code>,<br/> • Thu tiền.<br/> • Bấm. <code>Hoàn thành</code> → HT hiển thị popup <code>danh sách các sản phẩm</code> trong phiếu<br/>  + TH1: Nếu chọn <code>Giao hàng toàn bộ</code><br/>   • Tài xế/ Cod HT quét <code>mã barcode</code> các sản phẩm trong danh sách.<br/>   • Tài xế/ Cod nhập số lượng sản phẩm muốn giao → HT tự động hiển thị số lượng còn lại là số<br/>lượng sản phẩm mang về (= Tổng số lượng SP - Số lượng SP muốn giao)<br/>   • Bấm <code>Xác nhận</code> để hoàn thành giao hàng.<br/>  + TH2: Nếu chọn <code>Giao hàng toàn bộ</code><br/>   • Tài xế/ Cod quét <code>mã barcode</code> các sản phẩm trong danh sách</td></tr><tr id="2ceec18e-70ae-8092-abf4-f12934bbc3f6"><td id="aspe" class=""><strong>VHXT - Tài xế | LM - Cod</strong></td><td id="h:_u" class=""><strong>🕋 Luồng giao hàng theo Pallet<br/> </strong>- TX/Cod chọn tab <code>Đơn thu hồi Vật chứa</code><br/> - Giao hàng 1 phần :<br/>  • Tài xế/Cod quét <code>mã vật chứa</code> để giao và thu hồi → Chọn <code>sản phẩm giao</code> và <code>nhập số lượng giao 1 phần</code> → Chọn <code>các kiện</code> chuẩn bị giao 1 phần cho khách hàng → HT hiển thị thông báo <em>&quot;Bạn có chắc chắn ĐH chỉ thu tiền và hoàn trả toàn bộ số kiện hàng cho shop?&quot;</em><br/> - Giao hàng toàn phần :<br/>  • Tài xế/Cod quét <code>mã vật chứa</code> để giao và thu hồi → <code>Quét mã vật chứa</code></td></tr><tr id="2ceec18e-70ae-8008-83b0-f480fd4aa8a8"><td id="aspe" class=""><strong>VHXT - Tài xế | LM - Cod</strong></td><td id="h:_u" class=""><strong>📌 Thao tác chung:</strong><br/>- <strong><span style="border-bottom:0.05em solid">Bước 4:</span></strong> Bấm <code>Xác nhận</code> để hoàn thành giao hàng.</td></tr></tbody></table>

<!-- Video Slot: Giao hàng -->
<div id="vid_6_2" class="video-slot" style="margin-top: 24px;"></div>

<hr id="2ceec18e-70ae-80c7-b689-ce034b37c3c3"/><p id="2ceec18e-70ae-8025-b87b-e8a8cff21849" class=""><strong>6.3. Trả hàng.</strong></p><table id="2ceec18e-70ae-80aa-b861-c6afdec35654" data-table-id="table-18" class="simple-table"><thead class="simple-table-header"><tr id="2ceec18e-70ae-8013-aa7a-d4671231b7b0"><th id="Ecr|" class="simple-table-header-color simple-table-header">Bộ phận thực hiện</th><th id="GxiB" class="simple-table-header-color simple-table-header">Nội dung</th></tr></thead><tbody><tr id="2ceec18e-70ae-80fb-8788-cb28b3cc7322"><td id="Ecr|" class=""><strong>VHXT - Tài xế | LM - Cod</strong></td><td id="GxiB" class=""><strong><span style="border-bottom:0.05em solid">- Bước 1:</span></strong> Chọn <code>đơn cần trả</code> / <code>điểm cần trả </code><br/><strong><span style="border-bottom:0.05em solid">- Bước 2:</span></strong> Chọn <code> Trả hàng</code><br/><strong><span style="border-bottom:0.05em solid">- Bước 3:</span></strong> Thao tác trả hàng<br/> • Chụp ảnh<br/> • Bấm <code>Hoàn thành</code> → HT hiển thị popup danh sách các sản phẩm trong phiếu.<br/> • Tài xế/ Cod quét <code>mã barcode</code> sản phẩm trong phiếu.</td></tr></tbody></table>

<!-- Video Slot: Trả hàng -->
<div id="vid_6_3" class="video-slot" style="margin-top: 24px;"></div>

</main>
<!-- End Document Paper Container -->

<span style="font-size:14px;padding-top:2em"></span>
<script>

/* ============================================
   USER AUTHENTICATION SYSTEM
   ============================================ */

(function() {
    'use strict';

    // Google Apps Script Web App URL
    const API_URL = 'https://script.google.com/macros/s/AKfycbxaujZ9IVqRWnpAOA-HuCvDWDg46J_Q8xSZOGAbJ8IQ0DOsybDf-hWptKVl9q7ncfNS8g/exec';

    // LocalStorage keys
    const AUTH_KEY = 'ghtk_auth_user';
    const AUTH_TIMESTAMP_KEY = 'ghtk_auth_timestamp';
    const AUTH_DURATION = 7 * 24 * 60 * 60 * 1000; // 7 days in milliseconds

    // DOM elements
    let authOverlay, loginForm, formContainer, emailInput, submitBtn, errorMessage;
    let successContainer, successUserName;

    // Initialize authentication on page load
    document.addEventListener('DOMContentLoaded', function() {
        initAuthElements();
        checkLoginStatus();
    });

    /**
     * Initialize DOM element references
     */
    function initAuthElements() {
        authOverlay = document.getElementById('auth-overlay');
        loginForm = document.getElementById('login-form');
        formContainer = document.getElementById('form-container');
        emailInput = document.getElementById('user-email-input');
        submitBtn = document.getElementById('login-submit-btn');
        errorMessage = document.getElementById('auth-error-message');
        successContainer = document.getElementById('success-container');
        successUserName = document.getElementById('success-user-name');

        // Attach form submit handler
        if (loginForm) {
            loginForm.addEventListener('submit', handleLoginSubmit);
        }

        // Prevent closing modal by clicking outside
        if (authOverlay) {
            authOverlay.addEventListener('click', function(e) {
                if (e.target === authOverlay) {
                    e.stopPropagation();
                }
            });
        }

        // Prevent F12 inspect on auth overlay (basic protection)
        if (authOverlay) {
            authOverlay.addEventListener('contextmenu', function(e) {
                e.preventDefault();
            });
        }
    }

    /**
     * Check if user is already logged in
     */
    function checkLoginStatus() {
        console.log('🔐 Checking authentication status...');

        const authData = localStorage.getItem(AUTH_KEY);
        const authTimestamp = localStorage.getItem(AUTH_TIMESTAMP_KEY);

        if (authData && authTimestamp) {
            const timestamp = parseInt(authTimestamp, 10);
            const now = Date.now();
            const elapsed = now - timestamp;

            // Check if auth is still valid (within 7 days)
            if (elapsed < AUTH_DURATION) {
                const user = JSON.parse(authData);
                console.log('✅ User already authenticated:', user.userName);
                grantAccess(user);
                return;
            } else {
                console.log('⏰ Authentication expired. Please login again.');
                clearAuthData();
            }
        }

        // Not authenticated - show login modal
        console.log('🔒 User not authenticated. Showing login modal.');
        showLoginModal();
    }

    /**
     * Show login modal
     */
    function showLoginModal() {
        if (authOverlay) {
            authOverlay.style.display = 'flex';
            authOverlay.classList.remove('auth-success');

            // Focus email input after animation
            setTimeout(() => {
                if (emailInput) emailInput.focus();
            }, 400);
        }
    }

    /**
     * Handle login form submission
     */
    async function handleLoginSubmit(e) {
        e.preventDefault();

        const email = emailInput.value.trim();

        if (!email) {
            showError('Vui lòng nhập email');
            return;
        }

        // Validate email format
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(email)) {
            showError('Email không hợp lệ. Vui lòng kiểm tra lại.');
            return;
        }

        // Show loading state
        setLoadingState(true);
        hideError();

        try {
            console.log('🔐 Verifying email:', email);

            // Call API to verify user
            const url = `${API_URL}?action=verify_user&email=${encodeURIComponent(email)}`;
            const response = await fetch(url, {
                method: 'GET',
                headers: {
                    'Accept': 'application/json'
                }
            });

            if (!response.ok) {
                throw new Error(`HTTP Error: ${response.status}`);
            }

            const result = await response.json();

            console.log('📡 API Response:', result);

            if (result.authorized === true) {
                // Success - Save to localStorage
                const userData = {
                    userName: result.userName || 'User',
                    userEmail: result.userEmail || email
                };

                localStorage.setItem(AUTH_KEY, JSON.stringify(userData));
                localStorage.setItem(AUTH_TIMESTAMP_KEY, Date.now().toString());

                console.log('✅ Login successful:', userData.userName);

                // THE SUCCESS SEQUENCE - Multi-stage animation
                // Stage 1: Hide form (300ms)
                // Stage 2: Show success container with checkmark animation (1200ms)
                // Stage 3: Hold success state for user to see (1800ms)
                // Stage 4: Fade out overlay and reveal content (600ms)
                // Total: ~4 seconds of smooth, delightful UX

                showSuccessSequence(userData);

            } else {
                // Failed - Email not authorized
                const errorMsg = result.message || 'Email không có quyền truy cập. Vui lòng liên hệ quản trị viên.';
                console.log('❌ Login failed:', errorMsg);
                showError(errorMsg);
                setLoadingState(false);
            }

        } catch (error) {
            console.error('❌ Error during login:', error);
            showError('Lỗi kết nối đến server. Vui lòng thử lại sau.\n\nChi tiết: ' + error.message);
            setLoadingState(false);
        }
    }

    /**
     * Grant access to the system
     */
    function grantAccess(userData) {
        console.log('✅ Granting access to:', userData.userName);

        // Hide auth overlay with animation
        if (authOverlay) {
            authOverlay.classList.add('auth-success');

            // Remove from DOM after animation
            setTimeout(() => {
                authOverlay.style.display = 'none';
            }, 300);
        }

        // Show welcome message in console
        console.log(`👋 Chào mừng ${userData.userName}!`);

        // Optional: Display welcome banner on page
        // showWelcomeBanner(userData);
    }

    /**
     * Set loading state on submit button
     */
    function setLoadingState(isLoading) {
        if (!submitBtn) return;

        submitBtn.disabled = isLoading;

        if (isLoading) {
            submitBtn.innerHTML = '<span class="loading-spinner"></span>Đang kiểm tra...';
        } else {
            submitBtn.innerHTML = 'Truy cập';
        }
    }

    /**
     * Show error message
     */
    function showError(message) {
        if (errorMessage) {
            errorMessage.textContent = message;
            errorMessage.classList.add('show');
        }
    }

    /**
     * Hide error message
     */
    function hideError() {
        if (errorMessage) {
            errorMessage.classList.remove('show');
        }
    }

    /**
     * THE SUCCESS SEQUENCE ✨
     * Multi-stage animation for delightful UX
     */
    function showSuccessSequence(userData) {
        console.log('🎬 Starting Success Sequence...');

        // STAGE 1: Hide Form Container (300ms)
        setTimeout(() => {
            if (formContainer) {
                formContainer.style.opacity = '0';
                formContainer.style.transform = 'scale(0.95)';
                console.log('  → Stage 1: Form hidden');
            }
        }, 100);

        // STAGE 2: Show Success Container (after 400ms)
        setTimeout(() => {
            // Hide form completely
            if (formContainer) {
                formContainer.style.display = 'none';
            }

            // Show success container with user name
            if (successUserName) {
                successUserName.textContent = userData.userName;
            }

            if (successContainer) {
                successContainer.classList.add('show');
                console.log('  → Stage 2: Success animation playing');
            }
        }, 400);

        // STAGE 3: Hold Success State (1800ms for user to enjoy the animation)
        // Checkmark animation takes ~900ms, we hold for another 900ms
        setTimeout(() => {
            console.log('  → Stage 3: Holding success state...');
        }, 1200);

        // STAGE 4: Fade Out Overlay and Grant Access (after 2000ms total)
        setTimeout(() => {
            console.log('  → Stage 4: Granting access...');
            grantAccess(userData);
        }, 2000);
    }

    /**
     * Clear authentication data
     */
    function clearAuthData() {
        localStorage.removeItem(AUTH_KEY);
        localStorage.removeItem(AUTH_TIMESTAMP_KEY);
    }

    /**
     * Periodic auth check (every 5 minutes)
     * Ensures user can't bypass by staying on page
     */
    setInterval(function() {
        const authData = localStorage.getItem(AUTH_KEY);
        if (!authData) {
            console.log('⚠️ Authentication lost. Showing login modal.');
            showLoginModal();
        }
    }, 5 * 60 * 1000); // 5 minutes

    // Expose logout function globally (for testing/admin)
    window.GHTK_Logout = function() {
        clearAuthData();
        location.reload();
    };

    console.log('🔐 Authentication system initialized');
    console.log('💡 To logout, run: GHTK_Logout()');

})();

/* ============================================
   INTERACTIVE FEATURES
   ============================================ */

(function() {
    'use strict';

    // Google Apps Script Web App URL
    const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbxaujZ9IVqRWnpAOA-HuCvDWDg46J_Q8xSZOGAbJ8IQ0DOsybDf-hWptKVl9q7ncfNS8g/exec';

    // Initialize when DOM is ready
    document.addEventListener('DOMContentLoaded', function() {
        initTableOfContents();
        initScrollSpy();
        initHighlightedTerms();
        initBackToTop();
        initMobileMenu();
        // initCreateTermModal will be initialized in its own closure below
    });

    /* ====== TABLE OF CONTENTS ====== */
    function initTableOfContents() {
        const tocLinks = document.querySelectorAll('.toc-link');

        tocLinks.forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const targetId = this.getAttribute('data-target');
                const targetElement = document.getElementById(targetId);

                if (targetElement) {
                    const headerOffset = 140; // header height + padding
                    const elementPosition = targetElement.getBoundingClientRect().top;
                    const offsetPosition = elementPosition + window.pageYOffset - headerOffset;

                    window.scrollTo({
                        top: offsetPosition,
                        behavior: 'smooth'
                    });

                    // Close mobile menu after click
                    if (window.innerWidth <= 768) {
                        document.querySelector('.toc-sidebar').classList.remove('open');
                    }
                }
            });
        });
    }

    /* ====== SCROLL SPY ====== */
    function initScrollSpy() {
        const sections = document.querySelectorAll('h3[id]');
        const tocLinks = document.querySelectorAll('.toc-link');

        if (sections.length === 0) return;

        function updateActiveLink() {
            const scrollPosition = window.scrollY + 150;

            let currentSection = null;
            sections.forEach(section => {
                const sectionTop = section.offsetTop;
                if (scrollPosition >= sectionTop) {
                    currentSection = section;
                }
            });

            tocLinks.forEach(link => {
                link.classList.remove('active');
                if (currentSection && link.getAttribute('data-target') === currentSection.id) {
                    link.classList.add('active');
                }
            });
        }

        // Throttle scroll events
        let ticking = false;
        window.addEventListener('scroll', function() {
            if (!ticking) {
                window.requestAnimationFrame(function() {
                    updateActiveLink();
                    ticking = false;
                });
                ticking = true;
            }
        });

        // Initial update
        updateActiveLink();
    }

    /* ====== HIGHLIGHTED TERMS TOOLTIPS ====== */
    // Populate image URLs from database cache
    function populateImageUrls() {
        if (!window.masterDataCache || !Array.isArray(window.masterDataCache)) {
            console.log('⏳ Cache not ready yet, skipping image URL population');
            return;
        }

        const terms = document.querySelectorAll('.interactive-term');
        let populated = 0;
        
        // Debug: Show sample data
        console.log('='.repeat(80));
        console.log('🔍 DEBUG: TEXT-BASED MATCHING');
        console.log('='.repeat(80));
        console.log('📦 Cache has', window.masterDataCache.length, 'rows');
        console.log('🎯 Found', terms.length, 'interactive terms in HTML');
        console.log('');
        
        // Show first 5 terms from HTML
        console.log('📄 SAMPLE HTML TERMS (first 5):');
        Array.from(terms).slice(0, 5).forEach((term, i) => {
            console.log(`  ${i+1}. Text="${term.textContent.trim()}"`);
        });
        console.log('');
        
        // Show cache structure
        console.log('💾 CACHE STRUCTURE:');
        console.log('  First data row:', window.masterDataCache[0]);
        console.log('');
        
        // Backend returns objects with column names
        const dataRows = window.masterDataCache;
        console.log(`📊 Processing ${dataRows.length} data rows`);
        console.log('');
        
        // Show first 5 from database
        console.log('💿 SAMPLE DATABASE (first 5):');
        dataRows.slice(0, 5).forEach((row, i) => {
            const text = row.ten_the || row.C || row[2] || '(no text)';
            const id = row.id_the || row.B || row[1] || '(no id)';
            const url = row.url || row.D || row[3] || '(empty)';
            console.log(`  ${i+1}. Text="${text}" ID="${id}" URL="${url}"`);
        });
        console.log('');
        console.log('🔄 STARTING TEXT-BASED MAPPING...');
        console.log('='.repeat(80));
        
        let matched = 0;
        let notFound = 0;
        
        terms.forEach((term, index) => {
            const termText = term.textContent.trim();
            
            if (!termText) return;
            
            // MATCH BY TEXT - support multiple column name formats
            // Backend may return: {ten_the, id_the, url} or {A, B, C, D} or mixed
            const termData = dataRows.find(row => {
                const rowText = row.ten_the || row.C || row[2] || ''; // ten_the, C, or column index 2
                return rowText.trim() === termText;
            });

            if (termData) {
                matched++;
                // Set the correct ID - support multiple formats
                const termId = termData.id_the || termData.B || termData[1]; // id_the, B, or column index 1
                term.setAttribute('data-term-id', termId);

                // Set URL if available - support multiple formats
                const termUrl = termData.url || termData.D || termData[3]; // url, D, or column index 3
                if (termUrl && termUrl.trim && termUrl.trim()) {
                    term.setAttribute('data-image-url', termUrl.trim());
                    populated++;
                    if (index < 5) {
                        console.log(`✅ [${index+1}] MATCHED: "${termText}" → ID: ${termId}, URL: ${termUrl}`);
                    }
                } else {
                    if (index < 5) {
                        console.log(`⚠️ [${index+1}] MATCHED but NO URL: "${termText}" (ID: ${termId})`);
                    }
                }
            } else {
                notFound++;
                if (index < 5) {
                    console.log(`❌ [${index+1}] NOT FOUND: "${termText}"`);
                }
            }
        });
        
        console.log('');
        console.log('='.repeat(80));
        console.log(`📊 RESULTS:`);
        console.log(`   ✅ Matched: ${matched}/${terms.length}`);
        console.log(`   🖼️ With URLs: ${populated}/${terms.length}`);
        console.log(`   ❌ Not found: ${notFound}/${terms.length}`);
        console.log('='.repeat(80));
    }
    
    // Expose for external use
    window.populateImageUrls = populateImageUrls;
    
    // Function to prepare interactive terms (add class only, NO ID yet)
    function prepareInteractiveTerms() {
        console.log('🔧 PREPARING INTERACTIVE TERMS...');
        
        // Find all code tags and mark tags (potential interactive terms)
        const allElements = document.querySelectorAll('code, mark');
        let prepared = 0;
        
        allElements.forEach(element => {
            // Skip empty elements
            const text = element.textContent.trim();
            if (!text) return;
            
            // Skip if not inside table
            if (!element.closest('td, th')) {
                return;
            }
            
            // Add interactive-term class if not already present
            if (!element.classList.contains('interactive-term')) {
                element.classList.add('interactive-term');
                prepared++;
            }
        });
        
        console.log(`✅ Prepared ${prepared} interactive terms`);
        return prepared;
    }
    
    function initHighlightedTerms() {
        // STEP 1: Add interactive-term class (NO IDs yet)
        prepareInteractiveTerms();
        
        // STEP 2: Remove all interactive terms that are NOT inside table cells
        const allTerms = document.querySelectorAll('.interactive-term');
        console.log(`🔍 DEBUG: Found ${allTerms.length} total interactive terms before filtering`);
        
        let removed = 0;
        allTerms.forEach(term => {
            // Check if term is inside a table cell (td or th)
            const isInsideTable = term.closest('td, th') !== null;
            
            if (!isInsideTable) {
                console.log(`🗑️ Removing term outside table:`, {
                    id: term.getAttribute('data-term-id'),
                    text: term.textContent.trim(),
                    parent: term.parentElement?.tagName
                });
                term.remove();
                removed++;
            }
        });
        
        console.log(`✅ Removed ${removed} terms outside tables`);
        
        // Now get the remaining valid terms
        const interactiveTerms = document.querySelectorAll('.interactive-term');
        console.log(`🔍 DEBUG: Found ${interactiveTerms.length} interactive terms INSIDE tables to attach events`);
        
        let imagePreview = null;
        let hoverTimer = null;

        interactiveTerms.forEach((term, index) => {
            // Skip if already initialized (prevent duplicate event listeners)
            if (term.hasAttribute('data-events-attached')) {
                return;
            }

            if (index < 3) {
                console.log(`🔍 DEBUG: Attaching events to term ${index}:`, {
                    id: term.getAttribute('data-term-id'),
                    text: term.textContent.trim(),
                    hasUrl: !!term.getAttribute('data-image-url'),
                    url: term.getAttribute('data-image-url')
                });
            }

            // Mark as initialized
            term.setAttribute('data-events-attached', 'true');

            // Hover event - show image preview
            term.addEventListener('mouseenter', function(e) {
                console.log('🐭 MOUSEENTER EVENT FIRED!');
                
                // Clear any existing timer and preview first
                clearTimeout(hoverTimer);
                hideImagePreview();
                
                const termId = this.getAttribute('data-term-id');
                const imageUrl = this.getAttribute('data-image-url');
                
                console.log('🐭 Mouse entered term:', { termId, imageUrl, hasUrl: !!imageUrl, element: this });
                
                // Delay before showing preview
                hoverTimer = setTimeout(() => {
                    console.log('⏰ Timer fired, calling showImagePreview...');
                    showImagePreview(termId, imageUrl, e);
                }, 500); // 500ms delay
            });

            term.addEventListener('mousemove', function(e) {
                if (imagePreview && imagePreview.classList.contains('show')) {
                    positionImagePreview(imagePreview, e);
                }
            });

            term.addEventListener('mouseleave', function() {
                clearTimeout(hoverTimer);
                hideImagePreview();
            });
        });

        // Image preview functions
        function showImagePreview(termId, imageUrl, event) {
            console.log('🖼️ showImagePreview called:', { termId, imageUrl });
            
            // CRITICAL: Clear any existing preview first
            hideImagePreview();
            
            // Try to get URL from database cache first
            let finalUrl = imageUrl;
            
            try {
                // Use global cache (synchronous, safe)
                const dbData = window.masterDataCache;
                
                if (dbData && Array.isArray(dbData)) {
                    // Backend returns objects with column names: {hang_muc, id_the, ten_the, url}
                    const termData = dbData.find(row => row && (row.id_the === termId || row.B === termId));
                    if (termData) {
                        // Try 'url' field first (from backend), then 'D' (legacy)
                        finalUrl = termData.url || termData.D || imageUrl;
                        console.log('✅ Found term data:', termData);
                        console.log('✅ Using URL:', finalUrl);
                    } else {
                        console.log('⚠️ Term not found in cache:', termId);
                    }
                }
            } catch (error) {
                console.warn('Could not fetch data from cache:', error);
                // Continue with imageUrl from HTML attribute
            }

            // Early exit if no URL at all
            if (!finalUrl) {
                console.log('⚠️ No URL provided, skipping preview');
                return;
            }

            console.log('🔍 Original URL:', finalUrl);

            // Convert to direct/embed URL first (important!)
            const directUrl = getDirectImageUrl(finalUrl);
            if (directUrl !== finalUrl) {
                console.log('🔄 Converted to:', directUrl);
            }

            // Now check if the converted URL is valid
            console.log('🔍 Checking if valid media URL:', isImageUrl(directUrl));
            if (!isImageUrl(directUrl)) {
                console.log('⚠️ Not a valid media URL, skipping preview');
                return;
            }

            console.log('✅ Creating preview...');
            
            // Create preview tooltip
            imagePreview = document.createElement('div');
            imagePreview.className = 'image-preview-tooltip';
            imagePreview.innerHTML = '<div class="image-preview-loading">⏳ Đang tải...</div>';
            document.body.appendChild(imagePreview);

            // Position preview
            positionImagePreview(imagePreview, event);

            // Check if it's a Google Drive preview URL (iframe needed)
            if (directUrl.includes('drive.google.com') && directUrl.includes('/preview')) {
                console.log('📹 Loading as iframe (Google Drive - may have performance issues)...');
                const iframe = document.createElement('iframe');
                iframe.src = directUrl;
                iframe.style.width = '100%';
                iframe.style.height = '100%';
                iframe.style.border = 'none';
                iframe.allow = 'autoplay';
                
                iframe.onload = function() {
                    console.log('✅ Iframe loaded successfully');
                    if (imagePreview) {
                        imagePreview.innerHTML = '';
                        imagePreview.appendChild(iframe);
                        setTimeout(() => imagePreview.classList.add('show'), 10);
                    }
                };
                
                iframe.onerror = function() {
                    console.error('❌ Failed to load iframe:', directUrl);
                    if (imagePreview) {
                        imagePreview.innerHTML = '<div class="image-preview-error">❌ Không thể tải nội dung</div>';
                    }
                };
            // Check if it's a YouTube embed URL (iframe needed)
            } else if (directUrl.includes('youtube.com/embed/')) {
                console.log('🎬 Loading as iframe (YouTube)...');
                const iframe = document.createElement('iframe');
                iframe.src = directUrl;
                iframe.style.width = '100%';
                iframe.style.height = '100%';
                iframe.style.border = 'none';
                iframe.allow = 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture';
                iframe.allowFullscreen = true;
                
                iframe.onload = function() {
                    console.log('✅ YouTube iframe loaded successfully');
                    if (imagePreview) {
                        imagePreview.innerHTML = '';
                        imagePreview.appendChild(iframe);
                        setTimeout(() => imagePreview.classList.add('show'), 10);
                    }
                };
                
                iframe.onerror = function() {
                    console.error('❌ Failed to load YouTube iframe:', directUrl);
                    if (imagePreview) {
                        imagePreview.innerHTML = '<div class="image-preview-error">❌ Không thể tải video</div>';
                    }
                };
            } else {
                // Load as regular image
                console.log('🖼️ Loading as image...');
                
                // ⚡ INSTANT PREVIEW: Check if image is already cached
                const isCached = window.ResourceManager.isCached(directUrl);
                console.log(`📦 Cache status: ${isCached ? 'HIT ✅' : 'MISS ❌'}`);
                
                if (isCached) {
                    // Image already preloaded - show instantly!
                    console.log('⚡ INSTANT DISPLAY from cache');
                    const img = document.createElement('img');
                    img.src = directUrl;
                    img.alt = 'Preview';
                    img.style.maxWidth = '100%';
                    img.style.maxHeight = '100%';
                    img.style.objectFit = 'contain';
                    
                    if (imagePreview) {
                        imagePreview.innerHTML = '';
                        imagePreview.appendChild(img);
                        imagePreview.classList.add('show'); // Show immediately
                    }
                    return; // Done!
                }
                
                // Not cached yet - load normally with loading state
                const img = new Image();
                img.onload = function() {
                    console.log('✅ Image loaded successfully');
                    if (imagePreview) {
                        imagePreview.innerHTML = '';
                        imagePreview.appendChild(img);
                        setTimeout(() => imagePreview.classList.add('show'), 10);
                    }
                };
                img.onerror = function() {
                    console.error('❌ Failed to load image:', directUrl);
                    if (imagePreview) {
                        imagePreview.innerHTML = '<div class="image-preview-error">❌ Không thể tải hình ảnh</div>';
                    }
                };
                img.src = directUrl;
            }
        }

        function hideImagePreview() {
            // Remove from DOM
            if (imagePreview) {
                imagePreview.remove();
                imagePreview = null;
            }
            
            // CRITICAL: Cleanup any orphaned previews (safety net)
            const orphanedPreviews = document.querySelectorAll('.image-preview-tooltip');
            orphanedPreviews.forEach(preview => preview.remove());
        }

        function positionImagePreview(preview, event) {
            const padding = 20;
            let left = event.clientX + padding;
            let top = event.clientY + padding;

            // Get preview dimensions (might not be accurate before image loads)
            const previewRect = preview.getBoundingClientRect();

            // Adjust if goes off right edge
            if (left + previewRect.width > window.innerWidth - padding) {
                left = event.clientX - previewRect.width - padding;
            }

            // Adjust if goes off bottom edge
            if (top + previewRect.height > window.innerHeight - padding) {
                top = window.innerHeight - previewRect.height - padding;
            }

            // Keep within bounds
            left = Math.max(padding, left);
            top = Math.max(padding, top);

            preview.style.left = left + 'px';
            preview.style.top = top + 'px';
        }

        function isImageUrl(url) {
            if (!url) return false;
            const imageExtensions = ['.jpg', '.jpeg', '.png', '.gif', '.webp', '.svg', '.bmp'];
            const videoExtensions = ['.mp4', '.webm', '.ogg'];
            const imageHosts = ['image', 'imgur', 'cloudinary', 'postimg', 'imgbb', 'flickr', 'photobucket', 'drive.google.com', 'youtube.com', 'youtu.be'];
            const lowerUrl = url.toLowerCase();
            return imageExtensions.some(ext => lowerUrl.includes(ext)) || 
                   videoExtensions.some(ext => lowerUrl.includes(ext)) ||
                   imageHosts.some(host => lowerUrl.includes(host));
        }
        
        // Convert page URLs to direct image/video URLs
        function getDirectImageUrl(url) {
            if (!url) return url;
            
            console.log('🔍 getDirectImageUrl input:', url);
            
            // Handle YouTube URLs: https://www.youtube.com/watch?v=VIDEO_ID or https://youtu.be/VIDEO_ID
            const youtubeMatch = url.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/)([a-zA-Z0-9_-]+)/);
            if (youtubeMatch) {
                const videoId = youtubeMatch[1];
                console.log('✅ YouTube detected! Video ID:', videoId);
                const embedUrl = `https://www.youtube.com/embed/${videoId}`;
                console.log('🔄 Converted to:', embedUrl);
                return embedUrl;
            }
            
            // Handle Google Drive URLs: https://drive.google.com/file/d/FILE_ID/view?usp=sharing
            // NOTE: Google Drive không khuyến nghị cho embedding do performance và CORS issues
            const driveMatch = url.match(/drive\.google\.com\/file\/d\/([a-zA-Z0-9_-]+)/);
            if (driveMatch) {
                const fileId = driveMatch[1];
                console.log('⚠️ Google Drive detected (not recommended for performance)! File ID:', fileId);
                console.log('💡 Tip: Use Imgur or YouTube instead for better performance');
                // Use preview endpoint which works for both images and videos
                const previewUrl = `https://drive.google.com/file/d/${fileId}/preview`;
                console.log('🔄 Converted to:', previewUrl);
                return previewUrl;
            }
            
            // Handle postimg.cc page URLs: https://postimg.cc/k621yTNS
            const postimgPageMatch = url.match(/https?:\/\/postimg\.cc\/([a-zA-Z0-9]+)/);
            if (postimgPageMatch) {
                const imageId = postimgPageMatch[1];
                // Try different extensions (postimg.cc usually converts to jpg)
                return `https://i.postimg.cc/${imageId}/image.jpg`;
            }
            
            // Handle imgur page URLs: https://imgur.com/abc123
            const imgurPageMatch = url.match(/https?:\/\/imgur\.com\/([a-zA-Z0-9]+)/);
            if (imgurPageMatch && !url.includes('i.imgur.com')) {
                const imageId = imgurPageMatch[1];
                return `https://i.imgur.com/${imageId}.jpg`;
            }
            
            // Already a direct URL
            return url;
        }
    }

    // Expose initHighlightedTerms globally for re-initialization after ContentData updates
    window.initHighlightedTerms = initHighlightedTerms;

    function escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }

    /* ====== BACK TO TOP BUTTON ====== */
    function initBackToTop() {
        const backToTopButton = document.querySelector('.back-to-top');

        if (!backToTopButton) return;

        window.addEventListener('scroll', function() {
            if (window.pageYOffset > 300) {
                backToTopButton.classList.add('visible');
            } else {
                backToTopButton.classList.remove('visible');
            }
        });

        backToTopButton.addEventListener('click', function() {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        });
    }

    /* ====== MOBILE MENU TOGGLE ====== */
    function initMobileMenu() {
        const tocToggle = document.querySelector('.toc-toggle');
        const tocSidebar = document.querySelector('.toc-sidebar');

        if (!tocToggle || !tocSidebar) return;

        tocToggle.addEventListener('click', function() {
            tocSidebar.classList.toggle('open');
        });
    }

    /* ====== LAZY LOADING IMAGES ====== */
    if ('IntersectionObserver' in window) {
        const imageObserver = new IntersectionObserver(function(entries, observer) {
            entries.forEach(function(entry) {
                if (entry.isIntersecting) {
                    const img = entry.target;
                    img.src = img.dataset.src;
                    img.classList.remove('lazy');
                    imageObserver.unobserve(img);
                }
            });
        });

        document.querySelectorAll('img[data-src]').forEach(function(img) {
            imageObserver.observe(img);
        });
    }

})();

// ==========================================
// RESOURCE MANAGER - Hybrid Preload System
// ==========================================
// 🌐 Global scope to be accessible from anywhere
window.ResourceManager = {
    cache: new Set(), // Track successfully loaded URLs
    queue: [], // Queue of URLs to preload
    isProcessing: false,
    loadingMap: new Map(), // Track loading promises for deduplication
    
    /**
     * Add URL to preload queue
     * @param {string} url - URL to preload
     * @param {string} priority - 'high' or 'low' (default)
     */
    preload(url, priority = 'low') {
        if (!url || this.cache.has(url) || this.loadingMap.has(url)) {
            return; // Already cached or loading
        }
        
        // Add to queue based on priority
        if (priority === 'high') {
            this.queue.unshift(url); // Add to front
            console.log(`📌 [HIGH] Added to preload queue: ${url.substring(0, 60)}...`);
        } else {
            this.queue.push(url); // Add to back
            console.log(`📋 [LOW] Added to preload queue: ${url.substring(0, 60)}...`);
        }
        
        this.processQueue();
    },
    
    /**
     * Process preload queue (non-blocking with requestIdleCallback)
     */
    processQueue() {
        if (this.isProcessing || this.queue.length === 0) {
            return;
        }
        
        this.isProcessing = true;
        
        // ⚡ Use requestIdleCallback for non-blocking preload
        const runTask = window.requestIdleCallback || ((cb) => setTimeout(cb, 10));
        
        runTask(() => {
            const url = this.queue.shift();
            
            console.log(`⏳ Preloading (${this.cache.size} cached, ${this.queue.length} queued): ${url.substring(0, 60)}...`);
            
            const img = new Image();
            img.crossOrigin = 'anonymous'; // Enable CORS for cached images
            
            img.onload = () => {
                this.cache.add(url);
                this.loadingMap.delete(url);
                console.log(`✅ Cached: ${url.substring(0, 60)}...`);
                this.isProcessing = false;
                this.processQueue(); // Continue with next
            };
            
            img.onerror = () => {
                console.warn(`❌ Failed to cache: ${url.substring(0, 60)}...`);
                this.loadingMap.delete(url);
                this.isProcessing = false;
                this.processQueue(); // Continue with next
            };
            
            // Start loading
            this.loadingMap.set(url, img);
            img.src = url;
        });
    },
    
    /**
     * Check if URL is cached
     * @param {string} url
     * @returns {boolean}
     */
    isCached(url) {
        return this.cache.has(url);
    },
    
    /**
     * Get preload statistics
     * @returns {object}
     */
    getStats() {
        return {
            cached: this.cache.size,
            queued: this.queue.length,
            loading: this.loadingMap.size,
            isProcessing: this.isProcessing
        };
    },
    
    /**
     * Preload all images from MasterData (non-blocking)
     * @param {Array} masterData
     */
    preloadMasterDataImages(masterData) {
        if (!masterData || !Array.isArray(masterData)) return;
        
        console.log('🖼️ Scheduling images for preload from MasterData...');
        
        // ⚡ Delay preload to not block UI rendering
        setTimeout(() => {
            let count = 0;
            
            masterData.forEach(row => {
                const url = row.url || row.D; // Support both formats
                if (url && this.isImageUrl(url)) {
                    this.preload(url, 'low'); // Low priority for hover images
                    count++;
                }
            });
            
            console.log(`📊 Queued ${count} images for background preload`);
        }, 1000); // 1s delay to let UI render first
    },
    
    /**
     * Check if URL is an image
     * @param {string} url
     * @returns {boolean}
     */
    isImageUrl(url) {
        if (!url) return false;
        
        // Check common image hosting platforms
        const imageHosts = [
            'i.postimg.cc',
            'i.imgur.com',
            'drive.google.com',
            'res.cloudinary.com',
            'image.jpg',
            'image.png',
            'image.gif',
            'image.webp'
        ];
        
        return imageHosts.some(host => url.includes(host)) || 
               /\.(jpg|jpeg|png|gif|webp|svg)(\?|$)/i.test(url);
    }
};

// ==========================================
// GOOGLE SHEETS DATABASE INTEGRATION
// Dynamic Content Management System
// ==========================================
(function() {
    'use strict';
    
    // ============================================
    // CONFIGURATION - Cập nhật Google Sheet ID của bạn
    // ============================================
    const CONFIG = {
        // Backend API URL
        API_URL: 'https://script.google.com/macros/s/AKfycbxaujZ9IVqRWnpAOA-HuCvDWDg46J_Q8xSZOGAbJ8IQ0DOsybDf-hWptKVl9q7ncfNS8g/exec',
        
        // Google Sheet ID (legacy support)
        SHEET_ID: '12iEpuLYiZJAB3AyqAzVefHI3MyShiEeoUYag6gMcXH4',
        
        // Tab names (legacy support)
        SHEET_NAME: 'MasterData',
        CONTENT_DATA_SHEET: 'ContentData',
        
        // Cache timeout (10 giây)
        CACHE_DURATION: 10 * 1000
    };
    
    // ============================================
    // CACHE MANAGER
    // ============================================
    const CacheManager = {
        get(key) {
            const item = localStorage.getItem(key);
            if (!item) return null;
            
            const data = JSON.parse(item);
            if (Date.now() > data.expiry) {
                localStorage.removeItem(key);
                return null;
            }
            return data.value;
        },
        
        set(key, value, duration = CONFIG.CACHE_DURATION) {
            const data = {
                value: value,
                expiry: Date.now() + duration
            };
            localStorage.setItem(key, JSON.stringify(data));
        },
        
        clear() {
            const itemCount = localStorage.length;
            localStorage.clear();
            console.log(`🗑️ Cache cleared (${itemCount} items removed)`);
        }
    };
    
    // ============================================
    // GOOGLE SHEETS API
    // ============================================
    const GoogleSheetsAPI = {
        // Fetch data từ published Google Sheet
        async fetchSheet(sheetName) {
            const cacheKey = `sheet_${sheetName}`;
            const cached = CacheManager.get(cacheKey);
            
            if (cached) {
                console.log(`✓ Loaded ${sheetName} from cache`);
                return cached;
            }
            
            try {
                // URL format: Published as CSV
                const url = `https://docs.google.com/spreadsheets/d/${CONFIG.SHEET_ID}/gviz/tq?tqx=out:json&sheet=${sheetName}`;
                
                const response = await fetch(url);
                
                // Check response status
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const text = await response.text();
                
                // Validate response format
                if (!text || text.length < 50) {
                    throw new Error('Invalid response format');
                }
                
                // Parse Google Sheets JSON response
                // Remove the callback wrapper: google.visualization.Query.setResponse(...)
                let jsonString = text;
                if (text.startsWith('/*O_o*/')) {
                    jsonString = text.substring(text.indexOf('(') + 1, text.lastIndexOf(')'));
                } else {
                    jsonString = text.substring(47, text.length - 2);
                }
                
                const json = JSON.parse(jsonString);
                
                // Check if data exists
                if (!json.table || !json.table.rows) {
                    throw new Error('No table data found in response');
                }
                
                const data = this.parseGoogleSheetsData(json);
                
                CacheManager.set(cacheKey, data);
                console.log(`✓ Fetched ${sheetName} from Google Sheets (${data.length} rows)`);
                
                return data;
            } catch (error) {
                console.error(`✗ Error fetching ${sheetName}:`, error);
                
                // Specific error messages
                if (error.message && error.message.includes('Failed to fetch')) {
                    console.error('❌ CORS Error: Google Sheet chưa được publish to web!');
                    console.error('📋 Hướng dẫn fix:');
                    console.error('   1. Mở Google Sheet');
                    console.error('   2. File → Share → Publish to web');
                    console.error('   3. Sheet: "MasterData" | Format: "Web page"');
                    console.error('   4. ✓ Check "Automatically republish..."');
                    console.error('   5. Click "Publish" → Confirm');
                    console.error('');
                    console.error('📖 Chi tiết: Xem file PUBLISH_SHEET_GUIDE.md');
                } else {
                    console.error('Check:');
                    console.error('   1) Sheet ID correct? Current:', CONFIG.SHEET_ID);
                    console.error('   2) Sheet published to web? (File → Share → Publish to web)');
                    console.error('   3) Sheet name matches? Expected: "MasterData"');
                }
                
                return [];
            }
        },
        
        // Parse Google Sheets JSON format
        parseGoogleSheetsData(json) {
            try {
                const rows = json.table.rows;
                const cols = json.table.cols;
                
                // Get headers - Dùng col.id (tên cột thật) trước col.label (A,B,C...)
                const headers = cols.map(col => col.id || col.label || '');
                
                // Convert to array of objects
                return rows.map(row => {
                    const obj = {};
                    if (row.c) {
                        row.c.forEach((cell, index) => {
                            const header = headers[index] || `col_${index}`;
                            obj[header] = cell && cell.v !== null && cell.v !== undefined ? cell.v : '';
                        });
                    }
                    return obj;
                }).filter(row => Object.keys(row).length > 0); // Remove empty rows
            } catch (error) {
                console.error('Error parsing Google Sheets data:', error);
                return [];
            }
        }
    };
    
    // ============================================
    // CONTENT UPDATER - Enhanced with Auto-Creation
    // ============================================
    const ContentUpdater = {
        // Map category to section ID (actual Notion IDs from HTML)
        getSectionId(category) {
            const sectionMap = {
                'ONBOARD': 'faeda640-dac4-4844-9dad-9606804fd78c',
                'CẤU HÌNH': '2ceec18e-70ae-8058-841a-e0265fc85386',
                'ĐĂNG ĐƠN': '2ceec18e-70ae-8021-ba52-d0ba83f7adf6',
                'VẬN HÀNH': '2ceec18e-70ae-804c-99de-f363da316462',
                'HUB': '2ceec18e-70ae-8095-9925-c2ca73ab3c91',
                'KHO ĐÍCH': '2ceec18e-70ae-80f6-8e4e-cc86f4a0e914'
            };
            return sectionMap[category] || null;
        },

        // Create new element based on id_the pattern
        createElement(elementId, content, url, category) {
            let element = null;
            
            // Determine element type based on ID pattern
            if (elementId.startsWith('image-')) {
                // Skip image/video placeholders - removed per user request
                console.log('⏭️ Skipping image placeholder:', elementId);
                return null;
                
            } else if (elementId.startsWith('term-code-') || elementId.startsWith('term-default-') || 
                       elementId.startsWith('term-blue-') || elementId.startsWith('term-yellow-') || 
                       elementId.startsWith('term-gray-')) {
                // Create interactive term (code or mark)
                const isLink = url && url.startsWith('http');
                
                if (isLink) {
                    // Create link with code inside
                    element = document.createElement('mark');
                    element.className = this.getTermClass(elementId);
                    element.setAttribute('data-term-id', elementId);
                    
                    const code = document.createElement('code');
                    code.className = 'interactive-term';
                    code.setAttribute('data-term-id', elementId);
                    
                    const link = document.createElement('a');
                    link.href = url;
                    link.textContent = content;
                    
                    code.appendChild(link);
                    element.appendChild(code);
                } else {
                    // Create code element
                    element = document.createElement('code');
                    element.className = 'interactive-term';
                    element.id = elementId;
                    element.setAttribute('data-term-id', elementId);
                    element.textContent = content;
                }
                
            } else if (elementId.startsWith('section-')) {
                // Create section header
                element = document.createElement('h3');
                element.id = elementId;
                element.textContent = content;
                
            } else {
                // Default: create a div or span
                element = document.createElement('div');
                element.id = elementId;
                element.innerHTML = content;
            }
            
            return element;
        },

        // Get CSS class for term based on ID
        getTermClass(termId) {
            if (termId.includes('default')) return 'highlight-default interactive-term';
            if (termId.includes('blue')) return 'highlight-blue interactive-term';
            if (termId.includes('yellow')) return 'highlight-yellow interactive-term';
            if (termId.includes('gray')) return 'highlight-gray interactive-term';
            return 'interactive-term';
        },

        // Find or create insertion point for new element
        getInsertionPoint(category) {
            const sectionId = this.getSectionId(category);
            if (!sectionId) return null;
            
            // Find the section
            const section = document.getElementById(sectionId);
            if (!section) return null;
            
            // Return the parent that contains the section content
            return section.parentElement;
        },

        // Update or create element
        updateOrCreateElement(elementId, content, url, category) {
            let element = document.getElementById(elementId);
            let isNew = false;
            
            if (!element) {
                // Element doesn't exist - create it
                element = this.createElement(elementId, content, url, category);
                isNew = true;
                
                // Find insertion point
                const insertionPoint = this.getInsertionPoint(category);
                if (insertionPoint && element) {
                    insertionPoint.appendChild(element);
                    console.log(`✓ Created new element #${elementId} in ${category}`);
                    return { updated: true, created: true };
                } else {
                    console.warn(`✗ Could not create #${elementId} - no insertion point for ${category}`);
                    return { updated: false, created: false };
                }
            }
            
            // Element exists - update it
            return this.updateExistingElement(element, content, url);
        },

        // Update existing element
        updateExistingElement(element, content, url) {
            let updated = false;
            
            if (element.tagName === 'IMG') {
                if (url) {
                    element.src = url;
                    element.alt = content || element.alt;
                    updated = true;
                }
            } else if (element.tagName === 'A') {
                if (content) element.textContent = content;
                if (url) element.href = url;
                updated = true;
            } else if (element.tagName === 'VIDEO' || element.tagName === 'SOURCE') {
                if (url) {
                    element.src = url;
                    updated = true;
                }
            } else if (element.hasAttribute('data-image-id')) {
                // Button placeholder for image
                if (content) element.textContent = content;
                if (url) {
                    element.onclick = () => window.open(url, '_blank');
                    element.style.cursor = 'pointer';
                }
                updated = true;
            } else {
                // Regular text element
                if (content) {
                    element.innerHTML = content;
                    updated = true;
                }
            }
            
            return { updated, created: false };
        },

        // Main update function with auto-creation support
        updateFromMasterData(data) {
            if (!data || data.length === 0) {
                console.warn('No data to update');
                return { total: 0, updated: 0, created: 0, errors: 0 };
            }
            
            let stats = { total: 0, updated: 0, created: 0, errors: 0 };
            
            data.forEach(row => {
                // Skip header row or empty rows
                if (!row.B || row.B === 'id_the') return;
                
                const elementId = row.B;
                const content = row.C || '';
                const url = row.D || '';
                const category = row.A || '';
                
                stats.total++;
                
                try {
                    const result = this.updateOrCreateElement(elementId, content, url, category);
                    
                    if (result.created) {
                        stats.created++;
                        console.log(`✓ Created #${elementId}`);
                    } else if (result.updated) {
                        stats.updated++;
                        console.log(`✓ Updated #${elementId}`);
                    }
                } catch (error) {
                    stats.errors++;
                    console.error(`✗ Error processing #${elementId}:`, error);
                }
            });
            
            return stats;
        },
        
        // Get statistics by category
        getStats(data) {
            const stats = {};
            data.forEach(row => {
                if (row.A && row.A !== 'hang_muc') {
                    stats[row.A] = (stats[row.A] || 0) + 1;
                }
            });
            return stats;
        }
    };
    
    // ============================================
    // TABLE CONTENT UPDATER - Update table cells from ContentData
    // ============================================
    const TableContentUpdater = {
        // ============================================
        // PARSE CONTENT - Handle both plain text and Notion JSON format
        // ============================================
        parseNotionColumn(columnData) {
            // ContentData now uses manual edits in content_text and content_html
            // This parser handles backwards compatibility with Notion JSON format

            if (!columnData) return '';

            // If already a simple string (manual edit format)
            if (typeof columnData === 'string' && !columnData.includes('{')) {
                return columnData.trim();
            }

            // Legacy: Try to extract plain_text from Notion format
            const plainTextMatch = String(columnData).match(/plain_text=([^,}]+)/);
            if (plainTextMatch) {
                return plainTextMatch[1].trim();
            }

            // Fallback: Try to extract from text.content
            const textContentMatch = String(columnData).match(/content=([^,}]+)/);
            if (textContentMatch) {
                return textContentMatch[1].trim();
            }

            // Last resort: return as-is
            return String(columnData).trim();
        },
        
        // Update table cells from ContentData sheet
        updateTableContent(contentData) {
            if (!contentData || contentData.length === 0) {
                console.warn('⚠️ No ContentData to update');
                return { total: 0, updated: 0, errors: 0 };
            }
            
            let stats = { total: 0, updated: 0, errors: 0, skipped: 0 };
            
            // Skip header row if exists
            const dataRows = contentData[0]?.table_id === 'table_id' 
                ? contentData.slice(1) 
                : contentData;
            
            console.log(`🔄 Processing ${dataRows.length} ContentData rows...`);
            
            dataRows.forEach((row, index) => {
                // Expected columns: table_id | section_name | row_number | column_name | content_text
                // Note: Notion export uses "row_number" not "row_num"
                const tableId = row.table_id || row.A;
                const sectionName = row.section_name || row.B;
                const rowNumber = parseInt(row.row_number || row.row_num || row.C);
                const columnNameRaw = row.column_name || row.D;
                const contentText = row.content_text || row.E || '';
                const contentHtml = row.content_html || row.F || contentText;
                
                // Parse Notion JSON format for column name
                const columnName = this.parseNotionColumn(columnNameRaw);
                
                // Skip if missing essential data
                if (!tableId || !columnName || isNaN(rowNumber)) {
                    stats.skipped++;
                    if (index < 3) { // Log first few for debugging
                        console.log(`⚠️ Skipped row ${index + 1}: tableId=${tableId}, column="${columnName}", row=${rowNumber}`);
                    }
                    return;
                }
                
                stats.total++;
                
                try {
                    const updated = this.updateCell(tableId, rowNumber, columnName, contentHtml);
                    if (updated) {
                        stats.updated++;
                    }
                } catch (error) {
                    stats.errors++;
                    console.error(`✗ Error updating ${tableId} row ${rowNumber} col ${columnName}:`, error);
                }
            });
            
            console.log(`📊 ContentData Stats:`, stats);
            return stats;
        },
        
        // Update a specific table cell
        updateCell(tableId, rowNumber, columnName, content) {
            // Find table by original Notion UUID (simplified - no conversion)
            const table = document.getElementById(tableId);

            if (!table) {
                // Debug: Show warning once per table
                if (!this._warnedTables) this._warnedTables = new Set();
                if (!this._warnedTables.has(tableId)) {
                    console.warn(`⚠️ Table not found: ${tableId}`);
                    this._warnedTables.add(tableId);
                }
                return false;
            }

            // Find the column index by matching header text
            const headers = table.querySelectorAll('thead th');
            let columnIndex = -1;
            
            headers.forEach((th, index) => {
                const headerText = th.textContent.trim();
                if (headerText === columnName || th.querySelector('strong')?.textContent.trim() === columnName) {
                    columnIndex = index;
                }
            });
            
            if (columnIndex === -1) {
                // Debug: Show available headers
                const availableHeaders = Array.from(headers).map(th => th.textContent.trim());
                console.warn(`⚠️ Column not found: "${columnName}" in table ${tableId}`);
                console.warn(`   Available headers: ${JSON.stringify(availableHeaders)}`);
                return false;
            }
            
            // Find the row in tbody (rowNumber is 1-based, but we use 0-based index)
            const rows = table.querySelectorAll('tbody tr');
            const targetRow = rows[rowNumber - 1];
            
            if (!targetRow) {
                console.warn(`⚠️ Row ${rowNumber} not found in table ${tableId}`);
                return false;
            }
            
            // Get the cell
            const cells = targetRow.querySelectorAll('td');
            const targetCell = cells[columnIndex];
            
            if (!targetCell) {
                console.warn(`⚠️ Cell not found at row ${rowNumber}, column ${columnIndex} in table ${tableId}`);
                return false;
            }
            
            // Update cell content
            // Decode HTML entities first (backend may escape HTML)
            const decodedContent = this.decodeHtmlEntities(content);
            targetCell.innerHTML = decodedContent;

            return true;
        },
        
        // Decode HTML entities (backend may escape HTML)
        decodeHtmlEntities(html) {
            if (!html) return '';

            // Step 1: Fix CSV-style double quotes ("" -> ")
            let cleaned = html.replace(/""/g, '"');

            // Step 2: Decode HTML entities
            const textarea = document.createElement('textarea');
            textarea.innerHTML = cleaned;
            let decoded = textarea.value;

            // Step 3: Convert line breaks to <br> if not already present
            // Only convert \n that are NOT already part of <br> tags
            if (!decoded.includes('<br>') && !decoded.includes('<br/>')) {
                decoded = decoded.replace(/\n/g, '<br>');
            }

            return decoded;
        },

        // Get statistics about tables
        getTableStats() {
            const tables = document.querySelectorAll('table[id]');
            const stats = {
                totalTables: tables.length,
                tableIds: []
            };

            tables.forEach(table => {
                const rows = table.querySelectorAll('tbody tr').length;
                const cols = table.querySelectorAll('thead th').length;
                stats.tableIds.push({
                    id: table.id,
                    rows: rows,
                    cols: cols
                });
            });

            return stats;
        }
    };
    
    // ============================================
    // VIDEO LOADER - Load and render videos
    // ============================================
    const VideoLoader = {
        async loadVideos() {
            if (!CONFIG.API_URL) {
                console.warn('⚠️ API_URL not configured');
                return [];
            }
            
            console.log('🎥 Loading videos from backend...');
            
            try {
                const response = await fetch(CONFIG.API_URL);
                const result = await response.json();
                
                if (result.success && result.data) {
                    console.log(`✅ Received ${result.data.length} videos from API`);
                    return result.data;
                } else {
                    console.warn('⚠️ No video data received');
                    return [];
                }
            } catch (error) {
                console.error('✗ Error loading videos:', error);
                return [];
            }
        },
        
        renderVideos(videos) {
            let rendered = 0;
            let skipped = 0;
            
            console.log('📹 Starting video rendering...');
            console.log(`   Total videos to render: ${videos.length}`);
            
            videos.forEach((video, index) => {
                const elementId = video.Element_ID;
                
                if (!elementId) {
                    console.warn(`⚠️ Video ${index}: Missing Element_ID`);
                    skipped++;
                    return;
                }
                
                const slot = document.getElementById(elementId);
                
                if (!slot) {
                    console.warn(`⚠️ Video ${index}: Slot not found for ID: ${elementId}`);
                    skipped++;
                    return;
                }
                
                let videoUrl = (video.Video_URL || '').trim();
                const hangMuc = video.Hang_Muc || '';
                const thumbnail = video.Thumbnail || '';
                
                // AUTO-DETECT PLATFORM if missing or unknown
                let platform = (video.platform || '').trim().toLowerCase();
                
                if (!platform || platform === 'unknown') {
                    // Auto-detect from URL
                    if (videoUrl.includes('cloudinary.com')) {
                        platform = 'cloudinary';
                    } else if (videoUrl.includes('streamable.com')) {
                        platform = 'streamable';
                    } else if (videoUrl.includes('youtube.com') || videoUrl.includes('youtu.be')) {
                        platform = 'youtube';
                    } else if (videoUrl.includes('vimeo.com')) {
                        platform = 'vimeo';
                    } else if (videoUrl.match(/\.(mp4|webm|ogg)(\?|$)/i)) {
                        platform = 'native';
                    } else {
                        platform = 'iframe'; // Generic fallback
                    }
                    console.log(`🔍 Auto-detected platform: ${platform} for URL: ${videoUrl.substring(0, 50)}...`);
                }
                
                console.log(`🎬 Video ${index}:`, {
                    elementId,
                    hangMuc,
                    platform,
                    thumbnail: thumbnail ? 'Yes' : 'No',
                    url: videoUrl.substring(0, 60) + '...'
                });
                
                // 🚀 PRELOAD: Get thumbnail and preload with HIGH priority
                const finalThumbnail = thumbnail || this.getDefaultThumbnail(videoUrl, platform);
                if (finalThumbnail && !finalThumbnail.startsWith('data:')) {
                    window.ResourceManager.preload(finalThumbnail, 'high');
                }
                
                // CREATE CLICK-TO-LOAD CARD
                const cardHTML = this.createVideoCard(videoUrl, platform, finalThumbnail, hangMuc);
                
                if (cardHTML) {
                    slot.innerHTML = cardHTML;
                    rendered++;
                    
                    // ATTACH CLICK EVENT
                    const card = slot.querySelector('.video-card');
                    if (card) {
                        card.addEventListener('click', () => {
                            this.loadVideo(card, videoUrl, platform);
                        });
                    }
                    
                    console.log(`   ✅ Rendered card to slot: ${elementId}`);
                }
            });
            
            console.log('');
            console.log('📊 VIDEO RENDERING SUMMARY:');
            console.log(`   ✅ Rendered: ${rendered}`);
            console.log(`   ⚠️ Skipped: ${skipped}`);
            console.log(`   📦 Total: ${videos.length}`);
            
            return rendered;
        },
        
        // CREATE VIDEO CARD (Placeholder with GHTK branding)
        createVideoCard(videoUrl, platform, thumbnail, title) {
            // Use thumbnail if provided, otherwise gradient will show
            const thumbStyle = thumbnail 
                ? `background-image: url('${thumbnail}');` 
                : '';
            
            const hasThumb = thumbnail ? 'data-has-thumb="true"' : '';
            
            return `
                <div class="video-card" ${hasThumb} data-video-url="${videoUrl}" data-platform="${platform}">
                    <!-- Background: Thumbnail or Gradient -->
                    <div class="video-poster" style="${thumbStyle}"></div>
                    
                    <!-- Dark overlay for logo visibility -->
                    <div class="video-overlay"></div>
                    
                    <!-- GHTK Logo as Play Button -->
                    <div class="play-button-ghtk">
                        <img src="https://i.postimg.cc/sDPS4wnk/GHTK-Logo-RGB.webp" 
                             alt="GHTK Play" 
                             onerror="this.style.display='none'">
                    </div>
                    
                    ${title ? `<div class="video-title">${title}</div>` : ''}
                </div>
            `;
        },
        
        // GET DEFAULT THUMBNAIL based on platform
        getDefaultThumbnail(videoUrl, platform) {
            switch (platform) {
                case 'youtube':
                    const ytId = this.extractYouTubeId(videoUrl);
                    return ytId ? `https://img.youtube.com/vi/${ytId}/maxresdefault.jpg` : 'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1920 1080"%3E%3Crect fill="%23000" width="1920" height="1080"/%3E%3C/svg%3E';
                
                case 'vimeo':
                    // Vimeo requires API call for thumbnail, use placeholder
                    return 'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1920 1080"%3E%3Crect fill="%23000" width="1920" height="1080"/%3E%3Ctext x="50%25" y="50%25" fill="%23fff" font-size="48" text-anchor="middle" dy=".3em"%3EVimeo Video%3C/text%3E%3C/svg%3E';
                
                default:
                    // Generic black placeholder
                    return 'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1920 1080"%3E%3Crect fill="%23000" width="1920" height="1080"/%3E%3Ctext x="50%25" y="50%25" fill="%23fff" font-size="48" text-anchor="middle" dy=".3em"%3EClick to Play%3C/text%3E%3C/svg%3E';
            }
        },
        
        // LOAD VIDEO (Replace card with actual video iframe/tag)
        loadVideo(card, videoUrl, platform) {
            // Prevent multiple clicks
            if (card.classList.contains('loading') || card.classList.contains('loaded')) {
                return;
            }
            
            card.classList.add('loading');
            console.log(`🎥 Loading video: ${platform} - ${videoUrl.substring(0, 50)}...`);
            
            let embedHTML = '';
            
            // RENDER BASED ON PLATFORM
            switch (platform) {
                case 'streamable':
                    const streamableId = this.extractStreamableId(videoUrl);
                    if (streamableId) {
                        embedHTML = `
                            <iframe src="https://streamable.com/e/${streamableId}?autoplay=1" 
                                    frameborder="0" 
                                    allowfullscreen 
                                    allow="autoplay; fullscreen">
                            </iframe>
                        `;
                    }
                    break;
                
                case 'cloudinary':
                    if (videoUrl.includes('player.cloudinary.com')) {
                        // Add autoplay parameter
                        const autoplayUrl = videoUrl.includes('?') 
                            ? `${videoUrl}&autoplay=true` 
                            : `${videoUrl}?autoplay=true`;
                        embedHTML = `
                            <iframe src="${autoplayUrl}" 
                                    frameborder="0" 
                                    allowfullscreen 
                                    allow="autoplay; fullscreen; encrypted-media; picture-in-picture">
                            </iframe>
                        `;
                    } else {
                        embedHTML = `
                            <video controls autoplay playsinline>
                                <source src="${videoUrl}" type="video/mp4">
                            </video>
                        `;
                    }
                    break;
                
                case 'youtube':
                    const youtubeId = this.extractYouTubeId(videoUrl);
                    if (youtubeId) {
                        embedHTML = `
                            <iframe src="https://www.youtube.com/embed/${youtubeId}?autoplay=1" 
                                    frameborder="0" 
                                    allowfullscreen
                                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture">
                            </iframe>
                        `;
                    }
                    break;
                
                case 'vimeo':
                    const vimeoId = this.extractVimeoId(videoUrl);
                    if (vimeoId) {
                        embedHTML = `
                            <iframe src="https://player.vimeo.com/video/${vimeoId}?autoplay=1" 
                                    frameborder="0" 
                                    allowfullscreen
                                    allow="autoplay; fullscreen; picture-in-picture">
                            </iframe>
                        `;
                    }
                    break;
                
                case 'native':
                    embedHTML = `
                        <video controls autoplay playsinline>
                            <source src="${videoUrl}" type="video/mp4">
                        </video>
                    `;
                    break;
                
                case 'iframe':
                default:
                    // Add autoplay if possible
                    const autoplayUrl = videoUrl.includes('?') 
                        ? `${videoUrl}&autoplay=1` 
                        : `${videoUrl}?autoplay=1`;
                    embedHTML = `
                        <iframe src="${autoplayUrl}" 
                                frameborder="0" 
                                allowfullscreen
                                allow="autoplay; fullscreen; encrypted-media; picture-in-picture">
                        </iframe>
                    `;
                    break;
            }
            
            if (embedHTML) {
                // Small delay for smooth transition
                setTimeout(() => {
                    card.innerHTML = embedHTML;
                    card.classList.remove('loading');
                    card.classList.add('loaded');
                    console.log(`   ✅ Video loaded successfully`);
                }, 300);
            } else {
                console.error(`   ❌ Failed to generate embed HTML`);
                card.classList.remove('loading');
            }
        },
        
        // Helper: Extract Streamable ID from URL
        extractStreamableId(url) {
            const match = url.match(/streamable\.com\/(?:e\/)?([a-zA-Z0-9]+)/);
            return match ? match[1] : null;
        },
        
        // Helper: Extract YouTube ID from URL
        extractYouTubeId(url) {
            const match = url.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/)([^&?]+)/);
            return match ? match[1] : null;
        },
        
        // Helper: Extract Vimeo ID from URL
        extractVimeoId(url) {
            const match = url.match(/vimeo\.com\/(\d+)/);
            return match ? match[1] : null;
        },
        
        // ============================================
        // STATIC MODE: Render videos from pre-built data
        // ============================================
        renderVideosFromStatic(videoData) {
            if (!videoData || videoData.length === 0) {
                console.log('ℹ️ No video data to render');
                return 0;
            }
            
            let rendered = 0;
            
            videoData.forEach(video => {
                const element = document.getElementById(video.Element_ID);
                if (element) {
                    this.createVideoCard(element, video);
                    rendered++;
                }
            });
            
            return rendered;
        }
    };
    
    // ============================================
    // MAIN LOADER - Load all data sources
    // ============================================
    const SheetLoader = {
        async init() {
            // ============================================================================
            // STATIC DATA MODE - Load from pre-built data file (no API calls)
            // ============================================================================
            if (window.STATIC_DATA) {
                console.log('📦 Loading from STATIC DATA (pre-built)...');
                console.log('   Version:', window.STATIC_DATA.version);
                console.log('   Generated:', window.STATIC_DATA.generatedAt);
                console.log('   Age:', window.STATIC_DATA.getStats().age);
                
                try {
                    // 1. Load MasterData from static
                    window.masterDataCache = window.STATIC_DATA.masterData;
                    console.log(`✅ MasterData: ${window.STATIC_DATA.masterData.length} items loaded (static)`);
                    
                    // ⚡ RENDER FIRST: Initialize UI immediately
                    setTimeout(() => {
                        if (window.populateImageUrls) {
                            window.populateImageUrls();
                        }
                    }, 50); // Ultra fast render
                    
                    // 🚀 PRELOAD LATER: Start background preload
                    window.ResourceManager.preloadMasterDataImages(window.STATIC_DATA.masterData);
                    
                    // 2. Load ContentData from static
                    const contentStats = TableContentUpdater.updateTableContent(window.STATIC_DATA.contentData);
                    console.log(`✅ ContentData: ${contentStats.updated}/${contentStats.total} cells updated (static)`);
                    
                    // 3. Load VideoData from static
                    if (window.STATIC_DATA.videoData && window.STATIC_DATA.videoData.length > 0) {
                        const rendered = VideoLoader.renderVideosFromStatic(window.STATIC_DATA.videoData);
                        console.log(`✅ Videos: ${rendered} rendered (static)`);
                    }
                    
                    // 4. Log ResourceManager statistics
                    const stats = window.ResourceManager.getStats();
                    console.log('');
                    console.log('📊 RESOURCE MANAGER STATISTICS:');
                    console.log(`   ✅ Cached: ${stats.cached} images`);
                    console.log(`   ⏳ Queued: ${stats.queued} remaining`);
                    console.log(`   🔄 Loading: ${stats.loading} in progress`);
                    console.log(`   📈 Status: ${stats.isProcessing ? 'Processing' : 'Idle'}`);
                    console.log('');
                    console.log('⚡ PERFORMANCE: No API calls → Ultra fast load!');
                    
                    this.showNotification('✅ Đã load tất cả nội dung (static)', 'success');
                    return;
                    
                } catch (error) {
                    console.error('✗ Error loading static content:', error);
                    console.warn('⚠️ Falling back to API mode...');
                    // Fall through to API mode
                }
            }
            
            // ============================================================================
            // FALLBACK: DYNAMIC API MODE (original logic)
            // ============================================================================
            if (!CONFIG.API_URL) {
                console.warn('⚠️ API_URL not configured. Using static content.');
                window.masterDataCache = [];
                return;
            }
            
            console.log('🔄 Loading content from backend API...');
            
            try {
                // 1. Load MasterData for hover preview
                console.log('📚 Loading MasterData...');
                const masterResponse = await fetch(`${CONFIG.API_URL}?action=get_master_data`);
                const masterResult = await masterResponse.json();
                
                if (masterResult.success && masterResult.data) {
                    window.masterDataCache = masterResult.data;
                    console.log(`✅ MasterData: ${masterResult.data.length} items loaded`);
                    
                    // ⚡ RENDER FIRST: Initialize UI immediately
                    setTimeout(() => {
                        if (window.populateImageUrls) {
                            window.populateImageUrls();
                        }
                    }, 100); // Quick render, don't wait for validation
                    
                    // 🚀 PRELOAD LATER: Start background preload after UI is ready
                    window.ResourceManager.preloadMasterDataImages(masterResult.data);
                } else {
                    console.warn('⚠️ No MasterData found');
                    window.masterDataCache = [];
                }
                
                // 2. Load ContentData for table cells
                console.log('📊 Loading ContentData...');
                const contentResponse = await fetch(`${CONFIG.API_URL}?action=get_content_data`);
                const contentResult = await contentResponse.json();
                
                if (contentResult.success && contentResult.data) {
                    const contentStats = TableContentUpdater.updateTableContent(contentResult.data);
                    console.log(`✅ ContentData: ${contentStats.updated}/${contentStats.total} cells updated`);

                    // Re-initialize hover events for newly added content
                    if (typeof initHighlightedTerms === 'function') {
                        console.log('🔄 Re-initializing hover events for updated content...');
                        initHighlightedTerms();
                    }
                } else {
                    console.log('ℹ️ No ContentData found');
                }
                
                // 3. Load VideoData and render videos
                console.log('🎥 Loading VideoData...');
                const videos = await VideoLoader.loadVideos();
                if (videos && videos.length > 0) {
                    const rendered = VideoLoader.renderVideos(videos);
                    console.log(`✅ Videos: ${rendered} rendered`);
                } else {
                    console.log('ℹ️ No videos found');
                }
                
                // 4. Log ResourceManager statistics
                const stats = window.ResourceManager.getStats();
                console.log('');
                console.log('📊 RESOURCE MANAGER STATISTICS:');
                console.log(`   ✅ Cached: ${stats.cached} images`);
                console.log(`   ⏳ Queued: ${stats.queued} remaining`);
                console.log(`   🔄 Loading: ${stats.loading} in progress`);
                console.log(`   📈 Status: ${stats.isProcessing ? 'Processing' : 'Idle'}`);
                
                this.showNotification('✅ Đã load tất cả nội dung', 'success');
                
            } catch (error) {
                console.error('✗ Error loading content:', error);
                this.showNotification('⚠️ Lỗi khi load nội dung - Xem Console', 'error');
            }
        },
        
        // Show notification to user
        showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 100px;
                right: 20px;
                background: ${type === 'success' ? '#2ECC71' : type === 'error' ? '#E74C3C' : '#3498DB'};
                color: white;
                padding: 1rem 1.5rem;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.2);
                z-index: 10000;
                font-weight: 600;
                animation: slideIn 0.3s ease;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        },
        
        // Manual refresh button
        addRefreshButton() {
            const button = document.createElement('button');
            button.innerHTML = '🔄 Refresh Content';
            button.style.cssText = `
                position: fixed;
                bottom: 20px;
                right: 20px;
                background: linear-gradient(135deg, #2ECC71 0%, #27AE60 100%);
                color: white;
                border: none;
                padding: 0.75rem 1.5rem;
                border-radius: 25px;
                font-weight: 600;
                cursor: pointer;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                z-index: 9999;
                transition: all 0.3s ease;
            `;
            
            button.addEventListener('click', async () => {
                button.disabled = true;
                button.innerHTML = '⏳ Đang tải...';
                CacheManager.clear();
                await this.init();
                button.disabled = false;
                button.innerHTML = '🔄 Refresh Content';
            });
            
            button.addEventListener('mouseenter', () => {
                button.style.transform = 'translateY(-2px)';
                button.style.boxShadow = '0 6px 16px rgba(0,0,0,0.2)';
            });
            
            button.addEventListener('mouseleave', () => {
                button.style.transform = 'translateY(0)';
                button.style.boxShadow = '0 4px 12px rgba(0,0,0,0.15)';
            });
            
            document.body.appendChild(button);
        }
    };
    
    // ============================================
    // AUTO-INITIALIZE
    // ============================================
    
    // Check for reload parameter to force clear cache
    function checkReloadParameter() {
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get('reload') === 'true') {
            console.log('🔄 Reload parameter detected - clearing cache...');
            CacheManager.clear();
            // Remove reload param from URL to avoid repeated reloads
            urlParams.delete('reload');
            const newUrl = window.location.pathname + (urlParams.toString() ? '?' + urlParams.toString() : '');
            window.history.replaceState({}, '', newUrl);
        }
    }
    
    // Test Mode: Add ?test=true to URL to enable test image
    function enableTestMode() {
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get('test') === 'true') {
            console.log('🧪 TEST MODE ENABLED');
            const testImageUrl = 'https://i.postimg.cc/SsrBk5Jg/6201954590022896843.jpg';
            const terms = document.querySelectorAll('.interactive-term[data-term-id]');
            
            setTimeout(() => {
                terms.forEach(term => {
                    term.setAttribute('data-image-url', testImageUrl);
                });
                console.log(`✅ Added test image URL to ${terms.length} terms`);
                console.log(`📸 Test image: ${testImageUrl}`);
                console.log('👉 Hover over any colored text to see image preview!');
            }, 1000);
        }
    }
    
    // Load content when DOM is ready
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', () => {
            checkReloadParameter();
            SheetLoader.init();
            // Removed: SheetLoader.addRefreshButton();
            enableTestMode();
        });
    } else {
        checkReloadParameter();
        SheetLoader.init();
        // Removed: SheetLoader.addRefreshButton();
        enableTestMode();
    }
    
    // Expose API for manual control
    window.SheetDB = {
        refresh: () => {
            CacheManager.clear();
            return SheetLoader.init().then(() => {
                // Re-populate image URLs after refresh
                if (window.populateImageUrls) {
                    setTimeout(() => window.populateImageUrls(), 500);
                }
            });
        },
        clearCache: () => CacheManager.clear(),
        config: CONFIG,
        getMasterData: async () => {
            // Return cached data first if available
            if (window.masterDataCache && Array.isArray(window.masterDataCache)) {
                return window.masterDataCache;
            }
            // Check if configured
            if (!CONFIG.SHEET_ID || CONFIG.SHEET_ID === 'YOUR_SHEET_ID_HERE') {
                console.warn('Sheet ID not configured');
                return [];
            }
            // Fetch from API
            const data = await GoogleSheetsAPI.fetchSheet(CONFIG.SHEET_NAME);
            return data || [];
        },
        updateFromData: (data) => {
            return ContentUpdater.updateFromMasterData(data);
        },
        getStats: (data) => {
            return ContentUpdater.getStats(data);
        }
    };
    
    // Initialize global cache
    window.masterDataCache = [];
    
})();

// ==========================================
// SMOOTH SCROLL & NAVIGATION FUNCTIONALITY
// ==========================================
(function() {
    'use strict';
    
    // Get navigation elements
    const mainNav = document.querySelector('#main-navigation');
    const navLinks = document.querySelectorAll('#main-navigation a');
    
    if (!mainNav || navLinks.length === 0) return;
    
    // Smooth scroll to sections
    navLinks.forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            
            // Remove active class from all links
            navLinks.forEach(l => l.classList.remove('active'));
            
            // Add active class to clicked link
            this.classList.add('active');
            
            // Get target section
            const targetId = this.getAttribute('href');
            const targetSection = document.querySelector(targetId);
            
            if (targetSection) {
                // Calculate offset for fixed nav
                const navHeight = mainNav.offsetHeight;
                const targetPosition = targetSection.getBoundingClientRect().top + window.pageYOffset - navHeight - 20;
                
                // Smooth scroll
                window.scrollTo({
                    top: targetPosition,
                    behavior: 'smooth'
                });
            }
        });
    });
    
    // Highlight active section on scroll
    let ticking = false;
    
    function updateActiveNav() {
        const sections = document.querySelectorAll('h3[id^="section-"]');
        const navHeight = mainNav ? mainNav.offsetHeight : 0;
        const scrollPosition = window.pageYOffset + navHeight + 100;
        
        sections.forEach(section => {
            const sectionTop = section.offsetTop;
            const sectionBottom = sectionTop + section.offsetHeight;
            const sectionId = section.getAttribute('id');
            
            if (scrollPosition >= sectionTop && scrollPosition < sectionBottom) {
                navLinks.forEach(link => {
                    link.classList.remove('active');
                    if (link.getAttribute('href') === '#' + sectionId) {
                        link.classList.add('active');
                    }
                });
            }
        });
        
        ticking = false;
    }
    
    function requestUpdateNav() {
        if (!ticking) {
            window.requestAnimationFrame(updateActiveNav);
            ticking = true;
        }
    }
    
    window.addEventListener('scroll', requestUpdateNav);
    
    // Initial active section
    updateActiveNav();
    
    /* ====== CREATE TERM MODAL ====== */
    function initCreateTermModal() {
        const createBtn = document.getElementById('create-term-btn');
        const modal = document.getElementById('create-term-modal');
        const closeBtn = document.getElementById('modal-close-btn');
        const cancelBtn = document.getElementById('cancel-btn');
        const submitBtn = document.getElementById('submit-btn');
        const hangMucSelect = document.getElementById('hang-muc-select');
        const contentArea = document.getElementById('content-area');
        const selectedTextInfo = document.getElementById('selected-text-info');
        const selectedTextDisplay = document.getElementById('selected-text-display');
        const idTheInput = document.getElementById('id-the-input');
        const tenTheInput = document.getElementById('ten-the-input');
        const urlInput = document.getElementById('url-input');
        const uploadArea = document.getElementById('upload-area');
        const fileInput = document.getElementById('file-input');
        const uploadPreview = document.getElementById('upload-preview');
        const previewImage = document.getElementById('preview-image');
        const fileName = document.getElementById('file-name');
        const removeFileBtn = document.getElementById('remove-file');
        const uploadProgress = document.getElementById('upload-progress');
        const progressFill = document.getElementById('progress-fill');
        const uploadStatus = document.getElementById('upload-status');

        let selectedText = '';
        let currentHangMuc = '';
        let uploadedFile = null;

        // Section mapping - match với sections trong HTML
        const sectionMap = {
            '1. ONBOARD': 'section-onboard',
            '2. CẤU HÌNH': 'section-dang-don',
            '3. ĐĂNG ĐƠN': 'section-dang-don-3',
            '4. VẬN HÀNH.': 'section-van-hanh',
            '5. HUB.': 'section-hub',
            '6. KHO ĐÍCH.': 'section-kho-dich'
        };

        // Open modal
        createBtn.addEventListener('click', () => {
            modal.classList.add('active');
            resetForm();
        });

        // Close modal
        const closeModal = () => {
            modal.classList.remove('active');
            resetForm();
        };

        closeBtn.addEventListener('click', closeModal);
        cancelBtn.addEventListener('click', closeModal);
        
        // Close on backdrop click
        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                closeModal();
            }
        });

        // Hạng mục selection
        hangMucSelect.addEventListener('change', (e) => {
            currentHangMuc = e.target.value;
            if (currentHangMuc) {
                loadSectionContent(currentHangMuc);
            } else {
                contentArea.innerHTML = 'Vui lòng chọn hạng mục để hiển thị nội dung...';
                contentArea.classList.remove('has-selection');
            }
            resetSelection();
        });

        // Load section content
        function loadSectionContent(hangMuc) {
            const sectionId = sectionMap[hangMuc];
            if (!sectionId) {
                contentArea.innerHTML = '<p style="color: red;">Không tìm thấy nội dung cho hạng mục này.</p>';
                return;
            }

            const sectionElement = document.getElementById(sectionId);
            if (!sectionElement) {
                contentArea.innerHTML = '<p style="color: red;">Không tìm thấy section trong trang.</p>';
                return;
            }

            // Get section content (exclude heading)
            const heading = sectionElement.querySelector('h3');
            let content = sectionElement.innerHTML;
            
            // Remove heading from content
            if (heading) {
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = content;
                const headingClone = tempDiv.querySelector('h3');
                if (headingClone) {
                    headingClone.remove();
                }
                content = tempDiv.innerHTML;
            }

            // Display content (first 3000 characters to avoid too much text)
            const truncatedContent = content.substring(0, 3000);
            contentArea.innerHTML = truncatedContent + (content.length > 3000 ? '...' : '');
            contentArea.classList.remove('has-selection');

            // Enable text selection
            enableTextSelection();
        }

        // Enable text selection in content area
        function enableTextSelection() {
            contentArea.addEventListener('mouseup', handleTextSelection);
            contentArea.addEventListener('touchend', handleTextSelection);
        }

        // Handle text selection
        function handleTextSelection() {
            const selection = window.getSelection();
            const text = selection.toString().trim();

            if (text.length > 0 && text.length <= 100) {
                selectedText = text;
                selectedTextDisplay.textContent = text;
                selectedTextInfo.classList.add('active');
                contentArea.classList.add('has-selection');

                // Auto-fill form fields
                tenTheInput.value = text;
                idTheInput.value = generateId(text, currentHangMuc);
                
                // Enable submit button if URL is provided
                updateSubmitButton();
            }
        }

        // Generate ID from text
        function generateId(text, hangMuc) {
            // Remove dấu
            const normalized = text
                .normalize('NFD')
                .replace(/[\u0300-\u036f]/g, '')
                .toUpperCase()
                .replace(/[^A-Z0-9\s]/g, '')
                .replace(/\s+/g, '_')
                .substring(0, 30);

            // Prefix from hạng mục
            const prefixMap = {
                '1. ONBOARD': 'OB',
                '2. CẤU HÌNH': 'CH',
                '3. ĐĂNG ĐƠN': 'DD',
                '4. VẬN HÀNH.': 'VH',
                '5. HUB.': 'HUB',
                '6. KHO ĐÍCH.': 'KD'
            };

            const prefix = prefixMap[hangMuc] || 'TERM';
            return `${prefix}_${normalized}`;
        }

        // File upload handlers
        uploadArea.addEventListener('click', () => fileInput.click());
        
        fileInput.addEventListener('change', handleFileSelect);
        
        // Drag and drop
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });
        
        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });
        
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                fileInput.files = files;
                handleFileSelect();
            }
        });
        
        removeFileBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            resetUpload();
        });

        // URL input validation
        urlInput.addEventListener('input', updateSubmitButton);

        function updateSubmitButton() {
            const hasText = tenTheInput.value.trim().length > 0;
            const hasUrl = urlInput.value.trim().length > 0;
            submitBtn.disabled = !(hasText && hasUrl);
        }

        // Submit form
        submitBtn.addEventListener('click', async () => {
            const formData = {
                hang_muc: currentHangMuc,
                id_the: idTheInput.value,
                ten_the: tenTheInput.value,
                url: urlInput.value
            };

            console.log('📋 Form Data:', formData);
            
            // Disable button and show loading
            submitBtn.disabled = true;
            submitBtn.textContent = '⏳ Đang lưu...';

            try {
                // Call Google Apps Script Web App
                const response = await fetch(WEB_APP_URL, {
                    method: 'POST',
                    mode: 'no-cors', // Required for Apps Script
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    },
                    body: new URLSearchParams({
                        action: 'create',
                        ...formData
                    })
                });

                // Note: no-cors mode doesn't return response body
                // Assume success and reload cache
                alert('✅ Tạo khối thành công!\n\n' +
                      `ID: ${formData.id_the}\n` +
                      `Tên: ${formData.ten_the}\n\n` +
                      'Vui lòng reload trang để thấy khối mới.');

                // Reload page to fetch new data
                setTimeout(() => {
                    window.location.reload();
                }, 1000);

            } catch (error) {
                console.error('Error creating term:', error);
                alert('❌ Có lỗi xảy ra! Vui lòng thử lại.\n\n' + error.message);
                submitBtn.disabled = false;
                submitBtn.textContent = 'Tạo Khối';
            }
        });

        function resetForm() {
            hangMucSelect.value = '';
            contentArea.innerHTML = 'Vui lòng chọn hạng mục để hiển thị nội dung...';
            contentArea.classList.remove('has-selection');
            resetSelection();
            resetUpload();
            submitBtn.disabled = true;
        }

        function resetSelection() {
            selectedText = '';
            selectedTextInfo.classList.remove('active');
            selectedTextDisplay.textContent = '';
            idTheInput.value = '';
            tenTheInput.value = '';
        }

        // File upload functions
        function handleFileSelect() {
            const file = fileInput.files[0];
            if (!file) return;

            // Validate file size (10MB max)
            if (file.size > 10 * 1024 * 1024) {
                alert('⚠️ File quá lớn! Vui lòng chọn file dưới 10MB.');
                fileInput.value = '';
                return;
            }

            // Validate file type
            const validTypes = ['image/jpeg', 'image/png', 'image/gif', 'image/webp', 'video/mp4'];
            if (!validTypes.includes(file.type)) {
                alert('⚠️ File không hợp lệ! Chỉ hỗ trợ JPG, PNG, GIF, WEBP, MP4');
                fileInput.value = '';
                return;
            }

            uploadedFile = file;
            showPreview(file);
            uploadToImgur(file);
        }

        function showPreview(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                if (file.type.startsWith('image/')) {
                    previewImage.src = e.target.result;
                    previewImage.style.display = 'block';
                } else {
                    previewImage.style.display = 'none';
                }
                fileName.textContent = file.name;
                uploadPreview.classList.add('active');
                uploadArea.style.display = 'none';
            };
            reader.readAsDataURL(file);
        }

        async function uploadToImgur(file) {
            // Imgur API Client ID (public, free tier)
            const IMGUR_CLIENT_ID = '547b0c065feb937';
            
            uploadProgress.classList.add('active');
            uploadStatus.textContent = '⏳ Đang upload...';
            uploadStatus.className = 'upload-status';
            progressFill.style.width = '0%';
            progressFill.textContent = '0%';

            const formData = new FormData();
            formData.append('image', file);

            try {
                // Simulate progress
                let progress = 0;
                const progressInterval = setInterval(() => {
                    progress += 10;
                    if (progress <= 90) {
                        progressFill.style.width = progress + '%';
                        progressFill.textContent = progress + '%';
                    }
                }, 200);

                const response = await fetch('https://api.imgur.com/3/image', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Client-ID ${IMGUR_CLIENT_ID}`
                    },
                    body: formData
                });

                clearInterval(progressInterval);

                if (!response.ok) {
                    throw new Error('Upload failed');
                }

                const data = await response.json();
                
                if (data.success && data.data.link) {
                    const imageUrl = data.data.link;
                    
                    // Complete progress
                    progressFill.style.width = '100%';
                    progressFill.textContent = '100%';
                    
                    // Update status
                    uploadStatus.textContent = '✅ Upload thành công!';
                    uploadStatus.className = 'upload-status success';
                    
                    // Fill URL input
                    urlInput.value = imageUrl;
                    updateSubmitButton();
                    
                    // Hide progress after 2s
                    setTimeout(() => {
                        uploadProgress.classList.remove('active');
                    }, 2000);
                } else {
                    throw new Error('Invalid response');
                }
            } catch (error) {
                console.error('Upload error:', error);
                progressFill.style.width = '100%';
                progressFill.textContent = 'Error';
                uploadStatus.textContent = '❌ Upload thất bại! Vui lòng thử lại.';
                uploadStatus.className = 'upload-status error';
            }
        }

        function resetUpload() {
            fileInput.value = '';
            uploadedFile = null;
            uploadPreview.classList.remove('active');
            uploadProgress.classList.remove('active');
            uploadArea.style.display = 'block';
            urlInput.value = '';
            previewImage.src = '';
            fileName.textContent = '';
            updateSubmitButton();
        }
    }
    
    // Initialize when DOM is ready
    document.addEventListener('DOMContentLoaded', function() {
        initCreateTermModal();
    });
    
})();

    


    // ===== NAVIGATION SMOOTH SCROLL AND ACTIVE STATE =====
    // Smooth scroll for navigation
    document.querySelectorAll('.nav-link').forEach(link => {
      link.addEventListener('click', function(e) {
        e.preventDefault();
        const targetId = this.getAttribute('href').substring(1);
        const targetElement = document.getElementById(targetId);
        
        if (targetElement) {
          const navHeight = document.querySelector('.main-nav').offsetHeight;
          const elementPosition = targetElement.getBoundingClientRect().top;
          const offsetPosition = elementPosition + window.pageYOffset - navHeight - 20;
          
          window.scrollTo({
            top: offsetPosition,
            behavior: 'smooth'
          });
        }
      });
    });

    // Active link on scroll
    window.addEventListener('scroll', function() {
      const sections = ['faeda640-dac4-4844-9dad-9606804fd78c', '2ceec18e-70ae-8058-841a-e0265fc85386', '2ceec18e-70ae-8021-ba52-d0ba83f7adf6', '2ceec18e-70ae-804c-99de-f363da316462', '2ceec18e-70ae-8095-9925-c2ca73ab3c91', '2ceec18e-70ae-80f6-8e4e-cc86f4a0e914'];
      const navHeight = document.querySelector('.main-nav').offsetHeight;
      
      let currentSection = '';
      sections.forEach(sectionId => {
        const section = document.getElementById(sectionId);
        if (section) {
          const sectionTop = section.offsetTop - navHeight - 100;
          if (window.pageYOffset >= sectionTop) {
            currentSection = sectionId;
          }
        }
      });
      
      document.querySelectorAll('.nav-link').forEach(link => {
        link.classList.remove('active');
        if (link.getAttribute('href') === '#' + currentSection) {
          link.classList.add('active');
        }
      });
    });

/* ============================================
   EXTRACT DATA FUNCTIONS
   ============================================ */
let extractedTermsData = '';

function openExtractModal() {
	document.getElementById('extract-data-modal').classList.add('show');
	extractTermsData(); // Auto extract on open
}

function closeExtractModal() {
	document.getElementById('extract-data-modal').classList.remove('show');
}

function extractTermsData() {
	const terms = document.querySelectorAll('.interactive-term');
	const output = document.getElementById('extract-data-output');
	const stats = document.getElementById('extract-stats');
	
	if (terms.length === 0) {
		stats.innerHTML = '<p style="color: red;">❌ Không tìm thấy interactive terms nào! Vui lòng đợi page load xong.</p>';
		output.textContent = '';
		return;
	}
	
	const data = [];
	let withId = 0;
	let withUrl = 0;
	
	terms.forEach(term => {
		const idThe = term.dataset.id || '';
		const tenThe = term.textContent.trim();
		const url = term.dataset.imageUrl || '';
		
		// Find hang_muc from nearest heading
		let hangMuc = '';
		let el = term.parentElement;
		
		// Search backwards for nearest heading
		while (el) {
			const prevHeading = el.querySelector('h1, h2, h3');
			if (prevHeading) {
				hangMuc = prevHeading.textContent.trim();
				break;
			}
			
			// Check previous siblings
			let prev = el.previousElementSibling;
			while (prev && !hangMuc) {
				if (prev.tagName && (prev.tagName === 'H1' || prev.tagName === 'H2' || prev.tagName === 'H3')) {
					hangMuc = prev.textContent.trim();
					break;
				}
				prev = prev.previousElementSibling;
			}
			
			if (hangMuc) break;
			el = el.parentElement;
		}
		
		if (!hangMuc) hangMuc = 'Chưa xác định';
		
		data.push({
			hang_muc: hangMuc,
			id_the: idThe,
			ten_the: tenThe,
			url: url
		});
		
		if (idThe) withId++;
		if (url) withUrl++;
	});
	
	// Sort by hang_muc then ten_the
	data.sort((a, b) => {
		if (a.hang_muc !== b.hang_muc) return a.hang_muc.localeCompare(b.hang_muc);
		return a.ten_the.localeCompare(b.ten_the);
	});
	
	// Create tab-separated format
	extractedTermsData = 'hang_muc\tid_the\tten_the\turl\n';
	data.forEach(item => {
		extractedTermsData += `${item.hang_muc}\t${item.id_the}\t${item.ten_the}\t${item.url}\n`;
	});
	
	output.textContent = extractedTermsData;
	
	stats.innerHTML = `
		<p><strong>✅ Đã extract ${data.length} terms</strong></p>
		<ul style="margin: 10px 0; list-style: none; padding-left: 0;">
			<li>📊 Terms có ID: <strong>${withId}</strong> (${(withId/data.length*100).toFixed(1)}%)</li>
			<li>❌ Terms chưa có ID: <strong>${data.length - withId}</strong></li>
			<li>🖼️ Terms có URL: <strong>${withUrl}</strong> (${(withUrl/data.length*100).toFixed(1)}%)</li>
		</ul>
		<p style="margin-top: 10px; color: #6c757d;">💡 Tip: Bấm "Copy" rồi paste vào Google Sheets để update hàng loạt</p>
	`;
}

function copyExtractedData() {
	if (!extractedTermsData) {
		alert('⚠️ Vui lòng extract data trước!');
		return;
	}
	
	navigator.clipboard.writeText(extractedTermsData).then(() => {
		alert('✅ Đã copy vào clipboard!\n\nBước tiếp theo:\n1. Mở Google Sheets\n2. Select cell A1\n3. Paste bằng Cmd+V (Mac) hoặc Ctrl+V (Windows)');
	}).catch(() => {
		alert('❌ Không thể copy tự động.\n\nVui lòng:\n1. Select toàn bộ text trong box\n2. Copy bằng Cmd+C (Mac) hoặc Ctrl+C (Windows)');
	});
}

function downloadExtractedCSV() {
	if (!extractedTermsData) {
		alert('⚠️ Vui lòng extract data trước!');
		return;
	}
	
	const csv = extractedTermsData.replace(/\t/g, ',');
	const blob = new Blob(['\ufeff' + csv], { type: 'text/csv;charset=utf-8;' });
	const url = URL.createObjectURL(blob);
	const a = document.createElement('a');
	a.href = url;
	a.download = `terms_data_${new Date().toISOString().slice(0, 10)}.csv`;
	a.click();
	URL.revokeObjectURL(url);
	alert('✅ Đã download CSV file!');
}

// Debug function to check hover setup
function debugHover() {
	console.clear();
	console.log('🐛 DEBUG HOVER - Starting diagnostic...');
	console.log('='.repeat(80));
	
	// 1. Check cache
	console.log('\n📦 STEP 1: Check Cache');
	const cacheData = localStorage.getItem('masterData');
	if (cacheData) {
		const cache = JSON.parse(cacheData);
		console.log('✅ Cache exists:', {
			rows: cache.data?.length || 0,
			timestamp: new Date(cache.timestamp),
			age: Math.round((Date.now() - cache.timestamp) / 1000) + 's ago'
		});
		if (cache.data && cache.data.length > 0) {
			console.log('Sample row:', cache.data[1]); // Skip header
		}
	} else {
		console.log('❌ No cache found');
	}
	
	// 2. Check interactive terms
	console.log('\n🎯 STEP 2: Check Interactive Terms');
	const terms = document.querySelectorAll('.interactive-term[data-term-id]');
	console.log(`Found ${terms.length} terms with data-term-id`);
	
	if (terms.length > 0) {
		console.log('\nFirst 5 terms:');
		Array.from(terms).slice(0, 5).forEach((term, i) => {
			console.log(`${i+1}. ID="${term.getAttribute('data-term-id')}"`, {
				text: term.textContent.trim(),
				hasUrl: term.hasAttribute('data-image-url'),
				url: term.getAttribute('data-image-url') || '(none)',
				classes: term.className
			});
		});
		
		// Count terms with URLs
		const termsWithUrl = Array.from(terms).filter(t => t.getAttribute('data-image-url'));
		console.log(`\n📊 Stats: ${termsWithUrl.length}/${terms.length} terms have URLs`);
	} else {
		console.log('❌ No terms found! Check assignTermIds() function.');
	}
	
	// 3. Check event listeners
	console.log('\n👂 STEP 3: Test Event Listener');
	if (terms.length > 0) {
		const firstTerm = terms[0];
		console.log('Testing first term:', firstTerm.textContent.trim());
		console.log('Simulating mouseenter...');
		
		// Trigger mouseenter
		const event = new MouseEvent('mouseenter', { bubbles: true });
		firstTerm.dispatchEvent(event);
		
		setTimeout(() => {
			console.log('Check if preview appeared above ☝️');
		}, 600);
	}
	
	// 4. Force refresh cache
	console.log('\n🔄 STEP 4: Force Refresh Cache');
	localStorage.removeItem('masterData');
	console.log('✅ Cache cleared');
	console.log('Reloading data from Google Sheets...');
	
	if (window.SheetDB && window.SheetDB.refresh) {
		window.SheetDB.refresh().then(() => {
			console.log('✅ Data refreshed!');
			console.log('Re-running populateImageUrls()...');
			if (window.populateImageUrls) {
				window.populateImageUrls();
			}
		});
	} else {
		console.log('⚠️ SheetDB.refresh not available. Reload page manually.');
	}
	
	console.log('='.repeat(80));
	console.log('🐛 DEBUG COMPLETE');
	console.log('💡 TIP: Nếu vẫn không work, reload page: Cmd+Shift+R (Mac) hoặc Ctrl+Shift+R (Windows)');
}

/* ============================================
   VIDEO LAZY LOADING SYSTEM V2 (GOOGLE SHEETS)
   Performance: Click-to-Load + Stale-while-revalidate Cache
   ============================================ */

/**
 * VIDEO DATABASE MANAGER
 * Fetch video data from Google Sheets API
 */
const VideoDatabase = {
    // ⚠️ IMPORTANT: Thay bằng URL Google Apps Script của bạn
    API_URL: 'https://script.google.com/macros/s/AKfycbxaujZ9IVqRWnpAOA-HuCvDWDg46J_Q8xSZOGAbJ8IQ0DOsybDf-hWptKVl9q7ncfNS8g/exec',
    CACHE_KEY: 'video_data_cache',
    CACHE_DURATION: 5 * 60 * 1000, // 5 minutes

    /**
     * Check if URL has ?reload=true parameter
     */
    shouldForceReload() {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get('reload') === 'true';
    },

    /**
     * Force refresh - Clear cache and reload data
     */
    async forceRefresh() {
        console.log('🚀 Force Refresh initiated...');
        
        // Clear cache
        localStorage.removeItem(this.CACHE_KEY);
        console.log('✅ Cache cleared');
        
        // Fetch fresh data
        try {
            const data = await this.fetchAndUpdateCache();
            console.log('🚀 Đã xóa cache và tải dữ liệu mới từ Sheet!');
            console.log(`📊 Loaded ${data.length} videos`);
            
            // Re-render
            this.renderVideos(data);
            
            // Remove ?reload=true from URL (clean URL)
            if (this.shouldForceReload()) {
                const url = new URL(window.location);
                url.searchParams.delete('reload');
                window.history.replaceState({}, '', url);
            }
            
            return data;
        } catch (error) {
            console.error('❌ Force refresh failed:', error);
            alert(`❌ Lỗi khi tải dữ liệu mới:\n${error.message}`);
            throw error;
        }
    },

    /**
     * Debug Tool - Check data status
     */
    checkDataStatus() {
        console.log('\n' + '='.repeat(80));
        console.log('🔍 VIDEO DATA STATUS CHECK');
        console.log('='.repeat(80));
        
        // Check cache
        const cache = this.getCache();
        if (cache) {
            const age = Date.now() - cache.timestamp;
            const ageMinutes = Math.floor(age / 60000);
            console.log('📦 Data Source: CACHE (localStorage)');
            console.log(`⏰ Cache Age: ${ageMinutes} minutes ago`);
            console.log(`📊 Videos in Cache: ${cache.data.length}`);
            console.log(`🔄 Cache Status: ${age < this.CACHE_DURATION ? '✅ Fresh' : '⚠️ Stale (will revalidate)'}`);
            
            // List videos
            console.log('\n📹 Videos loaded:');
            cache.data.forEach((video, i) => {
                console.log(`  ${i + 1}. ${video.element_id} - ${video.category || 'Untitled'} (${video.platform})`);
            });
        } else {
            console.log('📦 Data Source: LIVE API (no cache)');
            console.log('⚠️ Cache is empty - will fetch from Google Sheets');
        }
        
        console.log('\n🔗 API Endpoint:', this.API_URL);
        console.log('💡 Force Refresh: Add ?reload=true to URL or click refresh button');
        console.log('='.repeat(80) + '\n');
    },

    /**
     * Get video data with cache strategy
     * 1. Check localStorage cache
     * 2. If exists: Return immediately (instant load)
     * 3. Background fetch to check for updates
     * 4. If no cache: Show skeleton, then fetch
     */
    async getData() {
        // Check for force reload parameter
        if (this.shouldForceReload()) {
            console.log('🔄 Force reload detected (?reload=true)');
            return await this.forceRefresh();
        }

        const cache = this.getCache();

        // Strategy 1: Cache exists - Return immediately
        if (cache) {
            console.log('📦 Loading videos from cache (instant)');
            
            // Background revalidation
            this.fetchAndUpdateCache().then(freshData => {
                if (this.hasChanged(cache.data, freshData)) {
                    console.log('🔄 Cache updated, re-rendering videos');
                    this.renderVideos(freshData);
                }
            }).catch(err => {
                console.warn('⚠️ Background fetch failed:', err);
            });

            return cache.data;
        }

        // Strategy 2: No cache - Fetch from API
        console.log('🌐 Fetching videos from Google Sheets...');
        this.showSkeletonLoading();
        
        try {
            const data = await this.fetchAndUpdateCache();
            this.hideSkeletonLoading();
            return data;
        } catch (error) {
            console.error('❌ Failed to load videos:', error);
            this.hideSkeletonLoading();
            return [];
        }
    },

    /**
     * Fetch from API and update cache
     * Enhanced error handling for better debugging
     */
    async fetchAndUpdateCache() {
        console.log('🌐 Fetching from API:', this.API_URL);

        let response;
        try {
            response = await fetch(this.API_URL);
            console.log('📡 Response received:', {
                status: response.status,
                statusText: response.statusText,
                ok: response.ok,
                headers: {
                    contentType: response.headers.get('content-type')
                }
            });
        } catch (fetchError) {
            console.error('❌ Network/Fetch Error:', {
                name: fetchError.name,
                message: fetchError.message,
                stack: fetchError.stack
            });
            throw new Error(`Network Error: ${fetchError.message}. Check your internet connection or API endpoint.`);
        }

        if (!response.ok) {
            const errorText = await response.text();
            console.error('❌ HTTP Error Response:', {
                status: response.status,
                statusText: response.statusText,
                body: errorText.substring(0, 500)
            });
            throw new Error(`HTTP ${response.status}: ${response.statusText}. Response: ${errorText.substring(0, 200)}`);
        }

        let result;
        try {
            const rawText = await response.text();
            console.log('📄 Raw response (first 500 chars):', rawText.substring(0, 500));
            result = JSON.parse(rawText);
            console.log('✅ JSON parsed successfully:', {
                success: result.success,
                hasData: !!result.data,
                dataLength: result.data?.length,
                hasError: !!result.error
            });
        } catch (jsonError) {
            console.error('❌ JSON Parse Error:', {
                name: jsonError.name,
                message: jsonError.message,
                rawResponsePreview: rawText?.substring(0, 500)
            });
            throw new Error(`Invalid JSON response from API. The server may have returned HTML instead of JSON. Error: ${jsonError.message}`);
        }

        if (!result.success) {
            const errorDetails = {
                error: result.error,
                message: result.message,
                fullResult: result
            };
            console.error('❌ API returned success=false:', errorDetails);

            // SPECIAL CASE: Health check response (not an error!)
            // If message contains "running" or "Web App", this is likely a health check endpoint
            const isHealthCheck = result.message && (
                result.message.includes('running') ||
                result.message.includes('Web App') ||
                result.status === 'ok'
            );

            if (isHealthCheck) {
                console.warn('⚠️ Detected health check response instead of video data');
                console.warn('💡 This means the API endpoint might be misconfigured');
                console.warn('💡 Expected: Video data endpoint');
                console.warn('💡 Got: Health check endpoint');

                // Return empty array with warning instead of crashing
                console.log('📊 Returning empty video array to prevent crash');
                return [];
            }

            throw new Error(result.error || result.message || `API Error: ${JSON.stringify(result)}`);
        }

        const data = result.data || [];

        if (!Array.isArray(data)) {
            console.error('❌ Data is not an array:', typeof data, data);
            throw new Error(`Invalid data format: Expected array, got ${typeof data}`);
        }

        console.log(`📊 Received ${data.length} videos from API`);

        // Save to cache
        try {
            localStorage.setItem(this.CACHE_KEY, JSON.stringify({
                data: data,
                timestamp: Date.now()
            }));
            console.log('💾 Data saved to cache');
        } catch (storageError) {
            console.warn('⚠️ Failed to save to localStorage:', storageError.message);
            // Continue anyway - not critical
        }

        console.log(`✅ Fetched ${data.length} videos from Google Sheets`);
        return data;
    },

    /**
     * Get cached data
     */
    getCache() {
        const cached = localStorage.getItem(this.CACHE_KEY);
        if (!cached) return null;

        try {
            const parsed = JSON.parse(cached);
            const age = Date.now() - parsed.timestamp;
            
            // Cache valid for 5 minutes, but still usable for 1 hour
            if (age > 60 * 60 * 1000) {
                console.log('🗑️ Cache too old, clearing...');
                localStorage.removeItem(this.CACHE_KEY);
                return null;
            }

            return parsed;
        } catch (error) {
            console.error('❌ Cache parse error:', error);
            localStorage.removeItem(this.CACHE_KEY);
            return null;
        }
    },

    /**
     * Check if data has changed (simple comparison)
     */
    hasChanged(oldData, newData) {
        if (oldData.length !== newData.length) return true;
        return JSON.stringify(oldData) !== JSON.stringify(newData);
    },

    /**
     * Show skeleton loading UI
     */
    showSkeletonLoading() {
        const slots = document.querySelectorAll('.video-slot');
        slots.forEach(slot => {
            if (!slot.innerHTML.trim()) {
                slot.innerHTML = `
                    <div class="browser-mockup skeleton-loading">
                        <div class="browser-header">
                            <div class="traffic-lights">
                                <span style="background: #ff5f57;"></span>
                                <span style="background: #febc2e;"></span>
                                <span style="background: #28c840;"></span>
                            </div>
                        </div>
                        <div class="browser-content" style="background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%); background-size: 200% 100%; animation: shimmer 1.5s infinite;">
                        </div>
                    </div>
                `;
            }
        });
    },

    /**
     * Hide skeleton loading
     */
    hideSkeletonLoading() {
        const skeletons = document.querySelectorAll('.skeleton-loading');
        skeletons.forEach(s => s.remove());
    },

    /**
     * Render videos to page (Browser Window + Click-to-Load)
     */
    renderVideos(videoData) {
        console.log(`🎬 Rendering ${videoData.length} videos...`);

        videoData.forEach(video => {
            const slot = document.getElementById(video.element_id);
            if (!slot) {
                console.warn(`⚠️ Slot not found: ${video.element_id}`);
                return;
            }

            // Clear existing content
            slot.innerHTML = '';

            // Build Browser Window with Placeholder
            const browserWindow = document.createElement('div');
            browserWindow.className = 'browser-mockup';
            browserWindow.id = `video-placeholder-${video.element_id}`;

            browserWindow.innerHTML = `
                <div class="browser-header">
                    <div class="traffic-lights">
                        <span style="background: #ff5f57;"></span>
                        <span style="background: #febc2e;"></span>
                        <span style="background: #28c840;"></span>
                    </div>
                </div>
                <div class="browser-content video-placeholder" data-video-url="${video.video_url}" data-platform="${video.platform}">
                    ${video.thumbnail ? `<img src="${video.thumbnail}" class="thumbnail-bg" alt="Video thumbnail">` : ''}
                    <div class="video-overlay">
                        <div class="play-button-wrapper">
                            <div class="play-button"></div>
                        </div>
                        <div class="play-helper-text">Bấm để xem video hướng dẫn</div>
                    </div>
                </div>
            `;

            slot.appendChild(browserWindow);

            // Attach click event for lazy loading
            const placeholder = browserWindow.querySelector('.video-placeholder');
            placeholder.addEventListener('click', () => {
                this.loadVideo(placeholder, video.video_url, video.platform, video.category);
            });

            console.log(`✓ Rendered: ${video.element_id} (${video.category})`);
        });

        console.log('🎬 Video system ready!');
    },

    /**
     * Load video iframe (Facade Pattern)
     * Supports multiple platforms: Cloudinary, Streamable, YouTube, etc.
     */
    loadVideo(placeholder, videoUrl, platform, category) {
        console.log(`🎥 Loading video: ${category || 'Untitled'} [Platform: ${platform || 'default'}]`);

        // Add loading state
        placeholder.classList.add('loading');

        // Create iframe
        const iframe = document.createElement('iframe');
        iframe.src = videoUrl;
        iframe.allow = 'autoplay; fullscreen; encrypted-media; picture-in-picture';
        iframe.allowFullscreen = true;
        iframe.frameBorder = '0';
        iframe.style.cssText = 'border: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%;';

        // Platform-specific settings
        switch(platform?.toLowerCase()) {
            case 'cloudinary':
                iframe.setAttribute('autoplay', 'true');
                iframe.allow += '; accelerometer; gyroscope';
                console.log('📹 Cloudinary video - autoplay enabled');
                break;
            
            case 'streamable':
                // Streamable works well with default settings
                // URL format: https://streamable.com/e/[VIDEO_ID]
                console.log('📹 Streamable video - using embed format');
                break;
            
            case 'youtube':
                // YouTube embed format: https://www.youtube.com/embed/[VIDEO_ID]
                iframe.allow += '; accelerometer; gyroscope; picture-in-picture';
                console.log('📹 YouTube video');
                break;
            
            case 'vimeo':
                // Vimeo embed format: https://player.vimeo.com/video/[VIDEO_ID]
                console.log('📹 Vimeo video');
                break;
            
            default:
                console.log('📹 Generic video platform');
        }

        // Replace placeholder with iframe
        setTimeout(() => {
            placeholder.innerHTML = '';
            placeholder.appendChild(iframe);
            placeholder.classList.remove('loading', 'video-placeholder');
            placeholder.style.background = 'transparent';
            console.log(`✅ Video loaded: ${category || 'Untitled'} (${platform || 'default'})`);
        }, 300);
    }
};

/**
 * Initialize Video System
 * Enhanced error handling and logging
 */
async function initVideoSystem() {
    console.log('\n' + '='.repeat(80));
    console.log('🎬 Initializing Video System (Google Sheets)...');
    console.log('='.repeat(80));

    // Check if API URL is configured
    if (VideoDatabase.API_URL === 'YOUR_GOOGLE_APPS_SCRIPT_URL_HERE' || !VideoDatabase.API_URL) {
        console.error('❌ Google Apps Script URL not configured!');
        console.log('👉 Please update VideoDatabase.API_URL in the code');
        console.log('='.repeat(80) + '\n');
        return;
    }

    console.log('📍 API Endpoint:', VideoDatabase.API_URL);

    // Debug: Check data status before loading
    console.log('\n📊 Pre-initialization check:');
    VideoDatabase.checkDataStatus();

    try {
        console.log('\n🚀 Starting video data fetch...');
        const videoData = await VideoDatabase.getData();

        console.log(`\n✅ Data fetched successfully: ${videoData.length} videos`);

        console.log('\n🎨 Rendering videos to page...');
        VideoDatabase.renderVideos(videoData);

        // Debug: Check data status after loading
        console.log('\n' + '='.repeat(80));
        console.log('✅ VIDEO SYSTEM INITIALIZED SUCCESSFULLY!');
        console.log('='.repeat(80));
        VideoDatabase.checkDataStatus();
        console.log('='.repeat(80) + '\n');

        return true;
    } catch (error) {
        console.log('\n' + '='.repeat(80));
        console.error('❌ VIDEO SYSTEM INITIALIZATION FAILED!');
        console.log('='.repeat(80));
        console.error('Error details:', {
            name: error.name,
            message: error.message,
            stack: error.stack
        });
        console.log('='.repeat(80) + '\n');

        // Show user-friendly error
        const errorMessage = `❌ Lỗi khởi tạo hệ thống video:\n\n${error.message}\n\nVui lòng kiểm tra:\n1. Google Apps Script API URL đã deploy đúng chưa\n2. Kết nối internet\n3. Console (F12) để xem chi tiết lỗi`;

        console.error('💡 Troubleshooting tips:');
        console.log('1. Check API URL:', VideoDatabase.API_URL);
        console.log('2. Test API manually: fetch(VideoDatabase.API_URL).then(r=>r.json()).then(console.log)');
        console.log('3. Check Google Apps Script deployment');
        console.log('4. Verify Sheet data exists and is accessible');

        alert(errorMessage);

        throw error; // Re-throw to prevent success message
    }
}

// Initialize when DOM ready
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initVideoSystem);
} else {
    initVideoSystem();
}

// Expose for debugging
window.VideoDatabase = VideoDatabase;

// Quick debug commands
window.checkVideoStatus = () => VideoDatabase.checkDataStatus();
window.forceRefreshVideos = () => VideoDatabase.forceRefresh();

console.log('\n💡 DEBUG COMMANDS:');
console.log('  - checkVideoStatus()     → Check data source & video count');
console.log('  - forceRefreshVideos()   → Clear cache & reload from Sheets');
console.log('  - Or add ?reload=true to URL to force refresh\n');

// Initialize Refresh Button
function initRefreshButton() {
    const refreshButton = document.getElementById('refreshButton');
    if (!refreshButton) return;
    
    refreshButton.addEventListener('click', async function() {
        const button = this;
        button.classList.add('spinning');
        
        try {
            await VideoDatabase.forceRefresh();
            
            // Success feedback
            setTimeout(() => {
                button.classList.remove('spinning');
                button.style.background = 'linear-gradient(135deg, #10b981, #059669)';
                setTimeout(() => {
                    button.style.background = 'linear-gradient(135deg, #00b14f, #009944)';
                }, 1000);
            }, 800);
        } catch (error) {
            button.classList.remove('spinning');
            button.style.background = 'linear-gradient(135deg, #ef4444, #dc2626)';
            setTimeout(() => {
                button.style.background = 'linear-gradient(135deg, #00b14f, #009944)';
            }, 2000);
        }
    });
}

// Initialize refresh button when DOM ready
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initRefreshButton);
} else {
    initRefreshButton();
}

// ========================================
// GHTK AI ASSISTANT - CHATBOT LOGIC
// ========================================

/**
 * GHTK AI Assistant Configuration
 * Direct API integration - No backend proxy needed!
 */
const GHTK_AI_CONFIG = {
    // ⚠️ REPLACE WITH YOUR GEMINI API KEY
    // Get your key at: https://aistudio.google.com/app/apikey
    // IMPORTANT: Restrict this key to your domain in Google AI Studio settings
    GEMINI_API_KEY: 'AIzaSyCe_ddlTTGepkgbmvTM4lpbqkpbW6bw5Fs',

    // Gemini API Endpoint (Direct)
    GEMINI_API_URL: 'https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent',

    // Storage settings
    STORAGE_KEY: 'ghtk_chat_history',
    MAX_CONTEXT_LENGTH: 15000, // Limit context to avoid API overload
    MAX_MESSAGES: 50 // Maximum messages to store in localStorage
};

/**
 * GHTK Chat Manager Class
 */
class GHTKChatManager {
    constructor() {
        this.messages = [];
        this.isOpen = false;
        this.isTyping = false;

        // DOM Elements
        this.launcher = document.getElementById('chat-launcher');
        this.chatWindow = document.getElementById('chat-window');
        this.closeBtn = document.getElementById('chat-close');
        this.messagesContainer = document.getElementById('chat-messages');
        this.input = document.getElementById('chat-input');
        this.sendBtn = document.getElementById('chat-send');
        this.quickActions = document.querySelectorAll('.quick-action-chip');

        this.init();
    }

    init() {
        // Load chat history from localStorage
        this.loadHistory();

        // Event Listeners
        this.launcher.addEventListener('click', () => this.toggleChat());
        this.closeBtn.addEventListener('click', () => this.closeChat());
        this.sendBtn.addEventListener('click', () => this.sendMessage());
        this.input.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                this.sendMessage();
            }
        });

        // Auto-resize textarea
        this.input.addEventListener('input', () => {
            this.input.style.height = 'auto';
            this.input.style.height = this.input.scrollHeight + 'px';
        });

        // Quick Action Chips
        this.quickActions.forEach(chip => {
            chip.addEventListener('click', () => {
                const question = chip.dataset.question;
                this.sendMessage(question);
            });
        });

        console.log('✅ GHTK AI Assistant initialized');
    }

    toggleChat() {
        this.isOpen = !this.isOpen;
        if (this.isOpen) {
            this.chatWindow.classList.add('active');
            this.input.focus();
        } else {
            this.chatWindow.classList.remove('active');
        }
    }

    closeChat() {
        this.isOpen = false;
        this.chatWindow.classList.remove('active');
    }

    async sendMessage(text = null) {
        const message = text || this.input.value.trim();

        if (!message || this.isTyping) return;

        // Clear input
        this.input.value = '';
        this.input.style.height = 'auto';

        // Remove welcome message if exists
        const welcomeMsg = this.messagesContainer.querySelector('.welcome-message');
        if (welcomeMsg) {
            welcomeMsg.remove();
        }

        // Add user message
        this.addMessage(message, 'user');

        // Show typing indicator
        this.showTyping();

        // Get page context
        const context = this.getPageContext();

        try {
            // Call backend API
            const response = await this.callBackendAPI(message, context);

            // Hide typing indicator
            this.hideTyping();

            // Add bot response
            this.addMessage(response, 'bot');

        } catch (error) {
            console.error('Chat error:', error);
            this.hideTyping();
            this.addMessage(
                'Xin lỗi, đã có lỗi xảy ra. Vui lòng thử lại sau hoặc kiểm tra kết nối mạng.',
                'bot'
            );
        }

        // Save history
        this.saveHistory();
    }

    addMessage(text, sender) {
        const messageDiv = document.createElement('div');
        messageDiv.className = `chat-message ${sender}`;

        const avatar = document.createElement('div');
        avatar.className = `message-avatar ${sender}`;
        avatar.textContent = sender === 'bot' ? '🤖' : '👤';

        const bubble = document.createElement('div');
        bubble.className = 'message-bubble';
        bubble.innerHTML = this.formatMessage(text);

        messageDiv.appendChild(avatar);
        messageDiv.appendChild(bubble);

        this.messagesContainer.appendChild(messageDiv);
        this.scrollToBottom();

        // Store message
        this.messages.push({ text, sender, timestamp: Date.now() });

        // Limit stored messages
        if (this.messages.length > GHTK_AI_CONFIG.MAX_MESSAGES) {
            this.messages = this.messages.slice(-GHTK_AI_CONFIG.MAX_MESSAGES);
        }
    }

    formatMessage(text) {
        // Simple markdown-like formatting
        let formatted = text
            // Bold: **text** -> <strong>text</strong>
            .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
            // Bullet points: - item -> <li>item</li>
            .replace(/^- (.+)$/gm, '<li>$1</li>')
            // Code: `code` -> <code>code</code>
            .replace(/`([^`]+)`/g, '<code>$1</code>');

        // Wrap bullet points in <ul>
        if (formatted.includes('<li>')) {
            formatted = formatted.replace(/(<li>.*<\/li>\s*)+/gs, match => `<ul>${match}</ul>`);
        }

        // Convert newlines to <br>
        formatted = formatted.replace(/\n/g, '<br>');

        return formatted;
    }

    showTyping() {
        this.isTyping = true;
        this.sendBtn.disabled = true;

        const typingDiv = document.createElement('div');
        typingDiv.className = 'chat-message bot';
        typingDiv.id = 'typing-indicator';

        const avatar = document.createElement('div');
        avatar.className = 'message-avatar bot';
        avatar.textContent = '🤖';

        const bubble = document.createElement('div');
        bubble.className = 'message-bubble';
        bubble.innerHTML = `
            <div class="typing-indicator">
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
            </div>
        `;

        typingDiv.appendChild(avatar);
        typingDiv.appendChild(bubble);

        this.messagesContainer.appendChild(typingDiv);
        this.scrollToBottom();
    }

    hideTyping() {
        this.isTyping = false;
        this.sendBtn.disabled = false;

        const typingIndicator = document.getElementById('typing-indicator');
        if (typingIndicator) {
            typingIndicator.remove();
        }
    }

    scrollToBottom() {
        setTimeout(() => {
            this.messagesContainer.scrollTop = this.messagesContainer.scrollHeight;
        }, 100);
    }

    /**
     * Extract page content as context for AI
     */
    getPageContext() {
        const mainContent = document.querySelector('main.document-paper');
        if (!mainContent) {
            return 'Không tìm thấy nội dung trang web.';
        }

        // Get all text content
        let context = mainContent.innerText;

        // Limit context length to avoid API overload
        if (context.length > GHTK_AI_CONFIG.MAX_CONTEXT_LENGTH) {
            context = context.substring(0, GHTK_AI_CONFIG.MAX_CONTEXT_LENGTH) + '...';
        }

        return context;
    }

    /**
     * Call Google Gemini API Directly (No Backend Proxy!)
     * This eliminates all CORS and network issues from Google Apps Script
     */
    async callBackendAPI(question, context) {
        // Check if API key is configured
        if (!GHTK_AI_CONFIG.GEMINI_API_KEY || GHTK_AI_CONFIG.GEMINI_API_KEY === 'YOUR_GEMINI_API_KEY_HERE') {
            return '⚠️ **Chưa cấu hình Gemini API Key**\n\n' +
                   'Vui lòng:\n' +
                   '1. Truy cập: https://aistudio.google.com/app/apikey\n' +
                   '2. Tạo API Key mới\n' +
                   '3. Cập nhật `GHTK_AI_CONFIG.GEMINI_API_KEY` trong code\n' +
                   '4. Giới hạn key theo domain để bảo mật';
        }

        console.log('🤖 Calling Gemini API directly...');
        console.log('📝 Question length:', question.length);
        console.log('📄 Context length:', context.length);

        // Build system prompt
        const systemPrompt = `Bạn là trợ lý AI chuyên nghiệp của GHTK (Giao Hàng Tiết Kiệm).

**Vai trò của bạn:**
- Hỗ trợ người dùng tìm hiểu về quy trình phân phối của GHTK
- Trả lời câu hỏi dựa trên tài liệu được cung cấp
- Cung cấp thông tin chính xác, súc tích và dễ hiểu

**Nguyên tắc trả lời:**
1. **Chính xác**: Chỉ trả lời dựa trên thông tin trong tài liệu được cung cấp
2. **Súc tích**: Trả lời ngắn gọn, đi thẳng vào vấn đề (2-5 câu)
3. **Dễ đọc**: Sử dụng gạch đầu dòng (-) khi liệt kê nhiều điểm
4. **In đậm điểm quan trọng**: Sử dụng **text** để làm nổi bật
5. **Thành thật**: Nếu không tìm thấy thông tin trong tài liệu, nói rõ "Thông tin này không có trong tài liệu hiện tại"

**Định dạng câu trả lời:**
- Bắt đầu với câu tóm tắt ngắn gọn
- Sử dụng gạch đầu dòng (-) cho danh sách
- Sử dụng **in đậm** cho thuật ngữ quan trọng
- Kết thúc bằng lời khuyên hoặc lưu ý (nếu cần)`;

        // Build full prompt with context
        const fullPrompt = `${systemPrompt}

========================================
TÀI LIỆU QUY TRÌNH PHÂN PHỐI GHTK:
========================================

${context}

========================================
CÂU HỎI TỪ NGƯỜI DÙNG:
========================================

${question}

========================================
YÊU CẦU:
========================================

Hãy trả lời câu hỏi trên dựa vào tài liệu được cung cấp. Nhớ tuân thủ các nguyên tắc đã nêu.`;

        // Prepare API request payload
        const payload = {
            contents: [{
                parts: [{
                    text: fullPrompt
                }]
            }],
            generationConfig: {
                temperature: 0.7,
                topK: 40,
                topP: 0.95,
                maxOutputTokens: 2048,
            },
            safetySettings: [
                {
                    category: 'HARM_CATEGORY_HARASSMENT',
                    threshold: 'BLOCK_MEDIUM_AND_ABOVE'
                },
                {
                    category: 'HARM_CATEGORY_HATE_SPEECH',
                    threshold: 'BLOCK_MEDIUM_AND_ABOVE'
                },
                {
                    category: 'HARM_CATEGORY_SEXUALLY_EXPLICIT',
                    threshold: 'BLOCK_MEDIUM_AND_ABOVE'
                },
                {
                    category: 'HARM_CATEGORY_DANGEROUS_CONTENT',
                    threshold: 'BLOCK_MEDIUM_AND_ABOVE'
                }
            ]
        };

        try {
            // Build full API URL with detailed logging
            const apiUrl = `${GHTK_AI_CONFIG.GEMINI_API_URL}?key=${GHTK_AI_CONFIG.GEMINI_API_KEY}`;

            console.log('🔗 Calling URL:', apiUrl.replace(GHTK_AI_CONFIG.GEMINI_API_KEY, 'API_KEY_HIDDEN'));
            console.log('📦 Payload size:', JSON.stringify(payload).length, 'bytes');

            // Call Gemini API directly
            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(payload)
            });

            console.log('📡 Response status:', response.status);
            console.log('📡 Response ok:', response.ok);

            if (!response.ok) {
                const errorText = await response.text();
                console.error('❌ API Error Response:', errorText);

                // Try fallback to gemini-pro if gemini-1.5-flash fails
                if (response.status === 404) {
                    console.warn('⚠️ Gemini 1.5 Flash not available, trying fallback to Gemini Pro...');
                    return await this.callGeminiProFallback(question, context, payload);
                }

                throw new Error(`Gemini API error (${response.status}): ${errorText}`);
            }

            // Parse response
            const data = await response.json();
            console.log('✅ Response received successfully');
            console.log('📊 Response structure:', {
                hasCandidates: !!data.candidates,
                candidatesCount: data.candidates?.length || 0
            });

            // Extract answer from Gemini response
            if (data.candidates && data.candidates.length > 0) {
                const candidate = data.candidates[0];
                if (candidate.content && candidate.content.parts && candidate.content.parts.length > 0) {
                    const answer = candidate.content.parts[0].text;
                    console.log('✅ Answer extracted, length:', answer.length);
                    return answer;
                }
            }

            throw new Error('Unexpected API response format - no candidates or content found');

        } catch (error) {
            console.error('❌ Error calling Gemini API:', error);
            console.error('❌ Error stack:', error.stack);
            return `Xin lỗi, đã có lỗi xảy ra khi kết nối với AI.\n\nChi tiết lỗi: ${error.message}\n\nVui lòng thử lại sau.`;
        }
    }

    /**
     * Fallback to Gemini Pro (stable 1.0 model)
     * Called when gemini-1.5-flash returns 404
     */
    async callGeminiProFallback(question, context, originalPayload) {
        try {
            console.log('🔄 Attempting fallback to Gemini Pro (stable model)...');

            const fallbackUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${GHTK_AI_CONFIG.GEMINI_API_KEY}`;

            console.log('🔗 Fallback URL:', fallbackUrl.replace(GHTK_AI_CONFIG.GEMINI_API_KEY, 'API_KEY_HIDDEN'));

            const response = await fetch(fallbackUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(originalPayload)
            });

            console.log('📡 Fallback Response status:', response.status);

            if (!response.ok) {
                const errorText = await response.text();
                console.error('❌ Fallback also failed:', errorText);
                throw new Error(`Fallback API error (${response.status}): ${errorText}`);
            }

            const data = await response.json();
            console.log('✅ Fallback successful!');

            // Extract answer
            if (data.candidates && data.candidates.length > 0) {
                const candidate = data.candidates[0];
                if (candidate.content && candidate.content.parts && candidate.content.parts.length > 0) {
                    const answer = candidate.content.parts[0].text;
                    console.log('✅ Fallback answer extracted, length:', answer.length);
                    return answer;
                }
            }

            throw new Error('Fallback: Unexpected response format');

        } catch (error) {
            console.error('❌ Fallback failed:', error);
            throw error; // Re-throw to be caught by main error handler
        }
    }

    /**
     * Save chat history to localStorage
     */
    saveHistory() {
        try {
            localStorage.setItem(
                GHTK_AI_CONFIG.STORAGE_KEY,
                JSON.stringify(this.messages)
            );
        } catch (error) {
            console.warn('Failed to save chat history:', error);
        }
    }

    /**
     * Load chat history from localStorage
     */
    loadHistory() {
        try {
            const saved = localStorage.getItem(GHTK_AI_CONFIG.STORAGE_KEY);
            if (saved) {
                this.messages = JSON.parse(saved);

                // Clear welcome message
                const welcomeMsg = this.messagesContainer.querySelector('.welcome-message');
                if (welcomeMsg && this.messages.length > 0) {
                    welcomeMsg.remove();
                }

                // Restore messages
                this.messages.forEach(msg => {
                    this.addMessageToDOM(msg.text, msg.sender);
                });

                console.log(`📜 Loaded ${this.messages.length} messages from history`);
            }
        } catch (error) {
            console.warn('Failed to load chat history:', error);
            this.messages = [];
        }
    }

    /**
     * Add message to DOM only (without saving)
     */
    addMessageToDOM(text, sender) {
        const messageDiv = document.createElement('div');
        messageDiv.className = `chat-message ${sender}`;

        const avatar = document.createElement('div');
        avatar.className = `message-avatar ${sender}`;
        avatar.textContent = sender === 'bot' ? '🤖' : '👤';

        const bubble = document.createElement('div');
        bubble.className = 'message-bubble';
        bubble.innerHTML = this.formatMessage(text);

        messageDiv.appendChild(avatar);
        messageDiv.appendChild(bubble);

        this.messagesContainer.appendChild(messageDiv);
    }

    /**
     * Clear chat history
     */
    clearHistory() {
        this.messages = [];
        localStorage.removeItem(GHTK_AI_CONFIG.STORAGE_KEY);

        // Clear messages from DOM
        this.messagesContainer.innerHTML = `
            <div class="welcome-message">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/>
                </svg>
                <h3>Xin chào! Tôi là trợ lý AI của GHTK</h3>
                <p>Tôi có thể giúp bạn tìm hiểu về quy trình phân phối.<br>Hãy hỏi tôi bất cứ điều gì!</p>
            </div>
        `;

        console.log('🗑️ Chat history cleared');
    }
}

// Initialize GHTK Chat when DOM is ready
let ghtkChat;

if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => {
        ghtkChat = new GHTKChatManager();
        window.ghtkChat = ghtkChat; // Expose for debugging
    });
} else {
    ghtkChat = new GHTKChatManager();
    window.ghtkChat = ghtkChat;
}

// Debug commands
console.log('\n🤖 GHTK AI ASSISTANT DEBUG COMMANDS:');
console.log('  - ghtkChat.clearHistory()  → Clear all chat history');
console.log('  - ghtkChat.messages        → View current messages');
console.log('  - ghtkChat.toggleChat()    → Open/close chat window');

</script>

<!-- Refresh Button (Dev Tool) -->
<div class="refresh-button" id="refreshButton" title="Force Refresh Videos">
    <div class="tooltip">Force Refresh Videos</div>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
        <path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/>
    </svg>
</div>

<!-- GHTK AI Assistant Widget -->
<div id="ghtk-chat-widget">
    <!-- Chat Launcher Button -->
    <button id="chat-launcher" aria-label="Open GHTK Assistant">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z"/>
            <circle cx="12" cy="10" r="1.5"/>
            <circle cx="8" cy="10" r="1.5"/>
            <circle cx="16" cy="10" r="1.5"/>
        </svg>
    </button>

    <!-- Chat Window -->
    <div id="chat-window">
        <!-- Header -->
        <div id="chat-header">
            <div id="chat-header-left">
                <div id="chat-header-logo">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-13h2v6h-2zm0 8h2v2h-2z"/>
                    </svg>
                </div>
                <div>
                    <h3 id="chat-header-title">Trợ lý Quy trình</h3>
                    <p id="chat-header-subtitle">GHTK AI Assistant</p>
                </div>
            </div>
            <button id="chat-close" aria-label="Close chat">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none">
                    <path d="M18 6L6 18M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </button>
        </div>

        <!-- Messages Area -->
        <div id="chat-messages">
            <div class="welcome-message">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/>
                </svg>
                <h3>Xin chào! Tôi là trợ lý AI của GHTK</h3>
                <p>Tôi có thể giúp bạn tìm hiểu về quy trình phân phối.<br>Hãy hỏi tôi bất cứ điều gì!</p>
            </div>
        </div>

        <!-- Quick Action Chips -->
        <div id="chat-quick-actions">
            <button class="quick-action-chip" data-question="Tóm tắt quy trình ONBOARD">📋 Tóm tắt ONBOARD</button>
            <button class="quick-action-chip" data-question="Quy trình Đăng đơn như thế nào?">📦 Quy trình Đăng đơn</button>
            <button class="quick-action-chip" data-question="Lưu ý khi Trả hàng">⚠️ Lưu ý Trả hàng</button>
            <button class="quick-action-chip" data-question="Quy trình tại Hub">🏢 Quy trình Hub</button>
        </div>

        <!-- Input Area -->
        <div id="chat-input-container">
            <textarea
                id="chat-input"
                placeholder="Hỏi về quy trình phân phối..."
                rows="1"
                maxlength="500"
            ></textarea>
            <button id="chat-send" aria-label="Send message">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
                </svg>
            </button>
        </div>
    </div>
</div>

</body></html>